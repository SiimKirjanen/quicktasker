(()=>{"use strict";var e,t,s,a={7115:(e,t,s)=>{const a=window.wp.element;var n=s(790),i=s(9571);const o=window.wp.i18n;class r extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){var e;return this.state.hasError?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-h-screen wpqt-items-center wpqt-justify-center wpqt-text-center wpqt-text-lg",children:[(0,o.__)("Something went wrong. Please refresh the page.","quicktasker"),(0,n.jsx)("br",{}),null===(e=this.state.error)||void 0===e?void 0:e.message]}):this.props.children}}const c=r;function l({children:e,description:t=null,icon:s=null}){return(0,n.jsx)("div",{className:"wpqt-mb-6 wpqt-inline-grid wpqt-grid-cols-[auto_auto] wpqt-items-center wpqt-gap-2",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("h1",{children:[e,s&&(0,n.jsx)("span",{className:"wpqt-ml-1 wpqt-align-middle",children:s})]}),t&&(0,n.jsx)("div",{children:t})]})})}const d=window.wp.apiFetch;var u=s.n(d);function p(){return{"Content-Type":"application/json","X-WPQT-API-Nonce":window.wpqt.apiNonce}}function w(e,t,s){return u()({path:`/wpqt/v1/tasks/${e}/move`,method:"PATCH",data:{stageId:t,order:s},headers:p()})}function h(e,t,s){const a=new URLSearchParams({typeId:e,type:t,isPrivate:s.toString()}).toString();return u()({path:`/wpqt/v1/comments?${a}`,method:"GET",headers:p()})}function m(e,t,s,a){return u()({path:"/wpqt/v1/comments",data:{comment:a,typeId:e,type:t,isPrivate:s},method:"POST",headers:p()})}function q(e,t){const s=new URLSearchParams({typeId:e,type:t});return u()({path:`/wpqt/v1/logs?${s.toString()}`,method:"GET",headers:p()})}function v(e,t,s){return u()({path:`/wpqt/v1/users/${e}/tasks/${t}`,method:"DELETE",data:{user_type:s},headers:p()})}function x(e,t,s){const a=new URLSearchParams({entityId:e,entityType:t,active:String(s)});return u()({path:`/wpqt/v1/custom-fields?${a.toString()}`,method:"GET",headers:p()})}const f="SET_LOADING",_="SET_PIPELINE",g="MOVE_TASK",k="ADD_TASK",j="ADD_STAGE",y="DELETE_STAGE",b="EDIT_TASK",T="EDIT_STAGE",E="ADD_PIPELINE",S="EDIT_PIPELINE",A="SET_PRIMARY",N="SET_PIPELINES",C="ADD_USER_TO_TASK",O="REMOVE_USER_FROM_TASK",I="CHANGE_TASK_DONE_STATUS",D="REMOVE_PIPELINE",P="REMOVE_ACTIVE_PIPELINE",L="REMOVE_TASK",R="TOGGLE_VIEW",U="ADD_LABEL_TO_TASK",M="REMOVE_LABEL_FROM_TASK",F="EDIT_PIPELINE_LABEL",z="REMOVE_PIPELINE_LABEL",K="SET_STAGE_FILTER",$="SET_USER_FILTER",V="OPEN_EDIT_TASK_MODAL",B="CLOSE_TASK_MODAL",G="OPEN_NEW_STAGE_MODAL",H="CLOSE_STAGE_MODAL",W="OPEN_STAGE_EDIT_MODAL",Q="OPEN_NEW_PIPELINE_MODAL",Y="OPEN_EDIT_PIPELINE_MODAL",X="CLOSE_PIPELINE_EDIT_MODAL",J="CLOSE_USER_MODAL",Z="OPEN_EDIT_USER_MODAL",ee="ADD_ASSIGNED_USER_TO_EDITING_TASK",te="REMOVE_ASSIGNED_USER_FROM_EDITING_TASK",se="CHANGE_USER_SETTINGS_MODAL_OPEN",ae="OPEN_MOVE_TASK_MODAL",ne="CLOSE_MOVE_TASK_MODAL",ie="SET_ARCHIVE_TASKS",oe="SET_ARCHIVE_SEARCH_VALUE",re="SET_ARCHIVE_FILTERED_PIPELINE",ce="REMOVE_ARCHIVED_TASK",le="ADD_ASSIGNED_USER_TO_ARCHIVED_TASK",de="REMOVE_ASSINGED_USER_FROM_ARCHIVED_TASK",ue="CHANGE_ARCHIVED_TASK_DONE_STATUS",pe="EDIT_ARCHIVED_TASK",we="CHANGE_ARCHIVE_TASK_DONE_FILTER",he="ADD_LABEL_ARCHIVED_TASK",me="REMOVE_LABEL_ARCHIVED_TASK",qe="SET_USERS",ve="SET_WP_USERS",xe="ADD_USER",fe="SET_USERS_SEARCH_VALUE",_e="EDIT_USER",ge="DELETE_USER",ke="CHANGE_USER_STATUS",je="RESET_PASSWORD",ye="INIT_APP_STATE",be="SET_CUSTOM_USER_PAGE_STYLES",Te="SET_FULL_PAGE_LOADING",Ee="SET_USER_SESSIONS_SEARCH_VALUE",Se="SET_USER_SESSIONS",Ae="CHANGE_USER_SESSION_STATUS",Ne="DELETE_USER_SESSION",Ce="SET_USER_TASKS",Oe="SET_USER_TASKS_SEARCH_VALUE",Ie="REMOVE_USER_TASK",De="EDIT_USER_TASK",Pe="SET_USER_TASKS_FILTERED_PIPELINE",Le="ADD_ASSIGNED_USER_TO_USER_TASK",Re="REMOVE_ASSIGNED_USER_FROM_USER_TASK",Ue="CHANGE_USER_TASK_DONE_STATUS",Me="SET_CUSTOM_FIELDS",Fe="ADD_CUSTOM_FIELD",ze="DELETE_CUSTOM_FIELD",Ke="SET_CUSTOM_FIELD_LOADING",$e="SET_CUSTOM_FIELD_INITIAL_DATA",Ve="SET_LABELS",Be="ADD_LABEL",Ge="REMOVE_LABEL",He="EDIT_LABEL",We="SET_LABEL_ACTION_STATE_SELECTION",Qe="SET_LABEL_ACTION_STATE_EDITING",Ye="SET_LABEL_ACTION_STATE_CREATION",Xe="RESET_LABEL_CONTEXT",Je="SET_PIPELINE_AUTOMATIONS",Ze="SET_PIPELINE_AUTOMATIONS_LOADING",et="REMOVE_PIPELINE_AUTOMATION",tt="ADD_PIPELINE_AUTOMATION",st="SET_META",at="SET_ACTION_TARGET",nt="RESET_AUTOMATION_TO_TARGET",it="RESET_AUTOMATION_TO_TRIGGER",ot="RESET_AUTOMATION_TO_ACTION",rt="SET_UPLOADS",ct="ADD_UPLOAD",lt="REMOVE_UPLOAD",dt=!1,ut=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","text/plain","image/jpeg","image/png","image/gif","image/bmp","image/svg+xml","audio/mpeg","audio/wav","audio/ogg","video/mp4","video/webm","video/ogg","application/zip","application/x-rar-compressed","application/x-tar","application/gzip"],pt=26214400,wt=/^[a-zA-Z0-9_\-.]+$/;var ht,mt,qt,vt,xt;function ft(e){return!e.user_type||e.user_type===ht.QUICKTASKER}function _t(e){return e.user_type===ht.WP_USER}!function(e){e.QUICKTASKER="quicktasker",e.WP_USER="wp-user"}(ht||(ht={})),function(e){e.TASK_DONE="task-done",e.Task_NOT_DONE="task-not-done",e.TASK_CREATED="task-created",e.TASK_DELETED="task-deleted",e.TASK_ASSIGNED="task-assigned",e.TASK_UNASSIGNED="task-unassigned",e.TASK_PUBLIC_COMMENT_ADDED="task-public-comment-added",e.TASK_PRIVATE_COMMENT_ADDED="task-private-comment-added",e.TASK_FILE_UPLOADED="task-attachment-added",e.TASK_FILE_DELETED="task-attachment-deleted"}(mt||(mt={})),function(e){e.PIPELINE="pipeline",e.Stage="stage",e.Task="task",e.quicktasker="quicktasker"}(qt||(qt={})),function(e){e.PIPELINE="pipeline",e.STAGE="stage",e.TASK="task",e.QUICKTASKER="quicktasker",e.WP_USER="wp-user"}(vt||(vt={})),function(e){e.ARCHIVE_TASK="archive-task",e.ASSIGN_USER="assign-user",e.NEW_ENTITY_EMAIL="new-entity-email",e.DELETED_ENTITY_EMAIL="deleted-entity-email",e.TASK_ASSIGNED_EMAIL="task-assigned-email",e.TASK_UNASSIGNED_EMAIL="task-unassigned-email",e.TASK_PUBLIC_COMMENT_ADDED_EMAIL="task-public-comment-added-email",e.TASK_PRIVATE_COMMENT_ADDED_EMAIL="task-private-comment-added-email",e.TASK_FILE_UPLOADED_EMAIL="task-attachment-added-email",e.TASK_FILE_DELETED_EMAIL="task-attachment-deleted-email"}(xt||(xt={}));const gt=e=>Object.assign(Object.assign({},e),{is_active:"1"===e.is_active,has_password:"1"===e.has_password}),kt=e=>{switch(e){case vt.QUICKTASKER:return ht.QUICKTASKER;case vt.WP_USER:return ht.WP_USER;default:return null}},jt={[ht.QUICKTASKER]:"Quicktasker",[ht.WP_USER]:"WordPress User"},yt=e=>Object.assign(Object.assign({},e),{task_order:Number(e.task_order),free_for_all:"1"===e.free_for_all,is_archived:"1"===e.is_archived,is_done:"1"===e.is_done,assigned_users:e.assigned_users?e.assigned_users.map((e=>Object.assign({},gt(e)))):[]}),bt=(e,t)=>{var s,a,n,i,o,r,c;switch(t.type){case ie:{const s=t.payload;return Object.assign(Object.assign({},e),{archivedTasks:s.map(yt)})}case oe:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveSearchValue:s})}case re:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveFilteredPipelineId:s})}case ce:{const a=(null!==(s=e.archivedTasks)&&void 0!==s?s:[]).filter((e=>e.id!==t.payload));return Object.assign(Object.assign({},e),{archivedTasks:a})}case le:{const{taskId:s,user:n}=t.payload,i=(null!==(a=e.archivedTasks)&&void 0!==a?a:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:ft(n)?[n,...e.assigned_users]:e.assigned_users,assigned_wp_users:_t(n)?[n,...e.assigned_wp_users]:e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{archivedTasks:i})}case de:{const{taskId:s,user:a}=t.payload,i=(null!==(n=e.archivedTasks)&&void 0!==n?n:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:ft(a)?e.assigned_users.filter((e=>e.id!==a.id)):e.assigned_users,assigned_wp_users:_t(a)?e.assigned_wp_users.filter((e=>e.id!==a.id)):e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{archivedTasks:i})}case ue:{const{taskId:s,done:a}=t.payload,n=(null!==(i=e.archivedTasks)&&void 0!==i?i:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case pe:{const s=t.payload,a=(null!==(o=e.archivedTasks)&&void 0!==o?o:[]).map((e=>e.id===s.id?yt(s):e));return Object.assign(Object.assign({},e),{archivedTasks:a})}case we:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveTaskDoneFilter:s})}case he:{const{taskId:s,label:a}=t.payload,n=(null!==(r=e.archivedTasks)&&void 0!==r?r:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:[...e.assigned_labels,a]}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case me:{const{taskId:s,labelId:a}=t.payload,n=(null!==(c=e.archivedTasks)&&void 0!==c?c:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:e.assigned_labels.filter((e=>e.id!==a))}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}default:return e}};var Tt,Et,St,At;!function(e){e.Task="task",e.User="user"}(Tt||(Tt={})),function(e){e.System="system",e.Admin="admin",e.WPQTUser="quicktasker_user",e.Automation="automation"}(Et||(Et={})),function(e){e.All="all",e.Completed="completed",e.NotCompleted="not completed"}(St||(St={})),function(e){e.Admin="administrator",e.Other="other"}(At||(At={}));const Nt=(e,t)=>{if(t.type===Te){const s=t.payload;return Object.assign(Object.assign({},e),{fullPageLoading:s})}return e},Ct={fullPageLoading:!1},Ot=(0,a.createContext)({state:Ct,loadingDispatch:()=>{}}),It=({children:e})=>{const[t,s]=(0,a.useReducer)(Nt,Ct);return(0,n.jsx)(Ot.Provider,{value:{state:t,loadingDispatch:s},children:e})};const Dt={archivedTasks:null,archiveLoading:!1,archiveSearchValue:"",archiveFilteredPipelineId:"",archiveTaskDoneFilter:St.All},Pt=(0,a.createContext)({state:Dt,archiveDispatch:()=>{}}),Lt=({children:e})=>{const[t,s]=(0,a.useReducer)(bt,Dt),{loadingDispatch:r}=(0,a.useContext)(Ot);(0,a.useEffect)((()=>{c()}),[]);const c=()=>{return e=void 0,t=void 0,n=function*(){try{r({type:Te,payload:!0});const{data:e}=yield u()({path:"/wpqt/v1/tasks/archived",method:"GET",headers:p()});s({type:ie,payload:e})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch archived tasks","quicktasker"))}finally{r({type:Te,payload:!1})}},new((a=void 0)||(a=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}c((n=n.apply(e,t||[])).next())}));var e,t,a,n};return(0,n.jsx)(Pt.Provider,{value:{state:t,archiveDispatch:s},children:e})};var Rt;!function(e){e.SELECTION="select",e.CREATION="create",e.EDIT="edit"}(Rt||(Rt={}));const Ut=(e,t)=>{switch(t.type){case Ve:return Object.assign(Object.assign({},e),{labels:t.payload});case Be:return Object.assign(Object.assign({},e),{labels:e.labels?[...e.labels,t.payload]:[t.payload],labelActionState:Rt.SELECTION});case He:return Object.assign(Object.assign({},e),{labels:e.labels?e.labels.map((e=>e.id===t.payload.id?t.payload:e)):[t.payload]});case Ge:return Object.assign(Object.assign({},e),{labels:e.labels?e.labels.filter((e=>e.id!==t.payload.id)):[]});case We:return Object.assign(Object.assign({},e),{labelActionState:Rt.SELECTION,labelToEdit:null});case Qe:return Object.assign(Object.assign({},e),{labelActionState:Rt.EDIT,labelToEdit:t.payload});case Ye:return Object.assign(Object.assign({},e),{labelActionState:Rt.CREATION,labelToEdit:null});case Xe:return Mt;default:return e}},Mt={labels:null,labelActionState:Rt.SELECTION,labelToEdit:null},Ft=(0,a.createContext)({state:Mt,labelDispatch:()=>{}}),zt=({children:e})=>{const[t,s]=(0,a.useReducer)(Ut,Mt);return(0,n.jsx)(Ft.Provider,{value:{state:t,labelDispatch:s},children:e})};var Kt=s(6061);function $t({width:e="80",height:t="80",className:s="",color:a="#1d4ed8",secondaryColor:i="#2563eb"}){return(0,n.jsx)(Kt.BM,{visible:!0,height:t,width:e,color:a,secondaryColor:i,ariaLabel:"oval-loading",wrapperStyle:{},wrapperClass:s})}function Vt(){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-h-screen-minus-top-bar wpqt-flex-col wpqt-items-center wpqt-justify-center",children:(0,n.jsx)($t,{})})}function Bt({className:e,ovalSize:t}){const s=t?{width:t,height:t}:{};return(0,n.jsx)("div",{className:`wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center ${e}`,children:(0,n.jsx)($t,Object.assign({},s))})}function Gt({children:e}){const{state:{fullPageLoading:t}}=(0,a.useContext)(Ot);return(0,n.jsx)("div",{className:"wpqt-pr-4",children:t?(0,n.jsx)(Vt,{}):e})}var Ht=s(2912);const Wt=e=>Object.assign(Object.assign({},e),{allow_only_last_stage_task_done:"1"===e.allow_only_last_stage_task_done}),Qt=e=>Object.assign(Object.assign({},e),{stage_order:Number(e.stage_order),tasks:(e.tasks||[]).map((e=>Object.assign({},yt(e))))}),Yt=(e,t)=>{var s;switch(t.type){case N:{const s=t.payload,a=e=>Object.assign({},Qt(e)),n=e=>{var t;return Object.assign(Object.assign({},e),{stages:null===(t=e.stages)||void 0===t?void 0:t.map(a),settings:e.settings?Wt(e.settings):void 0,is_primary:"1"===e.is_primary})};return Object.assign(Object.assign({},e),{pipelines:s.map(n)})}case E:{const a=t.payload,n=e=>Object.assign({},Qt(e)),i=Object.assign(Object.assign({},a),{stages:null===(s=a.stages)||void 0===s?void 0:s.map(n),settings:a.settings?Wt(a.settings):void 0,is_primary:!1});return Object.assign(Object.assign({},e),{pipelines:[...e.pipelines,i]})}case A:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.map((e=>Object.assign(Object.assign({},e),{is_primary:e.id===s})))})}case S:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.map((e=>e.id===s.id?s:e))})}case D:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.filter((e=>e.id!==s))})}default:return e}},Xt={pipelines:[]},Jt=(0,a.createContext)({state:Xt,pipelinesDispatch:()=>{}}),Zt=({children:e})=>{const[t,s]=(0,a.useReducer)(Yt,Xt);return(0,a.useEffect)((()=>{const e=window.wpqt.initialPipelines;s({type:N,payload:e})}),[]),(0,n.jsx)(Jt.Provider,{value:{state:t,pipelinesDispatch:s},children:e})};var es=s(3482);function ts({options:e,selectedOptionValue:t,onSelectionChange:s,allSelector:a=!0,className:i="",allSelectorLabel:o="All boards",id:r}){return(0,n.jsxs)(es.l,{id:r,value:t,onChange:e=>{const t=e.target.value;s(t)},className:`!wpqt-rounded-lg !wpqt-border !wpqt-border-solid !wpqt-border-qtBorder !wpqt-px-2 !wpqt-pr-6 !wpqt-py-1 focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${i}`,children:[a&&(0,n.jsx)("option",{value:"",children:o}),e.map((e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value)))]})}function ss({selectedOptionValue:e,selectionChange:t,extraOptions:s=[]}){const{state:{pipelines:i}}=(0,a.useContext)(Jt),o=(0,a.useMemo)((()=>i.map((e=>({value:e.id,label:e.name})))),[i]);return(0,n.jsx)(ts,{options:[...o,...s],selectedOptionValue:e,onSelectionChange:t})}function as({children:e,title:t,childrenClassName:s="",titleClassName:a=""}){return(0,n.jsxs)("div",{className:"wpqt-mb-8",children:[(0,n.jsx)("div",{className:`wpqt-mb-3 wpqt-text-lg wpqt-text-center ${a}`,children:t}),(0,n.jsx)("div",{className:`wpqt-flex wpqt-gap-4 wpqt-items-center wpqt-justify-center ${s}`,children:e})]})}function ns(){const{state:{archiveSearchValue:e,archiveFilteredPipelineId:t,archiveTaskDoneFilter:s},archiveDispatch:i}=(0,a.useContext)(Pt);return(0,n.jsxs)(as,{title:(0,o.__)("Archive filtering","quicktasker"),children:[(0,n.jsx)(Ht.p,{type:"text",value:e,onChange:e=>{i({type:oe,payload:e.target.value})}}),(0,n.jsx)(ss,{selectedOptionValue:t,selectionChange:e=>{i({type:re,payload:e})},extraOptions:[{value:"DELETED",label:(0,o.__)("DELETED","quicktasker")}]}),(0,n.jsx)(ts,{allSelector:!1,selectedOptionValue:s,options:[{label:(0,o.__)("All status","quicktasker"),value:St.All},{label:(0,o.__)("Completed","quicktasker"),value:St.Completed},{label:(0,o.__)("Not completed","quicktasker"),value:St.NotCompleted}],onSelectionChange:e=>{const t=(e=>{switch(e){case St.All:return St.All;case St.Completed:return St.Completed;case St.NotCompleted:return St.NotCompleted;default:throw new Error(`Invalid selection: ${e}`)}})(e);i({type:we,payload:t})}})]})}const is=(e,t)=>{var s,a,n,i,o,r,c,l,d,u,p,w,h,m;switch(t.type){case f:return Object.assign(Object.assign({},e),{loading:t.payload});case _:{const s=t.payload,a=(s.stages||[]).map((e=>Object.assign({},Qt(e)))),n=s.settings?Wt(s.settings):void 0;return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},s),{stages:a,settings:n,is_primary:"1"===s.is_primary})})}case g:{if(!e.activePipeline||!e.activePipeline.stages)return e;const s=((e,t,s)=>{const a=[...e],n=a.find((e=>e.id===t.droppableId)),i=a.find((e=>e.id===s.droppableId));if((null==n?void 0:n.tasks)&&(null==i?void 0:i.tasks)){const[e]=n.tasks.splice(t.index,1);i.tasks.splice(s.index,0,e)}return a})(e.activePipeline.stages,t.payload.source,t.payload.destination);return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:s})})}case"REORDER_TASK":{const{source:n,destination:i}=t.payload,o=i.droppableId,r=i.index;if(!e.activePipeline)return e;const c=null===(s=e.activePipeline.stages)||void 0===s?void 0:s.find((e=>e.id===o));if(!c||!c.tasks)return e;const l=((e,t,s)=>{const a=[...e],[n]=a.splice(t,1);return a.splice(s,0,n),a})(c.tasks,n.index,r),d=null===(a=e.activePipeline.stages)||void 0===a?void 0:a.map((e=>e.id===o?Object.assign(Object.assign({},e),{tasks:l}):e));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:d})})}case k:{const s=yt(t.payload);return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:null===(n=e.activePipeline.stages)||void 0===n?void 0:n.map((e=>e.id===s.stage_id?Object.assign(Object.assign({},e),{tasks:[...e.tasks||[],s]}):e))})}):e}case b:{const s=yt(t.payload);if(!e.activePipeline)return e;const a=null===(i=e.activePipeline.stages)||void 0===i?void 0:i.map((e=>{var t;return e.id===s.stage_id?Object.assign(Object.assign({},e),{tasks:null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s.id?s:e))}):e}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case j:{const{stage:s}=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:[...e.activePipeline.stages||[],s]})}):e}case T:{const s=t.payload;if(!e.activePipeline)return e;const a=e=>e.id===s.id?Object.assign(Object.assign({},e),{name:s.name,description:s.description}):e,n=null===(o=e.activePipeline.stages)||void 0===o?void 0:o.map(a);return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case y:{const s=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:null===(r=e.activePipeline.stages)||void 0===r?void 0:r.filter((e=>e.id!==s))})}):e}case C:{const{taskId:s,user:a}=t.payload;if(!e.activePipeline)return e;const n=null===(c=e.activePipeline.stages)||void 0===c?void 0:c.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>{if(e.id===s){const t=ft(a)?[a,...e.assigned_users||[]]:e.assigned_users||[],s=_t(a)?[a,...e.assigned_wp_users||[]]:e.assigned_wp_users||[];return Object.assign(Object.assign({},e),{assigned_users:t,assigned_wp_users:s})}return e}));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case O:{const{taskId:s,userId:a,userType:n}=t.payload;if(!e.activePipeline)return e;const i=null===(l=e.activePipeline.stages)||void 0===l?void 0:l.map((e=>{var t;const i=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>{var t,i;return e.id===s?Object.assign(Object.assign({},e),{assigned_users:n===ht.QUICKTASKER?null===(t=e.assigned_users)||void 0===t?void 0:t.filter((e=>e.id!==a)):e.assigned_users,assigned_wp_users:n===ht.WP_USER?null===(i=e.assigned_wp_users)||void 0===i?void 0:i.filter((e=>e.id!==a)):e.assigned_wp_users}):e}));return Object.assign(Object.assign({},e),{tasks:i})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:i})})}case S:{const s=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{name:s.name,description:s.description,is_primary:"1"===s.is_primary})}):e}case I:{const{taskId:s,done:a}=t.payload;if(!e.activePipeline)return e;const n=null===(d=e.activePipeline.stages)||void 0===d?void 0:d.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case P:return Object.assign(Object.assign({},e),{activePipeline:null});case L:{const s=t.payload;if(!e.activePipeline)return e;const a=null===(u=e.activePipeline.stages)||void 0===u?void 0:u.map((e=>{var t;return Object.assign(Object.assign({},e),{tasks:null===(t=e.tasks)||void 0===t?void 0:t.filter((e=>e.id!==s))})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case R:return Object.assign(Object.assign({},e),{view:t.payload});case U:{const{taskId:s,label:a}=t.payload;if(!e.activePipeline)return e;const n=null===(p=e.activePipeline.stages)||void 0===p?void 0:p.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:[...e.assigned_labels||[],a]}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case M:{const{taskId:s,labelId:a}=t.payload;if(!e.activePipeline)return e;const n=null===(w=e.activePipeline.stages)||void 0===w?void 0:w.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).filter((e=>e.id!==a))}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case F:{const{label:s}=t.payload;if(!e.activePipeline)return e;const a=null===(h=e.activePipeline.stages)||void 0===h?void 0:h.map((e=>{var t;const a=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).map((e=>e.id===s.id?s:e))})));return Object.assign(Object.assign({},e),{tasks:a})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case z:{const s=t.payload;if(!e.activePipeline)return e;const a=null===(m=e.activePipeline.stages)||void 0===m?void 0:m.map((e=>{var t;const a=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).filter((e=>e.id!==s))})));return Object.assign(Object.assign({},e),{tasks:a})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}default:return e}};var os;!function(e){e.PIPELINE="PIPELINE-VIEW",e.TASK="TASK-VIEW"}(os||(os={}));const rs={loading:!1,view:os.PIPELINE,activePipeline:null},cs=(0,a.createContext)({state:rs,dispatch:()=>{},fetchAndSetPipelineData:()=>Promise.resolve()}),ls=({children:e})=>{const[t,s]=(0,a.useReducer)(is,rs),{loadingDispatch:r}=(0,a.useContext)(Ot);(0,a.useEffect)((()=>{const e=window.wpqt.initialActivePipelineId;e&&l(e,!0)}),[]);const c=(e,t)=>{t?r({type:Te,payload:e}):s({type:f,payload:e})},l=(e,...t)=>{return a=void 0,n=[e,...t],l=function*(e,t=!1){try{c(!0,t);const{data:{pipeline:a}}=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e}`,headers:p()})}(e);s({type:_,payload:a})}catch(e){console.error(e),i.oR.error((0,o.__)("Unable to load the board. Please try again later.","quicktasker"))}finally{c(!1,t)}},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{o(l.next(e))}catch(e){t(e)}}function i(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var a;t.done?e(t.value):(a=t.value,a instanceof r?a:new r((function(e){e(a)}))).then(s,i)}o((l=l.apply(a,n||[])).next())}));var a,n,r,l};return(0,n.jsx)(cs.Provider,{value:{state:t,dispatch:s,fetchAndSetPipelineData:l},children:e})};var ds=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const us={[xt.ARCHIVE_TASK]:(0,o.__)("Task archived by automation","quicktasker"),[xt.ASSIGN_USER]:(0,o.__)("User assigned by automation","quicktasker"),[xt.NEW_ENTITY_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[xt.DELETED_ENTITY_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[xt.TASK_ASSIGNED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[xt.TASK_UNASSIGNED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[xt.TASK_PUBLIC_COMMENT_ADDED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[xt.TASK_PRIVATE_COMMENT_ADDED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[xt.TASK_FILE_UPLOADED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[xt.TASK_FILE_DELETED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker")};function ps(){const{dispatch:e}=(0,a.useContext)(cs),t=e=>{e&&e.forEach((e=>{if(e.automation_action.includes("email"))return;const t=us[e.automation_action]||`Automation executed: ${e.automation_action}`;i.oR.info(t)}))},s=(t,s)=>{t&&s&&t.forEach((t=>{if(t.automation_action===xt.ARCHIVE_TASK&&e({type:L,payload:s}),t.automation_action===xt.ASSIGN_USER){const n=t.executionResult;!n||!(a=n)||"object"!=typeof a||a.user_type&&a.user_type!==ht.QUICKTASKER&&a.user_type!==ht.WP_USER||e({type:C,payload:{taskId:s,user:n}})}var a}))};return{displayAutomationMessages:t,handleExecutedAnimationsResults:s,handleExecutedAutomations:(e,a)=>{0!==e.length&&(s(e,a),t(e))},createAutomation:(e,t,s)=>ds(this,void 0,void 0,(function*(){try{const a=yield function(e,t){var s;return u()({path:`/wpqt/v1/pipelines/${e}/automations`,method:"POST",data:{automationTargetId:null,automationTarget:t.automationTarget,automationTrigger:t.automationTrigger,automationAction:null===(s=t.automationAction)||void 0===s?void 0:s.id,automationActionTargetId:t.automationActionTargetId,automationActionTargetType:t.automationActionTargetType,automationMetadata:t.metaData},headers:p()})}(e,t);i.oR.success((0,o.__)("Automation created","quicktasker")),s&&s(!0,a.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create automation","quicktasker")),s&&s(!1,null)}})),deleteAutomation:(e,t,s)=>ds(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/automations/${t}`,method:"DELETE",headers:p()})}(e,t),i.oR.success((0,o.__)("Automation deleted","quicktasker")),s&&s(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete automation","quicktasker")),s&&s(!1)}}))}}var ws=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const hs=()=>{const{handleExecutedAutomations:e}=ps(),{displayErrorMessages:t}=function(){return{displayErrorMessages:e=>{return t=this,s=void 0,n=function*(){if(e.messages&&Array.isArray(e.messages)&&e.messages.length>0){const t=e.messages.join(", ");i.oR.error(t)}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n}}}();return{deleteTask:(t,s)=>ws(void 0,void 0,void 0,(function*(){try{const a=yield function(e){return u()({path:`/wpqt/v1/tasks/${e}`,method:"DELETE",headers:p()})}(t);s&&s(),i.oR.success((0,o.__)("Task deleted","quicktasker")),e(a.data.executedAutomations,t)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete a task","quicktasker"))}})),archiveTask:(e,t)=>ws(void 0,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/tasks/${e}/archive`,method:"PATCH",headers:p()})}(e),t&&t(),i.oR.success((0,o.__)("Task archived","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to archive a task","quicktasker"))}})),restoreArchivedTask:(e,t)=>ws(void 0,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/tasks/${e}/archive-restore`,method:"PATCH",headers:p()})}(e),t&&t(),i.oR.success((0,o.__)("Task restored","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to restore a task","quicktasker"))}})),removeTaskFromUser:(t,s,a)=>ws(void 0,void 0,void 0,(function*(){try{const n=yield v(t,s,ht.QUICKTASKER);i.oR.success((0,o.__)("Task has been unassigned","quicktasker")),e(n.data.executedAutomations,s),a&&a()}catch(e){console.error(e),i.oR.error((0,o.__)("Task unassignment failed. Try again","quicktasker"))}})),changeTaskDoneStatus:(s,a,n)=>ws(void 0,void 0,void 0,(function*(){try{const t=a?(0,o.__)("Task marked as completed","quicktasker"):(0,o.__)("Task marked as incomplete","quicktasker"),r=yield function(e,t){return u()({path:`/wpqt/v1/tasks/${e}/done`,method:"PATCH",data:{done:t},headers:p()})}(s,a);n&&n(a),i.oR.success(t),e(r.data.executedAutomations,s)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change task status","quicktasker")),t(e)}})),moveTask:(e,t,s,a)=>ws(void 0,void 0,void 0,(function*(){try{yield w(e,t,s),i.oR.success((0,o.__)("Task moved","quicktasaker")),a&&a(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to move a task","quicktasker")),a&&a(!1)}}))}},ms=()=>Object.assign({},vs),qs=(e,t)=>{var s,a,n,i,o,r,c,l,d,u,p,w,h,m,q,v;switch(t.type){case V:{const{taskToEdit:s,taskModalSettings:a}=t.payload;return Object.assign(Object.assign({},e),{taskModalOpen:!0,taskToEdit:s,targetStageId:s.stage_id,taskModalSettings:Object.assign(Object.assign({},e.taskModalSettings),a)})}case B:return ms();case ee:{const d=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{assigned_users:ft(d)?[d,...null!==(a=null===(s=e.taskToEdit)||void 0===s?void 0:s.assigned_users)&&void 0!==a?a:[]]:null!==(i=null===(n=e.taskToEdit)||void 0===n?void 0:n.assigned_users)&&void 0!==i?i:[],assigned_wp_users:_t(d)?[d,...null!==(r=null===(o=e.taskToEdit)||void 0===o?void 0:o.assigned_wp_users)&&void 0!==r?r:[]]:null!==(l=null===(c=e.taskToEdit)||void 0===c?void 0:c.assigned_wp_users)&&void 0!==l?l:[]})})}case te:{const s=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{assigned_users:ft(s)?(null!==(u=null===(d=e.taskToEdit)||void 0===d?void 0:d.assigned_users)&&void 0!==u?u:[]).filter((e=>e.id!==s.id)):null!==(w=null===(p=e.taskToEdit)||void 0===p?void 0:p.assigned_users)&&void 0!==w?w:[],assigned_wp_users:_t(s)?(null!==(m=null===(h=e.taskToEdit)||void 0===h?void 0:h.assigned_wp_users)&&void 0!==m?m:[]).filter((e=>e.id!==s.id)):null!==(v=null===(q=e.taskToEdit)||void 0===q?void 0:q.assigned_wp_users)&&void 0!==v?v:[]})})}case G:{const{targetPipelineId:s}=t.payload;return Object.assign(Object.assign({},e),{stageModalOpen:!0,targetPipelineId:s})}case W:{const{stageToEdit:s}=t.payload;return Object.assign(Object.assign({},e),{stageModalOpen:!0,stageToEdit:s})}case H:return ms();case Q:return Object.assign(Object.assign({},e),{newPipelineModalOpen:!0});case Y:{const{pipelineToEdit:s}=t.payload;return Object.assign(Object.assign({},e),{pipelineModalOpen:!0,pipelineToEdit:s})}case X:return ms();case"OPEN_ARCHIVE_TASK_MODAL":{const s=t.payload;return Object.assign(Object.assign({},e),{archiveTaskModalOpen:!0,archiveModalTask:s})}case"CLOSE_ARCHIVE_TASK_MODAL":return ms();case"OPEN_NEW_USER_MODAL":return Object.assign(Object.assign({},e),{userModalOpen:!0});case Z:{const s=t.payload;return Object.assign(Object.assign({},e),{userModalOpen:!0,userToEdit:s})}case J:return ms();case se:return t.payload?Object.assign(Object.assign({},e),{userSettingsModalOpen:!0}):ms();case"CHANGE_TASK_DONE_STATUS":{const{done:s}=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{is_done:s})})}case ae:{const{task:s}=t.payload;return Object.assign(Object.assign({},e),{moveTaskModalOpen:!0,taskToEdit:s})}case ne:return ms();default:return e}},vs={taskModalOpen:!1,targetStageId:"",taskToEdit:null,taskModalSettings:{allowToMarkTaskAsDone:!0},moveTaskModalOpen:!1,stageModalOpen:!1,stageToEdit:null,targetPipelineId:"",pipelineModalOpen:!1,newPipelineModalOpen:!1,pipelineToEdit:null,archiveTaskModalOpen:!1,archiveModalTask:null,userModalOpen:!1,userToEdit:null,userSettingsModalOpen:!1},xs=(0,a.createContext)({state:vs,modalDispatch:()=>{}}),fs=({children:e})=>{const[t,s]=(0,a.useReducer)(qs,vs);return(0,n.jsx)(xs.Provider,{value:{state:t,modalDispatch:s},children:e})},_s=(e,t)=>{switch(t.type){case qe:{const s=t.payload.map(gt);return Object.assign(Object.assign({},e),{users:s})}case ve:{const s=t.payload.map((e=>Object.assign(Object.assign({},e),{id:String(e.id)})));return Object.assign(Object.assign({},e),{wpUsers:s})}case xe:{const s=t.payload,a=gt(s);return Object.assign(Object.assign({},e),{users:[...e.users,a]})}case _e:{const s=t.payload,a=gt(s),n=e.users.map((e=>e.id===a.id?a:e));return Object.assign(Object.assign({},e),{users:n})}case ke:{const{isActive:s,userId:a}=t.payload,n=e.users.map((e=>e.id===a?Object.assign(Object.assign({},e),{is_active:s}):e));return Object.assign(Object.assign({},e),{users:n})}case je:{const s=t.payload,a=e.users.map((e=>e.id===s?Object.assign(Object.assign({},e),{has_password:!1}):e));return Object.assign(Object.assign({},e),{users:a})}case ge:{const s=t.payload,a=e.users.filter((e=>e.id!==s));return Object.assign(Object.assign({},e),{users:a})}case fe:{const s=t.payload;return Object.assign(Object.assign({},e),{usersSearchValue:s})}default:return e}};var gs=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const ks={users:[],wpUsers:[],usersSearchValue:""},js=(0,a.createContext)({state:ks,userDispatch:()=>{},updateUsers:()=>gs(void 0,void 0,void 0,(function*(){}))}),ys=({children:e})=>{const[t,s]=(0,a.useReducer)(_s,ks);return(0,a.useEffect)((()=>{const e=window.wpqt.initialUsers,t=window.wpqt.initialWPUsers;s({type:qe,payload:e}),s({type:ve,payload:t})}),[]),(0,n.jsx)(js.Provider,{value:{state:t,userDispatch:s,updateUsers:()=>gs(void 0,void 0,void 0,(function*(){try{const e=yield u()({path:"/wpqt/v1/users",method:"GET",headers:p()});s({type:qe,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch users","quicktasker"))}}))},children:e})};var bs;!function(e){e.ACTIVE_PIPELINE="ACTIVE_PIPELINE",e.PIPELINES="PIPELINES",e.USER="USER"}(bs||(bs={}));const Ts=e=>{const[t,s]=(0,a.useState)(!1),n=(0,a.useRef)(null),{modalDispatch:i}=(0,a.useContext)(xs),{dispatch:o}=(0,a.useContext)(cs),{pipelinesDispatch:r}=(0,a.useContext)(Jt),{userDispatch:c}=(0,a.useContext)(js);return{modalSaving:t,setModalSaving:s,modalContentRef:n,closeModal:()=>{i({type:e}),n.current&&n.current.clearContent()},handleSuccess:(e,t,a)=>{let n;switch(a){case bs.PIPELINES:n=r;break;case bs.ACTIVE_PIPELINE:n=o;break;case bs.USER:n=c;break;default:n=o}s(!1),n({type:e,payload:t})},handleError:e=>{s(!1),console.error(e)}}},Es=(e,t)=>{switch(t.type){case rt:return Object.assign(Object.assign({},e),{uploads:t.payload});case ct:return Object.assign(Object.assign({},e),{uploads:[...e.uploads,t.payload]});case lt:return Object.assign(Object.assign({},e),{uploads:e.uploads.filter((e=>e.id!==t.payload))});default:return e}},Ss={uploads:[]},As=(0,a.createContext)({state:Ss,uploadDispatch:()=>{}}),Ns=({children:e})=>{const[t,s]=(0,a.useReducer)(Es,Ss);return(0,n.jsx)(As.Provider,{value:{state:t,uploadDispatch:s},children:e})};var Cs,Os,Is=s(2922),Ds=s(6053),Ps=s(9828),Ls=s(540),Rs=s(4576),Us=s(5138),Ms=s(7008);function Fs({id:e}){return(0,n.jsx)(Ms.m_,{id:e,className:"wpqt-bg-red-600",children:(0,n.jsx)("span",{children:"Tooltip content"})})}function zs({onClick:e=()=>{},btnText:t,className:s,type:a=Cs.BUTTON,disabled:i=!1,loading:o=!1,buttonStyleType:r=Os.PRIMARY}){const c=r===Os.PRIMARY?"wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-transparent wpqt-bg-blue-500 wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-text-white wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 focus:wpqt-ring-blue-800 enabled:hover:wpqt-bg-blue-600":r===Os.SECONDARY?"wpqt-inline-flex wpqt-cursor-pointer wpqt-bg-gray-100 wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 enabled:hover:wpqt-bg-gray-200":"wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-transparent wpqt-bg-red-500 wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-text-white wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 focus:wpqt-ring-red-800 enabled:hover:wpqt-bg-red-600";return(0,n.jsx)(Us.$,{disabled:i||o,className:`${c} ${s}`,onClick:e,type:a,children:o?(0,n.jsx)($t,{width:"24",height:"24",color:"#ffffff",secondaryColor:"#ffffff"}):t})}function Ks({icon:e,text:t,onClick:s=()=>{},className:a,tooltipId:i,tooltipText:o,loading:r=!1}){const c=o&&i,l=c?{"data-tooltip-id":i,"data-tooltip-content":o,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info"}:{};return(0,n.jsxs)("div",Object.assign({},l,{className:`wpqt-main-border wpqt-relative wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-bg-gray-100 wpqt-p-2 hover:wpqt-bg-white ${a}`,onClick:s,children:[e,t||r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center wpqt-relative",children:[t&&(0,n.jsx)("span",{className:"wpqt-whitespace-nowrap "+(r?"wpqt-invisible":""),children:t}),r&&(0,n.jsx)($t,{width:"20",height:"20",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"})]}):null,c&&(0,n.jsx)(Fs,{id:i})]}))}function $s({icon:e,onClick:t=()=>{},className:s,loading:a=!1}){return(0,n.jsxs)("div",{className:`wpqt-main-border wpqt-p-1 wpqt-relative wpqt-inline-flex wpqt-cursor-pointer wpqt-bg-gray-100 hover:wpqt-bg-white ${s}`,onClick:t,children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center "+(a?"wpqt-invisible":""),children:e}),a&&(0,n.jsx)($t,{width:"20",height:"20",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"})]})}function Vs({modalOpen:e,closeModal:t,children:s,size:a="sm"}){return(0,n.jsxs)(Is.lG,{open:e,as:"div",className:"wpqt-relative wpqt-z-9999 focus:wpqt-outline-none",onClose:t,children:[(0,n.jsx)(Is.Xi,{className:"wpqt-fixed wpqt-inset-0 wpqt-bg-black/40"}),(0,n.jsx)("div",{className:"wpqt-fixed wpqt-inset-0 wpqt-z-10 wpqt-w-screen wpqt-overflow-y-auto",children:(0,n.jsx)("div",{className:"wpqt-mt-[8vh] wpqt-flex wpqt-justify-center",children:(0,n.jsxs)(Is.Lj,{transition:!0,className:`data-[closed]:wpqt-transform-[wpqt-scale(95%)] wpqt-relative wpqt-mt-[20px] wpqt-w-4/5 ${{sm:"wpqt-max-w-sm",md:"wpqt-max-w-lg",lg:"wpqt-max-w-4xl",xl:"wpqt-max-w-6xl"}[a]} wpqt-rounded-xl wpqt-bg-white wpqt-p-8 wpqt-backdrop-blur-2xl wpqt-duration-300 wpqt-ease-out data-[closed]:wpqt-opacity-0`,children:[(0,n.jsx)("div",{className:"wpqt-group wpqt-absolute wpqt-right-[-20px] wpqt-top-[-20px] wpqt-flex wpqt-h-[40px] wpqt-w-[40px] wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-rounded-full wpqt-border wpqt-border-solid wpqt-bg-white wpqt-text-qtBorder",onClick:t,children:(0,n.jsx)(Rs.A,{className:"wpqt-icon-blue group-hover:wpqt-icon-red wpqt-size-5"})}),s]})})})]})}function Bs({children:e}){return(0,n.jsx)(Is.L3,{as:"div",className:"wpqt-text-base/7 wpqt-font-medium wpqt-text-black",children:e})}function Gs({children:e}){return(0,n.jsx)(Ds.L,{children:e})}function Hs({label:e,children:t,tooltipId:s,tooltipText:a}){const i=s&&a,o=i?{"data-tooltip-id":s,"data-tooltip-content":a,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info","data-tooltip-place":"top-end"}:{};return(0,n.jsxs)(Ps.D,{className:"wpqt-mb-3",children:[(0,n.jsx)(Ls.JU,Object.assign({className:"wpqt-mb-2 wpqt-block wpqt-text-sm/6 wpqt-font-medium"},o,{children:e})),t,i&&(0,n.jsx)(Fs,{id:s})]})}function Ws({onSave:e,saveBtnText:t,loading:s=!1}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-px-2",children:(0,n.jsx)(zs,{btnText:t,loading:s,onClick:e})})}!function(e){e.BUTTON="button",e.SUBMIT="submit",e.RESET="reset"}(Cs||(Cs={})),function(e){e.PRIMARY="primary",e.SECONDARY="secondary",e.DANGER="danger"}(Os||(Os={}));var Qs=s(1489),Ys=s(8448),Xs=s(8176),Js=s(1052),Zs=s(4353),ea=s.n(Zs),ta=s(4461);function sa(){const[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1);return{loading1:e,loading2:s,setLoading1:t,setLoading2:n,loading3:i,setLoading3:o}}const aa=(e,t)=>{switch(t.type){case"SET_SITE_URL":{const s=t.payload;return Object.assign(Object.assign({},e),{siteURL:s})}case ye:{const{siteURL:s,publicUserPageId:a,timezone:n,isUserAllowedToDelete:i,userPageCustomStyles:o,pluginURL:r,taskUploadsURL:c}=t.payload;return Object.assign(Object.assign({},e),{siteURL:s,publicUserPageId:a,timezone:n,isUserAllowedToDelete:i,userPageCustomStyles:o,pluginURL:r,taskUploadsURL:c})}case be:{const s=t.payload;return Object.assign(Object.assign({},e),{userPageCustomStyles:s})}default:return e}},na={siteURL:"",pluginURL:"",publicUserPageId:"",is_customFields:!1,timezone:"",isUserAllowedToDelete:!1,userPageCustomStyles:"",taskUploadsURL:""},ia=(0,a.createContext)({state:na,appDispatch:()=>{}}),oa=({children:e})=>{const[t,s]=(0,a.useReducer)(aa,na);return(0,a.useEffect)((()=>{const e=window.wpqt.siteURL,t=window.wpqt.publicUserPageId,a=window.wpqt.timezone,n="1"===window.wpqt.isUserAllowedToDelete,i=window.wpqt.userPageCustomStyles,o=window.wpqt.pluginURL,r=window.wpqt.taskUploadsURL;s({type:ye,payload:{siteURL:e,publicUserPageId:t,timezone:a,isUserAllowedToDelete:n,userPageCustomStyles:i,pluginURL:o,taskUploadsURL:r}})}),[]),(0,n.jsx)(ia.Provider,{value:{state:t,appDispatch:s},children:e})};var ra=s(8569),ca=s.n(ra),la=s(3826),da=s.n(la);ea().extend(da()),ea().extend(ca());const ua=()=>{const{state:{timezone:e}}=(0,a.useContext)(ia);return{convertToWPTimezone:t=>((e,t)=>{try{return ea().utc(e).tz(t).format("MMMM D, YYYY HH:mm")}catch(t){return console.error("Error: ",t),e+" (UTC)"}})(t,e),convertUTCDateTimeToWPTimezone:t=>((e,t)=>{try{return ea().utc(e).tz(t).toDate()}catch(t){return console.error("Error: ",t),new Date(e)}})(t,e)}};var pa,wa,ha,ma;!function(e){e.Text="text",e.Select="select",e.Checkbox="checkbox",e.Radio="radio",e.Datetime="datetime",e.File="file"}(pa||(pa={})),function(e){e.User="user",e.Pipeline="pipeline",e.Users="users",e.Task="task"}(wa||(wa={})),function(e){e.TASK="task"}(ha||(ha={})),function(e){e.TEXT="text",e.PASSWORD="password"}(ma||(ma={}));const qa=(0,a.forwardRef)((({value:e,onChange:t,isAutoFocus:s,className:a="",wrapperClassName:i="",disabled:o=!1,type:r=ma.TEXT,loading:c=!1,inputId:l},d)=>(0,n.jsxs)("div",{className:`wpqt-inline-block wpqt-relative wpqt-mb-3 ${i}`,children:[(0,n.jsx)(Ht.p,{ref:d,autoFocus:s,className:`wpqt-block wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-3 wpqt-py-1.5 wpqt-text-sm/6 focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${a}`,value:e,disabled:o,onChange:e=>t(e.target.value),type:r,id:l}),c&&(0,n.jsx)($t,{width:"24",height:"24",className:"wpqt-absolute wpqt-right-[-32px] wpqt-top-1/2 wpqt-transform-y-center"})]})));var va=s(1062),xa=s(4164);function fa({value:e,onChange:t,rowsCount:s=3,className:a=""}){return(0,n.jsx)(va.T,{className:(0,xa.$)("wpqt-border-1 wpqt-mb-3 wpqt-block wpqt-w-auto wpqt-resize-none wpqt-rounded-lg wpqt-border-qtBorder wpqt-px-3 wpqt-py-1.5 wpqt-text-sm/6",`focus:wpqt-shadow-none focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${a}`),rows:s,value:e,onChange:e=>t(e.target.value)})}var _a=s(303);function ga({checked:e,handleChange:t}){return(0,n.jsx)(_a.A,{onChange:t,checked:e,uncheckedIcon:!1,checkedIcon:!1,height:20,width:44})}const ka=(e,t)=>{switch(t.type){case Ke:{const s=t.payload;return Object.assign(Object.assign({},e),{loading:s})}case $e:{const{entityId:s,entityType:a}=t.payload;return Object.assign(Object.assign({},e),{entityId:s,entityType:a})}case Me:{const s=t.payload;return Object.assign(Object.assign({},e),{customFields:s})}case Fe:{const s=t.payload;return Object.assign(Object.assign({},e),{customFields:[...e.customFields,s]})}case ze:{const s=t.payload,a=e.customFields.filter((e=>e.id!==s));return Object.assign(Object.assign({},e),{customFields:a})}default:return e}};const ja={customFields:[],loading:!0,entityId:"",entityType:null},ya=(0,a.createContext)({state:ja,customFieldsDispatch:()=>{},fetchCustomFields:()=>{}}),ba=({children:e,entityId:t,entityType:s})=>{const[r,c]=(0,a.useReducer)(ka,ja);(0,a.useEffect)((()=>{l()}),[]),(0,a.useEffect)((()=>{c({type:$e,payload:{entityType:s,entityId:t}})}),[s,t]);const l=()=>{return e=void 0,a=void 0,r=function*(){try{c({type:Ke,payload:!0});const e=yield x(t,s,!0);c({type:Me,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch custom fields","quicktasker"))}finally{c({type:Ke,payload:!1})}},new((n=void 0)||(n=Promise))((function(t,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}c((r=r.apply(e,a||[])).next())}));var e,a,n,r};return(0,n.jsx)(ya.Provider,{value:{state:r,customFieldsDispatch:c,fetchCustomFields:l},children:e})};var Ta=s(9197),Ea=s(2767),Sa=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Aa(){return{addCustomField:(e,t,s,a,n,r)=>Sa(this,void 0,void 0,(function*(){try{const i=yield function(e,t,s,a,n){return u()({path:"/wpqt/v1/custom-fields",method:"POST",data:{entityId:e,entityType:t,type:s,name:a,description:n},headers:p()})}(e,t,s,a,n);r&&r(i.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add a custom field","quicktasker"))}})),markCustomFieldAsDeleted:(e,t)=>Sa(this,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/custom-fields/${e}`,method:"DELETE",headers:p()})}(e),t&&t()}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to mark custom field as deleted","quicktasker"))}})),restoreCustomField:(e,t)=>Sa(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/custom-fields/${e}/restore`,method:"PATCH",headers:p()})}(e);i.oR.success((0,o.__)("Custom field restored","quicktasker")),t&&t(s.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to restore custom field","quicktasker"))}})),updateCustomFieldValue:(e,t,s,a,n)=>Sa(this,void 0,void 0,(function*(){try{yield function(e,t,s,a){return u()({path:`/wpqt/v1/custom-fields/${e}/value`,method:"PATCH",data:{value:t,entityId:String(s),entityType:a},headers:p()})}(e,t,s,a),n&&n()}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to update custom field value","quicktasker"))}}))}}function Na({title:e,description:t,className:s=""}){return(0,n.jsxs)("div",{className:`wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center wpqt-h-full ${s}`,children:[e&&(0,n.jsx)("h2",{className:"wpqt-font-semibold",children:e}),t&&(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-4",children:t}),(0,n.jsx)("div",{className:"wpqt-text-blue-500 wpqt-font-semibold",children:(0,n.jsx)("a",{href:"https://payhip.com/b/84TLC",target:"_blank",rel:"noreferrer",children:(0,o.__)("Get the premium version","quicktasker")})})]})}var Ca=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Oa({description:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(!1),[d,u]=(0,a.useState)(pa.Text),{addCustomField:p}=Aa(),{state:{entityId:w,entityType:h,customFields:m,loading:q},customFieldsDispatch:v}=(0,a.useContext)(ya),{state:{is_customFields:x}}=(0,a.useContext)(ia),[f,_]=(0,a.useState)(!1),g=[{value:pa.Text,label:"Text"},{value:pa.Checkbox,label:"Checkbox"}],k=m.length>=1&&!x;return q?null:(0,n.jsxs)("div",{className:"wpqt-mb-6 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom Fields","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-text-center",children:[e,!x&&(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[" ",(0,o.__)("Free version allows only one custom field. To add more, please upgrade to premium.","quicktasker")]})]}),c&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(qa,{value:t,onChange:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Description","quicktasker")}),(0,n.jsx)(fa,{value:i,onChange:r})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Type","quicktasker")}),(0,n.jsx)(ts,{selectedOptionValue:d,options:g,onSelectionChange:e=>{u(e)},allSelector:!1})]})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:[!k&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Ks,{text:c?(0,o.__)("Cancel","quicktasker"):(0,o.__)("Add new custom field","quicktasker"),onClick:()=>l(!c),icon:c?(0,n.jsx)(Ta.A,{className:"wpqt-icon-red wpqt-size-5"}):(0,n.jsx)(Ea.A,{className:"wpqt-icon-green wpqt-size-5"})}),c&&(0,n.jsx)(Ks,{text:(0,o.__)("Add","quicktasker"),onClick:()=>Ca(this,void 0,void 0,(function*(){w&&h?(_(!0),yield p(w,h,d,t,i,(e=>{v({type:Fe,payload:e}),s(""),r(""),u(pa.Text),l(!1)})),_(!1)):console.error("Entity ID or Entity Type is missing")})),loading:f,icon:(0,n.jsx)(Ea.A,{className:"wpqt-icon-green wpqt-size-5"})})]}),k&&(0,n.jsx)(Na,{})]})]})}var Ia=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Da({data:e,onSave:t,locationOfCustomFields:s,onDelete:i,actionLoading:r}){const{state:{isUserAllowedToDelete:c}}=(0,a.useContext)(ia),l=e.entity_type===s,d=s===wa.Task||s===wa.User,u=e.entity_type===wa.Pipeline?"board":e.entity_type;return r?(0,n.jsx)(Bt,{ovalSize:"24"}):(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-gap-2",children:[d&&(0,n.jsx)(zs,{onClick:t,btnText:(0,o.__)("Save","quicktasker")}),c&&(0,n.jsx)(Ks,Object.assign({onClick:()=>Ia(this,void 0,void 0,(function*(){l&&i()})),className:l?"":"!wpqt-cursor-not-allowed",icon:(0,n.jsx)(Xs.A,{className:"wpqt-icon-red wpqt-size-4"})},!l&&{tooltipId:`custom-field-${e.id}-delete`,tooltipText:(0,o.sprintf)((0,o.__)("This custom field is inherited from %s settings and can't be deleted here","quicktasker"),u)}))]})}var Pa=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function La({data:e}){const[t,s]=(0,a.useState)(""),{state:{entityType:i,entityId:o},customFieldsDispatch:r}=(0,a.useContext)(ya),{updateCustomFieldValue:c,markCustomFieldAsDeleted:l}=Aa(),[d,u]=(0,a.useState)(!1);let p;switch((0,a.useEffect)((()=>{e.value&&s(e.value)}),[e.value]),e.type){case pa.Text:p=(0,n.jsx)(Ra,{data:e,value:t,onChange:s});break;case pa.Checkbox:p=(0,n.jsx)(Ua,{data:e,value:t,onChange:s})}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{}),p,(0,n.jsx)(Da,{data:e,locationOfCustomFields:i,onSave:()=>Pa(this,void 0,void 0,(function*(){i===wa.User||i===wa.Task?(u(!0),yield c(e.id,t,o,i),u(!1)):console.error("Invalid entity type for saving custom field value")})),onDelete:()=>Pa(this,void 0,void 0,(function*(){u(!0),yield l(e.id,(()=>{r({type:ze,payload:e.id})})),u(!1)})),actionLoading:d})]})}function Ra({data:e,value:t,onChange:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center",children:[(0,n.jsx)(Ma,{name:e.name,description:e.description}),(0,n.jsx)(qa,{value:t,onChange:s})]})}function Ua({data:e,value:t,onChange:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(Ma,{name:e.name,description:e.description}),(0,n.jsx)("input",{type:"checkbox",checked:"true"===t,className:"!wpqt-block",onChange:e=>s(e.target.checked?"true":"false")})]})}function Ma({name:e,description:t=""}){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-mb-1 wpqt-text-base wpqt-font-semibold",children:e}),t&&(0,n.jsx)("div",{className:"wpqt-mb-2 wpqt-italic",children:t})]})}function Fa(){const{state:{loading:e,customFields:t}}=(0,a.useContext)(ya);return e?(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)($t,{width:"36",height:"36"})}):t&&0===t.length?(0,n.jsx)("div",{className:"wpqt-text-center wpqt-font-semibold",children:(0,o.__)("No related custom fields created","quicktasker")}):(0,n.jsx)("div",{className:"wpqt-my-4 wpqt-grid wpqt-grid-cols-[100px_1fr_100px] wpqt-items-center wpqt-gap-3",children:t.map((e=>(0,n.jsx)(La,{data:e},e.id)))})}var za=s(5066);const Ka={[wa.Pipeline]:(0,o.__)("Board","quicktasker"),[wa.Task]:(0,o.__)("Task","quicktasker"),[wa.User]:(0,o.__)("User","quicktasker"),[wa.Users]:(0,o.__)("Global users","quicktasker")};var $a=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Va({customField:e,refreshDeletedFields:t}){const{customFieldsDispatch:s}=(0,a.useContext)(ya),[i,r]=(0,a.useState)(!1),{restoreCustomField:c}=Aa(),{convertToWPTimezone:l}=ua();return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Name:","quicktasker")})," ",e.name]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Description:","quicktasker")})," ",e.description]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Level:","quicktasker")})," ",Ka[e.entity_type]]}),e.deleted_at&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Deleted:","quicktasker")})," ",l(e.deleted_at)]}),(0,n.jsx)("div",{children:(0,n.jsx)($s,{onClick:()=>$a(this,void 0,void 0,(function*(){r(!0),yield c(e.id,(e=>{s({type:Fe,payload:e}),t()})),r(!1)})),loading:i,icon:(0,n.jsx)(za.HCd,{className:"wpqt-icon-green wpqt-size-5"})})})]})}var Ba=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ga(){const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(!0),[c,l]=(0,a.useState)(null),{state:{entityId:d,entityType:u}}=(0,a.useContext)(ya);(0,a.useEffect)((()=>{e&&p()}),[e]);const p=()=>Ba(this,void 0,void 0,(function*(){if(d&&u)try{r(!0);const e=yield x(d,u,!1);l(e.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load deleted custom fields","quicktasker"))}finally{r(!1)}else console.error("Entity ID or Entity Type is missing")}));return(0,n.jsxs)("div",{className:"wpqt-my-3 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom Field recovery","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:(0,o.__)("Deleted custom field by accident? No worries! You can recover it here.","quicktasker")}),e&&(0,n.jsx)("div",{className:"wpqt-mb-3",children:s?(0,n.jsx)(Bt,{ovalSize:"36"}):c&&0===c.length?(0,n.jsx)("div",{className:"wpqt-text-center wpqt-font-semibold",children:(0,o.__)("No deleted custom fields","quicktasker")}):c&&c.length>0?(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:c.map((e=>(0,n.jsx)(Va,{customField:e,refreshDeletedFields:p},e.id)))}):null}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:(0,n.jsx)(Ks,{text:e?(0,o.__)("Close recovery","quicktasker"):(0,o.__)("Open recovery","quicktasker"),onClick:()=>t(!e),icon:(0,n.jsx)(za.HCd,{className:"wpqt-icon-green wpqt-size-5"})})})]})}const Ha={[wa.User]:(0,o.__)("Add user-specific custom fields. If you want to add custom fields to all users, please go to users settings.","quicktasker"),[wa.Users]:(0,o.__)("Add custom fields to all users. If you want to add custom fields to a specific user only, please go to that user settings.","quicktasker"),[wa.Pipeline]:(0,o.__)("Add board level custom fields.","quicktasker"),[wa.Task]:(0,o.__)("Add task-specific custom fields. If you want to add custom fields to all tasks in this board, please go to board settings.","quicktasker")},Wa={[wa.User]:(0,o.__)("Custom fields applied to this user, including both user-specific and global users fields.","quicktasker"),[wa.Users]:(0,o.__)("Global user custom field are applied to all users.","quicktasker"),[wa.Pipeline]:(0,o.__)("Board level fields are applied to all tasks in this board.","quicktasker"),[wa.Task]:(0,o.__)("Custom fields applied to this task, including both task-specific and board-level fields.","quicktasker")},Qa={[wa.User]:(0,o.__)("User custom fields","quicktasker"),[wa.Users]:(0,o.__)("Global users custom fields","quicktasker"),[wa.Pipeline]:(0,o.__)("Board custom fields","quicktasker"),[wa.Task]:(0,o.__)("Task custom fields","quicktasker")};function Ya({entityId:e,entityType:t}){const s=Ha[t],a=Qa[t],i=Wa[t];return(0,n.jsx)("div",{children:(0,n.jsxs)(ba,{entityId:e,entityType:t,children:[(0,n.jsx)("h2",{className:"wpqt-text-center",children:a}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:i}),(0,n.jsx)(Fa,{}),(0,n.jsx)(Oa,{description:s}),(0,n.jsx)(Ga,{})]})})}var Xa=s(5785);function Ja({children:e,inlineStyle:t,className:s=""}){return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-py-1 wpqt-px-2 wpqt-font-semibold wpqt-text-xs wpqt-leading-none wpqt-shopping-tag ${s}`,style:t,children:e})}var Za=s(2185);function en({children:e,menuBtn:t,menuBtnClasses:s="",anchor:a="bottom end"}){return(0,n.jsxs)(Za.W1,{children:[(0,n.jsx)(Za.IU,{as:"div",className:`wpqt-cursor-pointer ${s}`,onClick:e=>e.stopPropagation(),children:({active:e})=>(0,n.jsx)(n.Fragment,{children:t({active:e})})}),(0,n.jsx)(Za.c,{anchor:a,transition:!0,className:"wpqt-z-20 wpqt-origin-top wpqt-rounded-xl wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-bg-white wpqt-p-4 wpqt-transition wpqt-duration-200 wpqt-ease-out data-[closed]:wpqt-scale-95 data-[closed]:wpqt-opacity-0",children:e})]})}function tn({isActive:e,IconComponent:t}){return(0,n.jsx)(t,{className:"wpqt-size-6 wpqt-text-gray-400 hover:wpqt-text-qtBlueHover "+(e?"wpqt-text-qtBlueHover":"")})}function sn({text:e,onClick:t,icon:s,className:a,disabled:i=!1,id:o="",tooltipText:r="",loading:c=!1}){const l=""!==r&&""!==o?{"data-tooltip-id":o,"data-tooltip-content":r,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info"}:{};return(0,n.jsx)(Za.Dr,{children:(0,n.jsxs)("div",Object.assign({},l,{className:`wpqt-mb-3 wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-relative ${i?"wpqt-cursor-not-allowed wpqt-line-through":"wpqt-cursor-pointer hover:wpqt-underline"} ${a}`,onClick:e=>{!i&&t&&t(e)},children:[s,(0,n.jsx)("span",{className:c?"wpqt-invisible":"",children:e}),c&&(0,n.jsx)($t,{width:"16",height:"16",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-y-center wpqt-transform-x-center"}),(0,n.jsx)(Fs,{id:o})]}))})}var an=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};var nn=s(3858);function on({children:e,labelFor:t,className:s=""}){return(0,n.jsx)("label",{className:`wpqt-mb-1 ${s}`,htmlFor:t,children:e})}function rn({labelCreated:e,loading:t=!1}){const{labelDispatch:s}=(0,a.useContext)(Ft),[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)("");return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Create new label","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(on,{labelFor:"new-label-name",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(qa,{value:i,onChange:r,inputId:"new-label-name"})]}),(0,n.jsx)(nn.A,{color:c,disableAlpha:!0,onChange:e=>{l(e.hex)}}),(0,n.jsx)(zs,{btnText:(0,o.__)("Create","quicktasker"),onClick:()=>{i&&c&&e(i,c)},loading:t}),(0,n.jsx)(zs,{btnText:(0,o.__)("Cancel","quicktasker"),buttonStyleType:Os.SECONDARY,onClick:()=>{s({type:We})}})]})}var cn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ln({labelToEdit:e,editLabel:t,deleteLabe:s,closeEdit:i=()=>{}}){if(!e)return null;const[r,c]=(0,a.useState)(Object.assign({},e)),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Edit label","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(on,{labelFor:"edit-label-name",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(qa,{value:r.name,onChange:e=>{c(Object.assign(Object.assign({},r),{name:e}))},inputId:"edit-label-name"})]}),(0,n.jsx)(nn.A,{color:r.color,disableAlpha:!0,onChange:e=>{c(Object.assign(Object.assign({},r),{color:e.hex}))}}),(0,n.jsx)(zs,{btnText:(0,o.__)("Save","quicktasker"),onClick:()=>cn(this,void 0,void 0,(function*(){r.name&&r.color&&(d(!0),yield t(r),d(!1))})),loading:l}),(0,n.jsx)(zs,{btnText:(0,o.__)("Delete","quicktasker"),onClick:()=>cn(this,void 0,void 0,(function*(){p(!0),yield s(r.id),p(!1)})),loading:u,buttonStyleType:Os.DANGER}),(0,n.jsx)(zs,{btnText:(0,o.__)("Cancel","quicktasker"),buttonStyleType:Os.SECONDARY,onClick:i})]})}var dn=s(2601),un=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function pn({labels:e,title:t,labelSelected:s,labelDeSelection:i,loading:r=!1}){const{labelDispatch:c}=(0,a.useContext)(Ft);return e?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-4",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:t}),r?(0,n.jsx)(Bt,{ovalSize:"24"}):0===e.length?(0,n.jsx)("div",{className:"wpqt-text-gray-500",children:(0,o.__)("There are no labels created for this board","quicktasker")}):e.map((e=>(0,n.jsx)(wn,{label:e,labelSelected:s,labelDeSelection:i},e.id))),(0,n.jsx)(zs,{btnText:(0,o.__)("Create new label","quicktasker"),className:"wpqt-mt-3",buttonStyleType:Os.SECONDARY,onClick:()=>{c({type:Ye})}})]}):null}function wn({label:e,labelSelected:t,labelDeSelection:s}){const{labelDispatch:i}=(0,a.useContext)(Ft),[o,r]=(0,a.useState)(e.selected);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-between wpqt-gap-2 wpqt-w-full",children:[(0,n.jsx)("input",{type:"checkbox",checked:o,onChange:a=>un(this,void 0,void 0,(function*(){const n=a.target.checked;r(n),n?t(e.id):s(e.id)}))}),(0,n.jsx)(Ja,{inlineStyle:{backgroundColor:e.color},className:"wpqt-py-2",children:e.name}),(0,n.jsx)(dn.A,{className:"wpqt-size-5 wpqt-icon-green wpqt-cursor-pointer",onClick:()=>{i({type:Qe,payload:e})}})]})}var hn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const mn=(0,a.memo)((({task:e,labelSelected:t,labelDeselected:s,labelDeleted:r})=>{const{state:{labels:c,labelActionState:l,labelToEdit:d},labelDispatch:w}=(0,a.useContext)(Ft),{archiveDispatch:h}=(0,a.useContext)(Pt),{dispatch:m}=(0,a.useContext)(cs),[q,v]=(0,a.useState)(!0),[x,f]=(0,a.useState)(!1),{getPipelineLabels:_,createPipelineLabel:g,assignLabelToTask:k,usassignLabelFromTask:j,editLabel:y,deleteLabel:b}=function(){return{deleteLabel:(e,t,s)=>an(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/labels/${t}`,method:"DELETE",headers:p()})}(e,t);i.oR.success((0,o.__)("Label deleted from the board","quicktasker")),s&&s(!0,a.data.deletedLabel)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete label","quicktasker")),s&&s(!1)}})),getPipelineLabels:(e,t)=>an(this,void 0,void 0,(function*(){try{const a=yield(s=e,u()({path:`/wpqt/v1/pipelines/${s}/labels`,method:"GET",headers:p()}));t&&t(!0,a.data.labels)}catch(e){console.error(e),t&&t(!1)}var s})),createPipelineLabel:(e,t,s,a)=>an(this,void 0,void 0,(function*(){try{const n=yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/labels`,method:"POST",headers:p(),data:{name:t,color:s}})}(e,t,s);i.oR.success((0,o.__)("Label created successfully","quicktasker")),a&&a(!0,n.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create label","quicktasker")),a&&a(!1)}})),editLabel:(e,t,s)=>an(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/labels/${t.id}`,method:"PATCH",headers:p(),data:{name:t.name,color:t.color}})}(e,t);i.oR.success((0,o.__)("Label updated successfully","quicktasker")),s&&s(!0,a.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to update label","quicktasker")),s&&s(!1)}})),assignLabelToTask:(e,t,s,a)=>an(this,void 0,void 0,(function*(){try{const n=yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/tasks/${t}/labels`,method:"POST",headers:p(),data:{labelId:s}})}(e,t,s);i.oR.success((0,o.__)("Label added to task","quicktasker")),a&&a(!0,n.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add label to task","quicktasker")),a&&a(!1)}})),usassignLabelFromTask:(e,t,s,a)=>an(this,void 0,void 0,(function*(){try{yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/tasks/${t}/labels/${s}`,method:"DELETE",headers:p()})}(e,t,s),i.oR.success((0,o.__)("Label removed from task","quicktasker")),a&&a(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to remove label from task","quicktasker")),a&&a(!1)}}))}}();(0,a.useEffect)((()=>(hn(void 0,void 0,void 0,(function*(){v(!0),yield _(e.pipeline_id,((e,t)=>{e&&t&&w({type:Ve,payload:t})})),v(!1)})),()=>{w({type:Xe})})),[]);const T=()=>{const t=e.assigned_labels||[];return(c||[]).map((e=>Object.assign(Object.assign({},e),{selected:t.some((t=>t.id===e.id))})))},E=s=>hn(void 0,void 0,void 0,(function*(){yield k(e.pipeline_id,e.id,s,((s,a)=>{s&&a&&(m({type:U,payload:{taskId:e.id,label:a}}),h({type:he,payload:{taskId:e.id,label:a}}),t(a))}))})),S=t=>hn(void 0,void 0,void 0,(function*(){yield j(e.pipeline_id,e.id,t,(a=>{a&&(m({type:M,payload:{taskId:e.id,labelId:t}}),h({type:me,payload:{taskId:e.id,labelId:t}}),s(t))}))})),A=(t,s)=>hn(void 0,void 0,void 0,(function*(){f(!0),yield g(e.pipeline_id,t,s,((e,t)=>{e&&t&&w({type:Be,payload:t})})),f(!1)})),N=t=>hn(void 0,void 0,void 0,(function*(){yield y(e.pipeline_id,t,((e,t)=>{e&&t&&(w({type:He,payload:t}),m({type:F,payload:{label:t}}))}))})),C=t=>hn(void 0,void 0,void 0,(function*(){yield b(e.pipeline_id,t,((e,s)=>{e&&s&&(w({type:We}),w({type:Ge,payload:s}),m({type:z,payload:t}),r(t))}))}));return(0,n.jsx)("div",{className:"wpqt-min-w-56 wpqt-flex wpqt-flex-col wpqt-gap-4",onClick:e=>e.stopPropagation(),children:(()=>{switch(l){case Rt.SELECTION:return(0,n.jsx)(pn,{title:(0,o.__)("Task label selection","quicktasker"),labels:T(),loading:q,labelSelected:E,labelDeSelection:S});case Rt.CREATION:return(0,n.jsx)(rn,{labelCreated:A,loading:x});case Rt.EDIT:return(0,n.jsx)(ln,{labelToEdit:d,editLabel:N,deleteLabe:C,closeEdit:()=>{w({type:We})}});default:return null}})()})}));function qn({task:e,labelSelected:t=()=>{},labelDeselected:s=()=>{},labelDeleted:a=()=>{}}){const i=e.assigned_labels||[],o=Array.isArray(i)&&i.length>0;return(0,n.jsx)(en,{menuBtnClasses:"wpqt-inline-flex",anchor:"bottom start",menuBtn:()=>(0,n.jsxs)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1.5",children:[(0,n.jsx)(Xa.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`}),o&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-flex-wrap",children:i.map((e=>(0,n.jsx)(Ja,{inlineStyle:{backgroundColor:e.color},children:e.name},e.id)))})]}),children:e&&(0,n.jsx)(mn,{task:e,labelSelected:t,labelDeselected:s,labelDeleted:a})})}var vn=s(2792),xn=s(6797),fn=s(4403);function _n({sectionTitle:e,onItemSelect:t=()=>{},users:s=[],ActionIcon:a=fn.A,actionIconClasses:i,noUsersText:o}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2 wpqt-text-lg",children:e}),s.map(((e,s)=>{var o;return(0,n.jsxs)("div",{onClick:s=>{s.stopPropagation(),t(e)},className:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-px-2 wpqt-py-1 hover:wpqt-bg-gray-100",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("div",{children:e.name}),(0,n.jsx)("div",{className:"wpqt-italic",children:e.description}),_t(e)&&(0,n.jsx)("div",{children:null===(o=e.roles)||void 0===o?void 0:o.join(",")})]}),(0,n.jsx)(a,{className:`wpqt-ml-auto wpqt-size-5 ${i}`})]},s)})),0===s.length&&(0,n.jsx)("div",{children:o})]})}var gn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function kn({task:e,onUserAdd:t,onUserDelete:s}){const{state:{users:r,wpUsers:c}}=(0,a.useContext)(js),{handleExecutedAutomations:l}=ps(),{dispatch:d}=(0,a.useContext)(cs),[w,h]=(0,a.useState)(!1),m=r.filter((t=>{var s;return!(null!==(s=e.assigned_users)&&void 0!==s?s:[]).some((e=>e.id===t.id))})),q=c.filter((t=>{var s;return!(null!==(s=e.assigned_wp_users)&&void 0!==s?s:[]).some((e=>e.id===t.id))})),x=s=>gn(this,void 0,void 0,(function*(){try{h(!0);const a=s.user_type,n=yield function(e,t,s){return u()({path:`/wpqt/v1/users/${e}/tasks/${t}`,method:"POST",data:{user_type:s},headers:p()})}(s.id,e.id,a);d({type:C,payload:{taskId:e.id,user:s}}),t(s),l(n.data.executedAutomations,e.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to assign user","quicktasker"))}finally{h(!1)}})),f=t=>gn(this,void 0,void 0,(function*(){try{h(!0);const a=t.user_type,n=yield v(t.id,e.id,a);d({type:O,payload:{taskId:e.id,userId:t.id,userType:a}}),s(t),l(n.data.executedAutomations,e.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to remove user","quicktasker"))}finally{h(!1)}}));return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-w-[320px] wpqt-flex-col",children:[(0,n.jsx)(_n,{sectionTitle:(0,o.__)("Assigned quicktaskers","quicktasker"),users:e.assigned_users,onItemSelect:f,ActionIcon:xn.A,actionIconClasses:"wpqt-icon-red",noUsersText:(0,o.__)("No quicktaskers assigned","quicktasker")}),(0,n.jsx)(_n,{sectionTitle:(0,o.__)("Assigned WordPress users","quicktasker"),users:e.assigned_wp_users,onItemSelect:f,ActionIcon:xn.A,actionIconClasses:"wpqt-icon-red",noUsersText:(0,o.__)("No WordPress users assigned","quicktasker")}),(0,n.jsx)(_n,{sectionTitle:(0,o.__)("Assign a quicktasker","quicktasker"),users:m,onItemSelect:x,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No quicktaskers available to assign","quicktasker")}),(0,n.jsx)(_n,{sectionTitle:(0,o.__)("Assign a WordPress user","quicktasker"),users:q,onItemSelect:x,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No WordPress users with required permissions available to assign","quicktasker")}),w&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)($t,{width:"30",height:"30"})})]})}function jn({task:e,onUserAdd:t=()=>{},onUserDelete:s=()=>{},menuBtnClasses:a=""}){const i=[...e.assigned_users||[],...e.assigned_wp_users||[]],o=i.length>0;return(0,n.jsx)(en,{menuBtnClasses:`wpqt-inline-flex ${a}`,anchor:"bottom start",menuBtn:()=>(0,n.jsxs)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1",children:[(0,n.jsx)(vn.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`}),o&&(0,n.jsx)("div",{children:i.map(((e,t)=>(0,n.jsxs)("span",{children:[e.name,t<i.length-1&&", "]},t)))})]}),children:(0,n.jsx)(kn,{task:e,onUserAdd:t,onUserDelete:s})})}var yn=s(1848);function bn({tabs:e,tabsContent:t,tabClassName:s="",tabListClassName:a=""}){return(0,n.jsxs)(yn.fu,{children:[(0,n.jsx)(yn.wb,{className:`wpqt-mb-6 wpqt-flex wpqt-border-0 wpqt-border-b wpqt-border-solid wpqt-border-b-gray-300 ${a}`,children:e.map((e=>(0,n.jsx)(Tn,{className:s,children:e},e)))}),(0,n.jsx)(yn.T2,{children:t.map(((e,t)=>(0,n.jsx)(En,{children:e},t)))})]})}function Tn({children:e,className:t}){return(0,n.jsx)(yn.oz,{as:"div",className:`wpqt-flex-1 wpqt-cursor-pointer wpqt-p-1 wpqt-pb-[10px] wpqt-text-center wpqt-text-lg data-[selected]:wpqt-border-b-2 data-[selected]:wpqt-border-l-0 data-[selected]:wpqt-border-r-0 data-[selected]:wpqt-border-t-0 data-[selected]:wpqt-border-solid data-[selected]:wpqt-border-b-blue-500 ${t}`,children:e})}function En({children:e}){return(0,n.jsx)(yn.Kp,{children:e})}const Sn={[Et.Admin]:(0,o.__)("Admin","quicktasker"),[Et.Automation]:(0,o.__)("Automation","quicktasker"),[Et.System]:(0,o.__)("System","quicktasker"),[Et.WPQTUser]:"Quicktasker"},An=({log:e})=>{const{convertToWPTimezone:t}=ua(),s=Sn[e.created_by];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-1",children:e.author_name}),(0,n.jsx)("div",{className:"wpqt-text-center",children:s})]}),(0,n.jsx)("div",{children:e.text}),(0,n.jsx)("div",{children:t(e.created_at)})]})};var Nn=s(3338),Cn=s(3211);const On={success:"wpqt-bg-green-100 wpqt-border-green-400 wpqt-text-green-700",error:"wpqt-bg-red-100 wpqt-border-red-400 wpqt-text-red-700",warning:"wpqt-bg-yellow-100 wpqt-border-yellow-400 wpqt-text-yellow-700",info:"wpqt-bg-blue-100 wpqt-border-blue-400 wpqt-text-blue-700",primary:"wpqt-bg-gray-100 wpqt-border-gray-400 wpqt-text-gray-700"};function In({type:e="primary",className:t="",children:s}){const a=On[e];return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-p-2 wpqt-border wpqt-border-solid wpqt-rounded-md ${a} ${t}`,children:s})}var Dn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Pn({typeId:e,fetchData:t,renderItem:s,noDataMessage:i,explanation:o,onAdd:r=()=>Dn(this,void 0,void 0,(function*(){})),enableAdd:c=!1}){const[l,d]=(0,a.useState)(null),[u,p]=(0,a.useState)(""),[w,h]=(0,a.useState)(!0),[m,q]=(0,a.useState)(!1);(0,a.useEffect)((()=>{v()}),[e]);const v=()=>Dn(this,void 0,void 0,(function*(){h(!0);const e=yield t();e&&d(e),h(!1)}));return null===l?(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)($t,{width:"30",height:"30"})}):(0,n.jsxs)("div",{children:[o&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(In,{type:"info",className:"wpqt-mb-3 wpqt-text-center",children:o})}),0===l.length&&(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-text-center",children:i}),(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-mt-3 wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Ln,{isLoading:w,refreshComemnts:v})}),c&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-w-2/3 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(fa,{rowsCount:3,value:u,onChange:e=>p(e),className:"wpqt-mb-4 wpqt-w-full"}),(0,n.jsx)(Ks,{text:"Add comment",loading:m,onClick:()=>Dn(this,void 0,void 0,(function*(){if(!u)return;q(!0);const e=yield r(u);e&&(d((t=>t?[e,...t]:[e])),p("")),q(!1)})),icon:(0,n.jsx)(Nn.A,{className:"wpqt-icon-blue wpqt-size-5"})})]})}),l.length>0&&(0,n.jsx)("div",{className:"wpqt-mb-[28px] wpqt-mt-[56px] wpqt-logs-grid",children:l.map((e=>s(e)))})]})}function Ln({isLoading:e,refreshComemnts:t}){return(0,n.jsx)(n.Fragment,{children:e?(0,n.jsx)($t,{width:"32",height:"32"}):(0,n.jsx)(Cn.A,{className:"wpqt-icon-blue wpqt-size-8 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:t})})}function Rn({item:e}){const{convertToWPTimezone:t}=ua();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-1",children:e.author_name}),(0,n.jsx)("div",{className:"wpqt-text-center",children:e.is_admin_comment?(0,o.__)("Admin","quicktasker"):(0,o.__)("QuickTasker","quicktasker")})]}),(0,n.jsx)("div",{children:e.text}),(0,n.jsx)("div",{children:t(e.created_at)})]})}var Un=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Mn({taskId:e}){return(0,n.jsx)(Pn,{typeId:e,fetchData:()=>Un(this,void 0,void 0,(function*(){try{return(yield q(e,Tt.Task)).data}catch(e){console.error(e),i.oR.error("Failed to get log")}})),renderItem:e=>(0,n.jsx)(An,{log:e}),noDataMessage:"No logs available",explanation:"Logs can be seen only by WordPress users (with required permissions)"})}var Fn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function zn(){return{addComment:(e,t,s,a)=>Fn(this,void 0,void 0,(function*(){try{const n=yield m(e,t,s,a);return i.oR.success((0,o.__)("Comment added","quicktasker")),n.data.newComment}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add comment","quicktasker"))}}))}}const Kn=e=>Object.assign(Object.assign({},e),{is_admin_comment:"1"===e.is_admin_comment});var $n=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Vn({taskId:e}){const{addComment:t}=zn();return(0,n.jsx)(Pn,{typeId:e,fetchData:()=>$n(this,void 0,void 0,(function*(){try{return(yield h(e,Tt.Task,!0)).data.map(Kn)}catch(e){console.error(e),i.oR.error("Failed to load comments")}})),onAdd:s=>$n(this,void 0,void 0,(function*(){const a=yield t(e,Tt.Task,!0,s);if(a)return Kn(a)})),renderItem:e=>(0,n.jsx)(Rn,{item:e}),noDataMessage:"No comments available",explanation:"Comments that can be added and viewed only by WordPress users (with required permissions).",enableAdd:!0})}var Bn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Gn({taskId:e}){const{addComment:t}=zn();return(0,n.jsx)(Pn,{typeId:e,fetchData:()=>Bn(this,void 0,void 0,(function*(){try{return(yield h(e,Tt.Task,!1)).data.map(Kn)}catch(e){console.error(e),i.oR.error("Failed to load comments")}})),onAdd:s=>Bn(this,void 0,void 0,(function*(){const a=yield t(e,Tt.Task,!1,s);if(a)return Kn(a)})),renderItem:e=>(0,n.jsx)(Rn,{item:e}),noDataMessage:"No comments available",explanation:"Comments that can be added and viewed by WordPress users (with required permissions) and quicktaskers (in quicktasker user page) who have been assigned to the task.",enableAdd:!0})}function Hn({task:e}){return(0,n.jsx)(bn,{tabs:["Private comments","Public comments","Logs"],tabsContent:[(0,n.jsx)(Vn,{taskId:e.id},1),(0,n.jsx)(Gn,{taskId:e.id},2),(0,n.jsx)(Mn,{taskId:e.id},3)]})}var Wn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Qn(){return{getUplaods:(e,t)=>Wn(this,void 0,void 0,(function*(){try{const s=yield function(e,t){const s=new URLSearchParams({entity_id:e,entity_type:t});return u()({path:`/wpqt/v1/uploads?${s.toString()}`,method:"GET"})}(e,t);return{data:s.data,error:null}}catch(e){return console.error(e),{data:null,error:e}}})),uploadFile:e=>Wn(this,void 0,void 0,(function*(){try{const t=yield function(e){return u()({path:"/wpqt/v1/uploads",method:"POST",body:e})}(e);return i.oR.success((0,o.__)("File uploaded successfully","quicktasker")),{data:t.data,error:null}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to upload a file","quicktasker")),{data:null,error:e}}})),deleteUpload:e=>Wn(this,void 0,void 0,(function*(){try{const t=yield function(e){return u()({path:`/wpqt/v1/uploads/${e}`,method:"DELETE"})}(e);return i.oR.success((0,o.__)("File deleted successfully","quicktasker")),{data:t.data,error:null}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to delete a file","quicktasker")),{data:null,error:e}}})),checkFileExists:e=>Wn(this,void 0,void 0,(function*(){try{return(yield fetch(e,{method:"HEAD"})).ok}catch(e){return!1}}))}}var Yn=s(2944),Xn=s(4015);function Jn({upload:e,menuBtnClasses:t=""}){const{state:{taskUploadsURL:s}}=(0,a.useContext)(ia),i=`${s}/${e.upload_uuid}/${e.file_name}`;return(0,n.jsx)(en,{menuBtnClasses:`wpqt-inline-flex ${t}`,anchor:"top",menuBtn:()=>(0,n.jsx)(Xn.A,{className:"wpqt-size-5 wpqt-icon-blue"}),children:(0,n.jsxs)("div",{children:[(0,n.jsx)(Zn,{title:(0,o.__)("File name","quicktasker"),children:e.file_name}),(0,n.jsx)(Zn,{title:(0,o.__)("File link","quicktasker"),children:(0,n.jsx)("a",{href:i,target:"_blank",rel:"noreferrer",children:i})}),(0,n.jsx)(Zn,{title:(0,o.__)("Created at","quicktasker"),children:e.created_at}),(0,n.jsx)(Zn,{title:(0,o.__)("Created by","quicktasker"),children:e.uploader_name})]})})}function Zn({title:e,children:t}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-uppercase",children:e}),(0,n.jsx)("div",{children:t})]})}var ei=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ti({upload:e}){const{state:{isUserAllowedToDelete:t,taskUploadsURL:s}}=(0,a.useContext)(ia),{uploadDispatch:r}=(0,a.useContext)(As),[c,l]=(0,a.useState)(!1),{checkFileExists:d,deleteUpload:u}=Qn(),p=`${s}/${e.upload_uuid}/${e.file_name}`,w=(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-4 wpqt-justify-end wpqt-items-center",children:[(0,n.jsx)("a",{href:p,download:!0,onClick:()=>ei(this,void 0,void 0,(function*(){(yield d(p))||i.oR.error((0,o.__)("File was not found","quicktasker"))})),className:"focus:wpqt-shadow-none",children:(0,n.jsx)(Yn.A,{className:"wpqt-icon-blue wpqt-size-5 :hover:wpqt-text-blue-800 wpqt-cursor-pointer"})}),(0,n.jsx)(Jn,{upload:e}),t&&(0,n.jsx)(Xs.A,{className:"wpqt-icon-red wpqt-size-5 :hover:wpqt-text-red-800 wpqt-cursor-pointer",onClick:()=>ei(this,void 0,void 0,(function*(){l(!0);const{data:t}=yield u(e.id);t&&r({type:lt,payload:e.id}),l(!1)}))})]});return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-main-border wpqt-p-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:e.file_name}),c?(0,n.jsx)(Bt,{ovalSize:"22",className:"!wpqt-items-end"}):w]})}var si=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ai({entityId:e,entityType:t}){const{uploadDispatch:s}=(0,a.useContext)(As),[r,c]=(0,a.useState)(null),[l,d]=(0,a.useState)(!1),{uploadFile:u}=Qn(),p=(0,a.useRef)(null);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsxs)("div",{className:"wpqt-max-w-[300px]",children:[(0,o.sprintf)((0,o.__)("Select file to upload (Max size: %d MB)","quicktasker"),pt/1024/1024),(0,n.jsx)("br",{}),(0,o.__)("Allowed characters in file name: Latin letters, numbers, underscores, hyphens, and dots.","quicktasker")]}),(0,n.jsx)("input",{type:"file",onChange:e=>{if(e.target.files){const t=e.target.files[0];if(t.size>pt)return void i.oR.error((0,o.sprintf)((0,o.__)("File size exceeds the maximum limit of %d MB","quicktasker"),pt));if(!wt.test(t.name))return void i.oR.error((0,o.__)("Invalid file name","quicktasker"));if(0===t.size)return void i.oR.error((0,o.__)("The selected file is empty","quicktasker"));c(t)}},ref:p,accept:ut.join(",")}),r&&(0,n.jsx)(zs,{btnText:(0,o.__)("Upload","quicktasker"),loading:l,onClick:()=>si(this,void 0,void 0,(function*(){const a=(()=>{if(!r)return null;const s=new FormData;return s.append("file_to_upload",r),s.append("entity_id",e),s.append("entity_type",t),s})();if(a){d(!0);const{data:e}=yield u(a);e&&(s({type:ct,payload:e.upload}),c(null),p.current&&(p.current.value="")),d(!1)}}))})]})}function ni({entityId:e,entityType:t}){const{state:{uploads:s},uploadDispatch:r}=(0,a.useContext)(As),[c,l]=(0,a.useState)(!0),{getUplaods:d}=Qn(),u=()=>{return s=this,a=void 0,c=function*(){l(!0);const{data:s,error:a}=yield d(e,t);l(!1),s&&s.uploads&&r({type:rt,payload:s.uploads}),a&&i.oR.error((0,o.__)("Failed to fetch uploads","quicktasker"))},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}r((c=c.apply(s,a||[])).next())}));var s,a,n,c};return(0,a.useEffect)((()=>{u()}),[]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(ai,{entityId:e,entityType:t}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-flex-wrap wpqt-items-start",children:c?(0,n.jsx)(Bt,{ovalSize:"24"}):s.map((e=>(0,n.jsx)(ti,{upload:e},e.id)))})]})}var ii=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const oi=(0,a.forwardRef)((({taskModalSaving:e,editTask:t,deleteTask:s},i)=>{const{state:{taskToEdit:r,taskModalSettings:c},modalDispatch:l}=(0,a.useContext)(xs),{state:{isUserAllowedToDelete:d}}=(0,a.useContext)(ia),{state:{activePipeline:u},fetchAndSetPipelineData:p}=(0,a.useContext)(cs),{archiveDispatch:w}=(0,a.useContext)(Pt),[h,m]=(0,a.useState)(""),[q,v]=(0,a.useState)(""),[x,f]=(0,a.useState)(!1),[_,g]=(0,a.useState)(null),[k,j]=(0,a.useState)([]),{archiveTask:y,restoreArchivedTask:b}=hs(),{loading1:T,setLoading1:E,loading2:S,setLoading2:A}=sa(),{convertUTCDateTimeToWPTimezone:N}=ua(),C=null==r?void 0:r.is_archived,O=null!==(null==r?void 0:r.pipeline_name);(0,a.useEffect)((()=>{if(r){const e=r.due_date?N(r.due_date):null;m(r.name),v(r.description),f(r.free_for_all),g(e),j(r.assigned_labels)}}),[r]);const I=()=>{m(""),v("")};return(0,a.useImperativeHandle)(i,(()=>({clearContent:I}))),r?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsxs)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:[(0,n.jsxs)("div",{className:"wpqt-mb-2 wpqt-grid wpqt-grid-cols-1 wpqt-gap-4 md:wpqt-grid-cols-[1fr_2fr]",children:[(0,n.jsxs)(Gs,{children:[(0,n.jsx)(Hs,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(qa,{isAutoFocus:!0,value:h,onChange:e=>m(e),wrapperClassName:"wpqt-w-full",className:"wpqt-w-full"})}),(0,n.jsx)(Hs,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(fa,{rowsCount:3,value:q,className:"wpqt-w-full",onChange:e=>v(e)})}),(0,n.jsx)(Hs,{label:(0,o.__)("Assigned users","quicktasker"),children:(0,n.jsx)(jn,{task:r,onUserAdd:e=>{l({type:ee,payload:e})},onUserDelete:e=>{l({type:te,payload:e})}})}),(0,n.jsx)(Hs,{label:(0,o.__)("Labels","quicktasker"),children:(0,n.jsx)(qn,{task:Object.assign(Object.assign({},r),{assigned_labels:k}),labelSelected:e=>{j((t=>[...t,e]))},labelDeselected:e=>{j((t=>t.filter((t=>t.id!==e))))},labelDeleted:e=>{j((t=>t.filter((t=>t.id!==e))))}})}),(0,n.jsx)(Hs,{label:(0,o.__)("Free for all task","quicktasker"),tooltipId:`free-for-all-${r.id}-tooltip`,tooltipText:(0,o.__)("When enabled, all QuickTasker users have the ability to self-assign or unassign this task.","quicktasker"),children:(0,n.jsx)(ga,{checked:x,handleChange:f})}),(0,n.jsx)(Hs,{label:(0,o.__)("Due date","quicktasker"),children:(0,n.jsx)(ta.A,{onChange:e=>{g(e)},value:_,format:"y-MM-dd HH:mm"})}),c.allowToMarkTaskAsDone&&(0,n.jsx)(ri,{taskId:r.id,isCompleted:r.is_done})]}),(0,n.jsx)("div",{children:(0,n.jsx)(Ya,{entityId:r.id,entityType:wa.Task})})]}),(0,n.jsx)("div",{className:"wpqt-mb-4",children:(0,n.jsx)(Ws,{onSave:()=>{r&&t(Object.assign(Object.assign({},r),{name:h,description:q,free_for_all:x,due_date:_?ea()(_).utc().format("YYYY-MM-DD HH:mm:ss"):null}))},saveBtnText:e?(0,o.__)("Saving...","quicktasker"):(0,o.__)("Save","quicktasker")})}),(0,n.jsx)(Hs,{label:(0,o.__)("File attachment","quicktasker"),children:(0,n.jsx)(ni,{entityId:r.id,entityType:ha.TASK})}),(0,n.jsx)("div",{className:"wpqt-mt-7 md:wpqt-pr-3",children:(0,n.jsx)(Hn,{task:r})})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[C&&O&&(0,n.jsx)(Ks,{icon:(0,n.jsx)(Qs.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Restore task","quicktasker"),onClick:()=>{b(r.id,(()=>{l({type:B}),w({type:ce,payload:r.id})}))}}),!C&&(0,n.jsx)(Ks,{icon:(0,n.jsx)(Ys.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("Archive task","quicktasker"),loading:S,onClick:()=>{A(!0),y(r.id,(()=>{l({type:B}),p(u.id),A(!1)}))}}),d&&(0,n.jsx)(Ks,{icon:(0,n.jsx)(Xs.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Delete task","quicktasker"),loading:T,onClick:()=>ii(void 0,void 0,void 0,(function*(){E(!0),yield s(r),l({type:B}),E(!1)}))})]})]})}):null}));function ri({isCompleted:e,taskId:t}){const{modalDispatch:s}=(0,a.useContext)(xs),{dispatch:i}=(0,a.useContext)(cs),[r,c]=(0,a.useState)(!1),{changeTaskDoneStatus:l}=hs();return(0,n.jsx)(Hs,{label:e?(0,o.__)("Task completed","quicktasker"):(0,o.__)("Task not completed","quicktasker"),children:r?(0,n.jsx)($t,{width:"24",height:"24"}):(0,n.jsx)(Js.A,{onClick:()=>ii(this,void 0,void 0,(function*(){c(!0),yield l(t,!e,(e=>{s({type:I,payload:{done:e}}),i({type:I,payload:{taskId:t,done:e}})})),c(!1)})),className:`wpqt-size-6 ${e?"wpqt-icon-green":"wpqt-text-gray-300"} wpqt-cursor-pointer`})})}var ci=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function li({editTaskCallback:e,deleteTaskCallback:t}){const{state:{taskModalOpen:s}}=(0,a.useContext)(xs),{deleteTask:i}=hs(),{modalSaving:o,setModalSaving:r,modalContentRef:c,closeModal:l,handleSuccess:d,handleError:w}=Ts(B);return(0,n.jsx)(Vs,{modalOpen:s,closeModal:l,size:"xl",children:(0,n.jsx)(Ns,{children:(0,n.jsx)(oi,{ref:c,editTask:t=>ci(this,void 0,void 0,(function*(){try{r(!0);const s=yield function(e){return u()({path:`/wpqt/v1/tasks/${e.id}`,method:"PATCH",data:{id:e.id,name:e.name,description:e.description,freeForAll:e.free_for_all,dueDate:e.due_date},headers:p()})}(t);d(b,s.data,bs.ACTIVE_PIPELINE),e&&e(s.data)}catch(e){w(e)}})),deleteTask:e=>ci(this,void 0,void 0,(function*(){i(e.id,(()=>{t&&t(e)}))})),taskModalSaving:o})})})}function di({text:e=(0,o.__)("No results found","quicktasker")}){return(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-center wpqt-text-xl",children:e})}const ui=()=>{const{state:{archiveSearchValue:e,archiveFilteredPipelineId:t,archiveTaskDoneFilter:s}}=(0,a.useContext)(Pt);return{filterArchive:a=>{const n=a.name.toLowerCase().includes(e.toLowerCase())||a.description&&a.description.toLowerCase().includes(e.toLowerCase()),i=!t||("DELETED"===t?null===a.pipeline_name:a.pipeline_id===t),o=s===St.All||s===St.Completed&&a.is_done||s===St.NotCompleted&&!a.is_done;return n&&i&&o}}};var pi=s(3033),wi=s(587);function hi({className:e,onClick:t,title:s,description:a,children:i,dropdown:o,titleClassName:r=""}){const c=void 0!==o;return(0,n.jsxs)("div",{className:(0,xa.$)("wpqt-relative wpqt-flex wpqt-flex-col wpqt-rounded wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-p-4",c&&"wpqt-pr-[24px]",e),onClick:t,children:[(0,n.jsxs)("div",{className:"wpqt-mb-3",children:[(0,n.jsx)("div",{className:`wpqt-text-lg ${r}`,children:s}),a&&(0,n.jsx)("div",{className:"wpqt-italic wpqt-text-gray-500",children:a})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-h-full",children:i}),c&&(0,n.jsx)("div",{className:"wpqt-absolute wpqt-right-2 wpqt-top-1 wpqt-z-10",children:o})]})}var mi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function qi({task:e,onDoneStatusChange:t,className:s=""}){const{changeTaskDoneStatus:i}=hs(),[o,r]=(0,a.useState)(!1),c=e.is_done,l=s=>mi(this,void 0,void 0,(function*(){r(!0),yield i(e.id,s,(s=>{t(e.id,s)})),r(!1)}));return o?(0,n.jsx)(Bt,{ovalSize:"24",className:"wpqt-mt-auto"}):(0,n.jsx)("div",{className:`wpqt-flex wpqt-justify-center wpqt-mt-auto ${s}`,children:c?(0,n.jsx)(Js.A,{className:"wpqt-size-6 wpqt-icon-green",onClick:e=>{e.stopPropagation(),l(!1)}}):(0,n.jsx)(Js.A,{className:"wpqt-size-6 wpqt-text-gray-300",onClick:e=>{e.stopPropagation(),l(!0)}})})}function vi({label:e,value:t,valueClassName:s="",valueLink:a,icon:i,onClick:o=()=>{},className:r="",labelClassName:c=""}){return(0,n.jsxs)("div",{className:`wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center ${r}`,onClick:o,children:[i&&i,(0,n.jsx)("div",{className:c,children:t?`${e}:`:e}),(0,n.jsx)("div",{className:`${s}`,children:a?(0,n.jsx)("a",{href:a,target:"_blank",className:"wpqt-text-qtTextBlue wpqt-no-underline",rel:"noreferrer",onClick:e=>e.stopPropagation(),children:t}):t})]})}var xi=s(6436),fi=s(72),_i=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function gi({task:e}){const{state:{isUserAllowedToDelete:t}}=(0,a.useContext)(ia),{archiveDispatch:s}=(0,a.useContext)(Pt),{deleteTask:i,restoreArchivedTask:o}=hs(),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),u=null!==e.pipeline_name;return(0,n.jsxs)(en,{menuBtn:({active:e})=>(0,n.jsx)(tn,{isActive:e,IconComponent:xi.A}),children:[(0,n.jsx)(sn,{text:"View task",icon:(0,n.jsx)(fi.A,{className:"wpqt-icon-blue wpqt-size-4"})}),(0,n.jsx)(sn,{text:"Restore task",loading:r,icon:(0,n.jsx)(Qs.A,{className:"wpqt-icon-green wpqt-size-4"}),disabled:!u,id:`restore-task-${e.id}-dropdown-item`,tooltipText:"Task cannot be restored because the board has been deleted.",onClick:t=>_i(this,void 0,void 0,(function*(){t.stopPropagation(),c(!0),yield o(e.id,(()=>{s({type:ce,payload:e.id})})),c(!1)}))}),t&&(0,n.jsx)(sn,{text:"Delete",loading:l,icon:(0,n.jsx)(Xs.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>_i(this,void 0,void 0,(function*(){t.stopPropagation(),d(!0),yield i(e.id,(()=>{s({type:ce,payload:e.id})})),d(!1)})),className:"!wpqt-mb-0"})]})}function ki({task:e}){const{modalDispatch:t}=(0,a.useContext)(xs),{archiveDispatch:s}=(0,a.useContext)(Pt),{convertToWPTimezone:i}=ua(),r=e.due_date?i(e.due_date):null;return(0,n.jsxs)(hi,{title:e.name,description:e.description,dropdown:(0,n.jsx)(gi,{task:e}),className:"wpqt-cursor-pointer",onClick:()=>{t({type:V,payload:{taskToEdit:e}})},children:[(0,n.jsx)(vi,{label:(0,o.__)("Board","quicktasker"),value:e.pipeline_name?e.pipeline_name:(0,o.__)("Board is deleted!","quicktasker"),icon:(0,n.jsx)(pi.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(jn,{menuBtnClasses:"wpqt-self-start",task:e,onUserAdd:t=>{s({type:le,payload:{taskId:e.id,user:t}})},onUserDelete:t=>{s({type:de,payload:{taskId:e.id,user:t}})}}),(0,n.jsx)(qn,{task:e})]}),r&&(0,n.jsx)(vi,{label:(0,o.__)("Due date","quicktasker"),value:r,icon:(0,n.jsx)(wi.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(qi,{task:e,onDoneStatusChange:(e,t)=>{s({type:ue,payload:{taskId:e,done:t}})}})]})}function ji(){var e;const{state:{archivedTasks:t=[]}}=(0,a.useContext)(Pt),{filterArchive:s}=ui(),i=null!==(e=null==t?void 0:t.filter(s))&&void 0!==e?e:[];return t&&0===t.length?(0,n.jsx)(di,{text:(0,o.__)("No tasks archived","quicktasker")}):i&&0===i.length?(0,n.jsx)(di,{}):(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"wpqt-card-grid",children:i.map((e=>(0,n.jsx)(ki,{task:e},e.id)))})})}function yi(){const{state:{archivedTasks:e},archiveDispatch:t}=(0,a.useContext)(Pt);return e?(0,n.jsxs)("div",{children:[(0,n.jsx)(ns,{}),(0,n.jsx)(ji,{}),(0,n.jsx)(li,{editTaskCallback:e=>{t({type:pe,payload:e})},deleteTaskCallback:e=>{t({type:ce,payload:e.id})}})]}):(0,n.jsx)(Bt,{className:"wpqt-h-[200px]"})}function bi(){return(0,n.jsx)(Lt,{children:(0,n.jsx)(zt,{children:(0,n.jsxs)(Gt,{children:[(0,n.jsx)(l,{description:(0,o.__)("Archived tasks management page.","quicktasker"),children:(0,o.__)("Archive","quicktasker")}),(0,n.jsx)(yi,{})]})})})}const Ti=()=>{const{state:{pluginURL:e}}=(0,a.useContext)(ia);return(0,n.jsxs)(Gt,{children:[(0,n.jsx)(l,{description:(0,o.__)("Reading material about QuickTasker features and usage.","quicktasker"),children:(0,o.__)("Guide","quicktasker")}),(0,n.jsx)("div",{children:(0,n.jsx)("a",{target:"_blank",rel:"noreferrer",href:e+"help/index.html",children:(0,o.__)("View Guide","quicktasker")})})]})};var Ei=s(4175);const Si=({filterSettings:e,setFilterSettings:t})=>{const{state:{pipelines:s}}=(0,a.useContext)(Jt),[i,r]=(0,a.useState)(e);return(0,n.jsxs)(as,{title:(0,o.__)("Logs filtering","quicktasker"),children:[(0,n.jsx)(ts,{allSelector:!1,selectedOptionValue:i.type,options:[{label:(0,o.__)("All types","quicktasker"),value:Ai.All},{label:(0,o.__)("Board","quicktasker"),value:Ai.Pipeline},{label:(0,o.__)("Stage","quicktasker"),value:Ai.Stage},{label:(0,o.__)("Task","quicktasker"),value:Ai.Task}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{type:e,typeId:""}))}}),i.type===Ai.Pipeline&&(0,n.jsx)(ts,{allSelector:!0,selectedOptionValue:i.typeId,options:s.map((e=>({label:e.name,value:e.id}))),onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{typeId:e}))}}),(0,n.jsx)(ts,{allSelector:!1,selectedOptionValue:i.createdBy,options:[{label:(0,o.__)("Everyone","quicktasker"),value:Ci.All},{label:(0,o.__)("Admin","quicktasker"),value:Ci.Admin},{label:"QuickTasker",value:Ci.Quicktasker},{label:"Automation",value:Ci.Automation}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{createdBy:e}))}}),(0,n.jsx)(ts,{allSelector:!1,selectedOptionValue:i.numberOfLogs,options:[{label:(0,o.__)("Show 100","quicktasker"),value:Di.Hundred},{label:(0,o.__)("Show 200","quicktasker"),value:Di.TwoHundred},{label:"Show 500",value:Di.FiveHundred},{label:"Show all",value:Di.All}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{numberOfLogs:e}))}}),(0,n.jsx)(ts,{allSelector:!1,selectedOptionValue:i.order,options:[{label:(0,o.__)("Ascending","quicktasker"),value:Ii.Asc},{label:(0,o.__)("Descending","quicktasker"),value:Ii.Desc}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{order:e}))}}),(0,n.jsx)(Ks,{text:(0,o.__)("Apply filter","quicktasker"),icon:(0,n.jsx)(Ei.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:()=>t(i)})]})};var Ai,Ni,Ci;!function(e){e.Pipeline="pipeline",e.Stage="stage",e.Task="task",e.All="all"}(Ai||(Ai={})),function(e){e.Success="success",e.Error="error"}(Ni||(Ni={})),function(e){e.Admin="admin",e.Quicktasker="quicktasker_user",e.Automation="automation",e.All="all"}(Ci||(Ci={}));const Oi=({logs:e,loading:t})=>t?(0,n.jsx)(Bt,{ovalSize:"64",className:"wpqt-mt-12"}):0===e.length?(0,n.jsx)(di,{text:(0,o.__)("No logs found","quicktasker")}):(0,n.jsx)("div",{className:"wpqt-logs-grid",children:e.map((e=>(0,n.jsx)(An,{log:e},e.id)))});var Ii,Di,Pi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};!function(e){e.Asc="ASC",e.Desc="DESC"}(Ii||(Ii={})),function(e){e.Hundred="100",e.TwoHundred="200",e.FiveHundred="500",e.All="all"}(Di||(Di={}));const Li=()=>{const[e,t]=(0,a.useState)([]),[s,o]=(0,a.useState)({numberOfLogs:Di.Hundred,type:Ai.All,typeId:"",createdBy:Ci.All,order:Ii.Desc}),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!0);(0,a.useEffect)((()=>{l&&(w(),d(!1))}),[s,l]);const w=()=>Pi(void 0,void 0,void 0,(function*(){try{c(!0);const e=Object.assign({},s);e.numberOfLogs===Di.All&&delete e.numberOfLogs,e.type===Ai.All&&delete e.type,""===e.typeId&&delete e.typeId,e.createdBy===Ci.All&&delete e.createdBy;const a=yield function(e){const t=new URLSearchParams(Object.entries(e).reduce(((e,[t,s])=>(e[t]=String(s),e)),{}));return u()({path:`/wpqt/v1/global-logs?${t.toString()}`,method:"GET",headers:p()})}(e);t(a.data)}catch(e){console.error(e),i.oR.error("Failed to fetch logs")}finally{c(!1)}}));return(0,n.jsxs)("div",{children:[(0,n.jsx)(Si,{filterSettings:s,setFilterSettings:e=>Pi(void 0,void 0,void 0,(function*(){o(e),d(!0)}))}),(0,n.jsx)(Oi,{logs:e,loading:r})]})},Ri=()=>(0,n.jsxs)(Gt,{children:[(0,n.jsx)(l,{description:(0,o.__)("The logs page where you can see all logs and filter them.","quicktasker"),children:(0,o.__)("Logs","quicktasker")}),(0,n.jsx)(Li,{})]});function Ui({overviewFilter:e,onCreationDateChange:t,onDoneDateChange:s}){const a=e=>e instanceof Date?ea()(e).format("YYYY-MM-DD"):"";return(0,n.jsx)("div",{children:(0,n.jsxs)(as,{title:(0,o.__)("Statistics filtering","quicktasker"),titleClassName:"wpqt-text-center",childrenClassName:"wpqt-gap-6 wpqt-justify-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:(0,o.__)("Task creation date","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("(Filter tasks that have creation date equal or bigger than)","quicktasker")})]}),(0,n.jsx)(ta.A,{onChange:e=>{const s=a(e);t(s)},value:e.taskCreationDate,format:"y-MM-dd",id:"taskCreationDate"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:(0,o.__)("Task done date","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("(Filter tasks that have done date equal or smaller than)","quicktasker")})]}),(0,n.jsx)(ta.A,{onChange:e=>{const t=a(e);s(t)},value:e.taskDoneDate,format:"y-MM-dd",id:"taskCreationDate"})]})]})})}var Mi=s(2298);function Fi(e){const t=e.slice(1).some((e=>e[1]>0));return e.length>1&&t}function zi({text:e}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center wpqt-items-center wpqt-h-[400px] wpqt-w-[500px] wpqt-font-semibold",children:e})}function Ki({pipelineOverviewData:e,options:t,width:s}){var a,i;const r=[["Archived tasks","Task Count"],["Archived tasks",parseInt(null!==(a=null==e?void 0:e.archivedTasksCount)&&void 0!==a?a:"0")||0],["Not archived tasks",parseInt(null!==(i=null==e?void 0:e.notArchivedTasksCount)&&void 0!==i?i:"0")||0]];return Fi(r)?(0,n.jsx)(Mi.t1,{chartType:"PieChart",data:r,options:Object.assign(Object.assign({},t),{title:"Archived tasks"}),width:s,height:"400px"}):(0,n.jsx)(zi,{text:(0,o.__)("Not enough data to display archived tasks chart","quicktasker")})}function $i({pipelineOverviewData:e,options:t,width:s}){var a;const i=[["Stage","Task Count"],...null!==(a=null==e?void 0:e.stages.map((e=>[e.name,parseInt(e.tasksCount)||0])))&&void 0!==a?a:[]];return Fi(i)?(0,n.jsx)(Mi.t1,{chartType:"PieChart",data:i,options:Object.assign(Object.assign({},t),{title:"Task distribution by stages"}),width:s,height:"400px"}):(0,n.jsx)(zi,{text:(0,o.__)("Not enough data to display task distribution by stages chart","quicktasker")})}function Vi({pipelineOverviewData:e,options:t,width:s}){var a,i;const r=[["Task status","Task Count"],["Done",parseInt(null!==(a=null==e?void 0:e.doneTasksCount)&&void 0!==a?a:"0")||0],["Not Done",parseInt(null!==(i=null==e?void 0:e.notDoneTasksCount)&&void 0!==i?i:"0")||0]];return Fi(r)?(0,n.jsx)(Mi.t1,{chartType:"PieChart",data:r,options:Object.assign(Object.assign({},t),{title:"Task status"}),width:s,height:"400px"}):(0,n.jsx)(zi,{text:(0,o.__)("Not enough data to display task status chart","quicktasker")})}var Bi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Gi={legend:{position:"left",alignment:"center",textStyle:{color:"#233238",fontSize:14}}};function Hi({pipeline:e,overviewFilter:t}){const[s,i]=(0,a.useState)(null),[o,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(()=>{Bi(this,void 0,void 0,(function*(){try{r(!0);const s=yield function(e,t){const s=new URLSearchParams({taskStartDate:t.taskCreationDate||"",taskDoneDate:t.taskDoneDate||"",taskAssignees:t.taskAssignees.join(",")});return u()({path:`/wpqt/v1/pipelines/${e}/overview?${s.toString()}`,method:"GET",headers:p()})}(e.id,t);i(s.data)}catch(e){console.error(e)}finally{r(!1)}}))})()}),[e.id,t]),o||!s?(0,n.jsx)(Bt,{ovalSize:"48"}):(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-wrap wpqt-justify-center xl:wpqt-justify-start",children:[(0,n.jsx)($i,{pipelineOverviewData:s,options:Gi,width:"500px"}),(0,n.jsx)(Vi,{pipelineOverviewData:s,options:Gi,width:"500px"}),(0,n.jsx)(Ki,{pipelineOverviewData:s,options:Gi,width:"500px"})]})}function Wi({pipeline:e}){const[t,s]=(0,a.useState)({taskCreationDate:null,taskDoneDate:null,taskAssignees:[]});return(0,n.jsxs)("div",{children:[(0,n.jsx)(Ui,{overviewFilter:t,onCreationDateChange:e=>{s(Object.assign(Object.assign({},t),{taskCreationDate:e}))},onDoneDateChange:e=>{s(Object.assign(Object.assign({},t),{taskDoneDate:e}))}}),(0,n.jsx)(Hi,{pipeline:e,overviewFilter:t})]})}function Qi(){const{state:{pipelines:e}}=(0,a.useContext)(Jt),t=e.map((e=>e.name)),s=e.map((e=>(0,n.jsx)(Wi,{pipeline:e},e.id)));return(0,n.jsxs)(Gt,{children:[(0,n.jsx)(l,{description:(0,o.__)("Get overview of the tasks.","quicktasker"),children:(0,o.__)("Overview","quicktasker")}),(0,n.jsx)(bn,{tabs:t,tabsContent:s,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})]})}function Yi(){const{state:{activePipeline:e}}=(0,a.useContext)(cs),t=()=>(null==e?void 0:e.stages)||[],s=e=>{const s=t();let a=null;return s?(s.forEach((t=>{t.tasks&&!a&&t.tasks.find((t=>t.id===e))&&(a=t)})),a):null},n=(0,a.useMemo)((()=>{const e=t();return e?e.map((e=>({label:e.name,value:e.id}))):[]}),[e]),i=(0,a.useMemo)((()=>{const e=t(),s=[];return e?(e.forEach((e=>{e.tasks&&s.push(...e.tasks)})),s):s}),[e]),o=null==e?void 0:e.settings;return{getActivePipelineStages:t,getActivePipelinStageTasksLength:e=>{const s=t();if(!s)return 0;const a=s.find((t=>t.id===e));return a&&a.tasks?a.tasks.length:0},getTaskStage:s,getTaskOrderInStage:e=>{const t=s(e);if(!t||!t.tasks)return null;const a=t.tasks.findIndex((t=>t.id===e));return-1!==a?a:null},activePipelineTasks:i,activePipelineSettings:o,isTaskOnLastStage:e=>{const a=t();if(!a)return!1;const n=s(e);if(!n)return!1;const i=a[a.length-1];return n.id===i.id},stageOptions:n}}const Xi=()=>{const{state:{users:e,wpUsers:t}}=(0,a.useContext)(js);return{getUser:(s,a)=>a===ht.QUICKTASKER?e.find((e=>e.id===s)):a===ht.WP_USER?t.find((e=>e.id===s)):void 0,combinedUsers:(0,a.useMemo)((()=>[...e,...t]),[e,t])}},Ji=(e,t)=>{switch(t.type){case $:{const{id:s,type:a}=t.payload;return Object.assign(Object.assign({},e),{userFilter:{id:s,type:a}})}case K:return Object.assign(Object.assign({},e),{stageIdFilter:t.payload});default:return e}},Zi={stageIdFilter:"",userFilter:{id:null,type:null}},eo=(0,a.createContext)({state:Zi,taskViewDispatch:()=>{}}),to=({children:e})=>{const[t,s]=(0,a.useReducer)(Ji,Zi);return(0,n.jsx)(eo.Provider,{value:{state:t,taskViewDispatch:s},children:e})};function so(){const{state:{stageIdFilter:e,userFilter:t},taskViewDispatch:s}=(0,a.useContext)(eo),{stageOptions:i}=Yi(),{combinedUsers:r}=Xi(),c=r.map((e=>({value:`${e.id}:${e.user_type}`,label:`${e.name} (${jt[e.user_type]})`}))),l=t.id&&t.type?`${t.id}:${t.type}`:"";return(0,n.jsxs)(as,{title:(0,o.__)("Filter tasks","quicktasker"),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(on,{labelFor:"task-view-stage-filter",className:"wpqt-block wpqt-text-center",children:(0,o.__)("Stage","quicktasker")}),(0,n.jsx)(ts,{id:"task-view-stage-filter",allSelectorLabel:(0,o.__)("All stages","quicktasker"),selectedOptionValue:e,options:i,onSelectionChange:e=>{s({type:K,payload:e})}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(on,{labelFor:"task-view-assigned-user-filter",className:"wpqt-block wpqt-text-center",children:(0,o.__)("Assigned user","quicktasker")}),(0,n.jsx)(ts,{id:"task-view-assigned-user-filter",allSelectorLabel:(0,o.__)("All users","quicktasker"),selectedOptionValue:l,options:c,onSelectionChange:e=>{const[t,a]=e.split(":");s({type:$,payload:{id:t,type:a}})}})]})]})}function ao(){const{state:{moveTaskModalOpen:e,taskToEdit:t},modalDispatch:s}=(0,a.useContext)(xs),{dispatch:i}=(0,a.useContext)(cs),{getActivePipelineStages:r,getActivePipelinStageTasksLength:c,getTaskStage:l,getTaskOrderInStage:d}=Yi(),{moveTask:u}=hs(),[p,w]=(0,a.useState)(0),[h,m]=(0,a.useState)(""),[q,v]=(0,a.useState)(!1),x=c(h),f=Array.from({length:x+1},((e,t)=>({value:t.toString(),label:(t+1).toString()}))),_=r().map((e=>({value:e.id,label:e.name}))),k=()=>{s({type:ne})};return(0,a.useEffect)((()=>{if(t){const e=l(t.id),s=d(t.id);e&&null!==s&&(m(e.id),w(s))}}),[t]),(0,n.jsx)(Vs,{modalOpen:e,closeModal:k,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)("h2",{children:(0,o.__)("Change task location on board","quicktasker")}),(0,n.jsx)("label",{htmlFor:"move-task-stage-selection",children:(0,o.__)("Select stage","quicktasker")}),(0,n.jsx)(ts,{id:"move-task-stage-selection",allSelector:!1,selectedOptionValue:h,options:_,onSelectionChange:e=>{m(e),w(0)}}),(0,n.jsx)("label",{htmlFor:"move-task-order-selection",children:(0,o.__)("Select order","quicktasker")}),(0,n.jsx)(ts,{id:"move-task-order-selection",allSelector:!1,selectedOptionValue:String(p),options:f,onSelectionChange:e=>w(Number(e))}),(0,n.jsx)(zs,{btnText:(0,o.__)("Apply","quicktasker"),loading:q,onClick:()=>{return e=this,s=void 0,n=function*(){if(!t)return;const e=l(t.id),s=d(t.id);e&&null!==s&&(v(!0),yield u(t.id,h,p,(t=>{t&&(i({type:g,payload:{source:{droppableId:e.id,index:s},destination:{droppableId:h,index:p}}}),k())})),v(!1))},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n}})]})})}const no=(0,a.forwardRef)((({addPipeline:e,modalSaving:t},s)=>{const[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(""),d=()=>{r(""),l("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:d}))),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(Gs,{children:[(0,n.jsx)(Hs,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(qa,{isAutoFocus:!0,value:i,onChange:e=>r(e)})}),(0,n.jsx)(Hs,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(fa,{rowsCount:3,value:c,onChange:e=>l(e)})})]}),(0,n.jsx)(Ws,{onSave:()=>{e(i,c)},loading:t,saveBtnText:(0,o.__)("Add board","quicktasker")})]})}));var io=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function oo(){return{deletePipeline:(e,t)=>io(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e}`,method:"DELETE",headers:p()})}(e);t&&t(s.data.deletedPipelineId,s.data.pipelineIdToLoad)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete board","quicktasker"))}})),addPipeline:(e,t,s,a)=>io(this,void 0,void 0,(function*(){try{const a=yield(n=e,r=t,u()({path:"/wpqt/v1/pipelines",method:"POST",data:{name:n,description:r},headers:p()}));i.oR.success((0,o.__)("Board created successfully","quicktasker")),s&&s(a.data)}catch(e){i.oR.error((0,o.__)("Failed to create a board","quicktasker")),a&&a(e)}var n,r})),editPipeline:(e,t,s)=>io(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e.id}`,method:"PATCH",data:{name:e.name,description:e.description,is_primary:e.is_primary},headers:p()})}(e);i.oR.success((0,o.__)("Board updated successfully","quicktasker")),t&&t(s.data)}catch(e){i.oR.error((0,o.__)("Failed to update board","quicktasker")),s&&s(e)}}))}}function ro(){const{state:{newPipelineModalOpen:e}}=(0,a.useContext)(xs),{fetchAndSetPipelineData:t}=(0,a.useContext)(cs),{modalSaving:s,setModalSaving:i,modalContentRef:o,closeModal:r,handleSuccess:c,handleError:l}=Ts(X),{addPipeline:d}=oo();return(0,n.jsx)(Vs,{modalOpen:e,closeModal:r,children:(0,n.jsx)(no,{ref:o,addPipeline:(e,s)=>{return a=this,n=void 0,u=function*(){i(!0),yield d(e,s,(e=>{c(E,e,bs.PIPELINES),t(e.id),r()}),(e=>{l(e)}))},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{r(u.next(e))}catch(e){t(e)}}function i(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){var a;t.done?e(t.value):(a=t.value,a instanceof o?a:new o((function(e){e(a)}))).then(s,i)}r((u=u.apply(a,n||[])).next())}));var a,n,o,u},modalSaving:s,setModalSaving:i})})}const co=(0,a.forwardRef)((({editPipeline:e,modalSaving:t},s)=>{const{state:{pipelineToEdit:r},modalDispatch:c}=(0,a.useContext)(xs),{fetchAndSetPipelineData:l,dispatch:d}=(0,a.useContext)(cs),{pipelinesDispatch:u}=(0,a.useContext)(Jt),{deletePipeline:p}=oo(),[w,h]=(0,a.useState)(""),[m,q]=(0,a.useState)(""),{loading1:v,setLoading1:x}=sa();(0,a.useEffect)((()=>{r&&(h(r.name),q(r.description||""))}),[r]);const f=()=>{h(""),q("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:f}))),r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsx)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:(0,n.jsxs)("div",{className:"wpqt-mb-5 wpqt-grid wpqt-grid-cols-1 wpqt-gap-4 md:wpqt-grid-cols-[auto_1fr]",children:[(0,n.jsxs)(Gs,{children:[(0,n.jsx)(Hs,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(qa,{isAutoFocus:!0,value:w,onChange:e=>h(e)})}),(0,n.jsx)(Hs,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(fa,{rowsCount:3,value:m,onChange:e=>q(e)})})]}),(0,n.jsx)(Ya,{entityId:r.id,entityType:wa.Pipeline})]})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:(0,n.jsx)(Ks,{icon:(0,n.jsx)(Xs.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:v,text:(0,o.__)("Delete board","quicktasker"),onClick:()=>{r&&(x(!0),p(r.id,((e,t)=>{c({type:X}),x(!1),i.oR.success((0,o.__)("Board deleted","quicktasker")),u({type:D,payload:e}),null!==t?(u({type:A,payload:t}),l(t)):d({type:P})})))}})})]}),(0,n.jsx)(Ws,{onSave:()=>{r&&e(Object.assign(Object.assign({},r),{name:w,description:m}))},loading:t,saveBtnText:(0,o.__)("Save","quicktasker")})]}):null}));function lo(){const{state:{pipelineModalOpen:e}}=(0,a.useContext)(xs),{modalSaving:t,setModalSaving:s,modalContentRef:i,closeModal:o,handleSuccess:r,handleError:c}=Ts(X),{editPipeline:l}=oo();return(0,n.jsx)(Vs,{modalOpen:e,closeModal:o,size:"xl",children:(0,n.jsx)(co,{ref:i,editPipeline:e=>{return t=this,a=void 0,i=function*(){s(!0),yield l(e,(e=>{r(S,e,bs.ACTIVE_PIPELINE)}),(e=>{c(e)}))},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i},modalSaving:t,setModalSaving:s})})}var uo=s(9919),po=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const wo=(0,a.forwardRef)((({editStage:e,addStage:t,stageModalSaving:s},i)=>{const{state:{stageToEdit:r}}=(0,a.useContext)(xs),[c,l]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),p=!!r;(0,a.useEffect)((()=>{r&&(l(r.name),u(r.description))}),[r]);const w=()=>{l(""),u("")};return(0,a.useImperativeHandle)(i,(()=>({clearContent:w}))),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Bs,{children:p?(0,o.__)("Edit Stage","quicktasker"):(0,o.__)("Add Stage","quicktasker")}),(0,n.jsxs)(Gs,{children:[(0,n.jsx)(Hs,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(qa,{isAutoFocus:!0,value:c,onChange:e=>l(e)})}),(0,n.jsx)(Hs,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(fa,{rowsCount:3,value:d,onChange:e=>u(e)})})]}),(0,n.jsx)(Ws,{onSave:()=>{p?e(Object.assign(Object.assign({},r),{name:c,description:d})):t(c,d)},loading:s,saveBtnText:p?(0,o.__)("Save","quicktasker"):(0,o.__)("Add stage","quicktasker")})]})}));var ho=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function mo(){const{state:{stageModalOpen:e,targetPipelineId:t}}=(0,a.useContext)(xs),{modalSaving:s,setModalSaving:r,modalContentRef:c,closeModal:l,handleSuccess:d,handleError:w}=Ts(H),{editStage:h,addStage:m}=function(){return{editStage:(e,t,s)=>po(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/stages/${e.id}`,method:"PATCH",data:{name:e.name,description:e.description},headers:p()})}(e);i.oR.success((0,o.__)("Stage updated successfully","quicktasker")),t&&t(s.data)}catch(e){i.oR.error((0,o.__)("Failed to update stage","quicktasker")),s&&s(e)}})),addStage:(e,t,s,a,n)=>po(this,void 0,void 0,(function*(){try{const n=yield(r=e,c=t,l=s,u()({path:"/wpqt/v1/stages",method:"POST",data:{pipelineId:r,name:c,description:l},headers:p()}));i.oR.success((0,o.__)("Stage created successfully","quicktasker")),a&&a(n.data)}catch(e){i.oR.error((0,o.__)("Failed to create stage","quicktasker")),n&&n(e)}var r,c,l}))}}();return(0,n.jsx)(Vs,{modalOpen:e,closeModal:l,children:(0,n.jsx)(wo,{ref:c,editStage:e=>ho(this,void 0,void 0,(function*(){r(!0),yield h(e,(e=>{d(T,e,bs.ACTIVE_PIPELINE),l()}),(e=>{w(e)}))})),addStage:(e,s)=>ho(this,void 0,void 0,(function*(){try{r(!0),yield m(t,e,s,(e=>{d(j,{stage:Object.assign(Object.assign({},e),{tasks:[]})},bs.ACTIVE_PIPELINE),l()}))}catch(e){w(e)}})),stageModalSaving:s,stageTaskModalSaving:r})})}var qo=s(1609);function vo({pipelineId:e,stagesLength:t=0}){const{modalDispatch:s}=(0,a.useContext)(xs),i=()=>{return t=this,a=void 0,i=function*(){s({type:G,payload:{targetPipelineId:e}})},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i};return 0===t?(0,n.jsx)("div",{className:"wpqt-pipeline-height wpqt-flex wpqt-w-full wpqt-items-center wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-main-border wpqt-flex wpqt-cursor-pointer wpqt-flex-col wpqt-items-center wpqt-justify-start wpqt-gap-y-1 wpqt-p-3 hover:wpqt-bg-gray-100",onClick:i,children:[(0,n.jsx)(Ea.A,{className:"wpqt-size-6 wpqt-text-green-600"}),(0,n.jsx)("div",{className:"wpqt-whitespace-nowrap",children:(0,o.__)("Add first stage","quicktasker")})]})}):(0,n.jsxs)("div",{className:"wpqt-main-border wpqt-mb-3 wpqt-flex wpqt-cursor-pointer wpqt-flex-col wpqt-items-center wpqt-justify-start wpqt-self-start wpqt-p-3 hover:wpqt-bg-gray-100",onClick:i,children:[(0,n.jsx)(Ea.A,{className:"wpqt-size-6 wpqt-text-green-600"}),(0,n.jsx)("div",{className:"wpqt-whitespace-nowrap",children:(0,o.__)("Add stage","quicktasker")})]})}function xo(){const{modalDispatch:e}=(0,a.useContext)(xs);return(0,n.jsx)("div",{className:"wpqt-flex wpqt-h-screen-minus-top-bar wpqt-items-center wpqt-justify-center",children:(0,n.jsxs)("div",{onClick:()=>{return t=this,s=void 0,n=function*(){e({type:Q})},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n},className:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)(Ea.A,{className:"wpqt-icon-green wpqt-size-6 wpqt-cursor-pointer"}),(0,n.jsx)("span",{children:(0,o.__)("Add your first Board","quicktasker")})]})})}var fo=s(12),_o=s(5575),go=s(6304),ko=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function jo({stage:e}){var t,s,r,c;const{dispatch:l,state:{activePipeline:d},fetchAndSetPipelineData:w}=(0,a.useContext)(cs),{modalDispatch:h}=(0,a.useContext)(xs),{state:{isUserAllowedToDelete:m}}=(0,a.useContext)(ia),[q,v]=(0,a.useState)(!1),[x,f]=(0,a.useState)(!1),[_,g]=(0,a.useState)(!1),k=null!==(s=null===(t=null==d?void 0:d.stages)||void 0===t?void 0:t.length)&&void 0!==s?s:0,j=null!==(c=null===(r=e.tasks)||void 0===r?void 0:r.length)&&void 0!==c?c:0,b=+e.stage_order,T=b>0&&b<k,E=b!==k-1,S=t=>ko(this,void 0,void 0,(function*(){try{v(!0),yield function(e,t){return u()({path:`/wpqt/v1/stages/${e}/move`,method:"PATCH",data:{direction:t},headers:p()})}(e.id,t),yield w(d.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to move a stage","quicktasker"))}finally{v(!1)}}));return(0,n.jsxs)(en,{menuBtn:({active:e})=>(0,n.jsx)(tn,{isActive:e,IconComponent:fo.A}),children:[T&&(0,n.jsx)(sn,{text:(0,o.__)("Move left","quicktasker"),loading:q,icon:(0,n.jsx)(_o.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:()=>S("left")}),E&&(0,n.jsx)(sn,{text:(0,o.__)("Move right","quicktasker"),loading:q,icon:(0,n.jsx)(go.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:()=>S("right")}),(0,n.jsx)(sn,{text:(0,o.__)("Edit stage","quicktasker"),icon:(0,n.jsx)(dn.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:()=>{h({type:W,payload:{stageToEdit:e}})}}),(0,n.jsx)(sn,{text:(0,o.__)("Archive all stage tasks","quicktasker"),icon:(0,n.jsx)(Ys.A,{className:"wpqt-icon-blue wpqt-size-4"}),loading:x,onClick:()=>ko(this,void 0,void 0,(function*(){try{f(!0),yield(t=e.id,u()({path:`/wpqt/v1/stages/${t}/archive-tasks`,method:"PATCH",headers:p()})),yield w(d.id),i.oR.success((0,o.sprintf)((0,o.__)("Archived all %s tasks","quicktasker"),e.name))}catch(t){console.error(t),i.oR.error((0,o.sprintf)((0,o.__)("Failed to archive stage %s tasks","quicktasker"),e.name))}finally{f(!1)}var t})),disabled:0===j,id:`item-dropdown-${e.id}-archive`,tooltipText:0===j?(0,o.__)("No tasks to archive on the stage","quicktasker"):void 0}),m&&(0,n.jsx)(sn,{text:(0,o.__)("Delete stage","quicktasker"),icon:(0,n.jsx)(Xs.A,{className:"wpqt-icon-red wpqt-size-4"}),loading:_,onClick:()=>ko(this,void 0,void 0,(function*(){try{g(!0),yield(t=e.id,u()({path:`/wpqt/v1/stages/${t}`,method:"DELETE",data:{stageId:t},headers:p()})),l({type:y,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete a stage","quicktasker"))}finally{g(!1)}var t})),disabled:j>0,className:"!wpqt-mb-0",id:`item-dropdown-${e.id}`,tooltipText:(0,o.__)("Stage can be deleted when there are no tasks on it","quicktasker")})]})}var yo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function bo({stageId:e}){const[t,s]=(0,a.useState)(""),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),w=(0,a.useRef)(null),h=(0,a.useRef)(null),{state:{activePipeline:m},dispatch:q}=(0,a.useContext)(cs),{handleExecutedAutomations:v}=ps();(0,a.useEffect)((()=>{const e=e=>{"Enter"===e.key&&document.activeElement===h.current&&x()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[t]),(0,a.useEffect)((()=>{const e=e=>{w.current&&!w.current.contains(e.target)&&f()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),(0,a.useEffect)((()=>{var e;r&&(null===(e=h.current)||void 0===e||e.focus())}),[r]);const x=()=>yo(this,void 0,void 0,(function*(){if(t)try{d(!0);const s=yield function(e,t,s){return u()({path:"/wpqt/v1/tasks",method:"POST",data:{stageId:e,name:s,pipelineId:t},headers:p()})}(e,m.id,t);q({type:k,payload:s.data.newTask}),i.oR.success((0,o.__)("Task created","quicktasker")),f(),v(s.data.executedAutomations,s.data.newTask.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create task","quicktasker"))}finally{d(!1)}else i.oR.error((0,o.__)("Task name is required","quicktasker"))})),f=()=>{c(!1),s("")};return(0,n.jsx)("div",{ref:w,className:"wpqt-sticky wpqt-bottom-0 wpqt-z-10 wpqt-order-1 wpqt-mt-2 wpqt-flex wpqt-justify-center wpqt-bg-gray-100 wpqt-py-2",children:r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-3",children:[(0,n.jsx)(qa,{ref:h,value:t,onChange:e=>s(e),wrapperClassName:"!wpqt-mb-0",className:"!wpqt-mb-0"}),l?(0,n.jsx)($t,{width:"24",height:"24"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Ta.A,{className:"wpqt-icon-red wpqt-size-6 wpqt-cursor-pointer",onClick:f}),(0,n.jsx)(Ea.A,{className:"wpqt-icon-green wpqt-size-6 wpqt-cursor-pointer",onClick:x})]})]}):(0,n.jsxs)("div",{onClick:()=>c(!0),className:"wpqt-main-border wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-p-2 hover:wpqt-bg-white",children:[(0,o.__)("Add task","quicktasker"),(0,n.jsx)(Ea.A,{className:"wpqt-size-6 wpqt-text-green-600"})]})})}var To=s(1735),Eo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function So({task:e}){const{modalDispatch:t}=(0,a.useContext)(xs),{state:{activePipeline:s},fetchAndSetPipelineData:i}=(0,a.useContext)(cs),{state:{isUserAllowedToDelete:r}}=(0,a.useContext)(ia),{deleteTask:c,archiveTask:l}=hs(),[d,u]=(0,a.useState)(!1);return(0,n.jsxs)(en,{menuBtn:({active:e})=>(0,n.jsx)(tn,{isActive:e,IconComponent:xi.A}),children:[(0,n.jsx)(sn,{text:(0,o.__)("Archive task","quicktasker"),icon:(0,n.jsx)(Ys.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),l(e.id,(()=>{i(s.id)}))}}),(0,n.jsx)(sn,{text:(0,o.__)("Edit task","quicktasker"),icon:(0,n.jsx)(dn.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:V,payload:{taskToEdit:e}})}}),(0,n.jsx)(sn,{text:(0,o.__)("Move task","quicktasker"),icon:(0,n.jsx)(To.zhn,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:ae,payload:{task:e}})}}),r&&(0,n.jsx)(sn,{text:(0,o.__)("Delete task","quicktasker"),icon:(0,n.jsx)(Xs.A,{className:"wpqt-icon-red wpqt-size-4"}),loading:d,onClick:t=>Eo(this,void 0,void 0,(function*(){t.stopPropagation(),u(!0),yield c(e.id,(()=>{i(s.id)})),u(!1)})),className:"!wpqt-mb-0"})]})}var Ao=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function No({task:e,allowToMarkTaskAsDone:t}){const{dispatch:s}=(0,a.useContext)(cs),{changeTaskDoneStatus:i}=hs(),[o,r]=(0,a.useState)(!1),c=e.is_done,l=t=>Ao(this,void 0,void 0,(function*(){r(!0),yield i(e.id,t,(t=>{s({type:I,payload:{taskId:e.id,done:t}})})),r(!1)}));return t?o?(0,n.jsx)(Bt,{ovalSize:"24"}):(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:c?(0,n.jsx)(Js.A,{className:"wpqt-size-6 wpqt-icon-green",onClick:e=>{e.stopPropagation(),l(!1)}}):(0,n.jsx)(Js.A,{className:"wpqt-size-6 wpqt-icon-gray",onClick:e=>{e.stopPropagation(),l(!0)}})}):null}function Co({task:e,index:t,onLastStage:s}){const{modalDispatch:i}=(0,a.useContext)(xs),{state:{activePipeline:r}}=(0,a.useContext)(cs),{convertToWPTimezone:c}=ua(),l=!(null==r?void 0:r.settings).allow_only_last_stage_task_done||s,d=()=>{i({type:V,payload:{taskToEdit:e,taskModalSettings:{allowToMarkTaskAsDone:l}}})};return(0,n.jsx)(uo.sx,{draggableId:e.id,index:t,children:t=>(0,n.jsxs)("div",Object.assign({ref:t.innerRef},t.draggableProps,t.dragHandleProps,{className:"wpqt-relative wpqt-mx-4 wpqt-mb-2 wpqt-flex !wpqt-cursor-pointer wpqt-flex-col wpqt-gap-1 wpqt-rounded wpqt-border wpqt-border-gray-200 wpqt-bg-white wpqt-p-3 wpqt-shadow hover:wpqt-shadow-md",onClick:d,children:[(0,n.jsx)("div",{className:"wpqt-absolute wpqt-right-[12px] wpqt-top-[12px]",children:(0,n.jsx)(So,{task:e})}),(0,n.jsx)("div",{className:"wpqt-text-base",children:e.name}),e.description&&(0,n.jsx)("div",{className:"wpqt-text-sm wpqt-italic",children:e.description}),(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(jn,{task:e}),(0,n.jsx)(qn,{task:e})]}),e.due_date&&(0,n.jsxs)("div",{className:"wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(wi.A,{className:"wpqt-size-5 wpqt-icon-blue"}),(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[(0,o.__)("Due date","quicktasker"),":"]}),c(e.due_date)]}),(0,n.jsx)(No,{task:e,allowToMarkTaskAsDone:l})]}))},e.id)}function Oo({tasks:e}){const t=e.length;return(0,n.jsx)("span",{className:"wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-1 wpqt-text-xs",children:t})}function Io({stage:e,isLastStage:t}){return(0,n.jsxs)("div",{"data-stage-id":e.id,className:"wpqt-relative wpqt-mb-3 wpqt-flex wpqt-max-h-full wpqt-w-[360px] wpqt-flex-none wpqt-flex-col wpqt-overflow-hidden wpqt-rounded-md wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-bg-gray-100",children:[(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-flex wpqt-flex-wrap wpqt-items-center wpqt-gap-1 wpqt-px-4 wpqt-pt-3",children:[(0,n.jsxs)("div",{className:"wpqt-mr-auto wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-text-base wpqt-leading-none",children:[e.name," ",(0,n.jsx)(Oo,{tasks:e.tasks})]}),(0,n.jsx)(jo,{stage:e}),e.description&&(0,n.jsx)("div",{className:"wpqt-w-full wpqt-flex-shrink-0 wpqt-flex-grow-0 wpqt-text-sm",children:e.description})]}),(0,n.jsx)(uo.gL,{droppableId:e.id,children:s=>{var a;return(0,n.jsxs)("div",{ref:s.innerRef,className:"wpqt-flex wpqt-h-full wpqt-flex-col wpqt-overflow-y-auto wpqt-overflow-x-hidden",children:[null===(a=e.tasks)||void 0===a?void 0:a.map(((e,s)=>(0,n.jsx)(Co,{task:e,index:s,onLastStage:t},e.id))),s.placeholder,(0,n.jsx)(bo,{stageId:e.id})]})}})]})}const Do=()=>{var e,t;const{state:{activePipeline:s},dispatch:r,fetchAndSetPipelineData:c}=(0,a.useContext)(cs),{isTabVisible:l}=(()=>{const[e,t]=(0,qo.useState)(!document.hidden);return(0,qo.useEffect)((()=>{const e=()=>{t(!document.hidden)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),{isTabVisible:e}})();(0,a.useEffect)((()=>{const e=setInterval((()=>{s&&l&&c(s.id)}),3e4);return()=>clearInterval(e)}),[s,l]);const d=(e,t)=>{e.droppableId===t.droppableId?r({type:"REORDER_TASK",payload:{source:e,destination:t}}):r({type:g,payload:{source:e,destination:t}})},u=(0,a.useCallback)((e=>{return t=void 0,s=void 0,n=function*(){const{source:t,destination:s,draggableId:a}=e;if(s){d(t,s);try{yield w(a,s.droppableId,s.index)}catch(e){console.error(e),d(s,t),i.oR.error((0,o.__)("Failed to move a task","quicktasker"))}}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n}),[s]);return s?(0,n.jsxs)("div",{className:"wpqt-pipeline-height wpqt-flex wpqt-gap-[24px] wpqt-overflow-x-auto wpqt-overflow-y-hidden",children:[(0,n.jsx)(uo.JY,{onDragEnd:u,children:null===(e=s.stages)||void 0===e?void 0:e.map(((e,t)=>{const a=t===s.stages.length-1;return(0,n.jsx)(Io,{stage:e,isLastStage:a},e.id)}))}),(0,n.jsx)(vo,{pipelineId:s.id,stagesLength:null===(t=s.stages)||void 0===t?void 0:t.length}),(0,n.jsx)(li,{deleteTaskCallback:()=>{s&&c(s.id)}}),(0,n.jsx)(mo,{})]}):(0,n.jsx)(xo,{})};var Po=s(8932),Lo=s(247),Ro=s(1203),Uo=s(2496),Mo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Fo(){const{state:{activePipeline:e},fetchAndSetPipelineData:t}=(0,a.useContext)(cs),{state:{pipelines:s},pipelinesDispatch:r}=(0,a.useContext)(Jt),{modalDispatch:c}=(0,a.useContext)(xs),l=e=>Mo(this,void 0,void 0,(function*(){try{yield(t=e.id,u()({path:`/wpqt/v1/pipelines/${t}/set-primary`,method:"PATCH",headers:p()})),r({type:A,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to set primary board","quicktasker"))}var t}));return(0,n.jsxs)(en,{menuBtnClasses:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1 wpqt-rounded-xl wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-p-3",menuBtn:({active:t})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-leading-none",children:null==e?void 0:e.name}),(0,n.jsx)(Ro.A,{className:"wpqt-size-4 "+(t?"wpqt-text-qtBlueHover":"")})]}),children:[(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center wpqt-font-bold",children:(0,o.__)("Change board","quicktasker")}),s.map((s=>{const a=s.is_primary,i=(null==e?void 0:e.id)===s.id;return(0,n.jsx)(Za.Dr,{children:(0,n.jsxs)("div",{className:"wpqt-mb-3 wpqt-flex wpqt-gap-2",children:[(0,n.jsx)("div",{className:(0,xa.$)("wpqt-cursor-pointer wpqt-text-center",{"wpqt-font-bold":i}),onClick:()=>t(s.id),children:s.name}),(0,n.jsx)("div",{className:"wpqt-ml-auto",children:a?(0,n.jsx)(Uo.A,{className:"wpqt-size-4 wpqt-cursor-pointer wpqt-text-blue-500"}):(0,n.jsx)(Lo.A,{className:"wpqt-size-4 wpqt-cursor-pointer wpqt-text-gray-400",onClick:e=>{e.stopPropagation(),l(s)}})})]})},s.id)})),(0,n.jsx)(Za.Dr,{children:(0,n.jsx)("div",{className:"wpqt-mt-4 wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-2",children:(0,n.jsx)(Ks,{text:(0,o.__)("Add new board","quicktasker"),onClick:()=>Mo(this,void 0,void 0,(function*(){c({type:Q})})),icon:(0,n.jsx)(Ea.A,{className:"wpqt-size-6 wpqt-icon-green"}),className:"wpqt-bg-white hover:!wpqt-bg-gray-100"})})},"new-pipeline")]})}function zo(){const{state:{activePipeline:e,loading:t},fetchAndSetPipelineData:s}=(0,a.useContext)(cs),{modalDispatch:i}=(0,a.useContext)(xs);return e?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-py-5",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:e.name}),(0,n.jsx)(fo.A,{className:"wpqt-text-gray-400 wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{e&&i({type:Y,payload:{pipelineToEdit:e}})}})]}),e.description&&(0,n.jsx)("div",{className:"wpqt-italic",children:e.description})]}),(0,n.jsxs)("div",{className:"wpqt-ml-auto wpqt-flex wpqt-items-center wpqt-gap-3",children:[(0,n.jsx)(Ko,{}),t?(0,n.jsx)($t,{width:"24",height:"24"}):(0,n.jsx)(Cn.A,{className:"wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>s(e.id)}),(0,n.jsx)(Fo,{})]})]}):null}function Ko(){const{state:{view:e},dispatch:t}=(0,a.useContext)(cs);return(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-items-center wpqt-cursor-pointer wpqt-text-blue-400 wpqt-text-base :hover:wpqt-text-blue-600",onClick:()=>{t({type:R,payload:e===os.PIPELINE?os.TASK:os.PIPELINE})},children:e===os.PIPELINE?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Po.A,{className:"wpqt-size-5 wpqt-text-blue-400"}),(0,o.__)("Switch to Task view","quicktasker")]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(pi.A,{className:"wpqt-size-5 wpqt-text-blue-400"}),(0,o.__)("Switch to Board view","quicktasker")]})})}function $o(){const{modalDispatch:e}=(0,a.useContext)(xs),{activePipelineTasks:t,activePipelineSettings:s,isTaskOnLastStage:i}=Yi(),{taskViewFilter:r}=(()=>{const{state:{stageIdFilter:e,userFilter:t}}=(0,a.useContext)(eo);return{taskViewFilter:s=>{var a,n;const i=!e||s.stage_id===e,o=!t.id||!t.type||t.type===ht.QUICKTASKER&&(null===(a=s.assigned_users)||void 0===a?void 0:a.some((e=>e.id===t.id)))||t.type===ht.WP_USER&&(null===(n=s.assigned_wp_users)||void 0===n?void 0:n.some((e=>e.id===t.id)));return i&&o}}})(),{convertToWPTimezone:c}=ua(),l=t.filter(r);return 0===l.length?(0,n.jsx)(di,{text:(0,o.__)("No tasks","quictasker")}):(0,n.jsxs)("div",{className:"wpqt-card-grid",children:[l.map((t=>{const a=i(t.id),r=!s.allow_only_last_stage_task_done||a;return(0,n.jsxs)(hi,{className:"wpqt-cursor-pointer",title:t.name,description:t.description,dropdown:(0,n.jsx)(So,{task:t}),onClick:()=>{e({type:V,payload:{taskToEdit:t,taskModalSettings:{allowToMarkTaskAsDone:r}}})},children:[(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(jn,{task:t}),(0,n.jsx)(qn,{task:t})]}),t.due_date&&(0,n.jsxs)("div",{className:"wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(wi.A,{className:"wpqt-size-5 wpqt-icon-blue"}),(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[(0,o.__)("Due date","quicktasker"),":"]}),c(t.due_date)]}),(0,n.jsx)(No,{task:t,allowToMarkTaskAsDone:r})]},t.id)})),(0,n.jsx)(li,{})]})}const Vo=()=>(0,n.jsx)(ls,{children:(0,n.jsx)(zt,{children:(0,n.jsx)(Bo,{})})}),Bo=()=>{const{state:{view:e}}=(0,a.useContext)(cs),t=e===os.PIPELINE;return(0,n.jsxs)(Gt,{children:[(0,n.jsx)(zo,{}),t?(0,n.jsx)(Do,{}):(0,n.jsxs)(to,{children:[(0,n.jsx)(so,{}),(0,n.jsx)($o,{})]}),(0,n.jsx)(ro,{}),(0,n.jsx)(lo,{}),(0,n.jsx)(ao,{})]})};var Go=s(6197),Ho=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Wo(){return{saveCustomUserPageStyles:(e,t)=>Ho(this,void 0,void 0,(function*(){try{const a=yield(s=e,u()({path:"/wpqt/v1/settings/user-page-custom-styles",method:"PATCH",data:{styles:s},headers:p()}));t&&t(a.data),i.oR.success((0,o.__)("Custom user page styles saved successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to save custom user page styles","quicktasker"))}var s})),saveTaskCompletionDoneSetting:(e,t,s)=>Ho(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/settings/task-completion-done-restriction`,method:"PATCH",data:{allow_task_completion_only_on_last_stage:t},headers:p()})}(e,t),s&&s(t)}catch(e){s&&s(!t),console.error(e),i.oR.error((0,o.__)("Failed to save setting","quicktasker"))}}))}}const Qo=({children:e,title:t,description:s})=>(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-mb-5",children:[(0,n.jsx)("h3",{className:"wpqt-mb-1",children:t}),(0,n.jsx)("p",{children:s}),e]});const Yo=()=>{const{state:{userPageCustomStyles:e},appDispatch:t}=(0,a.useContext)(ia),[s,i]=(0,a.useState)(""),[r,c]=(0,a.useState)(!1),{saveCustomUserPageStyles:l}=Wo();return(0,a.useEffect)((()=>{i(e)}),[e]),(0,n.jsxs)(Qo,{title:(0,o.__)("Custom style","quicktasker"),description:(0,o.__)("Add custom CSS rules for QuickTasker user page.","quicktasker"),children:[(0,n.jsx)(fa,{value:s,onChange:i}),(0,n.jsx)(Ks,{text:(0,o.__)("Save","quicktasker"),loading:r,onClick:()=>{return e=void 0,a=void 0,i=function*(){c(!0),yield l(s,(e=>{t({type:be,payload:e})})),c(!1)},new((n=void 0)||(n=Promise))((function(t,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(e,a||[])).next())}));var e,a,n,i},icon:(0,n.jsx)(Go.RZ0,{className:"wpqt-icon-blue wpqt-size-4"})})]})},Xo=(e,t)=>{var s,a;switch(t.type){case Je:{const s=t.payload.automations;return Object.assign(Object.assign({},e),{automations:s})}case Ze:{const s=t.payload;return Object.assign(Object.assign({},e),{loading:s})}case et:{const n=t.payload,i=null!==(a=null===(s=e.automations)||void 0===s?void 0:s.filter((e=>e.id!==n)))&&void 0!==a?a:null;return Object.assign(Object.assign({},e),{automations:i})}case tt:{const s=t.payload,a=e.automations?[...e.automations,s]:[s];return Object.assign(Object.assign({},e),{automations:a})}default:return e}};const Jo={automations:null,loading:!0},Zo=(0,a.createContext)({state:Jo,pipelineAutomationsDispatch:()=>{}}),er=({children:e,pipelineId:t})=>{const[s,o]=(0,a.useReducer)(Xo,Jo),r=()=>{return e=void 0,s=void 0,n=function*(){try{o({type:Ze,payload:!0});const e=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e}/automations`,method:"GET",headers:p()})}(t);o({type:Je,payload:{automations:e.data.automations}})}catch(e){console.error(e),i.oR.error("Failed to load board automations")}finally{o({type:Ze,payload:!1})}},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n};return(0,a.useEffect)((()=>{r()}),[]),(0,n.jsx)(Zo.Provider,{value:{state:s,pipelineAutomationsDispatch:o},children:e})};var tr=s(8046),sr=s(1226),ar=s(6973);const nr={automationTarget:null,automationTrigger:null,automationAction:null,automationActionTargetId:null,automationActionTargetType:null,metaData:null};function ir(e,t){switch(t.type){case"SET_TARGET":return Object.assign(Object.assign({},e),{automationTarget:t.payload,automationTrigger:null,automationAction:null});case"SET_TRIGGER":return Object.assign(Object.assign({},e),{automationTrigger:t.payload,automationAction:null});case"SET_ACTION":return Object.assign(Object.assign({},e),{automationAction:t.payload});case"RESET":return nr;case at:return Object.assign(Object.assign({},e),{automationActionTargetId:t.payload.automationActionTargetId,automationActionTargetType:t.payload.automationActionTargetType});case st:return Object.assign(Object.assign({},e),{metaData:t.payload});case nt:return nr;case it:return Object.assign(Object.assign({},nr),{automationTarget:e.automationTarget});case ot:return Object.assign(Object.assign({},nr),{automationTarget:e.automationTarget,automationTrigger:e.automationTrigger});default:return e}}const or={[xt.ARCHIVE_TASK]:(0,o.__)("Archive task","quicktasker"),[xt.ASSIGN_USER]:(0,o.__)("Assign user","quickkasker"),[xt.NEW_ENTITY_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[xt.DELETED_ENTITY_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[xt.TASK_ASSIGNED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[xt.TASK_UNASSIGNED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[xt.TASK_PUBLIC_COMMENT_ADDED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[xt.TASK_PRIVATE_COMMENT_ADDED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[xt.TASK_FILE_UPLOADED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[xt.TASK_FILE_DELETED_EMAIL]:(0,o.__)("Send email notification","quicktasker")},rr={[qt.Task]:(0,o.__)("Task","quicktasker"),[qt.Stage]:(0,o.__)("Stage","quicktasker"),[qt.PIPELINE]:(0,o.__)("Board","quicktasker"),[qt.quicktasker]:"Quicktasker"},cr={[mt.TASK_DONE]:(0,o.__)("Task marked as done","quicktasker"),[mt.Task_NOT_DONE]:(0,o.__)("Task marked as not done","quicktasker"),[mt.TASK_CREATED]:(0,o.__)("Task created","quicktasker"),[mt.TASK_DELETED]:(0,o.__)("Task deleted","quicktasker"),[mt.TASK_ASSIGNED]:(0,o.__)("Task assigned","quicktasker"),[mt.TASK_UNASSIGNED]:(0,o.__)("Task unassigned","quicktasker"),[mt.TASK_PUBLIC_COMMENT_ADDED]:(0,o.__)("Public comment added","quicktasker"),[mt.TASK_PRIVATE_COMMENT_ADDED]:(0,o.__)("Private comment added","quicktasker"),[mt.TASK_FILE_UPLOADED]:(0,o.__)("File attached","quicktasker"),[mt.TASK_FILE_DELETED]:(0,o.__)("Attached file deleted","quicktasker")},lr={[mt.TASK_DONE]:[{id:xt.ARCHIVE_TASK}],[mt.Task_NOT_DONE]:[{id:xt.ARCHIVE_TASK}],[mt.TASK_CREATED]:[{id:xt.ASSIGN_USER,requireAutomationTarget:!0,requireAutomationTargetType:!0},{id:xt.NEW_ENTITY_EMAIL,requireMetaData:!0}],[mt.TASK_DELETED]:[{id:xt.DELETED_ENTITY_EMAIL,requireMetaData:!0}],[mt.TASK_ASSIGNED]:[{id:xt.TASK_ASSIGNED_EMAIL,requireMetaData:!0}],[mt.TASK_UNASSIGNED]:[{id:xt.TASK_UNASSIGNED_EMAIL,requireMetaData:!0}],[mt.TASK_PUBLIC_COMMENT_ADDED]:[{id:xt.TASK_PUBLIC_COMMENT_ADDED_EMAIL,requireMetaData:!0}],[mt.TASK_PRIVATE_COMMENT_ADDED]:[{id:xt.TASK_PRIVATE_COMMENT_ADDED_EMAIL,requireMetaData:!0}],[mt.TASK_FILE_UPLOADED]:[{id:xt.TASK_FILE_UPLOADED_EMAIL,requireMetaData:!0}],[mt.TASK_FILE_DELETED]:[{id:xt.TASK_FILE_DELETED_EMAIL,requireMetaData:!0}]},dr={[qt.Task]:lr};function ur({actionTargetId:e,actionTargetType:t}){if(null===e||null===t)return null;const{getUser:s}=Xi();if(t===vt.QUICKTASKER||t===vt.WP_USER||null!==e){const a=kt(t);if(a){const t=s(e,a);return(0,n.jsx)("div",{className:"wpqt-text-center",children:(null==t?void 0:t.name)||(0,o.__)("User not found","quicktasker")})}}return null}var pr=s(7613);function wr({value:e,label:t,onClick:s=()=>{},className:a=""}){return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-font-semibold wpqt-rounded-xl wpqt-px-4 wpqt-py-2 wpqt-border wpqt-border-solid wpqt-cursor-pointer wpqt-border-qtBorder ${a}`,onClick:()=>{s(e)},children:t})}function hr({children:e,title:t}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-base wpqt-mb-4 wpqt-text-center",children:t}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center wpqt-gap-3",children:e})]})}function mr({automationDispatch:e,automation:t}){if(!t.automationTarget||!t.automationTrigger)return null;const s=t.automationTarget,a=t.automationTrigger,i=dr[s][a];return(0,n.jsx)(hr,{title:(0,o.__)("Step 3. Select action","quicktasker"),children:i.map((t=>(0,n.jsx)(wr,{value:t.id,label:or[t.id],onClick:()=>{e({type:"SET_ACTION",payload:t})}},t.id)))})}function qr({quickTaskerUsers:e,wpUsers:t,assignUser:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-w-[320px] wpqt-flex-col",children:[(0,n.jsx)(_n,{sectionTitle:(0,o.__)("Assign a quicktasker","quicktasker"),users:e,onItemSelect:s,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No quicktaskers available to assign","quicktasker")}),(0,n.jsx)(_n,{sectionTitle:(0,o.__)("Assign a WordPress user","quicktasker"),users:t,onItemSelect:s,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No WordPress users with required permissions available to assign","quicktasker")})]})}function vr({automationAction:e,onUserAdd:t=()=>{},quickTaskerUserTargets:s=[],wpUserTargets:a=[],menuBtnClasses:i=""}){const o=[...s,...a].length>0;return(0,n.jsx)(en,{menuBtnClasses:`wpqt-inline-flex ${i}`,anchor:"bottom start",menuBtn:()=>(0,n.jsx)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1",children:(0,n.jsx)(vn.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`})}),children:e===xt.ASSIGN_USER&&(0,n.jsx)(qr,{quickTaskerUsers:s,wpUsers:a,assignUser:t})})}const xr=[xt.ASSIGN_USER];function fr({automationDispatch:e,automation:t}){var s;const{state:{users:i,wpUsers:r}}=(0,a.useContext)(js),c=null===(s=t.automationAction)||void 0===s?void 0:s.id,l=void 0!==c&&xr.includes(c);return(0,n.jsx)(hr,{title:(0,o.__)("Step 4. Select action target","quicktasker"),children:l&&(0,n.jsx)(vr,{automationAction:c,quickTaskerUserTargets:i,wpUserTargets:r,onUserAdd:t=>{e({type:at,payload:{automationActionTargetId:t.id,automationActionTargetType:t.user_type}})}})})}const _r=s(4476).z.string().email({message:"Invalid email address"});function gr({setAutomationMeta:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(e=>{try{_r.parse(e),r(!0)}catch(e){r(!1)}})(t)}),[t]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-justify-center wpqt-items-center",children:[(0,n.jsx)(In,{type:"info",children:(0,o.__)("Make sure your website is configured to send out emails","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("label",{htmlFor:"automation-meta-email-input",children:(0,o.__)("Email will be sent to","quicktasker")}),(0,n.jsx)(qa,{inputId:"automation-meta-email-input",value:t,onChange:s,wrapperClassName:"!wpqt-mb-0"}),!i&&(0,n.jsx)("div",{className:"wpqt-text-red-500",children:(0,o.__)("Invalid email address","quicktasker")})]}),(0,n.jsx)(zs,{btnText:(0,o.__)("Set email","quicktasker"),onClick:()=>{i&&e(t)}})]})}function kr({automationCreationState:e,automationDispatch:t}){var s;const a=null===(s=null==e?void 0:e.automationAction)||void 0===s?void 0:s.id;return a===xt.NEW_ENTITY_EMAIL||a===xt.DELETED_ENTITY_EMAIL||a===xt.TASK_ASSIGNED_EMAIL||a===xt.TASK_UNASSIGNED_EMAIL||a===xt.TASK_PUBLIC_COMMENT_ADDED_EMAIL||a===xt.TASK_PRIVATE_COMMENT_ADDED_EMAIL||a===xt.TASK_FILE_UPLOADED_EMAIL||a===xt.TASK_FILE_DELETED_EMAIL?(0,n.jsx)(gr,{setAutomationMeta:e=>{t({type:st,payload:e})}}):null}function jr({automationDispatch:e}){const t=Object.keys(dr).map((e=>({value:e,label:rr[e]||e})));return(0,n.jsx)(hr,{title:(0,o.__)("Step 1. Select a target","quicktasker"),children:t.map((({value:t,label:s})=>(0,n.jsx)(wr,{value:t,label:s,onClick:()=>{e({type:"SET_TARGET",payload:t})}},t)))})}function yr({automationDispatch:e,automation:t}){if(!t.automationTarget)return null;const s=t.automationTarget,a=Object.keys(dr[s]).map((e=>({value:e,label:cr[e]||e})));return(0,n.jsx)(hr,{title:(0,o.__)("Step 2. Select a trigger","quicktasker"),children:a.map((({value:t,label:s})=>(0,n.jsx)(wr,{value:t,label:s,onClick:()=>{e({type:"SET_TRIGGER",payload:t})}},t)))})}var br=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Tr({automation:e,automationDispatch:t,createAutomation:s}){const[i,r]=(0,a.useState)(!1);return null===e.automationTarget?(0,n.jsx)(jr,{automationDispatch:t}):null===e.automationTrigger?(0,n.jsx)(yr,{automationDispatch:t,automation:e}):null===e.automationAction?(0,n.jsx)(mr,{automationDispatch:t,automation:e}):e.automationAction&&e.automationAction.requireAutomationTarget&&e.automationAction.requireAutomationTargetType&&(null===e.automationActionTargetType||null===e.automationActionTargetId)?(0,n.jsx)(fr,{automationDispatch:t,automation:e}):e.automationAction.requireMetaData&&!e.metaData?(0,n.jsx)(kr,{automationCreationState:e,automationDispatch:t}):(0,n.jsx)(Ks,{text:(0,o.__)("Create automation","quicktasker"),icon:(0,n.jsx)(pr.ltU,{className:"wpqt-size-6"}),onClick:()=>br(this,void 0,void 0,(function*(){r(!0),yield s(),r(!1)})),loading:i})}var Er=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Sr({pipelineId:e}){const{pipelineAutomationsDispatch:t,state:{loading:s,automations:i}}=(0,a.useContext)(Zo),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useReducer)(ir,nr),{createAutomation:u}=ps(),p=null!==l.automationActionTargetId&&null!==l.automationActionTargetType,w=null!==l.metaData,h=!dt&&i&&i.length>=1,m="wpqt-px-3 wpqt-min-w-[60px] wpqt-cursor-pointer",q="wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1",v=()=>{d({type:"RESET"})};return s?null:r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-3 wpqt-p-4 wpqt-justify-center wpqt-items-center",children:[(0,n.jsx)(hi,{title:(0,o.__)("Target","quicktasker"),className:m,titleClassName:q,onClick:()=>{d({type:nt})},children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:l.automationTarget?rr[l.automationTarget]:(0,n.jsx)(Ar,{})})}),(0,n.jsx)(tr.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(hi,{title:(0,o.__)("Trigger","quicktasker"),className:m,titleClassName:q,onClick:()=>{d({type:it})},children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:l.automationTrigger?cr[l.automationTrigger]:(0,n.jsx)(Ar,{})})}),(0,n.jsx)(tr.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(hi,{title:(0,o.__)("Action","quicktasker"),className:m,titleClassName:q,onClick:()=>{d({type:ot})},children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center wpqt-items-center",children:[l.automationAction?or[l.automationAction.id]:(0,n.jsx)(Ar,{}),p&&(0,n.jsx)(ur,{actionTargetId:l.automationActionTargetId,actionTargetType:l.automationActionTargetType}),w&&(0,n.jsx)("div",{children:l.metaData})]})})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Tr,{automation:l,automationDispatch:d,createAutomation:()=>Er(this,void 0,void 0,(function*(){yield u(e,l,((e,s)=>{e&&s&&(v(),c(!1),t({type:tt,payload:s}))}))}))})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Ks,{icon:(0,n.jsx)(ar.QK_,{className:"wpqt-size-5"}),text:(0,o.__)("Close automation creator","quicktasker"),onClick:()=>{c(!1),v()}})})]}):h?(0,n.jsx)(Na,{description:(0,o.__)("Free version limit reached. Upgrade to premium to create more automations.","quicktasker")}):(0,n.jsx)("div",{children:(0,n.jsx)(Ks,{icon:(0,n.jsx)(ar.QK_,{className:"wpqt-size-5"}),text:(0,o.__)("Create a new automation","quicktasker"),onClick:()=>c(!0)})})}function Ar(){return(0,n.jsx)(sr.A,{className:"wpqt-size-7 wpqt-text-gray-300"})}var Nr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Cr({automation:e}){const{pipelineAutomationsDispatch:t}=(0,a.useContext)(Zo),{deleteAutomation:s}=ps(),[i,r]=(0,a.useState)(!1),c="wpqt-px-3 wpqt-pt-1 wpqt-min-w-[60px] wpqt-cursor-default",l="wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1",d=null!==e.automation_action_target_id&&null!==e.automation_action_target_type,u=null!==e.metadata;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-3 wpqt-p-4 wpqt-items-center",children:[(0,n.jsx)(hi,{title:(0,o.__)("Target","quicktasker"),className:c,titleClassName:l,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:rr[e.target_type]})}),(0,n.jsx)(tr.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(hi,{title:(0,o.__)("Trigger","quicktasker"),className:c,titleClassName:l,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:cr[e.automation_trigger]})}),(0,n.jsx)(tr.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(hi,{title:(0,o.__)("Action","quicktasker"),className:c,titleClassName:l,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center wpqt-items-center",children:[or[e.automation_action],d&&(0,n.jsx)(ur,{actionTargetId:e.automation_action_target_id,actionTargetType:e.automation_action_target_type}),u&&(0,n.jsx)("div",{children:e.metadata})]})}),(0,n.jsx)(hi,{title:(0,o.__)("Controls","quicktasker"),className:`${c} wpqt-ml-6`,titleClassName:l,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-2",children:(0,n.jsx)(Ks,{loading:i,text:(0,o.__)("Delete","quicktasker"),icon:(0,n.jsx)(Xs.A,{className:"wpqt-icon-red wpqt-size-5"}),onClick:()=>Nr(this,void 0,void 0,(function*(){r(!0),yield s(e.pipeline_id,e.id,(s=>{s&&t({type:et,payload:e.id})})),r(!1)}))})})})]})}function Or(){const{state:{automations:e,loading:t}}=(0,a.useContext)(Zo),[s,i]=(0,a.useState)(!0);return t?(0,n.jsx)(Bt,{ovalSize:"24"}):e&&0!==e.length?s?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3 wpqt-mb-3",children:e.map((e=>(0,n.jsx)(Cr,{automation:e},e.id)))}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Ks,{icon:(0,n.jsx)(ar.QK_,{className:"wpqt-size-5"}),text:(0,o.__)("Hide board automations","quicktasker"),onClick:()=>i(!1)})})]}):(0,n.jsx)("div",{children:(0,n.jsx)(Ks,{icon:(0,n.jsx)(ar.QK_,{className:"wpqt-size-5"}),text:(0,o.__)("Show board automations","quicktasker"),onClick:()=>i(!0)})}):(0,n.jsx)(In,{type:"info",children:(0,o.__)("No automations created for this board","quicktasker")})}function Ir({children:e}){const t=dt?(0,o.__)("Allows to automate various tasks","quicktasker"):(0,o.__)("Allows to automate various tasks. To create more than one automation, please upgrade to the premium version.","quicktasker");return(0,n.jsx)(Qo,{title:(0,o.__)("Board automations","quicktasker"),description:t,children:e})}function Dr({pipelineId:e}){return(0,n.jsx)(er,{pipelineId:e,children:(0,n.jsxs)(Ir,{children:[(0,n.jsx)("div",{className:"wpqt-mb-4",children:(0,n.jsx)(Or,{})}),(0,n.jsx)("div",{children:(0,n.jsx)(Sr,{pipelineId:e})})]})})}var Pr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Lr({allow_only_last_stage_task_done:e,pipelineId:t}){const[s,i]=(0,a.useState)(e),[r,c]=(0,a.useState)(!1),{saveTaskCompletionDoneSetting:l}=Wo();return(0,n.jsx)(Qo,{title:(0,o.__)("Restrict Task Completion","quicktasker"),description:(0,o.__)("Allow to mark task as done only on board last stage. By default, task can be marked as done on any stage. Will apply also to QuickTasker page","quicktasker"),children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(ga,{checked:s,handleChange:e=>Pr(this,void 0,void 0,(function*(){i(e),c(!0),yield l(t,e,(e=>{i(e)})),c(!1)}))}),r&&(0,n.jsx)($t,{width:"20",height:"20"})]})})}var Rr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ur({pipeline:e}){const[t,s]=(0,a.useState)(!0),[i,o]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(()=>{Rr(this,void 0,void 0,(function*(){try{s(!0);const a=yield(t=e.id,u()({path:`/wpqt/v1/pipelines/${t}/settings`,method:"GET",headers:p()}));o(Wt(a.data.settings))}catch(e){console.error(e)}finally{s(!1)}var t}))})()}),[]),t?(0,n.jsx)(Bt,{}):i?(0,n.jsxs)("div",{children:[(0,n.jsx)(Lr,{pipelineId:e.id,allow_only_last_stage_task_done:i.allow_only_last_stage_task_done}),(0,n.jsx)(Dr,{pipelineId:e.id})]}):null}function Mr(){const{state:{pipelines:e}}=(0,a.useContext)(Jt),t=e.map((e=>e.name)),s=e.map((e=>(0,n.jsx)(Ur,{pipeline:e},e.id)));return(0,n.jsx)("div",{children:(0,n.jsx)(bn,{tabs:t,tabsContent:s,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})})}const Fr=()=>(0,n.jsxs)(Gt,{children:[(0,n.jsx)(l,{description:(0,o.__)("Manage settings, preferences, and configurations.","quicktasker"),children:(0,o.__)("Settings","quicktasker")}),(0,n.jsx)(Yo,{}),(0,n.jsx)(Mr,{})]});var zr=s(1548),Kr=s(1266),$r=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Vr(){return{createUser:(e,t,s)=>$r(this,void 0,void 0,(function*(){try{const r=yield(a=e,n=t,u()({path:"/wpqt/v1/users",method:"POST",data:{name:a,description:n},headers:p()}));s&&s(r.data),i.oR.success((0,o.__)("User created successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("User creation failed. Please try again","quicktasker"))}var a,n})),editUser:(e,t)=>$r(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/users/${e.id}`,method:"PATCH",data:{user:e},headers:p()})}(e);t&&t(s.data),i.oR.success((0,o.__)("User edited successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("User edit failed. Please try again","quicktasker"))}})),changeUserStatus:(e,t,s)=>$r(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return u()({path:`/wpqt/v1/users/${e}/status`,method:"PATCH",data:{status:t},headers:p()})}(e,t);s&&s(a.data),i.oR.success((0,o.__)("User status changed successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change user status. Please try again","quicktasker"))}})),deleteUser:(e,t)=>$r(this,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/users/${e}`,method:"DELETE",headers:p()})}(e),t&&t(e),i.oR.success((0,o.__)("User deleted successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete user. Please try again","quicktasker"))}})),resetUserPassword:(e,t)=>$r(this,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/users/${e}/password-reset`,method:"PATCH",headers:p()})}(e),t&&t(e),i.oR.success((0,o.__)("User password reset successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to reset user password. Please try again","quicktasker"))}}))}}var Br=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Gr({data:e,changeStatus:t,changeSetUpStatus:s,changePasswordStatus:i}){const{changeUserStatus:r,deleteUser:c,resetUserPassword:l}=Vr(),{userDispatch:d}=(0,a.useContext)(js),{loading1:u,setLoading1:p,loading2:w,setLoading2:h,loading3:m,setLoading3:q}=sa(),v=e.is_active,x=e.has_password;return(0,n.jsxs)("div",{className:"wpqt-mt-5 wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(Ks,{icon:(0,n.jsx)(Po.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("User tasks","quicktasker"),onClick:()=>{window.location.hash=`#/users/${e.id}/tasks`}}),!v&&(0,n.jsx)(Ks,{icon:(0,n.jsx)(zr.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Activate user","quicktasker"),loading:w,onClick:()=>Br(this,void 0,void 0,(function*(){h(!0),yield r(e.id,!0,(e=>{d({type:_e,payload:Object.assign({},e)}),t(!0)})),h(!1)}))}),v&&(0,n.jsx)(Ks,{icon:(0,n.jsx)(zr.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Disable user","quicktasker"),loading:w,onClick:()=>Br(this,void 0,void 0,(function*(){h(!0),yield r(e.id,!1,(e=>{d({type:_e,payload:Object.assign({},e)}),t(!1)})),h(!1)}))}),x&&(0,n.jsx)(Ks,{icon:(0,n.jsx)(Kr.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:u,text:(0,o.__)("Reset password","quicktasker"),onClick:()=>Br(this,void 0,void 0,(function*(){p(!0),yield l(e.id,(()=>{s(!1),i(!1)})),p(!1)}))}),(0,n.jsx)(Ks,{icon:(0,n.jsx)(Xs.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:m,text:(0,o.__)("Delete user","quicktasker"),onClick:()=>Br(this,void 0,void 0,(function*(){q(!0),yield c(e.id,(e=>{d({type:ge,payload:e}),window.location.hash="#/users"})),q(!1)}))})]})}var Hr=s(8624),Wr=s(3997),Qr=s(5028);function Yr(){const{state:{siteURL:e,publicUserPageId:t}}=(0,a.useContext)(ia);return{userPage:e+`/wpqt?page=${t}&page_id=wpqt`}}function Xr({data:e}){const{userPage:t}=Yr(),{convertToWPTimezone:s}=ua(),a=e.is_active,i=t+"&code="+e.page_hash;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)(Jr,{label:(0,o.__)("Name","quicktasker"),value:e.name,icon:(0,n.jsx)(Hr.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(Jr,{label:(0,o.__)("Created at","quicktasker"),value:s(e.created_at),icon:(0,n.jsx)(Wr.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(Jr,{label:(0,o.__)("Assigned tasks count","quicktasker"),value:e.assigned_tasks_count,icon:(0,n.jsx)(Po.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(Jr,{label:(0,o.__)("Setup completed","quicktasker"),value:e.setup_completed?(0,o.__)("Yes","quicktasker"):(0,o.__)("No","quicktasker"),icon:(0,n.jsx)(Qr.A,{className:"wpqt-size-5 wpqt-text-yellow-600"})}),(0,n.jsx)(Jr,{label:(0,o.__)("Is active","quicktasker"),value:a?(0,o.__)("Yes","quicktasker"):(0,o.__)("No","quicktasker"),icon:(0,n.jsx)(zr.A,{className:"wpqt-size-5 "+(a?"wpqt-icon-green":"wpqt-icon-red")})}),(0,n.jsx)(Jr,{label:(0,o.__)("User Page","quicktasker"),value:(0,n.jsx)("a",{href:i,rel:"noreferrer",target:"_blank",children:i}),icon:(0,n.jsx)(fi.A,{className:"wpqt-size-5 wpqt-icon-blue"})})]})}function Jr({label:e,value:t,icon:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[s,(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[e,": "]}),(0,n.jsx)("span",{children:t})]})}var Zr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ec({userId:e}){const{loadingDispatch:t}=(0,a.useContext)(Ot),[s,r]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(()=>{Zr(this,void 0,void 0,(function*(){try{t({type:Te,payload:!0});const a=yield function(e){return u()({path:`/wpqt/v1/users/${e}/extended`,method:"GET",headers:p()})}(e);r((s=a.data,Object.assign(Object.assign({},s),{is_active:"1"===s.is_active})))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to get user data. Please try again","quicktasker"))}finally{t({type:Te,payload:!1})}var s}))})()}),[]),(0,n.jsx)(Gt,{children:s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{description:(0,o.__)("User details","quicktasker"),children:s.name}),(0,n.jsx)(Xr,{data:s}),(0,n.jsx)(Gr,{data:s,changeStatus:e=>Zr(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{is_active:e}):t))})),changeSetUpStatus:e=>Zr(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{setup_completed:e}):t))})),changePasswordStatus:e=>Zr(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{has_password:e}):t))}))})]})})}const tc=e=>Object.assign(Object.assign({},e),{is_active:"1"===e.is_active}),sc=(e,t)=>{var s;switch(t.type){case Ee:return Object.assign(Object.assign({},e),{sessionsSearchValue:null!==(s=t.payload)&&void 0!==s?s:""});case Se:{const s=t.payload.map(tc);return Object.assign(Object.assign({},e),{userSessions:s})}case Ae:{const{sessionId:s,status:a}=t.payload;return Object.assign(Object.assign({},e),{userSessions:e.userSessions.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_active:a}):e))})}case Ne:{const s=t.payload;return Object.assign(Object.assign({},e),{userSessions:e.userSessions.filter((e=>e.id!==s))})}default:return e}};var ac=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const nc={loading:!0,sessionsSearchValue:"",userSessions:[]},ic=(0,a.createContext)({state:nc,usersSessionDispatch:()=>{},loadUserSessions:()=>ac(void 0,void 0,void 0,(function*(){}))}),oc=({children:e})=>{const[t,s]=(0,a.useReducer)(sc,nc),{loadingDispatch:r}=(0,a.useContext)(Ot);(0,a.useEffect)((()=>{c()}),[]);const c=()=>ac(void 0,void 0,void 0,(function*(){try{r({type:Te,payload:!0});const e=yield u()({path:"/wpqt/v1/users/sessions",method:"GET",headers:p()});s({type:Se,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch user sessions","quicktasker"))}finally{r({type:Te,payload:!1})}}));return(0,n.jsx)(ic.Provider,{value:{state:t,usersSessionDispatch:s,loadUserSessions:c},children:e})};function rc(){const{state:{sessionsSearchValue:e},usersSessionDispatch:t}=(0,a.useContext)(ic);return(0,n.jsx)(as,{title:(0,o.__)("Session filtering","quicktasker"),children:(0,n.jsx)(qa,{value:e,onChange:e=>{t({type:Ee,payload:e})}})})}const cc=()=>{const{state:{sessionsSearchValue:e}}=(0,a.useContext)(ic);return{filterSessions:t=>t.user_name.toLowerCase().includes(e.toLowerCase())||t.user_description&&t.user_description.toLowerCase().includes(e.toLowerCase())}};var lc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function dc({session:e}){const{usersSessionDispatch:t}=(0,a.useContext)(ic),{state:{isUserAllowedToDelete:s}}=(0,a.useContext)(ia),{convertToWPTimezone:r}=ua(),c=e.is_active,l=s=>lc(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/users/sessions/${e}/status`,method:"PATCH",data:{status:t},headers:p()})}(e.id,s),t({type:Ae,payload:{sessionId:e.id,status:s}})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change session status","quicktasker"))}}));return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:e.user_name}),(0,n.jsx)("div",{className:"wpqt-italic",children:e.user_description})]}),(0,n.jsx)("div",{children:r(e.created_at_utc)}),(0,n.jsx)("div",{children:r(e.expires_at_utc)}),(0,n.jsx)("div",{className:c?"wpqt-text-qtTextGreen":"wpqt-text-qtTextRed",children:c?(0,o.__)("On","quicktasker"):(0,o.__)("Off","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-4",children:[c?(0,n.jsx)(zr.A,{className:"wpqt-icon-red wpqt-size-5 wpqt-cursor-pointer",onClick:()=>l(!1),title:(0,o.__)("Turn session off","quicktasker")}):(0,n.jsx)(zr.A,{className:"wpqt-icon-green wpqt-size-5 wpqt-cursor-pointer",onClick:()=>l(!0),title:(0,o.__)("Turn session on","quicktasker")}),s&&(0,n.jsx)(Xs.A,{className:"wpqt-icon-red wpqt-size-5 wpqt-cursor-pointer",title:(0,o.__)("Delete session","quicktasker"),onClick:()=>lc(this,void 0,void 0,(function*(){try{yield(s=e.id,u()({path:`/wpqt/v1/users/sessions/${s}`,method:"DELETE",headers:p()})),t({type:Ne,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete session","quicktasker"))}var s}))})]})]})}function uc(){const{state:{userSessions:e}}=(0,a.useContext)(ic),{filterSessions:t}=cc(),s=e.filter(t);return 0===s.length?(0,n.jsx)(di,{text:(0,o.__)("No sessions found","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-grid wpqt-grid-cols-5 wpqt-font-bold",children:[(0,n.jsx)("div",{children:(0,o.__)("Session owner","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Created at","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Expires at","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Status","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Actions","quicktasker")})]}),(0,n.jsx)("div",{className:"wpqt-grid wpqt-grid-cols-5 wpqt-items-center wpqt-gap-y-4",children:s.map((e=>(0,n.jsx)(dc,{session:e},e.id)))})]})}function pc(){return(0,n.jsx)(oc,{children:(0,n.jsxs)(Gt,{children:[(0,n.jsx)(l,{children:(0,o.__)("Quicktasker sessions","quicktasker")}),(0,n.jsx)(rc,{}),(0,n.jsx)(uc,{})]})})}function wc(){const{state:{usersSearchValue:e},userDispatch:t}=(0,a.useContext)(js);return(0,n.jsx)(as,{title:(0,o.__)("User filtering","quicktasker"),children:(0,n.jsx)(Ht.p,{type:"text",value:e,onChange:e=>{t({type:fe,payload:e.target.value})}})})}var hc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function mc({userId:e}){return(0,n.jsx)(Pn,{typeId:e,fetchData:()=>hc(this,void 0,void 0,(function*(){try{return(yield q(e,Tt.User)).data}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load log","quicktasker"))}})),renderItem:e=>(0,n.jsx)(An,{log:e}),noDataMessage:(0,o.__)("No logs available","quicktasker"),explanation:(0,o.__)("Logs can be seen only by WordPress users (with required permissions)","quicktasker")})}var qc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function vc({userId:e}){return(0,n.jsx)(Pn,{typeId:e,fetchData:()=>qc(this,void 0,void 0,(function*(){try{return(yield h(e,Tt.User,!0)).data.map(Kn)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load private comments","quicktasker"))}})),onAdd:t=>qc(this,void 0,void 0,(function*(){try{const s=yield m(e,Tt.User,!0,t);return Kn(s.data.newComment)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add private comment","quicktasker"))}})),renderItem:e=>(0,n.jsx)(Rn,{item:e}),noDataMessage:(0,o.__)("No comments available","quicktasker"),explanation:(0,o.__)("Comments that can be added and viewed only by WordPress users (with required permissions).","quicktasker"),enableAdd:!0})}var xc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function fc({userId:e}){const{addComment:t}=zn();return(0,n.jsx)(Pn,{typeId:e,fetchData:()=>xc(this,void 0,void 0,(function*(){try{return(yield h(e,Tt.User,!1)).data.map(Kn)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load comments","quicktasker"))}})),onAdd:s=>xc(this,void 0,void 0,(function*(){const a=yield t(e,Tt.User,!1,s);if(a)return Kn(a)})),renderItem:e=>(0,n.jsx)(Rn,{item:e}),noDataMessage:(0,o.__)("No comments available","quicktasker"),explanation:(0,o.__)("Comments that can be added and viewed by WordPress users (with required permissions) and current QuickTasker user (in user page).","quicktasker"),enableAdd:!0})}function _c({user:e}){const t=[(0,o.__)("Private comments","quicktasker"),(0,o.__)("Public comments","quicktasker"),(0,o.__)("Logs","quicktasker")];return(0,n.jsx)(bn,{tabs:t,tabsContent:[(0,n.jsx)(vc,{userId:e.id},1),(0,n.jsx)(fc,{userId:e.id},2),(0,n.jsx)(mc,{userId:e.id},3)]})}var gc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const kc=(0,a.forwardRef)((function({modalSaving:e,editUser:t},s){const{state:{userToEdit:i},modalDispatch:r}=(0,a.useContext)(xs),{state:{isUserAllowedToDelete:c}}=(0,a.useContext)(ia),[l,d]=(0,a.useState)(""),[u,p]=(0,a.useState)(""),[w,h]=(0,a.useState)(!1),[m,q]=(0,a.useState)(!1),{changeUserStatus:v,deleteUser:x,resetUserPassword:f}=Vr(),{userDispatch:_}=(0,a.useContext)(js),{loading1:g,setLoading1:k,loading2:j,setLoading2:y,loading3:b,setLoading3:T}=sa();(0,a.useEffect)((()=>{i&&(d(i.name),p(i.description),h(i.is_active),q(i.has_password))}),[i]);const E=()=>{d(""),p("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:E}))),i?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsxs)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:[(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-3 md:wpqt-grid-cols-[auto_1fr]",children:[(0,n.jsx)("div",{children:(0,n.jsxs)(Gs,{children:[(0,n.jsx)(Hs,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(qa,{isAutoFocus:!0,value:l,onChange:e=>d(e)})}),(0,n.jsx)(Hs,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(fa,{rowsCount:3,value:u,onChange:e=>p(e)})})]})}),(0,n.jsx)(Ya,{entityId:i.id,entityType:wa.User})]}),(0,n.jsx)(Ws,{onSave:()=>{i&&t(Object.assign(Object.assign({},i),{name:l,description:u}))},saveBtnText:e?(0,o.__)("Saving...","quicktasker"):(0,o.__)("Save","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mt-7",children:(0,n.jsx)(_c,{user:i})})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)(Ks,{icon:(0,n.jsx)(Hr.A,{className:"wpqt-icon-blue wpqt-size-4"}),text:(0,o.__)("User details","quicktasker"),onClick:()=>{window.location.hash=`#/users/${i.id}`,r({type:J})}}),(0,n.jsx)(Ks,{icon:(0,n.jsx)(Po.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("User tasks","quicktasker"),onClick:()=>{window.location.hash=`#/users/${i.id}/tasks`,r({type:J})}}),m&&(0,n.jsx)(Ks,{icon:(0,n.jsx)(Kr.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Reset password","quicktasker"),loading:g,onClick:()=>gc(this,void 0,void 0,(function*(){k(!0),yield f(i.id,(()=>{_({type:je,payload:i.id}),q(!1)})),k(!1)}))}),!w&&(0,n.jsx)(Ks,{icon:(0,n.jsx)(zr.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Activate user","quicktasker"),loading:j,onClick:()=>gc(this,void 0,void 0,(function*(){y(!0),yield v(i.id,!0,(e=>{_({type:_e,payload:Object.assign({},e)}),h(!0)})),y(!1)}))}),w&&(0,n.jsx)(Ks,{icon:(0,n.jsx)(zr.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Disable user","quicktasker"),loading:j,onClick:()=>gc(this,void 0,void 0,(function*(){y(!0),yield v(i.id,!1,(e=>{_({type:_e,payload:Object.assign({},e)}),h(!1)})),y(!1)}))}),c&&(0,n.jsx)(Ks,{icon:(0,n.jsx)(Xs.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Delete user","quicktasker"),loading:b,onClick:()=>gc(this,void 0,void 0,(function*(){T(!0),yield x(i.id,(e=>{_({type:ge,payload:e}),r({type:J})})),T(!1)}))})]})]})}):null}));var jc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function yc(){const{state:{userModalOpen:e}}=(0,a.useContext)(xs),{modalSaving:t,setModalSaving:s,modalContentRef:i,closeModal:o,handleSuccess:r}=Ts(J),{editUser:c}=Vr();return(0,n.jsx)(Vs,{modalOpen:e,closeModal:o,size:"xl",children:(0,n.jsx)(kc,{ref:i,modalSaving:t,editUser:e=>jc(this,void 0,void 0,(function*(){s(!0),yield c(e,(e=>{r(_e,e,bs.USER)})),s(!1)}))})})}function bc(){const{state:{userSettingsModalOpen:e},modalDispatch:t}=(0,a.useContext)(xs);return(0,n.jsx)(Vs,{modalOpen:e,closeModal:()=>t({type:se,payload:!1}),size:"lg",children:(0,n.jsx)("div",{children:(0,n.jsx)(Ya,{entityId:"null",entityType:wa.Users})})})}var Tc=s(8316),Ec=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Sc(){const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(""),{userDispatch:d}=(0,a.useContext)(js),{createUser:u}=Vr(),p=()=>{r(""),l(""),t(!1)};return(0,n.jsx)("div",{className:"wpqt-mb-6",children:e?(0,n.jsxs)("div",{className:"wpqt-w-1/4",children:[(0,n.jsx)("label",{className:"wpqt-mb-2 wpqt-block wpqt-font-semibold",children:(0,o.__)("User name","quicktasker")}),(0,n.jsx)(qa,{value:s,onChange:r,className:"wpqt-w-full"}),(0,n.jsx)("label",{className:"wpqt-mb-2 wpqt-block wpqt-font-semibold",children:(0,o.__)("User description","quicktasker")}),(0,n.jsx)(fa,{value:c,onChange:l,className:"wpqt-w-full"}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:[(0,n.jsx)(Ks,{text:(0,o.__)("Cancel","quicktasker"),onClick:p,icon:(0,n.jsx)(Rs.A,{className:"wpqt-icon-red wpqt-size-5"})}),(0,n.jsx)(Ks,{text:(0,o.__)("Add","quicktasker"),onClick:()=>Ec(this,void 0,void 0,(function*(){s?yield u(s,c,(e=>{d({type:xe,payload:e}),p()})):i.oR.error("User name is required")})),icon:(0,n.jsx)(Tc.A,{className:"wpqt-icon-green wpqt-size-5"})})]})]}):(0,n.jsx)(Ks,{text:(0,o.__)("Add QuickTasker","quicktasker"),onClick:()=>t(!0),icon:(0,n.jsx)(Tc.A,{className:"wpqt-icon-green wpqt-size-5"})})})}const Ac=()=>{const{state:{usersSearchValue:e}}=(0,a.useContext)(js);return{filterUsers:t=>t.name.toLowerCase().includes(e.toLowerCase())||t.description&&t.description.toLowerCase().includes(e.toLowerCase())}};var Nc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Cc({user:e}){const{modalDispatch:t}=(0,a.useContext)(xs),{userDispatch:s}=(0,a.useContext)(js),{changeUserStatus:i,deleteUser:r,resetUserPassword:c}=Vr(),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1),[w,h]=(0,a.useState)(!1),m=e.is_active,q=t=>Nc(this,void 0,void 0,(function*(){h(!0),yield i(e.id,t,(()=>{s({type:ke,payload:{userId:e.id,isActive:t}})})),h(!1)}));return(0,n.jsxs)(en,{menuBtn:({active:e})=>(0,n.jsx)(tn,{isActive:e,IconComponent:xi.A}),children:[(0,n.jsx)(sn,{text:(0,o.__)("User details","quicktasker"),icon:(0,n.jsx)(Hr.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}`}}),(0,n.jsx)(sn,{text:(0,o.__)("User tasks","quicktasker"),icon:(0,n.jsx)(Po.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}/tasks`}}),(0,n.jsx)(sn,{text:(0,o.__)("Edit user","quicktasker"),icon:(0,n.jsx)(dn.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:Z,payload:e})}}),e.has_password&&(0,n.jsx)(sn,{text:(0,o.__)("Reset password","quicktasker"),loading:l,icon:(0,n.jsx)(Kr.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>Nc(this,void 0,void 0,(function*(){t.stopPropagation(),d(!0),yield c(e.id,(()=>{s({type:je,payload:e.id})})),d(!1)}))}),m&&(0,n.jsx)(sn,{text:(0,o.__)("Disable user","quicktasker"),loading:w,icon:(0,n.jsx)(zr.A,{className:"wpqt-icon-red wpqt-size-4"}),className:"!wpqt-mb-0",onClick:e=>{e.stopPropagation(),q(!1)}}),!m&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(sn,{text:(0,o.__)("Activate user","quicktasker"),loading:w,icon:(0,n.jsx)(zr.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:e=>{e.stopPropagation(),q(!0)}}),(0,n.jsx)(sn,{text:(0,o.__)("Delete user","quicktasker"),loading:u,icon:(0,n.jsx)(Xs.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>Nc(this,void 0,void 0,(function*(){t.stopPropagation(),p(!0),yield r(e.id,(e=>{s({type:ge,payload:e})})),p(!1)}))})]})]})}function Oc({user:e}){const{userPage:t}=Yr(),{modalDispatch:s}=(0,a.useContext)(xs),i=e.is_active,r=t+"&code="+e.page_hash;return(0,n.jsxs)(hi,{title:e.name,description:e.description,dropdown:(0,n.jsx)(Cc,{user:e}),onClick:()=>{s({type:Z,payload:e})},className:"wpqt-cursor-pointer",children:[(0,n.jsx)(vi,{className:"hover:wpqt-underline wpqt-self-start",label:(0,o.__)("Open user page","quicktasker"),icon:(0,n.jsx)(fi.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:e=>{e.stopPropagation(),window.open(r,"_blank")}}),(0,n.jsx)(vi,{className:"hover:wpqt-underline wpqt-self-start",label:(0,o.__)("View user details","quicktasker"),icon:(0,n.jsx)(fi.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}`}}),(0,n.jsx)(vi,{label:(0,o.__)("Status","quicktasker"),value:i?(0,o.__)("Active","quicktasker"):(0,o.__)("Disabled","quicktasker"),valueClassName:i?"wpqt-text-qtTextGreen wpqt-font-bold":"wpqt-text-qtTextRed wpqt-font-bold",icon:(0,n.jsx)(zr.A,{className:"wpqt-size-5 "+(i?"wpqt-icon-green":"wpqt-icon-red")})})]})}function Ic(){const{state:{users:e}}=(0,a.useContext)(js),{filterUsers:t}=Ac(),s=e.filter(t);return e&&0===e.length?(0,n.jsx)(di,{text:(0,o.__)("No users found","quicktasker")}):s&&0===s.length?(0,n.jsx)(di,{}):(0,n.jsx)("div",{className:"wpqt-card-grid",children:s.map((e=>(0,n.jsx)(Oc,{user:e},e.id)))})}function Dc(){return(0,n.jsxs)("div",{children:[(0,n.jsx)(Sc,{}),(0,n.jsx)(wc,{}),(0,n.jsx)(Ic,{}),(0,n.jsx)(bc,{}),(0,n.jsx)(yc,{})]})}var Pc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};var Lc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Rc({user:e}){const[t,s]=(0,a.useState)({quicktasker_admin_role:"quicktasker_admin_role"in e.allcaps,quicktasker_admin_role_allow_delete:"quicktasker_admin_role_allow_delete"in e.allcaps,quicktasker_admin_role_manage_users:"quicktasker_admin_role_manage_users"in e.allcaps,quicktasker_admin_role_manage_settings:"quicktasker_admin_role_manage_settings"in e.allcaps}),[i,r]=(0,a.useState)(!1),{updateWPUserCapabilities:c}=function(){return{updateWPUserCapabilities:(e,t,s,a)=>Pc(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/wp-users/${e}/capabilities`,method:"PATCH",data:{quicktasker_admin_role:t.quicktasker_admin_role,quicktasker_admin_role_allow_delete:t.quicktasker_admin_role_allow_delete,quicktasker_admin_role_manage_users:t.quicktasker_admin_role_manage_users,quicktasker_admin_role_manage_settings:t.quicktasker_admin_role_manage_settings},headers:p()})}(e,t),s&&s()}catch(e){a&&a(e)}}))}}(),l=(a,n)=>Lc(this,void 0,void 0,(function*(){if(i)return;r(!0);const o=Object.assign({},t),l=Object.assign(Object.assign({},t),{[n]:a});s(l),yield c(e.id,l,(()=>{}),(()=>{s(o)})),r(!1)}));return(0,n.jsxs)(hi,{title:e.name,description:e.description,children:[(0,n.jsx)(vi,{label:(0,o.__)("Role","quicktasker"),value:Array.isArray(e.roles)?e.roles.join(", "):""}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to admin areas","quicktasker")}),(0,n.jsx)(ga,{checked:t.quicktasker_admin_role,handleChange:e=>{l(e,"quicktasker_admin_role")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to users page","quicktasker")}),(0,n.jsx)(ga,{checked:t.quicktasker_admin_role_manage_users,handleChange:e=>{l(e,"quicktasker_admin_role_manage_users")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to settings page","quicktasker")}),(0,n.jsx)(ga,{checked:t.quicktasker_admin_role_manage_settings,handleChange:e=>{l(e,"quicktasker_admin_role_manage_settings")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Allow to delete resources","quicktasker")}),(0,n.jsx)(ga,{checked:t.quicktasker_admin_role_allow_delete,handleChange:e=>{l(e,"quicktasker_admin_role_allow_delete")}})]}),i&&(0,n.jsx)(Bt,{ovalSize:"24"})]})}var Uc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Mc(){const[e,t]=(0,a.useState)(null),[s,i]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(()=>{Uc(this,void 0,void 0,(function*(){try{i(!0);const s=yield(e=At.Other,u()({path:`/wpqt/v1/wp-users?type=${encodeURIComponent(e)}`,method:"GET",headers:p()}));t(s.data)}catch(e){console.error(e)}finally{i(!1)}var e}))})()}),[]),s||null===e?(0,n.jsx)(Bt,{ovalSize:"48"}):0===e.length?(0,n.jsx)(di,{text:(0,o.__)("No non-admin WordPress users found","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Displaying non-admin WordPress users.","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-card-grid",children:e.map((e=>(0,n.jsx)(Rc,{user:e},e.id)))})]})}function Fc(){const{updateUsers:e}=(0,a.useContext)(js),{loadingDispatch:t}=(0,a.useContext)(Ot),{modalDispatch:s}=(0,a.useContext)(xs),i=[(0,n.jsx)(Dc,{},0),(0,n.jsx)(Mc,{},1)];return(0,a.useEffect)((()=>{(()=>{var s,a,n,i;s=this,a=void 0,i=function*(){t({type:Te,payload:!0}),yield e(),t({type:Te,payload:!1})},new((n=void 0)||(n=Promise))((function(e,t){function o(e){try{c(i.next(e))}catch(e){t(e)}}function r(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(s,a||[])).next())}))})()}),[]),(0,n.jsxs)(Gt,{children:[(0,n.jsx)(l,{description:(0,o.__)("Manage QuickTaskers and WordPress users. This plugin supports three types of users: WordPress admins, other WordPress users, and QuickTaskers. WordPress admins have full access to all admin areas. Other WordPress users do not have any access by default but can be granted if needed. QuickTaskers are separate users who do not have admin access but can manage tasks through a mobile-friendly webpage.","quicktasker"),icon:(0,n.jsx)(fo.A,{className:"wpqt-icon-gray wpqt-size-7 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{s({type:se,payload:!0})}}),children:(0,o.__)("Users","quicktasker")}),(0,n.jsx)(bn,{tabs:["QuickTaskers","WordPress users"],tabsContent:i,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})]})}const zc=(e,t)=>{switch(t.type){case Ce:{const s=t.payload.map(yt);return Object.assign(Object.assign({},e),{tasks:s})}case Ie:{const s=t.payload;return Object.assign(Object.assign({},e),{tasks:e.tasks.filter((e=>e.id!==s))})}case De:{const s=t.payload,a=e.tasks.map((e=>e.id===s.id?yt(s):e));return Object.assign(Object.assign({},e),{tasks:a})}case Oe:{const s=t.payload;return Object.assign(Object.assign({},e),{searchValue:s})}case Pe:{const s=t.payload;return Object.assign(Object.assign({},e),{filteredPipelineId:s})}case Le:{const{taskId:s,user:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:ft(a)?[a,...e.assigned_users]:e.assigned_users,assigned_wp_users:_t(a)?[a,...e.assigned_wp_users]:e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{tasks:n})}case Re:{const{taskId:s,user:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:ft(a)?e.assigned_users.filter((e=>e.id!==a.id)):e.assigned_users,assigned_wp_users:_t(a)?e.assigned_wp_users.filter((e=>e.id!==a.id)):e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{tasks:n})}case Ue:{const{taskId:s,done:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}default:return e}};var Kc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const $c={tasks:[],searchValue:"",filteredPipelineId:""},Vc=(0,a.createContext)({state:$c,userTasksDispatch:()=>{},fetchAndSetUserTasks:()=>Kc(void 0,void 0,void 0,(function*(){}))}),Bc=({children:e,userId:t})=>{const[s,r]=(0,a.useReducer)(zc,$c),{loadingDispatch:c}=(0,a.useContext)(Ot);(0,a.useEffect)((()=>{l()}),[]);const l=()=>Kc(void 0,void 0,void 0,(function*(){try{c({type:Te,payload:!0});const e=yield function(e){return u()({path:`/wpqt/v1/users/${e}/tasks`,method:"GET",headers:p()})}(t);r({type:Ce,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch user tasks","quicktasker"))}finally{c({type:Te,payload:!1})}}));return(0,n.jsx)(Vc.Provider,{value:{state:s,userTasksDispatch:r,fetchAndSetUserTasks:l},children:e})};function Gc(){const{state:{searchValue:e,filteredPipelineId:t},userTasksDispatch:s}=(0,a.useContext)(Vc);return(0,n.jsxs)(as,{title:(0,o.__)("Filter tasks","quicktasker"),children:[(0,n.jsx)(qa,{value:e,onChange:e=>{s({type:Oe,payload:e})},className:"!wpqt-mb-0"}),(0,n.jsx)(ss,{selectedOptionValue:t,selectionChange:e=>{s({type:Pe,payload:e})}})]})}var Hc=s(7028),Wc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Qc({taskId:e,onUnAssignTask:t}){const[s,i]=(0,a.useState)(!1);return(0,n.jsx)(en,{menuBtn:({active:e})=>(0,n.jsx)(tn,{isActive:e,IconComponent:xi.A}),children:(0,n.jsx)(sn,{text:(0,o.__)("Unassign from task","quicktasker"),loading:s,icon:(0,n.jsx)(Hc.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:s=>Wc(this,void 0,void 0,(function*(){s.stopPropagation(),i(!0),yield t(e),i(!1)})),className:"!wpqt-mb-0"})})}const Yc=()=>{const{state:{searchValue:e,filteredPipelineId:t}}=(0,a.useContext)(Vc);return{filterTasks:s=>{const a=s.name&&s.name.toLowerCase().includes(e.toLowerCase())||s.description&&s.description.toLowerCase().includes(e.toLowerCase()),n=!t||s.pipeline_id===t;return a&&n}}};var Xc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Jc({userId:e}){var t;const{filterTasks:s}=Yc(),{modalDispatch:i}=(0,a.useContext)(xs),{state:{tasks:r},userTasksDispatch:c}=(0,a.useContext)(Vc),{removeTaskFromUser:l}=hs(),d=null!==(t=null==r?void 0:r.filter(s))&&void 0!==t?t:[],u=t=>Xc(this,void 0,void 0,(function*(){yield l(e,t,(()=>{c({type:Ie,payload:t})}))}));return r&&0===r.length?(0,n.jsx)(di,{text:(0,o.__)("User has no tasks","quicktasker")}):d&&0===d.length?(0,n.jsx)(di,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-card-grid",children:d.map((e=>(0,n.jsxs)(hi,{className:"wpqt-cursor-pointer",title:e.name,description:e.description,dropdown:(0,n.jsx)(Qc,{taskId:e.id,onUnAssignTask:u}),onClick:()=>{i({type:V,payload:{taskToEdit:e}})},children:[(0,n.jsx)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:(0,n.jsx)(jn,{task:e,onUserAdd:t=>{c({type:Le,payload:{taskId:e.id,user:t}})},onUserDelete:t=>{c({type:Re,payload:{taskId:e.id,user:t}})}})}),(0,n.jsx)(qi,{task:e,onDoneStatusChange:(e,t)=>{c({type:Ue,payload:{taskId:e,done:t}})}})]},e.id)))}),(0,n.jsx)(li,{editTaskCallback:e=>{c({type:De,payload:e})}})]})}function Zc({userId:e}){return(0,n.jsx)(Bc,{userId:e,children:(0,n.jsxs)(Gt,{children:[(0,n.jsx)(l,{description:(0,o.__)("Tasks assigned to user","quicktasker"),children:(0,o.__)("User tasks","quicktasker")}),(0,n.jsx)(Gc,{}),(0,n.jsx)(Jc,{userId:e})]})})}const el=()=>{const{page:e,hash:t}=tl();if("wp-quick-tasks"===e){const e=t.match(/^#\/users\/(\d+)\/tasks$/);if(e){const t=e[1];return(0,n.jsx)(Zc,{userId:t})}const s=t.match(/^#\/users\/(\d+)$/);if(s){const e=s[1];return(0,n.jsx)(ec,{userId:e})}switch(t){case"#/users":return(0,n.jsx)(Fc,{});case"#/overview":return(0,n.jsx)(Qi,{});case"#/archive":return(0,n.jsx)(bi,{});case"#/user-sessions":return(0,n.jsx)(pc,{});case"#/logs":return(0,n.jsx)(Ri,{});case"#/settings":return(0,n.jsx)(Fr,{});case"#/guide":return(0,n.jsx)(Ti,{});default:return(0,n.jsx)(Vo,{})}}},tl=()=>({page:new URLSearchParams(window.location.search).get("page"),hash:window.location.hash}),sl=function(){const e=(()=>{const[e,t]=(0,a.useState)(el());return(0,a.useEffect)((()=>{const e=()=>{t(el()),(()=>{const{page:e,hash:t}=tl();if("wp-quick-tasks"!==e)return;const s=document.querySelectorAll("#toplevel_page_wp-quick-tasks .wp-submenu li");s.forEach((e=>e.classList.remove("wpqt-current")));const a={"#/users":"#/users","#/overview":"#/overview","#/archive":"#/archive","#/user-sessions":"#/user-sessions","#/logs":"#/logs","#/settings":"#/settings","#/guide":"#/guide",default:""};let n=a.default;void 0!==a[t]?n=a[t]:/^#\/users(\/\d+)?(\/tasks)?$/.test(t)&&(n="#/users"),s.forEach((e=>{const t=e.querySelector("a");t&&t.getAttribute("href")&&t.getAttribute("href")===`admin.php?page=wp-quick-tasks${n}`&&e.classList.add("wpqt-current")}))})()};return e(),window.addEventListener("popstate",e),window.addEventListener("hashchange",e),()=>{window.removeEventListener("popstate",e),window.removeEventListener("hashchange",e)}}),[]),e})();return(0,n.jsx)(c,{children:(0,n.jsx)(oa,{children:(0,n.jsx)(ys,{children:(0,n.jsx)(fs,{children:(0,n.jsx)(Zt,{children:(0,n.jsxs)(It,{children:[e,(0,n.jsx)(i.N9,{position:"bottom-right",className:"wpqt-z-[999999]"})]})})})})})})};(0,a.render)((0,n.jsx)(sl,{}),document.getElementById("wpqt-app"))},1609:e=>{e.exports=window.React},5795:e=>{e.exports=window.ReactDOM},790:e=>{e.exports=window.ReactJSXRuntime}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return a[e].call(s.exports,s,s.exports,i),s.exports}i.m=a,e=[],i.O=(t,s,a,n)=>{if(!s){var o=1/0;for(d=0;d<e.length;d++){for(var[s,a,n]=e[d],r=!0,c=0;c<s.length;c++)(!1&n||o>=n)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(r=!1,n<o&&(o=n));if(r){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,a,n]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},s=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var n=Object.create(null);i.r(n);var o={};t=t||[null,s({}),s([]),s(s)];for(var r=2&a&&e;"object"==typeof r&&!~t.indexOf(r);r=s(r))Object.getOwnPropertyNames(r).forEach((t=>o[t]=()=>e[t]));return o.default=()=>e,i.d(n,o),n},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=524,(()=>{var e={524:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[o,r,c]=s,l=0;if(o.some((t=>0!==e[t]))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(c)var d=c(i)}for(t&&t(s);l<o.length;l++)n=o[l],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},s=globalThis.webpackChunkquicktasker=globalThis.webpackChunkquicktasker||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.nc=void 0;var o=i.O(void 0,[96],(()=>i(7115)));o=i.O(o)})();