(()=>{"use strict";var e,t,s,a={1004:(e,t,s)=>{const a=window.wp.element;var n=s(790),i=s(9571);const o=window.wp.i18n;class r extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){var e;return this.state.hasError?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-h-screen wpqt-items-center wpqt-justify-center wpqt-text-center wpqt-text-lg",children:[(0,o.__)("Something went wrong. Please refresh the page.","quicktasker"),(0,n.jsx)("br",{}),null===(e=this.state.error)||void 0===e?void 0:e.message]}):this.props.children}}const c=r;function l({children:e,description:t=null,icon:s=null}){return(0,n.jsx)("div",{className:"wpqt-mb-6 wpqt-inline-grid wpqt-grid-cols-[auto_auto] wpqt-items-center wpqt-gap-2",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("h1",{children:[e,s&&(0,n.jsx)("span",{className:"wpqt-ml-1 wpqt-align-middle",children:s})]}),t&&(0,n.jsx)("div",{children:t})]})})}const d=window.wp.apiFetch;var u=s.n(d);function p(){return{"Content-Type":"application/json","X-WPQT-API-Nonce":window.wpqt.apiNonce}}function w(e,t,s){return u()({path:`/wpqt/v1/tasks/${e}/move`,method:"PATCH",data:{stageId:t,order:s},headers:p()})}function h(e,t,s){const a=new URLSearchParams({typeId:e,type:t,isPrivate:s.toString()}).toString();return u()({path:`/wpqt/v1/comments?${a}`,method:"GET",headers:p()})}function q(e,t,s,a){return u()({path:"/wpqt/v1/comments",data:{comment:a,typeId:e,type:t,isPrivate:s},method:"POST",headers:p()})}function m(e,t){const s=new URLSearchParams({typeId:e,type:t});return u()({path:`/wpqt/v1/logs?${s.toString()}`,method:"GET",headers:p()})}function v(e,t,s){return u()({path:`/wpqt/v1/users/${e}/tasks/${t}`,method:"DELETE",data:{user_type:s},headers:p()})}function x(e,t,s){const a=new URLSearchParams({entityId:e,entityType:t,active:String(s)});return u()({path:`/wpqt/v1/custom-fields?${a.toString()}`,method:"GET",headers:p()})}const f="SET_LOADING",g="SET_PIPELINE",_="MOVE_TASK",k="ADD_TASK",j="ADD_STAGE",y="DELETE_STAGE",b="EDIT_TASK",T="EDIT_STAGE",S="ADD_PIPELINE",E="EDIT_PIPELINE",A="SET_PRIMARY",C="SET_PIPELINES",N="ADD_USER_TO_TASK",O="REMOVE_USER_FROM_TASK",I="CHANGE_TASK_DONE_STATUS",P="REMOVE_PIPELINE",D="REMOVE_ACTIVE_PIPELINE",R="REMOVE_TASK",L="TOGGLE_VIEW",U="ADD_LABEL_TO_TASK",M="REMOVE_LABEL_FROM_TASK",F="EDIT_PIPELINE_LABEL",z="SET_STAGE_FILTER",$="SET_USER_FILTER",K="OPEN_EDIT_TASK_MODAL",V="CLOSE_TASK_MODAL",G="OPEN_NEW_STAGE_MODAL",B="CLOSE_STAGE_MODAL",H="OPEN_STAGE_EDIT_MODAL",W="OPEN_NEW_PIPELINE_MODAL",Q="OPEN_EDIT_PIPELINE_MODAL",Y="CLOSE_PIPELINE_EDIT_MODAL",X="CLOSE_USER_MODAL",J="OPEN_EDIT_USER_MODAL",Z="ADD_ASSIGNED_USER_TO_EDITING_TASK",ee="REMOVE_ASSIGNED_USER_FROM_EDITING_TASK",te="CHANGE_USER_SETTINGS_MODAL_OPEN",se="OPEN_MOVE_TASK_MODAL",ae="CLOSE_MOVE_TASK_MODAL",ne="SET_ARCHIVE_TASKS",ie="SET_ARCHIVE_SEARCH_VALUE",oe="SET_ARCHIVE_FILTERED_PIPELINE",re="REMOVE_ARCHIVED_TASK",ce="ADD_ASSIGNED_USER_TO_ARCHIVED_TASK",le="REMOVE_ASSINGED_USER_FROM_ARCHIVED_TASK",de="CHANGE_ARCHIVED_TASK_DONE_STATUS",ue="EDIT_ARCHIVED_TASK",pe="CHANGE_ARCHIVE_TASK_DONE_FILTER",we="SET_USERS",he="SET_WP_USERS",qe="ADD_USER",me="SET_USERS_SEARCH_VALUE",ve="EDIT_USER",xe="DELETE_USER",fe="CHANGE_USER_STATUS",ge="RESET_PASSWORD",_e="INIT_APP_STATE",ke="SET_CUSTOM_USER_PAGE_STYLES",je="SET_FULL_PAGE_LOADING",ye="SET_USER_SESSIONS_SEARCH_VALUE",be="SET_USER_SESSIONS",Te="CHANGE_USER_SESSION_STATUS",Se="DELETE_USER_SESSION",Ee="SET_USER_TASKS",Ae="SET_USER_TASKS_SEARCH_VALUE",Ce="REMOVE_USER_TASK",Ne="EDIT_USER_TASK",Oe="SET_USER_TASKS_FILTERED_PIPELINE",Ie="ADD_ASSIGNED_USER_TO_USER_TASK",Pe="REMOVE_ASSIGNED_USER_FROM_USER_TASK",De="CHANGE_USER_TASK_DONE_STATUS",Re="SET_CUSTOM_FIELDS",Le="ADD_CUSTOM_FIELD",Ue="DELETE_CUSTOM_FIELD",Me="SET_CUSTOM_FIELD_LOADING",Fe="SET_CUSTOM_FIELD_INITIAL_DATA",ze="SET_LABELS",$e="ADD_LABEL",Ke="EDIT_LABEL",Ve="SET_LABEL_ACTION_STATE_SELECTION",Ge="SET_LABEL_ACTION_STATE_EDITING",Be="SET_LABEL_ACTION_STATE_CREATION",He="RESET_LABEL_CONTEXT",We="SET_PIPELINE_AUTOMATIONS",Qe="SET_PIPELINE_AUTOMATIONS_LOADING",Ye="REMOVE_PIPELINE_AUTOMATION",Xe="ADD_PIPELINE_AUTOMATION",Je="SET_META",Ze="SET_ACTION_TARGET",et="RESET_AUTOMATION_TO_TARGET",tt="RESET_AUTOMATION_TO_TRIGGER",st="RESET_AUTOMATION_TO_ACTION",at=!1;var nt,it,ot,rt,ct;function lt(e){return!e.user_type||e.user_type===nt.QUICKTASKER}function dt(e){return e.user_type===nt.WP_USER}!function(e){e.QUICKTASKER="quicktasker",e.WP_USER="wp-user"}(nt||(nt={})),function(e){e.TASK_DONE="task-done",e.Task_NOT_DONE="task-not-done",e.TASK_CREATED="task-created",e.TASK_DELETED="task-deleted",e.TASK_ASSIGNED="task-assigned",e.TASK_UNASSIGNED="task-unassigned",e.TASK_PUBLIC_COMMENT_ADDED="task-public-comment-added",e.TASK_PRIVATE_COMMENT_ADDED="task-private-comment-added"}(it||(it={})),function(e){e.PIPELINE="pipeline",e.Stage="stage",e.Task="task",e.quicktasker="quicktasker"}(ot||(ot={})),function(e){e.PIPELINE="pipeline",e.STAGE="stage",e.TASK="task",e.QUICKTASKER="quicktasker",e.WP_USER="wp-user"}(rt||(rt={})),function(e){e.ARCHIVE_TASK="archive-task",e.ASSIGN_USER="assign-user",e.NEW_ENTITY_EMAIL="new-entity-email",e.DELETED_ENTITY_EMAIL="deleted-entity-email",e.TASK_ASSIGNED_EMAIL="task-assigned-email",e.TASK_UNASSIGNED_EMAIL="task-unassigned-email",e.TASK_PUBLIC_COMMENT_ADDED_EMAIL="task-public-comment-added-email",e.TASK_PRIVATE_COMMENT_ADDED_EMAIL="task-private-comment-added-email"}(ct||(ct={}));const ut=e=>Object.assign(Object.assign({},e),{is_active:"1"===e.is_active,has_password:"1"===e.has_password}),pt=e=>{switch(e){case rt.QUICKTASKER:return nt.QUICKTASKER;case rt.WP_USER:return nt.WP_USER;default:return null}},wt={[nt.QUICKTASKER]:"Quicktasker",[nt.WP_USER]:"WordPress User"},ht=e=>Object.assign(Object.assign({},e),{task_order:Number(e.task_order),free_for_all:"1"===e.free_for_all,is_archived:"1"===e.is_archived,is_done:"1"===e.is_done,assigned_users:e.assigned_users?e.assigned_users.map((e=>Object.assign({},ut(e)))):[]}),qt=(e,t)=>{var s,a,n,i,o;switch(t.type){case ne:{const s=t.payload;return Object.assign(Object.assign({},e),{archivedTasks:s.map(ht)})}case ie:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveSearchValue:s})}case oe:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveFilteredPipelineId:s})}case re:{const a=(null!==(s=e.archivedTasks)&&void 0!==s?s:[]).filter((e=>e.id!==t.payload));return Object.assign(Object.assign({},e),{archivedTasks:a})}case ce:{const{taskId:s,user:n}=t.payload,i=(null!==(a=e.archivedTasks)&&void 0!==a?a:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:lt(n)?[n,...e.assigned_users]:e.assigned_users,assigned_wp_users:dt(n)?[n,...e.assigned_wp_users]:e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{archivedTasks:i})}case le:{const{taskId:s,user:a}=t.payload,i=(null!==(n=e.archivedTasks)&&void 0!==n?n:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:lt(a)?e.assigned_users.filter((e=>e.id!==a.id)):e.assigned_users,assigned_wp_users:dt(a)?e.assigned_wp_users.filter((e=>e.id!==a.id)):e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{archivedTasks:i})}case de:{const{taskId:s,done:a}=t.payload,n=(null!==(i=e.archivedTasks)&&void 0!==i?i:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case ue:{const s=t.payload,a=(null!==(o=e.archivedTasks)&&void 0!==o?o:[]).map((e=>e.id===s.id?ht(s):e));return Object.assign(Object.assign({},e),{archivedTasks:a})}case pe:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveTaskDoneFilter:s})}default:return e}};var mt,vt,xt,ft;!function(e){e.Task="task",e.User="user"}(mt||(mt={})),function(e){e.System="system",e.Admin="admin",e.WPQTUser="quicktasker_user",e.Automation="automation"}(vt||(vt={})),function(e){e.All="all",e.Completed="completed",e.NotCompleted="not completed"}(xt||(xt={})),function(e){e.Admin="administrator",e.Other="other"}(ft||(ft={}));const gt=(e,t)=>{if(t.type===je){const s=t.payload;return Object.assign(Object.assign({},e),{fullPageLoading:s})}return e},_t={fullPageLoading:!1},kt=(0,a.createContext)({state:_t,loadingDispatch:()=>{}}),jt=({children:e})=>{const[t,s]=(0,a.useReducer)(gt,_t);return(0,n.jsx)(kt.Provider,{value:{state:t,loadingDispatch:s},children:e})};const yt={archivedTasks:null,archiveLoading:!1,archiveSearchValue:"",archiveFilteredPipelineId:"",archiveTaskDoneFilter:xt.All},bt=(0,a.createContext)({state:yt,archiveDispatch:()=>{}}),Tt=({children:e})=>{const[t,s]=(0,a.useReducer)(qt,yt),{loadingDispatch:r}=(0,a.useContext)(kt);(0,a.useEffect)((()=>{c()}),[]);const c=()=>{return e=void 0,t=void 0,n=function*(){try{r({type:je,payload:!0});const{data:e}=yield u()({path:"/wpqt/v1/tasks/archived",method:"GET",headers:p()});s({type:ne,payload:e})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch archived tasks","quicktasker"))}finally{r({type:je,payload:!1})}},new((a=void 0)||(a=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}c((n=n.apply(e,t||[])).next())}));var e,t,a,n};return(0,n.jsx)(bt.Provider,{value:{state:t,archiveDispatch:s},children:e})};var St;!function(e){e.SELECTION="select",e.CREATION="create",e.EDIT="edit"}(St||(St={}));const Et=(e,t)=>{switch(t.type){case ze:return Object.assign(Object.assign({},e),{labels:t.payload});case $e:return Object.assign(Object.assign({},e),{labels:e.labels?[...e.labels,t.payload]:[t.payload],labelActionState:St.SELECTION});case Ke:return Object.assign(Object.assign({},e),{labels:e.labels?e.labels.map((e=>e.id===t.payload.id?t.payload:e)):[t.payload]});case"REMOVE_LABEL":return Object.assign(Object.assign({},e),{labels:e.labels?e.labels.filter((e=>e.id!==t.payload.id)):[]});case Ve:return Object.assign(Object.assign({},e),{labelActionState:St.SELECTION,labelToEdit:null});case Ge:return Object.assign(Object.assign({},e),{labelActionState:St.EDIT,labelToEdit:t.payload});case Be:return Object.assign(Object.assign({},e),{labelActionState:St.CREATION,labelToEdit:null});case He:return At;default:return e}},At={labels:null,labelActionState:St.SELECTION,labelToEdit:null},Ct=(0,a.createContext)({state:At,labelDispatch:()=>{}}),Nt=({children:e})=>{const[t,s]=(0,a.useReducer)(Et,At);return(0,n.jsx)(Ct.Provider,{value:{state:t,labelDispatch:s},children:e})};var Ot=s(6061);function It({width:e="80",height:t="80",className:s="",color:a="#1d4ed8",secondaryColor:i="#2563eb"}){return(0,n.jsx)(Ot.BM,{visible:!0,height:t,width:e,color:a,secondaryColor:i,ariaLabel:"oval-loading",wrapperStyle:{},wrapperClass:s})}function Pt(){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-h-screen-minus-top-bar wpqt-flex-col wpqt-items-center wpqt-justify-center",children:(0,n.jsx)(It,{})})}function Dt({className:e,ovalSize:t}){const s=t?{width:t,height:t}:{};return(0,n.jsx)("div",{className:`wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center ${e}`,children:(0,n.jsx)(It,Object.assign({},s))})}function Rt({children:e}){const{state:{fullPageLoading:t}}=(0,a.useContext)(kt);return(0,n.jsx)("div",{className:"wpqt-pr-4",children:t?(0,n.jsx)(Pt,{}):e})}var Lt=s(2912);const Ut=e=>Object.assign(Object.assign({},e),{allow_only_last_stage_task_done:"1"===e.allow_only_last_stage_task_done}),Mt=e=>Object.assign(Object.assign({},e),{stage_order:Number(e.stage_order),tasks:(e.tasks||[]).map((e=>Object.assign({},ht(e))))}),Ft=(e,t)=>{var s;switch(t.type){case C:{const s=t.payload,a=e=>Object.assign({},Mt(e)),n=e=>{var t;return Object.assign(Object.assign({},e),{stages:null===(t=e.stages)||void 0===t?void 0:t.map(a),settings:e.settings?Ut(e.settings):void 0,is_primary:"1"===e.is_primary})};return Object.assign(Object.assign({},e),{pipelines:s.map(n)})}case S:{const a=t.payload,n=e=>Object.assign({},Mt(e)),i=Object.assign(Object.assign({},a),{stages:null===(s=a.stages)||void 0===s?void 0:s.map(n),settings:a.settings?Ut(a.settings):void 0,is_primary:!1});return Object.assign(Object.assign({},e),{pipelines:[...e.pipelines,i]})}case A:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.map((e=>Object.assign(Object.assign({},e),{is_primary:e.id===s})))})}case E:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.map((e=>e.id===s.id?s:e))})}case P:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.filter((e=>e.id!==s))})}default:return e}},zt={pipelines:[]},$t=(0,a.createContext)({state:zt,pipelinesDispatch:()=>{}}),Kt=({children:e})=>{const[t,s]=(0,a.useReducer)(Ft,zt);return(0,a.useEffect)((()=>{const e=window.wpqt.initialPipelines;s({type:C,payload:e})}),[]),(0,n.jsx)($t.Provider,{value:{state:t,pipelinesDispatch:s},children:e})};var Vt=s(3482);function Gt({options:e,selectedOptionValue:t,onSelectionChange:s,allSelector:a=!0,className:i="",allSelectorLabel:o="All boards",id:r}){return(0,n.jsxs)(Vt.l,{id:r,value:t,onChange:e=>{const t=e.target.value;s(t)},className:`!wpqt-rounded-lg !wpqt-border !wpqt-border-solid !wpqt-border-qtBorder !wpqt-px-2 !wpqt-pr-6 !wpqt-py-1 focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${i}`,children:[a&&(0,n.jsx)("option",{value:"",children:o}),e.map((e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value)))]})}function Bt({selectedOptionValue:e,selectionChange:t,extraOptions:s=[]}){const{state:{pipelines:i}}=(0,a.useContext)($t),o=(0,a.useMemo)((()=>i.map((e=>({value:e.id,label:e.name})))),[i]);return(0,n.jsx)(Gt,{options:[...o,...s],selectedOptionValue:e,onSelectionChange:t})}function Ht({children:e,title:t,childrenClassName:s="",titleClassName:a=""}){return(0,n.jsxs)("div",{className:"wpqt-mb-8",children:[(0,n.jsx)("div",{className:`wpqt-mb-3 wpqt-text-lg wpqt-text-center ${a}`,children:t}),(0,n.jsx)("div",{className:`wpqt-flex wpqt-gap-4 wpqt-items-center wpqt-justify-center ${s}`,children:e})]})}function Wt(){const{state:{archiveSearchValue:e,archiveFilteredPipelineId:t,archiveTaskDoneFilter:s},archiveDispatch:i}=(0,a.useContext)(bt);return(0,n.jsxs)(Ht,{title:(0,o.__)("Archive filtering","quicktasker"),children:[(0,n.jsx)(Lt.p,{type:"text",value:e,onChange:e=>{i({type:ie,payload:e.target.value})}}),(0,n.jsx)(Bt,{selectedOptionValue:t,selectionChange:e=>{i({type:oe,payload:e})},extraOptions:[{value:"DELETED",label:(0,o.__)("DELETED","quicktasker")}]}),(0,n.jsx)(Gt,{allSelector:!1,selectedOptionValue:s,options:[{label:(0,o.__)("All status","quicktasker"),value:xt.All},{label:(0,o.__)("Completed","quicktasker"),value:xt.Completed},{label:(0,o.__)("Not completed","quicktasker"),value:xt.NotCompleted}],onSelectionChange:e=>{const t=(e=>{switch(e){case xt.All:return xt.All;case xt.Completed:return xt.Completed;case xt.NotCompleted:return xt.NotCompleted;default:throw new Error(`Invalid selection: ${e}`)}})(e);i({type:pe,payload:t})}})]})}const Qt=(e,t)=>{var s,a,n,i,o,r,c,l,d,u,p,w,h;switch(t.type){case f:return Object.assign(Object.assign({},e),{loading:t.payload});case g:{const s=t.payload,a=(s.stages||[]).map((e=>Object.assign({},Mt(e)))),n=s.settings?Ut(s.settings):void 0;return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},s),{stages:a,settings:n,is_primary:"1"===s.is_primary})})}case _:{if(!e.activePipeline||!e.activePipeline.stages)return e;const s=((e,t,s)=>{const a=[...e],n=a.find((e=>e.id===t.droppableId)),i=a.find((e=>e.id===s.droppableId));if((null==n?void 0:n.tasks)&&(null==i?void 0:i.tasks)){const[e]=n.tasks.splice(t.index,1);i.tasks.splice(s.index,0,e)}return a})(e.activePipeline.stages,t.payload.source,t.payload.destination);return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:s})})}case"REORDER_TASK":{const{source:n,destination:i}=t.payload,o=i.droppableId,r=i.index;if(!e.activePipeline)return e;const c=null===(s=e.activePipeline.stages)||void 0===s?void 0:s.find((e=>e.id===o));if(!c||!c.tasks)return e;const l=((e,t,s)=>{const a=[...e],[n]=a.splice(t,1);return a.splice(s,0,n),a})(c.tasks,n.index,r),d=null===(a=e.activePipeline.stages)||void 0===a?void 0:a.map((e=>e.id===o?Object.assign(Object.assign({},e),{tasks:l}):e));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:d})})}case k:{const s=ht(t.payload);return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:null===(n=e.activePipeline.stages)||void 0===n?void 0:n.map((e=>e.id===s.stage_id?Object.assign(Object.assign({},e),{tasks:[...e.tasks||[],s]}):e))})}):e}case b:{const s=ht(t.payload);if(!e.activePipeline)return e;const a=null===(i=e.activePipeline.stages)||void 0===i?void 0:i.map((e=>{var t;return e.id===s.stage_id?Object.assign(Object.assign({},e),{tasks:null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s.id?s:e))}):e}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case j:{const{stage:s}=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:[...e.activePipeline.stages||[],s]})}):e}case T:{const s=t.payload;if(!e.activePipeline)return e;const a=e=>e.id===s.id?Object.assign(Object.assign({},e),{name:s.name,description:s.description}):e,n=null===(o=e.activePipeline.stages)||void 0===o?void 0:o.map(a);return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case y:{const s=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:null===(r=e.activePipeline.stages)||void 0===r?void 0:r.filter((e=>e.id!==s))})}):e}case N:{const{taskId:s,user:a}=t.payload;if(!e.activePipeline)return e;const n=null===(c=e.activePipeline.stages)||void 0===c?void 0:c.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>{if(e.id===s){const t=lt(a)?[a,...e.assigned_users||[]]:e.assigned_users||[],s=dt(a)?[a,...e.assigned_wp_users||[]]:e.assigned_wp_users||[];return Object.assign(Object.assign({},e),{assigned_users:t,assigned_wp_users:s})}return e}));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case O:{const{taskId:s,userId:a,userType:n}=t.payload;if(!e.activePipeline)return e;const i=null===(l=e.activePipeline.stages)||void 0===l?void 0:l.map((e=>{var t;const i=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>{var t,i;return e.id===s?Object.assign(Object.assign({},e),{assigned_users:n===nt.QUICKTASKER?null===(t=e.assigned_users)||void 0===t?void 0:t.filter((e=>e.id!==a)):e.assigned_users,assigned_wp_users:n===nt.WP_USER?null===(i=e.assigned_wp_users)||void 0===i?void 0:i.filter((e=>e.id!==a)):e.assigned_wp_users}):e}));return Object.assign(Object.assign({},e),{tasks:i})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:i})})}case E:{const s=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{name:s.name,description:s.description,is_primary:"1"===s.is_primary})}):e}case I:{const{taskId:s,done:a}=t.payload;if(!e.activePipeline)return e;const n=null===(d=e.activePipeline.stages)||void 0===d?void 0:d.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case D:return Object.assign(Object.assign({},e),{activePipeline:null});case R:{const s=t.payload;if(!e.activePipeline)return e;const a=null===(u=e.activePipeline.stages)||void 0===u?void 0:u.map((e=>{var t;return Object.assign(Object.assign({},e),{tasks:null===(t=e.tasks)||void 0===t?void 0:t.filter((e=>e.id!==s))})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case L:return Object.assign(Object.assign({},e),{view:t.payload});case U:{const{taskId:s,label:a}=t.payload;if(console.log(s,a),!e.activePipeline)return e;const n=null===(p=e.activePipeline.stages)||void 0===p?void 0:p.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?(console.log("Found the task!!!"),Object.assign(Object.assign({},e),{assigned_labels:[...e.assigned_labels||[],a]})):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case M:{const{taskId:s,labelId:a}=t.payload;if(!e.activePipeline)return e;const n=null===(w=e.activePipeline.stages)||void 0===w?void 0:w.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).filter((e=>e.id!==a))}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case F:{const{label:s}=t.payload;if(!e.activePipeline)return e;const a=null===(h=e.activePipeline.stages)||void 0===h?void 0:h.map((e=>{var t;const a=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).map((e=>e.id===s.id?s:e))})));return Object.assign(Object.assign({},e),{tasks:a})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}default:return e}};var Yt;!function(e){e.PIPELINE="PIPELINE-VIEW",e.TASK="TASK-VIEW"}(Yt||(Yt={}));const Xt={loading:!1,view:Yt.PIPELINE,activePipeline:null},Jt=(0,a.createContext)({state:Xt,dispatch:()=>{},fetchAndSetPipelineData:()=>Promise.resolve()}),Zt=({children:e})=>{const[t,s]=(0,a.useReducer)(Qt,Xt),{loadingDispatch:r}=(0,a.useContext)(kt);(0,a.useEffect)((()=>{const e=window.wpqt.initialActivePipelineId;e&&l(e,!0)}),[]);const c=(e,t)=>{t?r({type:je,payload:e}):s({type:f,payload:e})},l=(e,...t)=>{return a=void 0,n=[e,...t],l=function*(e,t=!1){try{c(!0,t);const{data:{pipeline:a}}=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e}`,headers:p()})}(e);s({type:g,payload:a})}catch(e){console.error(e),i.oR.error((0,o.__)("Unable to load the board. Please try again later.","quicktasker"))}finally{c(!1,t)}},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{o(l.next(e))}catch(e){t(e)}}function i(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var a;t.done?e(t.value):(a=t.value,a instanceof r?a:new r((function(e){e(a)}))).then(s,i)}o((l=l.apply(a,n||[])).next())}));var a,n,r,l};return(0,n.jsx)(Jt.Provider,{value:{state:t,dispatch:s,fetchAndSetPipelineData:l},children:e})};var es=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const ts={[ct.ARCHIVE_TASK]:(0,o.__)("Task archived by automation","quicktasker"),[ct.ASSIGN_USER]:(0,o.__)("User assigned by automation","quicktasker"),[ct.NEW_ENTITY_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[ct.DELETED_ENTITY_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[ct.TASK_ASSIGNED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[ct.TASK_UNASSIGNED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[ct.TASK_PUBLIC_COMMENT_ADDED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[ct.TASK_PRIVATE_COMMENT_ADDED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker")};function ss(){const{dispatch:e}=(0,a.useContext)(Jt),t=e=>{e&&e.forEach((e=>{if(e.automation_action.includes("email"))return;const t=ts[e.automation_action]||`Automation executed: ${e.automation_action}`;i.oR.info(t)}))},s=(t,s)=>{t&&s&&t.forEach((t=>{if(t.automation_action===ct.ARCHIVE_TASK&&e({type:R,payload:s}),t.automation_action===ct.ASSIGN_USER){const n=t.executionResult;!n||!(a=n)||"object"!=typeof a||a.user_type&&a.user_type!==nt.QUICKTASKER&&a.user_type!==nt.WP_USER||e({type:N,payload:{taskId:s,user:n}})}var a}))};return{displayAutomationMessages:t,handleExecutedAnimationsResults:s,handleExecutedAutomations:(e,a)=>{0!==e.length&&(s(e,a),t(e))},createAutomation:(e,t,s)=>es(this,void 0,void 0,(function*(){try{const a=yield function(e,t){var s;return u()({path:`/wpqt/v1/pipelines/${e}/automations`,method:"POST",data:{automationTargetId:null,automationTarget:t.automationTarget,automationTrigger:t.automationTrigger,automationAction:null===(s=t.automationAction)||void 0===s?void 0:s.id,automationActionTargetId:t.automationActionTargetId,automationActionTargetType:t.automationActionTargetType,automationMetadata:t.metaData},headers:p()})}(e,t);i.oR.success((0,o.__)("Automation created","quicktasker")),s&&s(!0,a.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create automation","quicktasker")),s&&s(!1,null)}})),deleteAutomation:(e,t,s)=>es(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/automations/${t}`,method:"DELETE",headers:p()})}(e,t),i.oR.success((0,o.__)("Automation deleted","quicktasker")),s&&s(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete automation","quicktasker")),s&&s(!1)}}))}}var as=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const ns=()=>{const{handleExecutedAutomations:e}=ss(),{displayErrorMessages:t}=function(){return{displayErrorMessages:e=>{return t=this,s=void 0,n=function*(){if(e.messages&&Array.isArray(e.messages)&&e.messages.length>0){const t=e.messages.join(", ");i.oR.error(t)}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n}}}();return{deleteTask:(t,s)=>as(void 0,void 0,void 0,(function*(){try{const a=yield function(e){return u()({path:`/wpqt/v1/tasks/${e}`,method:"DELETE",headers:p()})}(t);s&&s(),i.oR.success((0,o.__)("Task deleted","quicktasker")),e(a.data.executedAutomations,t)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete a task","quicktasker"))}})),archiveTask:(e,t)=>as(void 0,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/tasks/${e}/archive`,method:"PATCH",headers:p()})}(e),t&&t(),i.oR.success((0,o.__)("Task archived","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to archive a task","quicktasker"))}})),restoreArchivedTask:(e,t)=>as(void 0,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/tasks/${e}/archive-restore`,method:"PATCH",headers:p()})}(e),t&&t(),i.oR.success((0,o.__)("Task restored","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to restore a task","quicktasker"))}})),removeTaskFromUser:(t,s,a)=>as(void 0,void 0,void 0,(function*(){try{const n=yield v(t,s,nt.QUICKTASKER);i.oR.success((0,o.__)("Task has been unassigned","quicktasker")),e(n.data.executedAutomations,s),a&&a()}catch(e){console.error(e),i.oR.error((0,o.__)("Task unassignment failed. Try again","quicktasker"))}})),changeTaskDoneStatus:(s,a,n)=>as(void 0,void 0,void 0,(function*(){try{const t=a?(0,o.__)("Task marked as completed","quicktasker"):(0,o.__)("Task marked as incomplete","quicktasker"),r=yield function(e,t){return u()({path:`/wpqt/v1/tasks/${e}/done`,method:"PATCH",data:{done:t},headers:p()})}(s,a);n&&n(a),i.oR.success(t),e(r.data.executedAutomations,s)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change task status","quicktasker")),t(e)}})),moveTask:(e,t,s,a)=>as(void 0,void 0,void 0,(function*(){try{yield w(e,t,s),i.oR.success((0,o.__)("Task moved","quicktasaker")),a&&a(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to move a task","quicktasker")),a&&a(!1)}}))}},is=()=>Object.assign({},rs),os=(e,t)=>{var s,a,n,i,o,r,c,l,d,u,p,w,h,q,m,v;switch(t.type){case K:{const{taskToEdit:s,taskModalSettings:a}=t.payload;return Object.assign(Object.assign({},e),{taskModalOpen:!0,taskToEdit:s,targetStageId:s.stage_id,taskModalSettings:Object.assign(Object.assign({},e.taskModalSettings),a)})}case V:return is();case Z:{const d=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{assigned_users:lt(d)?[d,...null!==(a=null===(s=e.taskToEdit)||void 0===s?void 0:s.assigned_users)&&void 0!==a?a:[]]:null!==(i=null===(n=e.taskToEdit)||void 0===n?void 0:n.assigned_users)&&void 0!==i?i:[],assigned_wp_users:dt(d)?[d,...null!==(r=null===(o=e.taskToEdit)||void 0===o?void 0:o.assigned_wp_users)&&void 0!==r?r:[]]:null!==(l=null===(c=e.taskToEdit)||void 0===c?void 0:c.assigned_wp_users)&&void 0!==l?l:[]})})}case ee:{const s=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{assigned_users:lt(s)?(null!==(u=null===(d=e.taskToEdit)||void 0===d?void 0:d.assigned_users)&&void 0!==u?u:[]).filter((e=>e.id!==s.id)):null!==(w=null===(p=e.taskToEdit)||void 0===p?void 0:p.assigned_users)&&void 0!==w?w:[],assigned_wp_users:dt(s)?(null!==(q=null===(h=e.taskToEdit)||void 0===h?void 0:h.assigned_wp_users)&&void 0!==q?q:[]).filter((e=>e.id!==s.id)):null!==(v=null===(m=e.taskToEdit)||void 0===m?void 0:m.assigned_wp_users)&&void 0!==v?v:[]})})}case G:{const{targetPipelineId:s}=t.payload;return Object.assign(Object.assign({},e),{stageModalOpen:!0,targetPipelineId:s})}case H:{const{stageToEdit:s}=t.payload;return Object.assign(Object.assign({},e),{stageModalOpen:!0,stageToEdit:s})}case B:return is();case W:return Object.assign(Object.assign({},e),{newPipelineModalOpen:!0});case Q:{const{pipelineToEdit:s}=t.payload;return Object.assign(Object.assign({},e),{pipelineModalOpen:!0,pipelineToEdit:s})}case Y:return is();case"OPEN_ARCHIVE_TASK_MODAL":{const s=t.payload;return Object.assign(Object.assign({},e),{archiveTaskModalOpen:!0,archiveModalTask:s})}case"CLOSE_ARCHIVE_TASK_MODAL":return is();case"OPEN_NEW_USER_MODAL":return Object.assign(Object.assign({},e),{userModalOpen:!0});case J:{const s=t.payload;return Object.assign(Object.assign({},e),{userModalOpen:!0,userToEdit:s})}case X:return is();case te:return t.payload?Object.assign(Object.assign({},e),{userSettingsModalOpen:!0}):is();case"CHANGE_TASK_DONE_STATUS":{const{done:s}=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{is_done:s})})}case se:{const{task:s}=t.payload;return Object.assign(Object.assign({},e),{moveTaskModalOpen:!0,taskToEdit:s})}case ae:return is();default:return e}},rs={taskModalOpen:!1,targetStageId:"",taskToEdit:null,taskModalSettings:{allowToMarkTaskAsDone:!0},moveTaskModalOpen:!1,stageModalOpen:!1,stageToEdit:null,targetPipelineId:"",pipelineModalOpen:!1,newPipelineModalOpen:!1,pipelineToEdit:null,archiveTaskModalOpen:!1,archiveModalTask:null,userModalOpen:!1,userToEdit:null,userSettingsModalOpen:!1},cs=(0,a.createContext)({state:rs,modalDispatch:()=>{}}),ls=({children:e})=>{const[t,s]=(0,a.useReducer)(os,rs);return(0,n.jsx)(cs.Provider,{value:{state:t,modalDispatch:s},children:e})},ds=(e,t)=>{switch(t.type){case we:{const s=t.payload.map(ut);return Object.assign(Object.assign({},e),{users:s})}case he:{const s=t.payload.map((e=>Object.assign(Object.assign({},e),{id:String(e.id)})));return Object.assign(Object.assign({},e),{wpUsers:s})}case qe:{const s=t.payload,a=ut(s);return Object.assign(Object.assign({},e),{users:[...e.users,a]})}case ve:{const s=t.payload,a=ut(s),n=e.users.map((e=>e.id===a.id?a:e));return Object.assign(Object.assign({},e),{users:n})}case fe:{const{isActive:s,userId:a}=t.payload,n=e.users.map((e=>e.id===a?Object.assign(Object.assign({},e),{is_active:s}):e));return Object.assign(Object.assign({},e),{users:n})}case ge:{const s=t.payload,a=e.users.map((e=>e.id===s?Object.assign(Object.assign({},e),{has_password:!1}):e));return Object.assign(Object.assign({},e),{users:a})}case xe:{const s=t.payload,a=e.users.filter((e=>e.id!==s));return Object.assign(Object.assign({},e),{users:a})}case me:{const s=t.payload;return Object.assign(Object.assign({},e),{usersSearchValue:s})}default:return e}};var us=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const ps={users:[],wpUsers:[],usersSearchValue:""},ws=(0,a.createContext)({state:ps,userDispatch:()=>{},updateUsers:()=>us(void 0,void 0,void 0,(function*(){}))}),hs=({children:e})=>{const[t,s]=(0,a.useReducer)(ds,ps);return(0,a.useEffect)((()=>{const e=window.wpqt.initialUsers,t=window.wpqt.initialWPUsers;s({type:we,payload:e}),s({type:he,payload:t})}),[]),(0,n.jsx)(ws.Provider,{value:{state:t,userDispatch:s,updateUsers:()=>us(void 0,void 0,void 0,(function*(){try{const e=yield u()({path:"/wpqt/v1/users",method:"GET",headers:p()});s({type:we,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch users","quicktasker"))}}))},children:e})};var qs;!function(e){e.ACTIVE_PIPELINE="ACTIVE_PIPELINE",e.PIPELINES="PIPELINES",e.USER="USER"}(qs||(qs={}));const ms=e=>{const[t,s]=(0,a.useState)(!1),n=(0,a.useRef)(null),{modalDispatch:i}=(0,a.useContext)(cs),{dispatch:o}=(0,a.useContext)(Jt),{pipelinesDispatch:r}=(0,a.useContext)($t),{userDispatch:c}=(0,a.useContext)(ws);return{modalSaving:t,setModalSaving:s,modalContentRef:n,closeModal:()=>{i({type:e}),n.current&&n.current.clearContent()},handleSuccess:(e,t,a)=>{let n;switch(a){case qs.PIPELINES:n=r;break;case qs.ACTIVE_PIPELINE:n=o;break;case qs.USER:n=c;break;default:n=o}s(!1),n({type:e,payload:t})},handleError:e=>{s(!1),console.error(e)}}};var vs,xs,fs=s(2922),gs=s(6053),_s=s(9828),ks=s(540),js=s(4576),ys=s(5138),bs=s(7008);function Ts({id:e}){return(0,n.jsx)(bs.m_,{id:e,className:"wpqt-bg-red-600",children:(0,n.jsx)("span",{children:"Tooltip content"})})}function Ss({onClick:e=()=>{},btnText:t,className:s,type:a=vs.BUTTON,disabled:i=!1,loading:o=!1,buttonStyleType:r=xs.PRIMARY}){const c=r===xs.PRIMARY?"wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-transparent wpqt-bg-blue-500 wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-text-white wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 focus:wpqt-ring-blue-800 enabled:hover:wpqt-bg-blue-600":"wpqt-inline-flex wpqt-cursor-pointer wpqt-bg-gray-100 wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 enabled:hover:wpqt-bg-gray-200";return(0,n.jsx)(ys.$,{disabled:i||o,className:`${c} ${s}`,onClick:e,type:a,children:o?(0,n.jsx)(It,{width:"24",height:"24",color:"#ffffff",secondaryColor:"#ffffff"}):t})}function Es({icon:e,text:t,onClick:s=()=>{},className:a,tooltipId:i,tooltipText:o,loading:r=!1}){const c=o&&i,l=c?{"data-tooltip-id":i,"data-tooltip-content":o,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info"}:{};return(0,n.jsxs)("div",Object.assign({},l,{className:`wpqt-main-border wpqt-relative wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-bg-gray-100 wpqt-p-2 hover:wpqt-bg-white ${a}`,onClick:s,children:[e,t||r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center wpqt-relative",children:[t&&(0,n.jsx)("span",{className:"wpqt-whitespace-nowrap "+(r?"wpqt-invisible":""),children:t}),r&&(0,n.jsx)(It,{width:"20",height:"20",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"})]}):null,c&&(0,n.jsx)(Ts,{id:i})]}))}function As({icon:e,onClick:t=()=>{},className:s,loading:a=!1}){return(0,n.jsxs)("div",{className:`wpqt-main-border wpqt-p-1 wpqt-relative wpqt-inline-flex wpqt-cursor-pointer wpqt-bg-gray-100 hover:wpqt-bg-white ${s}`,onClick:t,children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center "+(a?"wpqt-invisible":""),children:e}),a&&(0,n.jsx)(It,{width:"20",height:"20",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"})]})}function Cs({modalOpen:e,closeModal:t,children:s,size:a="sm"}){return(0,n.jsxs)(fs.lG,{open:e,as:"div",className:"wpqt-relative wpqt-z-9999 focus:wpqt-outline-none",onClose:t,children:[(0,n.jsx)(fs.Xi,{className:"wpqt-fixed wpqt-inset-0 wpqt-bg-black/40"}),(0,n.jsx)("div",{className:"wpqt-fixed wpqt-inset-0 wpqt-z-10 wpqt-w-screen wpqt-overflow-y-auto",children:(0,n.jsx)("div",{className:"wpqt-mt-[8vh] wpqt-flex wpqt-justify-center",children:(0,n.jsxs)(fs.Lj,{transition:!0,className:`data-[closed]:wpqt-transform-[wpqt-scale(95%)] wpqt-relative wpqt-mt-[20px] wpqt-w-4/5 ${{sm:"wpqt-max-w-sm",md:"wpqt-max-w-lg",lg:"wpqt-max-w-4xl",xl:"wpqt-max-w-6xl"}[a]} wpqt-rounded-xl wpqt-bg-white wpqt-p-8 wpqt-backdrop-blur-2xl wpqt-duration-300 wpqt-ease-out data-[closed]:wpqt-opacity-0`,children:[(0,n.jsx)("div",{className:"wpqt-group wpqt-absolute wpqt-right-[-20px] wpqt-top-[-20px] wpqt-flex wpqt-h-[40px] wpqt-w-[40px] wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-rounded-full wpqt-border wpqt-border-solid wpqt-bg-white wpqt-text-qtBorder",onClick:t,children:(0,n.jsx)(js.A,{className:"wpqt-icon-blue group-hover:wpqt-icon-red wpqt-size-5"})}),s]})})})]})}function Ns({children:e}){return(0,n.jsx)(fs.L3,{as:"div",className:"wpqt-text-base/7 wpqt-font-medium wpqt-text-black",children:e})}function Os({children:e}){return(0,n.jsx)(gs.L,{children:e})}function Is({label:e,children:t,tooltipId:s,tooltipText:a}){const i=s&&a,o=i?{"data-tooltip-id":s,"data-tooltip-content":a,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info","data-tooltip-place":"top-end"}:{};return(0,n.jsxs)(_s.D,{className:"wpqt-mb-3",children:[(0,n.jsx)(ks.JU,Object.assign({className:"wpqt-mb-2 wpqt-block wpqt-text-sm/6 wpqt-font-medium"},o,{children:e})),t,i&&(0,n.jsx)(Ts,{id:s})]})}function Ps({onSave:e,saveBtnText:t,loading:s=!1}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-px-2",children:(0,n.jsx)(Ss,{btnText:t,loading:s,onClick:e})})}!function(e){e.BUTTON="button",e.SUBMIT="submit",e.RESET="reset"}(vs||(vs={})),function(e){e.PRIMARY="primary",e.SECONDARY="secondary"}(xs||(xs={}));var Ds=s(1489),Rs=s(8448),Ls=s(8176),Us=s(1052);function Ms(){const[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1);return{loading1:e,loading2:s,setLoading1:t,setLoading2:n,loading3:i,setLoading3:o}}const Fs=(e,t)=>{switch(t.type){case"SET_SITE_URL":{const s=t.payload;return Object.assign(Object.assign({},e),{siteURL:s})}case _e:{const{siteURL:s,publicUserPageId:a,timezone:n,isUserAllowedToDelete:i,userPageCustomStyles:o,pluginURL:r}=t.payload;return Object.assign(Object.assign({},e),{siteURL:s,publicUserPageId:a,timezone:n,isUserAllowedToDelete:i,userPageCustomStyles:o,pluginURL:r})}case ke:{const s=t.payload;return Object.assign(Object.assign({},e),{userPageCustomStyles:s})}default:return e}},zs={siteURL:"",pluginURL:"",publicUserPageId:"",is_customFields:!1,timezone:"",isUserAllowedToDelete:!1,userPageCustomStyles:""},$s=(0,a.createContext)({state:zs,appDispatch:()=>{}}),Ks=({children:e})=>{const[t,s]=(0,a.useReducer)(Fs,zs);return(0,a.useEffect)((()=>{const e=window.wpqt.siteURL,t=window.wpqt.publicUserPageId,a=window.wpqt.timezone,n="1"===window.wpqt.isUserAllowedToDelete,i=window.wpqt.userPageCustomStyles,o=window.wpqt.pluginURL;s({type:_e,payload:{siteURL:e,publicUserPageId:t,timezone:a,isUserAllowedToDelete:n,userPageCustomStyles:i,pluginURL:o}})}),[]),(0,n.jsx)($s.Provider,{value:{state:t,appDispatch:s},children:e})};var Vs,Gs,Bs;!function(e){e.Text="text",e.Select="select",e.Checkbox="checkbox",e.Radio="radio",e.Datetime="datetime",e.File="file"}(Vs||(Vs={})),function(e){e.User="user",e.Pipeline="pipeline",e.Users="users",e.Task="task"}(Gs||(Gs={})),function(e){e.TEXT="text",e.PASSWORD="password"}(Bs||(Bs={}));const Hs=(0,a.forwardRef)((({value:e,onChange:t,isAutoFocus:s,className:a="",wrapperClassName:i="",disabled:o=!1,type:r=Bs.TEXT,loading:c=!1,inputId:l},d)=>(0,n.jsxs)("div",{className:`wpqt-inline-block wpqt-relative wpqt-mb-3 ${i}`,children:[(0,n.jsx)(Lt.p,{ref:d,autoFocus:s,className:`wpqt-block wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-3 wpqt-py-1.5 wpqt-text-sm/6 focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${a}`,value:e,disabled:o,onChange:e=>t(e.target.value),type:r,id:l}),c&&(0,n.jsx)(It,{width:"24",height:"24",className:"wpqt-absolute wpqt-right-[-32px] wpqt-top-1/2 wpqt-transform-y-center"})]})));var Ws=s(1062),Qs=s(4164);function Ys({value:e,onChange:t,rowsCount:s=3,className:a}){return(0,n.jsx)(Ws.T,{className:(0,Qs.$)("wpqt-border-1 wpqt-mb-3 wpqt-block wpqt-resize-none wpqt-rounded-lg wpqt-border-qtBorder wpqt-px-3 wpqt-py-1.5 wpqt-text-sm/6",`focus:wpqt-shadow-none focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${a}`),rows:s,value:e,onChange:e=>t(e.target.value)})}var Xs=s(303);function Js({checked:e,handleChange:t}){return(0,n.jsx)(Xs.A,{onChange:t,checked:e,uncheckedIcon:!1,checkedIcon:!1,height:20,width:44})}const Zs=(e,t)=>{switch(t.type){case Me:{const s=t.payload;return Object.assign(Object.assign({},e),{loading:s})}case Fe:{const{entityId:s,entityType:a}=t.payload;return Object.assign(Object.assign({},e),{entityId:s,entityType:a})}case Re:{const s=t.payload;return Object.assign(Object.assign({},e),{customFields:s})}case Le:{const s=t.payload;return Object.assign(Object.assign({},e),{customFields:[...e.customFields,s]})}case Ue:{const s=t.payload,a=e.customFields.filter((e=>e.id!==s));return Object.assign(Object.assign({},e),{customFields:a})}default:return e}};const ea={customFields:[],loading:!0,entityId:"",entityType:null},ta=(0,a.createContext)({state:ea,customFieldsDispatch:()=>{},fetchCustomFields:()=>{}}),sa=({children:e,entityId:t,entityType:s})=>{const[r,c]=(0,a.useReducer)(Zs,ea);(0,a.useEffect)((()=>{l()}),[]),(0,a.useEffect)((()=>{c({type:Fe,payload:{entityType:s,entityId:t}})}),[s,t]);const l=()=>{return e=void 0,a=void 0,r=function*(){try{c({type:Me,payload:!0});const e=yield x(t,s,!0);c({type:Re,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch custom fields","quicktasker"))}finally{c({type:Me,payload:!1})}},new((n=void 0)||(n=Promise))((function(t,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}c((r=r.apply(e,a||[])).next())}));var e,a,n,r};return(0,n.jsx)(ta.Provider,{value:{state:r,customFieldsDispatch:c,fetchCustomFields:l},children:e})};function aa({title:e,description:t,className:s=""}){return(0,n.jsxs)("div",{className:`wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center wpqt-h-full ${s}`,children:[(0,n.jsx)("h2",{className:"wpqt-font-semibold",children:e}),(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-4",children:t}),(0,n.jsx)("div",{className:"wpqt-text-blue-500 wpqt-font-semibold",children:(0,n.jsx)("a",{href:"https://payhip.com/b/84TLC",target:"_blank",rel:"noreferrer",children:(0,o.__)("Get the premium version","quicktasker")})})]})}var na=s(9197),ia=s(2767),oa=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ra(){return{addCustomField:(e,t,s,a,n,r)=>oa(this,void 0,void 0,(function*(){try{const i=yield function(e,t,s,a,n){return u()({path:"/wpqt/v1/custom-fields",method:"POST",data:{entityId:e,entityType:t,type:s,name:a,description:n},headers:p()})}(e,t,s,a,n);r&&r(i.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add a custom field","quicktasker"))}})),markCustomFieldAsDeleted:(e,t)=>oa(this,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/custom-fields/${e}`,method:"DELETE",headers:p()})}(e),t&&t()}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to mark custom field as deleted","quicktasker"))}})),restoreCustomField:(e,t)=>oa(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/custom-fields/${e}/restore`,method:"PATCH",headers:p()})}(e);i.oR.success((0,o.__)("Custom field restored","quicktasker")),t&&t(s.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to restore custom field","quicktasker"))}})),updateCustomFieldValue:(e,t,s,a,n)=>oa(this,void 0,void 0,(function*(){try{yield function(e,t,s,a){return u()({path:`/wpqt/v1/custom-fields/${e}/value`,method:"PATCH",data:{value:t,entityId:String(s),entityType:a},headers:p()})}(e,t,s,a),n&&n()}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to update custom field value","quicktasker"))}}))}}var ca=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function la({description:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(!1),[d,u]=(0,a.useState)(Vs.Text),{addCustomField:p}=ra(),{state:{entityId:w,entityType:h},customFieldsDispatch:q}=(0,a.useContext)(ta),[m,v]=(0,a.useState)(!1),x=[{value:Vs.Text,label:"Text"},{value:Vs.Checkbox,label:"Checkbox"}];return(0,n.jsxs)("div",{className:"wpqt-mb-6 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom Fields","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:e}),c&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(Hs,{value:t,onChange:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Description","quicktasker")}),(0,n.jsx)(Ys,{value:i,onChange:r})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Type","quicktasker")}),(0,n.jsx)(Gt,{selectedOptionValue:d,options:x,onSelectionChange:e=>{u(e)},allSelector:!1})]})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:[(0,n.jsx)(Es,{text:c?(0,o.__)("Cancel","quicktasker"):(0,o.__)("Add new custom field","quicktasker"),onClick:()=>l(!c),icon:c?(0,n.jsx)(na.A,{className:"wpqt-icon-red wpqt-size-5"}):(0,n.jsx)(ia.A,{className:"wpqt-icon-green wpqt-size-5"})}),c&&(0,n.jsx)(Es,{text:(0,o.__)("Add","quicktasker"),onClick:()=>ca(this,void 0,void 0,(function*(){w&&h?(v(!0),yield p(w,h,d,t,i,(e=>{q({type:Le,payload:e}),s(""),r(""),u(Vs.Text),l(!1)})),v(!1)):console.error("Entity ID or Entity Type is missing")})),loading:m,icon:(0,n.jsx)(ia.A,{className:"wpqt-icon-green wpqt-size-5"})})]})]})}var da=s(72),ua=s(2601),pa=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function wa({data:e,onSave:t,locationOfCustomFields:s,onDelete:i,actionLoading:r}){const{state:{isUserAllowedToDelete:c}}=(0,a.useContext)($s),l=e.entity_type===s,d=s===Gs.Task||s===Gs.User,u=e.entity_type===Gs.Pipeline?"board":e.entity_type;return r?(0,n.jsx)(Dt,{ovalSize:"24"}):(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-gap-2",children:[d&&(0,n.jsx)(Es,{onClick:t,icon:(0,n.jsx)(ua.A,{className:"wpqt-icon-green wpqt-size-4"}),tooltipId:`custom-field-${e.id}-update`,tooltipText:(0,o.__)("Edit custom field value","quicktasker")}),c&&(0,n.jsx)(Es,Object.assign({onClick:()=>pa(this,void 0,void 0,(function*(){l&&i()})),className:l?"":"!wpqt-cursor-not-allowed",icon:(0,n.jsx)(Ls.A,{className:"wpqt-icon-red wpqt-size-4"})},!l&&{tooltipId:`custom-field-${e.id}-delete`,tooltipText:(0,o.sprintf)((0,o.__)("This custom field is inherited from %s settings and can't be deleted here","quicktasker"),u)}))]})}var ha=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function qa({data:e}){const[t,s]=(0,a.useState)(""),{state:{entityType:i,entityId:o},customFieldsDispatch:r}=(0,a.useContext)(ta),{updateCustomFieldValue:c,markCustomFieldAsDeleted:l}=ra(),[d,u]=(0,a.useState)(!1);let p;switch((0,a.useEffect)((()=>{e.value&&s(e.value)}),[e.value]),e.type){case Vs.Text:p=(0,n.jsx)(ma,{data:e,value:t,onChange:s});break;case Vs.Checkbox:p=(0,n.jsx)(va,{data:e,value:t,onChange:s})}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{}),p,(0,n.jsx)(wa,{data:e,locationOfCustomFields:i,onSave:()=>ha(this,void 0,void 0,(function*(){i===Gs.User||i===Gs.Task?(u(!0),yield c(e.id,t,o,i),u(!1)):console.error("Invalid entity type for saving custom field value")})),onDelete:()=>ha(this,void 0,void 0,(function*(){u(!0),yield l(e.id,(()=>{r({type:Ue,payload:e.id})})),u(!1)})),actionLoading:d})]})}function ma({data:e,value:t,onChange:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center",children:[(0,n.jsx)(xa,{name:e.name,description:e.description}),(0,n.jsx)(Hs,{value:t,onChange:s})]})}function va({data:e,value:t,onChange:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(xa,{name:e.name,description:e.description}),(0,n.jsx)("input",{type:"checkbox",checked:"true"===t,className:"!wpqt-block",onChange:e=>s(e.target.checked?"true":"false")})]})}function xa({name:e,description:t=""}){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-mb-1 wpqt-text-base wpqt-font-semibold",children:e}),t&&(0,n.jsx)("div",{className:"wpqt-mb-2 wpqt-italic",children:t})]})}function fa(){const{state:{loading:e,customFields:t}}=(0,a.useContext)(ta),[s,i]=(0,a.useState)(!1);return e?(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(It,{width:"36",height:"36"})}):t&&0===t.length?(0,n.jsx)("div",{className:"wpqt-text-center wpqt-font-semibold",children:(0,o.__)("No related custom fields created","quicktasker")}):s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-my-4 wpqt-grid wpqt-grid-cols-[100px_1fr_100px] wpqt-items-center wpqt-gap-3",children:t.map((e=>(0,n.jsx)(qa,{data:e},e.id)))}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Es,{text:(0,o.__)("Hide custom fields","quicktasker"),onClick:()=>i(!1),icon:(0,n.jsx)(da.A,{className:"wpqt-icon-red wpqt-size-5"})})})]}):(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Es,{text:(0,o.__)("Show custom fields","quicktasker"),onClick:()=>i(!0),icon:(0,n.jsx)(da.A,{className:"wpqt-icon-blue wpqt-size-5"})})})}var ga=s(5066);const _a={[Gs.Pipeline]:(0,o.__)("Board","quicktasker"),[Gs.Task]:(0,o.__)("Task","quicktasker"),[Gs.User]:(0,o.__)("User","quicktasker"),[Gs.Users]:(0,o.__)("Global users","quicktasker")};var ka=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ja({customField:e,refreshDeletedFields:t}){const{customFieldsDispatch:s}=(0,a.useContext)(ta),[i,r]=(0,a.useState)(!1),{restoreCustomField:c}=ra();return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Name:","quicktasker")})," ",e.name]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Description:","quicktasker")})," ",e.description]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Level:","quicktasker")})," ",_a[e.entity_type]]}),(0,n.jsx)("div",{children:(0,n.jsx)(As,{onClick:()=>ka(this,void 0,void 0,(function*(){r(!0),yield c(e.id,(e=>{s({type:Le,payload:e}),t()})),r(!1)})),loading:i,icon:(0,n.jsx)(ga.HCd,{className:"wpqt-icon-green wpqt-size-5"})})})]})}var ya=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ba(){const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(!0),[c,l]=(0,a.useState)(null),{state:{entityId:d,entityType:u}}=(0,a.useContext)(ta);(0,a.useEffect)((()=>{e&&p()}),[e]);const p=()=>ya(this,void 0,void 0,(function*(){if(d&&u)try{r(!0);const e=yield x(d,u,!1);l(e.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load deleted custom fields","quicktasker"))}finally{r(!1)}else console.error("Entity ID or Entity Type is missing")}));return(0,n.jsxs)("div",{className:"wpqt-my-3 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom Field recovery","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:(0,o.__)("Deleted custom field by accident? No worries! You can recover it here.","quicktasker")}),e&&(0,n.jsx)("div",{className:"wpqt-mb-3",children:s?(0,n.jsx)(Dt,{ovalSize:"36"}):c&&0===c.length?(0,n.jsx)("div",{className:"wpqt-text-center wpqt-font-semibold",children:(0,o.__)("No deleted custom fields","quicktasker")}):c&&c.length>0?(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:c.map((e=>(0,n.jsx)(ja,{customField:e,refreshDeletedFields:p},e.id)))}):null}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:(0,n.jsx)(Es,{text:e?(0,o.__)("Close recovery","quicktasker"):(0,o.__)("Open recovery","quicktasker"),onClick:()=>t(!e),icon:(0,n.jsx)(ga.HCd,{className:"wpqt-icon-green wpqt-size-5"})})})]})}const Ta={[Gs.User]:(0,o.__)("Add user-specific custom fields. If you want to add custom fields to all users, please go to users settings.","quicktasker"),[Gs.Users]:(0,o.__)("Add custom fields to all users. If you want to add custom fields to a specific user only, please go to that user settings.","quicktasker"),[Gs.Pipeline]:(0,o.__)("Add board level custom fields.","quicktasker"),[Gs.Task]:(0,o.__)("Add task-specific custom fields. If you want to add custom fields to all tasks in this board, please go to board settings.","quicktasker")},Sa={[Gs.User]:(0,o.__)("Custom fields applied to this user, including both user-specific and global users fields.","quicktasker"),[Gs.Users]:(0,o.__)("Global user custom field are applied to all users.","quicktasker"),[Gs.Pipeline]:(0,o.__)("Board level fields are applied to all tasks in this board.","quicktasker"),[Gs.Task]:(0,o.__)("Custom fields applied to this task, including both task-specific and board-level fields.","quicktasker")},Ea={[Gs.User]:(0,o.__)("User custom fields","quicktasker"),[Gs.Users]:(0,o.__)("Global users custom fields","quicktasker"),[Gs.Pipeline]:(0,o.__)("Board custom fields","quicktasker"),[Gs.Task]:(0,o.__)("Task custom fields","quicktasker")};function Aa({entityId:e,entityType:t}){const{state:{is_customFields:s}}=(0,a.useContext)($s),i=Ta[t],r=Ea[t],c=Sa[t];return(0,n.jsx)(n.Fragment,{children:s?(0,n.jsx)("div",{children:(0,n.jsxs)(sa,{entityId:e,entityType:t,children:[(0,n.jsx)(la,{description:i}),(0,n.jsx)("h2",{className:"wpqt-text-center",children:r}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:c}),(0,n.jsx)(fa,{}),(0,n.jsx)(ba,{})]})}):(0,n.jsx)(aa,{title:(0,o.__)("Custom fields","quicktasker"),description:(0,o.__)("Premium feature to create and manage custom data fields. Allows to add extra data to tasks and users.","quicktasker")})})}var Ca=s(2792),Na=s(2185);function Oa({children:e,menuBtn:t,menuBtnClasses:s="",anchor:a="bottom end"}){return(0,n.jsxs)(Na.W1,{children:[(0,n.jsx)(Na.IU,{as:"div",className:`wpqt-cursor-pointer ${s}`,onClick:e=>e.stopPropagation(),children:({active:e})=>(0,n.jsx)(n.Fragment,{children:t({active:e})})}),(0,n.jsx)(Na.c,{anchor:a,transition:!0,className:"wpqt-z-20 wpqt-origin-top wpqt-rounded-xl wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-bg-white wpqt-p-4 wpqt-transition wpqt-duration-200 wpqt-ease-out data-[closed]:wpqt-scale-95 data-[closed]:wpqt-opacity-0",children:e})]})}function Ia({isActive:e,IconComponent:t}){return(0,n.jsx)(t,{className:"wpqt-size-6 wpqt-text-gray-400 hover:wpqt-text-qtBlueHover "+(e?"wpqt-text-qtBlueHover":"")})}function Pa({text:e,onClick:t,icon:s,className:a,disabled:i=!1,id:o="",tooltipText:r="",loading:c=!1}){const l=""!==r&&""!==o?{"data-tooltip-id":o,"data-tooltip-content":r,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info"}:{};return(0,n.jsx)(Na.Dr,{children:(0,n.jsxs)("div",Object.assign({},l,{className:`wpqt-mb-3 wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-relative ${i?"wpqt-cursor-not-allowed wpqt-line-through":"wpqt-cursor-pointer hover:wpqt-underline"} ${a}`,onClick:e=>{!i&&t&&t(e)},children:[s,(0,n.jsx)("span",{className:c?"wpqt-invisible":"",children:e}),c&&(0,n.jsx)(It,{width:"16",height:"16",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-y-center wpqt-transform-x-center"}),(0,n.jsx)(Ts,{id:o})]}))})}var Da=s(6797),Ra=s(4403);function La({sectionTitle:e,onItemSelect:t=()=>{},users:s=[],ActionIcon:a=Ra.A,actionIconClasses:i,noUsersText:o}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2 wpqt-text-lg",children:e}),s.map(((e,s)=>{var o;return(0,n.jsxs)("div",{onClick:s=>{s.stopPropagation(),t(e)},className:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-px-2 wpqt-py-1 hover:wpqt-bg-gray-100",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("div",{children:e.name}),(0,n.jsx)("div",{className:"wpqt-italic",children:e.description}),dt(e)&&(0,n.jsx)("div",{children:null===(o=e.roles)||void 0===o?void 0:o.join(",")})]}),(0,n.jsx)(a,{className:`wpqt-ml-auto wpqt-size-5 ${i}`})]},s)})),0===s.length&&(0,n.jsx)("div",{children:o})]})}var Ua=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ma({task:e,onUserAdd:t,onUserDelete:s}){const{state:{users:r,wpUsers:c}}=(0,a.useContext)(ws),{handleExecutedAutomations:l}=ss(),{dispatch:d}=(0,a.useContext)(Jt),[w,h]=(0,a.useState)(!1),q=r.filter((t=>{var s;return!(null!==(s=e.assigned_users)&&void 0!==s?s:[]).some((e=>e.id===t.id))})),m=c.filter((t=>{var s;return!(null!==(s=e.assigned_wp_users)&&void 0!==s?s:[]).some((e=>e.id===t.id))})),x=s=>Ua(this,void 0,void 0,(function*(){try{h(!0);const a=s.user_type,n=yield function(e,t,s){return u()({path:`/wpqt/v1/users/${e}/tasks/${t}`,method:"POST",data:{user_type:s},headers:p()})}(s.id,e.id,a);d({type:N,payload:{taskId:e.id,user:s}}),t(s),l(n.data.executedAutomations,e.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to assign user","quicktasker"))}finally{h(!1)}})),f=t=>Ua(this,void 0,void 0,(function*(){try{h(!0);const a=t.user_type,n=yield v(t.id,e.id,a);d({type:O,payload:{taskId:e.id,userId:t.id,userType:a}}),s(t),l(n.data.executedAutomations,e.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to remove user","quicktasker"))}finally{h(!1)}}));return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-w-[320px] wpqt-flex-col",children:[(0,n.jsx)(La,{sectionTitle:(0,o.__)("Assigned quicktaskers","quicktasker"),users:e.assigned_users,onItemSelect:f,ActionIcon:Da.A,actionIconClasses:"wpqt-icon-red",noUsersText:(0,o.__)("No quicktaskers assigned","quicktasker")}),(0,n.jsx)(La,{sectionTitle:(0,o.__)("Assigned WordPress users","quicktasker"),users:e.assigned_wp_users,onItemSelect:f,ActionIcon:Da.A,actionIconClasses:"wpqt-icon-red",noUsersText:(0,o.__)("No WordPress users assigned","quicktasker")}),(0,n.jsx)(La,{sectionTitle:(0,o.__)("Assign a quicktasker","quicktasker"),users:q,onItemSelect:x,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No quicktaskers available to assign","quicktasker")}),(0,n.jsx)(La,{sectionTitle:(0,o.__)("Assign a WordPress user","quicktasker"),users:m,onItemSelect:x,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No WordPress users with required permissions available to assign","quicktasker")}),w&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(It,{width:"30",height:"30"})})]})}function Fa({task:e,onUserAdd:t=()=>{},onUserDelete:s=()=>{},menuBtnClasses:a=""}){const i=[...e.assigned_users||[],...e.assigned_wp_users||[]],o=i.length>0;return(0,n.jsx)(Oa,{menuBtnClasses:`wpqt-inline-flex ${a}`,anchor:"bottom start",menuBtn:()=>(0,n.jsxs)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1",children:[(0,n.jsx)(Ca.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`}),o&&(0,n.jsx)("div",{children:i.map(((e,t)=>(0,n.jsxs)("span",{children:[e.name,t<i.length-1&&", "]},t)))})]}),children:(0,n.jsx)(Ma,{task:e,onUserAdd:t,onUserDelete:s})})}var za=s(1848);function $a({tabs:e,tabsContent:t,tabClassName:s="",tabListClassName:a=""}){return(0,n.jsxs)(za.fu,{children:[(0,n.jsx)(za.wb,{className:`wpqt-mb-6 wpqt-flex wpqt-border-0 wpqt-border-b wpqt-border-solid wpqt-border-b-gray-300 ${a}`,children:e.map((e=>(0,n.jsx)(Ka,{className:s,children:e},e)))}),(0,n.jsx)(za.T2,{children:t.map(((e,t)=>(0,n.jsx)(Va,{children:e},t)))})]})}function Ka({children:e,className:t}){return(0,n.jsx)(za.oz,{as:"div",className:`wpqt-flex-1 wpqt-cursor-pointer wpqt-p-1 wpqt-pb-[10px] wpqt-text-center wpqt-text-lg data-[selected]:wpqt-border-b-2 data-[selected]:wpqt-border-l-0 data-[selected]:wpqt-border-r-0 data-[selected]:wpqt-border-t-0 data-[selected]:wpqt-border-solid data-[selected]:wpqt-border-b-blue-500 ${t}`,children:e})}function Va({children:e}){return(0,n.jsx)(za.Kp,{children:e})}var Ga=s(4353),Ba=s.n(Ga),Ha=s(8569),Wa=s.n(Ha),Qa=s(3826),Ya=s.n(Qa);Ba().extend(Ya()),Ba().extend(Wa());const Xa=()=>{const{state:{timezone:e}}=(0,a.useContext)($s);return{convertToWPTimezone:t=>((e,t)=>{try{return Ba().utc(e).tz(t).format("MMMM D, YYYY HH:mm")}catch(t){return console.error("Error: ",t),e+" (UTC)"}})(t,e)}},Ja={[vt.Admin]:(0,o.__)("Admin","quicktasker"),[vt.Automation]:(0,o.__)("Automation","quicktasker"),[vt.System]:(0,o.__)("System","quicktasker"),[vt.WPQTUser]:"Quicktasker"},Za=({log:e})=>{const{convertToWPTimezone:t}=Xa(),s=Ja[e.created_by];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-1",children:e.author_name}),(0,n.jsx)("div",{className:"wpqt-text-center",children:s})]}),(0,n.jsx)("div",{children:e.text}),(0,n.jsx)("div",{children:t(e.created_at)})]})};var en=s(3338),tn=s(3211);const sn={success:"wpqt-bg-green-100 wpqt-border-green-400 wpqt-text-green-700",error:"wpqt-bg-red-100 wpqt-border-red-400 wpqt-text-red-700",warning:"wpqt-bg-yellow-100 wpqt-border-yellow-400 wpqt-text-yellow-700",info:"wpqt-bg-blue-100 wpqt-border-blue-400 wpqt-text-blue-700",primary:"wpqt-bg-gray-100 wpqt-border-gray-400 wpqt-text-gray-700"};function an({type:e="primary",className:t="",children:s}){const a=sn[e];return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-p-2 wpqt-border wpqt-border-solid wpqt-rounded-md ${a} ${t}`,children:s})}var nn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function on({typeId:e,fetchData:t,renderItem:s,noDataMessage:i,explanation:o,onAdd:r=()=>nn(this,void 0,void 0,(function*(){})),enableAdd:c=!1}){const[l,d]=(0,a.useState)(null),[u,p]=(0,a.useState)(""),[w,h]=(0,a.useState)(!0),[q,m]=(0,a.useState)(!1);(0,a.useEffect)((()=>{v()}),[e]);const v=()=>nn(this,void 0,void 0,(function*(){h(!0);const e=yield t();e&&d(e),h(!1)}));return null===l?(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(It,{width:"30",height:"30"})}):(0,n.jsxs)("div",{children:[o&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(an,{type:"info",className:"wpqt-mb-3 wpqt-text-center",children:o})}),0===l.length&&(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-text-center",children:i}),(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-mt-3 wpqt-flex wpqt-justify-center",children:(0,n.jsx)(rn,{isLoading:w,refreshComemnts:v})}),c&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-w-2/3 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(Ys,{rowsCount:3,value:u,onChange:e=>p(e),className:"wpqt-mb-4 wpqt-w-full"}),(0,n.jsx)(Es,{text:"Add comment",loading:q,onClick:()=>nn(this,void 0,void 0,(function*(){if(!u)return;m(!0);const e=yield r(u);e&&(d((t=>t?[e,...t]:[e])),p("")),m(!1)})),icon:(0,n.jsx)(en.A,{className:"wpqt-icon-blue wpqt-size-5"})})]})}),l.length>0&&(0,n.jsx)("div",{className:"wpqt-mb-[28px] wpqt-mt-[56px] wpqt-logs-grid",children:l.map((e=>s(e)))})]})}function rn({isLoading:e,refreshComemnts:t}){return(0,n.jsx)(n.Fragment,{children:e?(0,n.jsx)(It,{width:"32",height:"32"}):(0,n.jsx)(tn.A,{className:"wpqt-icon-blue wpqt-size-8 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:t})})}function cn({item:e}){const{convertToWPTimezone:t}=Xa();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-1",children:e.author_name}),(0,n.jsx)("div",{className:"wpqt-text-center",children:e.is_admin_comment?(0,o.__)("Admin","quicktasker"):(0,o.__)("QuickTasker","quicktasker")})]}),(0,n.jsx)("div",{children:e.text}),(0,n.jsx)("div",{children:t(e.created_at)})]})}var ln=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function dn({taskId:e}){return(0,n.jsx)(on,{typeId:e,fetchData:()=>ln(this,void 0,void 0,(function*(){try{return(yield m(e,mt.Task)).data}catch(e){console.error(e),i.oR.error("Failed to get log")}})),renderItem:e=>(0,n.jsx)(Za,{log:e}),noDataMessage:"No logs available",explanation:"Logs can be seen only by WordPress users (with required permissions)"})}var un=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function pn(){return{addComment:(e,t,s,a)=>un(this,void 0,void 0,(function*(){try{const n=yield q(e,t,s,a);return i.oR.success((0,o.__)("Comment added","quicktasker")),n.data.newComment}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add comment","quicktasker"))}}))}}const wn=e=>Object.assign(Object.assign({},e),{is_admin_comment:"1"===e.is_admin_comment});var hn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function qn({taskId:e}){const{addComment:t}=pn();return(0,n.jsx)(on,{typeId:e,fetchData:()=>hn(this,void 0,void 0,(function*(){try{return(yield h(e,mt.Task,!0)).data.map(wn)}catch(e){console.error(e),i.oR.error("Failed to load comments")}})),onAdd:s=>hn(this,void 0,void 0,(function*(){const a=yield t(e,mt.Task,!0,s);if(a)return wn(a)})),renderItem:e=>(0,n.jsx)(cn,{item:e}),noDataMessage:"No comments available",explanation:"Comments that can be added and viewed only by WordPress users (with required permissions).",enableAdd:!0})}var mn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function vn({taskId:e}){const{addComment:t}=pn();return(0,n.jsx)(on,{typeId:e,fetchData:()=>mn(this,void 0,void 0,(function*(){try{return(yield h(e,mt.Task,!1)).data.map(wn)}catch(e){console.error(e),i.oR.error("Failed to load comments")}})),onAdd:s=>mn(this,void 0,void 0,(function*(){const a=yield t(e,mt.Task,!1,s);if(a)return wn(a)})),renderItem:e=>(0,n.jsx)(cn,{item:e}),noDataMessage:"No comments available",explanation:"Comments that can be added and viewed by WordPress users (with required permissions) and quicktaskers (in quicktasker user page) who have been assigned to the task.",enableAdd:!0})}function xn({task:e}){return(0,n.jsx)($a,{tabs:["Private comments","Public comments","Logs"],tabsContent:[(0,n.jsx)(qn,{taskId:e.id},1),(0,n.jsx)(vn,{taskId:e.id},2),(0,n.jsx)(dn,{taskId:e.id},3)]})}var fn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const gn=(0,a.forwardRef)((({taskModalSaving:e,editTask:t,deleteTask:s},i)=>{const{state:{taskToEdit:r,taskModalSettings:c},modalDispatch:l}=(0,a.useContext)(cs),{state:{isUserAllowedToDelete:d}}=(0,a.useContext)($s),{state:{activePipeline:u},fetchAndSetPipelineData:p}=(0,a.useContext)(Jt),{archiveDispatch:w}=(0,a.useContext)(bt),[h,q]=(0,a.useState)(""),[m,v]=(0,a.useState)(""),[x,f]=(0,a.useState)(!1),{archiveTask:g,restoreArchivedTask:_}=ns(),{loading1:k,setLoading1:j,loading2:y,setLoading2:b}=Ms(),T=null==r?void 0:r.is_archived,S=null!==(null==r?void 0:r.pipeline_name);(0,a.useEffect)((()=>{r&&(q(r.name),v(r.description),f(r.free_for_all))}),[r]);const E=()=>{q(""),v("")};return(0,a.useImperativeHandle)(i,(()=>({clearContent:E}))),r?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsxs)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:[(0,n.jsxs)("div",{className:"wpqt-mb-5 wpqt-grid wpqt-grid-cols-1 wpqt-gap-4 md:wpqt-grid-cols-[auto_1fr]",children:[(0,n.jsxs)(Os,{children:[(0,n.jsx)(Is,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(Hs,{isAutoFocus:!0,value:h,onChange:e=>q(e)})}),(0,n.jsx)(Is,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Ys,{rowsCount:3,value:m,onChange:e=>v(e)})}),(0,n.jsx)(Is,{label:(0,o.__)("Assigned users","quicktasker"),children:(0,n.jsx)(Fa,{task:r,onUserAdd:e=>{l({type:Z,payload:e})},onUserDelete:e=>{l({type:ee,payload:e})}})}),(0,n.jsx)(Is,{label:(0,o.__)("Free for all task","quicktasker"),tooltipId:`free-for-all-${r.id}-tooltip`,tooltipText:(0,o.__)("When enabled, all QuickTasker users have the ability to self-assign or unassign this task.","quicktasker"),children:(0,n.jsx)(Js,{checked:x,handleChange:f})}),c.allowToMarkTaskAsDone&&(0,n.jsx)(_n,{taskId:r.id,isCompleted:r.is_done})]}),(0,n.jsx)("div",{children:(0,n.jsx)(Aa,{entityId:r.id,entityType:Gs.Task})})]}),(0,n.jsx)(Ps,{onSave:()=>{r&&t(Object.assign(Object.assign({},r),{name:h,description:m,free_for_all:x}))},saveBtnText:e?(0,o.__)("Saving...","quicktasker"):(0,o.__)("Save","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mt-7 md:wpqt-pr-3",children:(0,n.jsx)(xn,{task:r})})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[T&&S&&(0,n.jsx)(Es,{icon:(0,n.jsx)(Ds.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Restore task","quicktasker"),onClick:()=>{_(r.id,(()=>{l({type:V}),w({type:re,payload:r.id})}))}}),!T&&(0,n.jsx)(Es,{icon:(0,n.jsx)(Rs.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("Archive task","quicktasker"),loading:y,onClick:()=>{b(!0),g(r.id,(()=>{l({type:V}),p(u.id),b(!1)}))}}),d&&(0,n.jsx)(Es,{icon:(0,n.jsx)(Ls.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Delete task","quicktasker"),loading:k,onClick:()=>fn(void 0,void 0,void 0,(function*(){j(!0),yield s(r),l({type:V}),j(!1)}))})]})]})}):null}));function _n({isCompleted:e,taskId:t}){const{modalDispatch:s}=(0,a.useContext)(cs),{dispatch:i}=(0,a.useContext)(Jt),[r,c]=(0,a.useState)(!1),{changeTaskDoneStatus:l}=ns();return(0,n.jsx)(Is,{label:e?(0,o.__)("Task completed","quicktasker"):(0,o.__)("Task not completed","quicktasker"),children:r?(0,n.jsx)(It,{width:"24",height:"24"}):(0,n.jsx)(Us.A,{onClick:()=>fn(this,void 0,void 0,(function*(){c(!0),yield l(t,!e,(e=>{s({type:I,payload:{done:e}}),i({type:I,payload:{taskId:t,done:e}})})),c(!1)})),className:`wpqt-size-6 ${e?"wpqt-icon-green":"wpqt-text-gray-300"} wpqt-cursor-pointer`})})}var kn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function jn({editTaskCallback:e,deleteTaskCallback:t}){const{state:{taskModalOpen:s}}=(0,a.useContext)(cs),{deleteTask:i}=ns(),{modalSaving:o,setModalSaving:r,modalContentRef:c,closeModal:l,handleSuccess:d,handleError:w}=ms(V);return(0,n.jsx)(Cs,{modalOpen:s,closeModal:l,size:"xl",children:(0,n.jsx)(gn,{ref:c,editTask:t=>kn(this,void 0,void 0,(function*(){try{r(!0);const s=yield function(e){return u()({path:`/wpqt/v1/tasks/${e.id}`,method:"PATCH",data:{id:e.id,name:e.name,description:e.description,freeForAll:e.free_for_all},headers:p()})}(t);d(b,s.data,qs.ACTIVE_PIPELINE),e&&e(s.data)}catch(e){w(e)}})),deleteTask:e=>kn(this,void 0,void 0,(function*(){i(e.id,(()=>{t&&t(e)}))})),taskModalSaving:o})})}function yn({text:e=(0,o.__)("No results found","quicktasker")}){return(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-center wpqt-text-xl",children:e})}const bn=()=>{const{state:{archiveSearchValue:e,archiveFilteredPipelineId:t,archiveTaskDoneFilter:s}}=(0,a.useContext)(bt);return{filterArchive:a=>{const n=a.name.toLowerCase().includes(e.toLowerCase())||a.description&&a.description.toLowerCase().includes(e.toLowerCase()),i=!t||("DELETED"===t?null===a.pipeline_name:a.pipeline_id===t),o=s===xt.All||s===xt.Completed&&a.is_done||s===xt.NotCompleted&&!a.is_done;return n&&i&&o}}};var Tn=s(3033);function Sn({className:e,onClick:t,title:s,description:a,children:i,dropdown:o,titleClassName:r=""}){const c=void 0!==o;return(0,n.jsxs)("div",{className:(0,Qs.$)("wpqt-relative wpqt-flex wpqt-flex-col wpqt-rounded wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-p-4",c&&"wpqt-pr-[24px]",e),onClick:t,children:[(0,n.jsxs)("div",{className:"wpqt-mb-3",children:[(0,n.jsx)("div",{className:`wpqt-text-lg ${r}`,children:s}),a&&(0,n.jsx)("div",{className:"wpqt-italic wpqt-text-gray-500",children:a})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-h-full",children:i}),c&&(0,n.jsx)("div",{className:"wpqt-absolute wpqt-right-2 wpqt-top-1 wpqt-z-10",children:o})]})}var En=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function An({task:e,onDoneStatusChange:t,className:s=""}){const{changeTaskDoneStatus:i}=ns(),[o,r]=(0,a.useState)(!1),c=e.is_done,l=s=>En(this,void 0,void 0,(function*(){r(!0),yield i(e.id,s,(s=>{t(e.id,s)})),r(!1)}));return o?(0,n.jsx)(Dt,{ovalSize:"24",className:"wpqt-mt-auto"}):(0,n.jsx)("div",{className:`wpqt-flex wpqt-justify-center wpqt-mt-auto ${s}`,children:c?(0,n.jsx)(Us.A,{className:"wpqt-size-6 wpqt-icon-green",onClick:e=>{e.stopPropagation(),l(!1)}}):(0,n.jsx)(Us.A,{className:"wpqt-size-6 wpqt-text-gray-300",onClick:e=>{e.stopPropagation(),l(!0)}})})}function Cn({label:e,value:t,valueClassName:s="",valueLink:a,icon:i,onClick:o=()=>{},className:r="",labelClassName:c=""}){return(0,n.jsxs)("div",{className:`wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center ${r}`,onClick:o,children:[i&&i,(0,n.jsx)("div",{className:c,children:t?`${e}:`:e}),(0,n.jsx)("div",{className:`${s}`,children:a?(0,n.jsx)("a",{href:a,target:"_blank",className:"wpqt-text-qtTextBlue wpqt-no-underline",rel:"noreferrer",onClick:e=>e.stopPropagation(),children:t}):t})]})}var Nn=s(6436),On=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function In({task:e}){const{state:{isUserAllowedToDelete:t}}=(0,a.useContext)($s),{archiveDispatch:s}=(0,a.useContext)(bt),{deleteTask:i,restoreArchivedTask:o}=ns(),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),u=null!==e.pipeline_name;return(0,n.jsxs)(Oa,{menuBtn:({active:e})=>(0,n.jsx)(Ia,{isActive:e,IconComponent:Nn.A}),children:[(0,n.jsx)(Pa,{text:"View task",icon:(0,n.jsx)(da.A,{className:"wpqt-icon-blue wpqt-size-4"})}),(0,n.jsx)(Pa,{text:"Restore task",loading:r,icon:(0,n.jsx)(Ds.A,{className:"wpqt-icon-green wpqt-size-4"}),disabled:!u,id:`restore-task-${e.id}-dropdown-item`,tooltipText:"Task cannot be restored because the board has been deleted.",onClick:t=>On(this,void 0,void 0,(function*(){t.stopPropagation(),c(!0),yield o(e.id,(()=>{s({type:re,payload:e.id})})),c(!1)}))}),t&&(0,n.jsx)(Pa,{text:"Delete",loading:l,icon:(0,n.jsx)(Ls.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>On(this,void 0,void 0,(function*(){t.stopPropagation(),d(!0),yield i(e.id,(()=>{s({type:re,payload:e.id})})),d(!1)})),className:"!wpqt-mb-0"})]})}var Pn=s(5785);function Dn({children:e,inlineStyle:t,className:s=""}){return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-py-1 wpqt-px-2 wpqt-font-semibold ${s}`,style:t,children:e})}var Rn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};var Ln=s(3858);function Un({children:e,labelFor:t,className:s=""}){return(0,n.jsx)("label",{className:`wpqt-mb-1 ${s}`,htmlFor:t,children:e})}function Mn({labelCreated:e,loading:t=!1}){const{labelDispatch:s}=(0,a.useContext)(Ct),[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)("");return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Create new label","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(Un,{labelFor:"new-label-name",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(Hs,{value:i,onChange:r,inputId:"new-label-name"})]}),(0,n.jsx)(Ln.A,{color:c,disableAlpha:!0,onChange:e=>{l(e.hex)}}),(0,n.jsx)(Ss,{btnText:(0,o.__)("Create","quicktasker"),onClick:()=>{i&&c&&e(i,c)},loading:t}),(0,n.jsx)(Ss,{btnText:(0,o.__)("Cancel","quicktasker"),buttonStyleType:xs.SECONDARY,onClick:()=>{s({type:Ve})}})]})}function Fn({labelToEdit:e,editLabel:t,closeEdit:s=()=>{}}){if(!e)return null;const[i,r]=(0,a.useState)(Object.assign({},e)),[c,l]=(0,a.useState)(!1);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Edit label","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(Un,{labelFor:"edit-label-name",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(Hs,{value:i.name,onChange:e=>{r(Object.assign(Object.assign({},i),{name:e}))},inputId:"edit-label-name"})]}),(0,n.jsx)(Ln.A,{color:i.color,disableAlpha:!0,onChange:e=>{r(Object.assign(Object.assign({},i),{color:e.hex}))}}),(0,n.jsx)(Ss,{btnText:(0,o.__)("Edit","quicktasker"),onClick:()=>{return e=this,s=void 0,n=function*(){i.name&&i.color&&(l(!0),yield t(i),l(!1))},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n},loading:c}),(0,n.jsx)(Ss,{btnText:(0,o.__)("Cancel","quicktasker"),buttonStyleType:xs.SECONDARY,onClick:s})]})}var zn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function $n({labels:e,title:t,labelSelected:s,labelDeSelection:i,loading:r=!1}){const{labelDispatch:c}=(0,a.useContext)(Ct);return e?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-4",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:t}),r?(0,n.jsx)(Dt,{ovalSize:"24"}):0===e.length?(0,n.jsx)("div",{className:"wpqt-text-gray-500",children:(0,o.__)("There are no labels created for this board","quicktasker")}):e.map((e=>(0,n.jsx)(Kn,{label:e,labelSelected:s,labelDeSelection:i},e.id))),(0,n.jsx)(Ss,{btnText:(0,o.__)("Create new label","quicktasker"),className:"wpqt-mt-3",buttonStyleType:xs.SECONDARY,onClick:()=>{c({type:Be})}})]}):null}function Kn({label:e,labelSelected:t,labelDeSelection:s}){const{labelDispatch:i}=(0,a.useContext)(Ct),[o,r]=(0,a.useState)(e.selected);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-between wpqt-gap-2 wpqt-w-full",children:[(0,n.jsx)("input",{type:"checkbox",checked:o,onChange:a=>zn(this,void 0,void 0,(function*(){const n=a.target.checked;r(n),n?t(e.id):s(e.id)}))}),(0,n.jsx)(Dn,{inlineStyle:{backgroundColor:e.color},children:e.name}),(0,n.jsx)(ua.A,{className:"wpqt-size-5 wpqt-icon-green wpqt-cursor-pointer",onClick:()=>{i({type:Ge,payload:e})}})]})}var Vn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Gn=(0,a.memo)((({task:e})=>{const{state:{labels:t,labelActionState:s,labelToEdit:r},labelDispatch:c}=(0,a.useContext)(Ct),{dispatch:l}=(0,a.useContext)(Jt),[d,w]=(0,a.useState)(!0),[h,q]=(0,a.useState)(!1),{getPipelineLabels:m,createPipelineLabel:v,assignLabelToTask:x,usassignLabelFromTask:f,editLabel:g}=function(){return{getPipelineLabels:(e,t)=>Rn(this,void 0,void 0,(function*(){try{const a=yield(s=e,u()({path:`/wpqt/v1/pipelines/${s}/labels`,method:"GET",headers:p()}));t&&t(!0,a.data.labels)}catch(e){console.error(e),t&&t(!1)}var s})),createPipelineLabel:(e,t,s,a)=>Rn(this,void 0,void 0,(function*(){try{const n=yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/labels`,method:"POST",headers:p(),data:{name:t,color:s}})}(e,t,s);i.oR.success((0,o.__)("Label created successfully","quicktasker")),a&&a(!0,n.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create label","quicktasker")),a&&a(!1)}})),editLabel:(e,t,s)=>Rn(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/labels/${t.id}`,method:"PATCH",headers:p(),data:{name:t.name,color:t.color}})}(e,t);i.oR.success((0,o.__)("Label updated successfully","quicktasker")),s&&s(!0,a.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to update label","quicktasker")),s&&s(!1)}})),assignLabelToTask:(e,t,s,a)=>Rn(this,void 0,void 0,(function*(){try{const n=yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/tasks/${t}/labels`,method:"POST",headers:p(),data:{labelId:s}})}(e,t,s);i.oR.success((0,o.__)("Label assigned to task","quicktasker")),a&&a(!0,n.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to assign label to task","quicktasker")),a&&a(!1)}})),usassignLabelFromTask:(e,t,s,a)=>Rn(this,void 0,void 0,(function*(){try{yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/tasks/${t}/labels/${s}`,method:"DELETE",headers:p()})}(e,t,s),i.oR.success((0,o.__)("Label unassigned from task","quicktasker")),a&&a(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to unassign label from task","quicktasker")),a&&a(!1)}}))}}();(0,a.useEffect)((()=>(Vn(void 0,void 0,void 0,(function*(){w(!0),yield m(e.pipeline_id,((e,t)=>{e&&t&&c({type:ze,payload:t})})),w(!1)})),()=>{c({type:He})})),[]);const _=()=>{const s=e.assigned_labels||[];return(t||[]).map((e=>Object.assign(Object.assign({},e),{selected:s.some((t=>t.id===e.id))})))},k=t=>Vn(void 0,void 0,void 0,(function*(){yield x(e.pipeline_id,e.id,t,((t,s)=>{t&&s&&l({type:U,payload:{taskId:e.id,label:s}})}))})),j=t=>Vn(void 0,void 0,void 0,(function*(){yield f(e.pipeline_id,e.id,t,(s=>{s&&l({type:M,payload:{taskId:e.id,labelId:t}})}))})),y=(t,s)=>Vn(void 0,void 0,void 0,(function*(){q(!0),yield v(e.pipeline_id,t,s,((e,t)=>{e&&t&&c({type:$e,payload:t})})),q(!1)})),b=t=>Vn(void 0,void 0,void 0,(function*(){yield g(e.pipeline_id,t,((e,t)=>{e&&t&&(c({type:Ke,payload:t}),l({type:F,payload:{label:t}}))}))}));return(0,n.jsx)("div",{className:"wpqt-min-w-56 wpqt-flex wpqt-flex-col wpqt-gap-4",onClick:e=>e.stopPropagation(),children:(()=>{switch(s){case St.SELECTION:return(0,n.jsx)($n,{title:(0,o.__)("Task label selection","quicktasker"),labels:_(),loading:d,labelSelected:k,labelDeSelection:j});case St.CREATION:return(0,n.jsx)(Mn,{labelCreated:y,loading:h});case St.EDIT:return(0,n.jsx)(Fn,{labelToEdit:r,editLabel:b,closeEdit:()=>{c({type:Ve})}});default:return null}})()})}));function Bn({task:e}){const t=e.assigned_labels||[],s=Array.isArray(t)&&t.length>0;return(0,n.jsx)(Oa,{menuBtnClasses:"wpqt-inline-flex",anchor:"bottom start",menuBtn:()=>(0,n.jsxs)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1.5",children:[(0,n.jsx)(Pn.A,{className:`wpqt-mr-1 wpqt-size-5 ${s?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`}),s&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-flex-wrap",children:t.map((e=>(0,n.jsx)(Dn,{inlineStyle:{backgroundColor:e.color},className:"!wpqt-py-0.5",children:e.name},e.id)))})]}),children:e&&(0,n.jsx)(Gn,{task:e})})}function Hn({task:e}){const{modalDispatch:t}=(0,a.useContext)(cs),{archiveDispatch:s}=(0,a.useContext)(bt);return(0,n.jsxs)(Sn,{title:e.name,description:e.description,dropdown:(0,n.jsx)(In,{task:e}),className:"wpqt-cursor-pointer",onClick:()=>{t({type:K,payload:{taskToEdit:e}})},children:[(0,n.jsx)(Cn,{label:(0,o.__)("Board","quicktasker"),value:e.pipeline_name?e.pipeline_name:(0,o.__)("Board is deleted!","quicktasker"),icon:(0,n.jsx)(Tn.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(Fa,{menuBtnClasses:"wpqt-self-start",task:e,onUserAdd:t=>{s({type:ce,payload:{taskId:e.id,user:t}})},onUserDelete:t=>{s({type:le,payload:{taskId:e.id,user:t}})}}),(0,n.jsx)(Bn,{task:e})]}),(0,n.jsx)(An,{task:e,onDoneStatusChange:(e,t)=>{s({type:de,payload:{taskId:e,done:t}})}})]})}function Wn(){var e;const{state:{archivedTasks:t=[]}}=(0,a.useContext)(bt),{filterArchive:s}=bn(),i=null!==(e=null==t?void 0:t.filter(s))&&void 0!==e?e:[];return t&&0===t.length?(0,n.jsx)(yn,{text:(0,o.__)("No tasks archived","quicktasker")}):i&&0===i.length?(0,n.jsx)(yn,{}):(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"wpqt-card-grid",children:i.map((e=>(0,n.jsx)(Hn,{task:e},e.id)))})})}function Qn(){const{state:{archivedTasks:e},archiveDispatch:t}=(0,a.useContext)(bt);return e?(0,n.jsxs)("div",{children:[(0,n.jsx)(Wt,{}),(0,n.jsx)(Wn,{}),(0,n.jsx)(jn,{editTaskCallback:e=>{t({type:ue,payload:e})},deleteTaskCallback:e=>{t({type:re,payload:e.id})}})]}):(0,n.jsx)(Dt,{className:"wpqt-h-[200px]"})}function Yn(){return(0,n.jsx)(Tt,{children:(0,n.jsx)(Nt,{children:(0,n.jsxs)(Rt,{children:[(0,n.jsx)(l,{description:(0,o.__)("Archived tasks management page.","quicktasker"),children:(0,o.__)("Archive","quicktasker")}),(0,n.jsx)(Qn,{})]})})})}const Xn=()=>{const{state:{pluginURL:e}}=(0,a.useContext)($s);return(0,n.jsxs)(Rt,{children:[(0,n.jsx)(l,{description:(0,o.__)("Reading material about QuickTasker features and usage.","quicktasker"),children:(0,o.__)("Guide","quicktasker")}),(0,n.jsx)("div",{children:(0,n.jsx)("a",{target:"_blank",rel:"noreferrer",href:e+"help/index.html",children:(0,o.__)("View Guide","quicktasker")})})]})};var Jn=s(4175);const Zn=({filterSettings:e,setFilterSettings:t})=>{const{state:{pipelines:s}}=(0,a.useContext)($t),[i,r]=(0,a.useState)(e);return(0,n.jsxs)(Ht,{title:(0,o.__)("Logs filtering","quicktasker"),children:[(0,n.jsx)(Gt,{allSelector:!1,selectedOptionValue:i.type,options:[{label:(0,o.__)("All types","quicktasker"),value:ei.All},{label:(0,o.__)("Board","quicktasker"),value:ei.Pipeline},{label:(0,o.__)("Stage","quicktasker"),value:ei.Stage},{label:(0,o.__)("Task","quicktasker"),value:ei.Task}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{type:e,typeId:""}))}}),i.type===ei.Pipeline&&(0,n.jsx)(Gt,{allSelector:!0,selectedOptionValue:i.typeId,options:s.map((e=>({label:e.name,value:e.id}))),onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{typeId:e}))}}),(0,n.jsx)(Gt,{allSelector:!1,selectedOptionValue:i.createdBy,options:[{label:(0,o.__)("Everyone","quicktasker"),value:si.All},{label:(0,o.__)("Admin","quicktasker"),value:si.Admin},{label:"QuickTasker",value:si.Quicktasker},{label:"Automation",value:si.Automation}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{createdBy:e}))}}),(0,n.jsx)(Gt,{allSelector:!1,selectedOptionValue:i.numberOfLogs,options:[{label:(0,o.__)("Show 100","quicktasker"),value:ii.Hundred},{label:(0,o.__)("Show 200","quicktasker"),value:ii.TwoHundred},{label:"Show 500",value:ii.FiveHundred},{label:"Show all",value:ii.All}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{numberOfLogs:e}))}}),(0,n.jsx)(Gt,{allSelector:!1,selectedOptionValue:i.order,options:[{label:(0,o.__)("Ascending","quicktasker"),value:ni.Asc},{label:(0,o.__)("Descending","quicktasker"),value:ni.Desc}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{order:e}))}}),(0,n.jsx)(Es,{text:(0,o.__)("Apply filter","quicktasker"),icon:(0,n.jsx)(Jn.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:()=>t(i)})]})};var ei,ti,si;!function(e){e.Pipeline="pipeline",e.Stage="stage",e.Task="task",e.All="all"}(ei||(ei={})),function(e){e.Success="success",e.Error="error"}(ti||(ti={})),function(e){e.Admin="admin",e.Quicktasker="quicktasker_user",e.Automation="automation",e.All="all"}(si||(si={}));const ai=({logs:e,loading:t})=>t?(0,n.jsx)(Dt,{ovalSize:"64",className:"wpqt-mt-12"}):0===e.length?(0,n.jsx)(yn,{text:(0,o.__)("No logs found","quicktasker")}):(0,n.jsx)("div",{className:"wpqt-logs-grid",children:e.map((e=>(0,n.jsx)(Za,{log:e},e.id)))});var ni,ii,oi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};!function(e){e.Asc="ASC",e.Desc="DESC"}(ni||(ni={})),function(e){e.Hundred="100",e.TwoHundred="200",e.FiveHundred="500",e.All="all"}(ii||(ii={}));const ri=()=>{const[e,t]=(0,a.useState)([]),[s,o]=(0,a.useState)({numberOfLogs:ii.Hundred,type:ei.All,typeId:"",createdBy:si.All,order:ni.Desc}),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!0);(0,a.useEffect)((()=>{l&&(w(),d(!1))}),[s,l]);const w=()=>oi(void 0,void 0,void 0,(function*(){try{c(!0);const e=Object.assign({},s);e.numberOfLogs===ii.All&&delete e.numberOfLogs,e.type===ei.All&&delete e.type,""===e.typeId&&delete e.typeId,e.createdBy===si.All&&delete e.createdBy;const a=yield function(e){const t=new URLSearchParams(Object.entries(e).reduce(((e,[t,s])=>(e[t]=String(s),e)),{}));return u()({path:`/wpqt/v1/global-logs?${t.toString()}`,method:"GET",headers:p()})}(e);t(a.data)}catch(e){console.error(e),i.oR.error("Failed to fetch logs")}finally{c(!1)}}));return(0,n.jsxs)("div",{children:[(0,n.jsx)(Zn,{filterSettings:s,setFilterSettings:e=>oi(void 0,void 0,void 0,(function*(){o(e),d(!0)}))}),(0,n.jsx)(ai,{logs:e,loading:r})]})},ci=()=>(0,n.jsxs)(Rt,{children:[(0,n.jsx)(l,{description:(0,o.__)("The logs page where you can see all logs and filter them.","quicktasker"),children:(0,o.__)("Logs","quicktasker")}),(0,n.jsx)(ri,{})]});var li=s(6708);function di({overviewFilter:e,onCreationDateChange:t,onDoneDateChange:s}){const a=e=>e instanceof Date?Ba()(e).format("YYYY-MM-DD"):"";return(0,n.jsx)("div",{children:(0,n.jsxs)(Ht,{title:(0,o.__)("Statistics filtering","quicktasker"),titleClassName:"wpqt-text-center",childrenClassName:"wpqt-gap-6 wpqt-justify-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:(0,o.__)("Task creation date","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("(Filter tasks that have creation date equal or bigger than)","quicktasker")})]}),(0,n.jsx)(li.A,{onChange:e=>{const s=a(e);t(s)},value:e.taskCreationDate,format:"y-MM-dd",id:"taskCreationDate"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:(0,o.__)("Task done date","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("(Filter tasks that have done date equal or smaller than)","quicktasker")})]}),(0,n.jsx)(li.A,{onChange:e=>{const t=a(e);s(t)},value:e.taskDoneDate,format:"y-MM-dd",id:"taskCreationDate"})]})]})})}var ui=s(2298);function pi(e){const t=e.slice(1).some((e=>e[1]>0));return e.length>1&&t}function wi({text:e}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center wpqt-items-center wpqt-h-[400px] wpqt-w-[500px] wpqt-font-semibold",children:e})}function hi({pipelineOverviewData:e,options:t,width:s}){var a,i;const r=[["Archived tasks","Task Count"],["Archived tasks",parseInt(null!==(a=null==e?void 0:e.archivedTasksCount)&&void 0!==a?a:"0")||0],["Not archived tasks",parseInt(null!==(i=null==e?void 0:e.notArchivedTasksCount)&&void 0!==i?i:"0")||0]];return pi(r)?(0,n.jsx)(ui.t1,{chartType:"PieChart",data:r,options:Object.assign(Object.assign({},t),{title:"Archived tasks"}),width:s,height:"400px"}):(0,n.jsx)(wi,{text:(0,o.__)("Not enough data to display archived tasks chart","quicktasker")})}function qi({pipelineOverviewData:e,options:t,width:s}){var a;const i=[["Stage","Task Count"],...null!==(a=null==e?void 0:e.stages.map((e=>[e.name,parseInt(e.tasksCount)||0])))&&void 0!==a?a:[]];return pi(i)?(0,n.jsx)(ui.t1,{chartType:"PieChart",data:i,options:Object.assign(Object.assign({},t),{title:"Task distribution by stages"}),width:s,height:"400px"}):(0,n.jsx)(wi,{text:(0,o.__)("Not enough data to display task distribution by stages chart","quicktasker")})}function mi({pipelineOverviewData:e,options:t,width:s}){var a,i;const r=[["Task status","Task Count"],["Done",parseInt(null!==(a=null==e?void 0:e.doneTasksCount)&&void 0!==a?a:"0")||0],["Not Done",parseInt(null!==(i=null==e?void 0:e.notDoneTasksCount)&&void 0!==i?i:"0")||0]];return pi(r)?(0,n.jsx)(ui.t1,{chartType:"PieChart",data:r,options:Object.assign(Object.assign({},t),{title:"Task status"}),width:s,height:"400px"}):(0,n.jsx)(wi,{text:(0,o.__)("Not enough data to display task status chart","quicktasker")})}var vi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const xi={legend:{position:"left",alignment:"center",textStyle:{color:"#233238",fontSize:14}}};function fi({pipeline:e,overviewFilter:t}){const[s,i]=(0,a.useState)(null),[o,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(()=>{vi(this,void 0,void 0,(function*(){try{r(!0);const s=yield function(e,t){const s=new URLSearchParams({taskStartDate:t.taskCreationDate||"",taskDoneDate:t.taskDoneDate||"",taskAssignees:t.taskAssignees.join(",")});return u()({path:`/wpqt/v1/pipelines/${e}/overview?${s.toString()}`,method:"GET",headers:p()})}(e.id,t);i(s.data)}catch(e){console.error(e)}finally{r(!1)}}))})()}),[e.id,t]),o||!s?(0,n.jsx)(Dt,{ovalSize:"48"}):(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-wrap wpqt-justify-center xl:wpqt-justify-start",children:[(0,n.jsx)(qi,{pipelineOverviewData:s,options:xi,width:"500px"}),(0,n.jsx)(mi,{pipelineOverviewData:s,options:xi,width:"500px"}),(0,n.jsx)(hi,{pipelineOverviewData:s,options:xi,width:"500px"})]})}function gi({pipeline:e}){const[t,s]=(0,a.useState)({taskCreationDate:null,taskDoneDate:null,taskAssignees:[]});return(0,n.jsxs)("div",{children:[(0,n.jsx)(di,{overviewFilter:t,onCreationDateChange:e=>{s(Object.assign(Object.assign({},t),{taskCreationDate:e}))},onDoneDateChange:e=>{s(Object.assign(Object.assign({},t),{taskDoneDate:e}))}}),(0,n.jsx)(fi,{pipeline:e,overviewFilter:t})]})}function _i(){const{state:{pipelines:e}}=(0,a.useContext)($t),t=e.map((e=>e.name)),s=e.map((e=>(0,n.jsx)(gi,{pipeline:e},e.id)));return(0,n.jsxs)(Rt,{children:[(0,n.jsx)(l,{description:(0,o.__)("Get overview of the tasks.","quicktasker"),children:(0,o.__)("Overview","quicktasker")}),(0,n.jsx)($a,{tabs:t,tabsContent:s,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})]})}function ki(){const{state:{activePipeline:e}}=(0,a.useContext)(Jt),t=()=>(null==e?void 0:e.stages)||[],s=e=>{const s=t();let a=null;return s?(s.forEach((t=>{t.tasks&&!a&&t.tasks.find((t=>t.id===e))&&(a=t)})),a):null},n=(0,a.useMemo)((()=>{const e=t();return e?e.map((e=>({label:e.name,value:e.id}))):[]}),[e]),i=(0,a.useMemo)((()=>{const e=t(),s=[];return e?(e.forEach((e=>{e.tasks&&s.push(...e.tasks)})),s):s}),[e]),o=null==e?void 0:e.settings;return{getActivePipelineStages:t,getActivePipelinStageTasksLength:e=>{const s=t();if(!s)return 0;const a=s.find((t=>t.id===e));return a&&a.tasks?a.tasks.length:0},getTaskStage:s,getTaskOrderInStage:e=>{const t=s(e);if(!t||!t.tasks)return null;const a=t.tasks.findIndex((t=>t.id===e));return-1!==a?a:null},activePipelineTasks:i,activePipelineSettings:o,isTaskOnLastStage:e=>{const a=t();if(!a)return!1;const n=s(e);if(!n)return!1;const i=a[a.length-1];return n.id===i.id},stageOptions:n}}const ji=()=>{const{state:{users:e,wpUsers:t}}=(0,a.useContext)(ws);return{getUser:(s,a)=>a===nt.QUICKTASKER?e.find((e=>e.id===s)):a===nt.WP_USER?t.find((e=>e.id===s)):void 0,combinedUsers:(0,a.useMemo)((()=>[...e,...t]),[e,t])}},yi=(e,t)=>{switch(t.type){case $:{const{id:s,type:a}=t.payload;return Object.assign(Object.assign({},e),{userFilter:{id:s,type:a}})}case z:return Object.assign(Object.assign({},e),{stageIdFilter:t.payload});default:return e}},bi={stageIdFilter:"",userFilter:{id:null,type:null}},Ti=(0,a.createContext)({state:bi,taskViewDispatch:()=>{}}),Si=({children:e})=>{const[t,s]=(0,a.useReducer)(yi,bi);return(0,n.jsx)(Ti.Provider,{value:{state:t,taskViewDispatch:s},children:e})};function Ei(){const{state:{stageIdFilter:e,userFilter:t},taskViewDispatch:s}=(0,a.useContext)(Ti),{stageOptions:i}=ki(),{combinedUsers:r}=ji(),c=r.map((e=>({value:`${e.id}:${e.user_type}`,label:`${e.name} (${wt[e.user_type]})`}))),l=t.id&&t.type?`${t.id}:${t.type}`:"";return(0,n.jsxs)(Ht,{title:(0,o.__)("Filter tasks","quicktasker"),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(Un,{labelFor:"task-view-stage-filter",className:"wpqt-block wpqt-text-center",children:(0,o.__)("Stage","quicktasker")}),(0,n.jsx)(Gt,{id:"task-view-stage-filter",allSelectorLabel:(0,o.__)("All stages","quicktasker"),selectedOptionValue:e,options:i,onSelectionChange:e=>{s({type:z,payload:e})}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(Un,{labelFor:"task-view-assigned-user-filter",className:"wpqt-block wpqt-text-center",children:(0,o.__)("Assigned user","quicktasker")}),(0,n.jsx)(Gt,{id:"task-view-assigned-user-filter",allSelectorLabel:(0,o.__)("All users","quicktasker"),selectedOptionValue:l,options:c,onSelectionChange:e=>{const[t,a]=e.split(":");s({type:$,payload:{id:t,type:a}})}})]})]})}function Ai(){const{state:{moveTaskModalOpen:e,taskToEdit:t},modalDispatch:s}=(0,a.useContext)(cs),{dispatch:i}=(0,a.useContext)(Jt),{getActivePipelineStages:r,getActivePipelinStageTasksLength:c,getTaskStage:l,getTaskOrderInStage:d}=ki(),{moveTask:u}=ns(),[p,w]=(0,a.useState)(0),[h,q]=(0,a.useState)(""),[m,v]=(0,a.useState)(!1),x=c(h),f=Array.from({length:x+1},((e,t)=>({value:t.toString(),label:(t+1).toString()}))),g=r().map((e=>({value:e.id,label:e.name}))),k=()=>{s({type:ae})};return(0,a.useEffect)((()=>{if(t){const e=l(t.id),s=d(t.id);e&&null!==s&&(q(e.id),w(s))}}),[t]),(0,n.jsx)(Cs,{modalOpen:e,closeModal:k,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)("h2",{children:(0,o.__)("Change task location on board","quicktasker")}),(0,n.jsx)("label",{htmlFor:"move-task-stage-selection",children:(0,o.__)("Select stage","quicktasker")}),(0,n.jsx)(Gt,{id:"move-task-stage-selection",allSelector:!1,selectedOptionValue:h,options:g,onSelectionChange:e=>{q(e),w(0)}}),(0,n.jsx)("label",{htmlFor:"move-task-order-selection",children:(0,o.__)("Select order","quicktasker")}),(0,n.jsx)(Gt,{id:"move-task-order-selection",allSelector:!1,selectedOptionValue:String(p),options:f,onSelectionChange:e=>w(Number(e))}),(0,n.jsx)(Ss,{btnText:(0,o.__)("Apply","quicktasker"),loading:m,onClick:()=>{return e=this,s=void 0,n=function*(){if(!t)return;const e=l(t.id),s=d(t.id);e&&null!==s&&(v(!0),yield u(t.id,h,p,(t=>{t&&(i({type:_,payload:{source:{droppableId:e.id,index:s},destination:{droppableId:h,index:p}}}),k())})),v(!1))},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n}})]})})}const Ci=(0,a.forwardRef)((({addPipeline:e,modalSaving:t},s)=>{const[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(""),d=()=>{r(""),l("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:d}))),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(Os,{children:[(0,n.jsx)(Is,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(Hs,{isAutoFocus:!0,value:i,onChange:e=>r(e)})}),(0,n.jsx)(Is,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Ys,{rowsCount:3,value:c,onChange:e=>l(e)})})]}),(0,n.jsx)(Ps,{onSave:()=>{e(i,c)},loading:t,saveBtnText:(0,o.__)("Add board","quicktasker")})]})}));var Ni=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Oi(){return{deletePipeline:(e,t)=>Ni(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e}`,method:"DELETE",headers:p()})}(e);t&&t(s.data.deletedPipelineId,s.data.pipelineIdToLoad)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete board","quicktasker"))}})),addPipeline:(e,t,s,a)=>Ni(this,void 0,void 0,(function*(){try{const a=yield(n=e,r=t,u()({path:"/wpqt/v1/pipelines",method:"POST",data:{name:n,description:r},headers:p()}));i.oR.success((0,o.__)("Board created successfully","quicktasker")),s&&s(a.data)}catch(e){i.oR.error((0,o.__)("Failed to create a board","quicktasker")),a&&a(e)}var n,r})),editPipeline:(e,t,s)=>Ni(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e.id}`,method:"PATCH",data:{name:e.name,description:e.description,is_primary:e.is_primary},headers:p()})}(e);i.oR.success((0,o.__)("Board updated successfully","quicktasker")),t&&t(s.data)}catch(e){i.oR.error((0,o.__)("Failed to update board","quicktasker")),s&&s(e)}}))}}function Ii(){const{state:{newPipelineModalOpen:e}}=(0,a.useContext)(cs),{fetchAndSetPipelineData:t}=(0,a.useContext)(Jt),{modalSaving:s,setModalSaving:i,modalContentRef:o,closeModal:r,handleSuccess:c,handleError:l}=ms(Y),{addPipeline:d}=Oi();return(0,n.jsx)(Cs,{modalOpen:e,closeModal:r,children:(0,n.jsx)(Ci,{ref:o,addPipeline:(e,s)=>{return a=this,n=void 0,u=function*(){i(!0),yield d(e,s,(e=>{c(S,e,qs.PIPELINES),t(e.id),r()}),(e=>{l(e)}))},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{r(u.next(e))}catch(e){t(e)}}function i(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){var a;t.done?e(t.value):(a=t.value,a instanceof o?a:new o((function(e){e(a)}))).then(s,i)}r((u=u.apply(a,n||[])).next())}));var a,n,o,u},modalSaving:s,setModalSaving:i})})}const Pi=(0,a.forwardRef)((({editPipeline:e,modalSaving:t},s)=>{const{state:{pipelineToEdit:r},modalDispatch:c}=(0,a.useContext)(cs),{fetchAndSetPipelineData:l,dispatch:d}=(0,a.useContext)(Jt),{pipelinesDispatch:u}=(0,a.useContext)($t),{deletePipeline:p}=Oi(),[w,h]=(0,a.useState)(""),[q,m]=(0,a.useState)(""),{loading1:v,setLoading1:x}=Ms();(0,a.useEffect)((()=>{r&&(h(r.name),m(r.description||""))}),[r]);const f=()=>{h(""),m("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:f}))),r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsx)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:(0,n.jsxs)("div",{className:"wpqt-mb-5 wpqt-grid wpqt-grid-cols-1 wpqt-gap-4 md:wpqt-grid-cols-[auto_1fr]",children:[(0,n.jsxs)(Os,{children:[(0,n.jsx)(Is,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(Hs,{isAutoFocus:!0,value:w,onChange:e=>h(e)})}),(0,n.jsx)(Is,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Ys,{rowsCount:3,value:q,onChange:e=>m(e)})})]}),(0,n.jsx)(Aa,{entityId:r.id,entityType:Gs.Pipeline})]})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:(0,n.jsx)(Es,{icon:(0,n.jsx)(Ls.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:v,text:(0,o.__)("Delete board","quicktasker"),onClick:()=>{r&&(x(!0),p(r.id,((e,t)=>{c({type:Y}),x(!1),i.oR.success((0,o.__)("Board deleted","quicktasker")),u({type:P,payload:e}),null!==t?(u({type:A,payload:t}),l(t)):d({type:D})})))}})})]}),(0,n.jsx)(Ps,{onSave:()=>{r&&e(Object.assign(Object.assign({},r),{name:w,description:q}))},loading:t,saveBtnText:(0,o.__)("Save","quicktasker")})]}):null}));function Di(){const{state:{pipelineModalOpen:e}}=(0,a.useContext)(cs),{modalSaving:t,setModalSaving:s,modalContentRef:i,closeModal:o,handleSuccess:r,handleError:c}=ms(Y),{editPipeline:l}=Oi();return(0,n.jsx)(Cs,{modalOpen:e,closeModal:o,size:"xl",children:(0,n.jsx)(Pi,{ref:i,editPipeline:e=>{return t=this,a=void 0,i=function*(){s(!0),yield l(e,(e=>{r(E,e,qs.ACTIVE_PIPELINE)}),(e=>{c(e)}))},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i},modalSaving:t,setModalSaving:s})})}var Ri=s(9919),Li=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Ui=(0,a.forwardRef)((({editStage:e,addStage:t,stageModalSaving:s},i)=>{const{state:{stageToEdit:r}}=(0,a.useContext)(cs),[c,l]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),p=!!r;(0,a.useEffect)((()=>{r&&(l(r.name),u(r.description))}),[r]);const w=()=>{l(""),u("")};return(0,a.useImperativeHandle)(i,(()=>({clearContent:w}))),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Ns,{children:p?(0,o.__)("Edit Stage","quicktasker"):(0,o.__)("Add Stage","quicktasker")}),(0,n.jsxs)(Os,{children:[(0,n.jsx)(Is,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(Hs,{isAutoFocus:!0,value:c,onChange:e=>l(e)})}),(0,n.jsx)(Is,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Ys,{rowsCount:3,value:d,onChange:e=>u(e)})})]}),(0,n.jsx)(Ps,{onSave:()=>{p?e(Object.assign(Object.assign({},r),{name:c,description:d})):t(c,d)},loading:s,saveBtnText:p?(0,o.__)("Save","quicktasker"):(0,o.__)("Add stage","quicktasker")})]})}));var Mi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Fi(){const{state:{stageModalOpen:e,targetPipelineId:t}}=(0,a.useContext)(cs),{modalSaving:s,setModalSaving:r,modalContentRef:c,closeModal:l,handleSuccess:d,handleError:w}=ms(B),{editStage:h,addStage:q}=function(){return{editStage:(e,t,s)=>Li(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/stages/${e.id}`,method:"PATCH",data:{name:e.name,description:e.description},headers:p()})}(e);i.oR.success((0,o.__)("Stage updated successfully","quicktasker")),t&&t(s.data)}catch(e){i.oR.error((0,o.__)("Failed to update stage","quicktasker")),s&&s(e)}})),addStage:(e,t,s,a,n)=>Li(this,void 0,void 0,(function*(){try{const n=yield(r=e,c=t,l=s,u()({path:"/wpqt/v1/stages",method:"POST",data:{pipelineId:r,name:c,description:l},headers:p()}));i.oR.success((0,o.__)("Stage created successfully","quicktasker")),a&&a(n.data)}catch(e){i.oR.error((0,o.__)("Failed to create stage","quicktasker")),n&&n(e)}var r,c,l}))}}();return(0,n.jsx)(Cs,{modalOpen:e,closeModal:l,children:(0,n.jsx)(Ui,{ref:c,editStage:e=>Mi(this,void 0,void 0,(function*(){r(!0),yield h(e,(e=>{d(T,e,qs.ACTIVE_PIPELINE),l()}),(e=>{w(e)}))})),addStage:(e,s)=>Mi(this,void 0,void 0,(function*(){try{r(!0),yield q(t,e,s,(e=>{d(j,{stage:Object.assign(Object.assign({},e),{tasks:[]})},qs.ACTIVE_PIPELINE),l()}))}catch(e){w(e)}})),stageModalSaving:s,stageTaskModalSaving:r})})}function zi({pipelineId:e,stagesLength:t=0}){const{modalDispatch:s}=(0,a.useContext)(cs),i=()=>{return t=this,a=void 0,i=function*(){s({type:G,payload:{targetPipelineId:e}})},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i};return 0===t?(0,n.jsx)("div",{className:"wpqt-pipeline-height wpqt-flex wpqt-w-full wpqt-items-center wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-main-border wpqt-flex wpqt-cursor-pointer wpqt-flex-col wpqt-items-center wpqt-justify-start wpqt-gap-y-1 wpqt-p-3 hover:wpqt-bg-gray-100",onClick:i,children:[(0,n.jsx)(ia.A,{className:"wpqt-size-6 wpqt-text-green-600"}),(0,n.jsx)("div",{className:"wpqt-whitespace-nowrap",children:(0,o.__)("Add first stage","quicktasker")})]})}):(0,n.jsxs)("div",{className:"wpqt-main-border wpqt-mb-3 wpqt-flex wpqt-cursor-pointer wpqt-flex-col wpqt-items-center wpqt-justify-start wpqt-self-start wpqt-p-3 hover:wpqt-bg-gray-100",onClick:i,children:[(0,n.jsx)(ia.A,{className:"wpqt-size-6 wpqt-text-green-600"}),(0,n.jsx)("div",{className:"wpqt-whitespace-nowrap",children:(0,o.__)("Add stage","quicktasker")})]})}function $i(){const{modalDispatch:e}=(0,a.useContext)(cs);return(0,n.jsx)("div",{className:"wpqt-flex wpqt-h-screen-minus-top-bar wpqt-items-center wpqt-justify-center",children:(0,n.jsxs)("div",{onClick:()=>{return t=this,s=void 0,n=function*(){e({type:W})},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n},className:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)(ia.A,{className:"wpqt-icon-green wpqt-size-6 wpqt-cursor-pointer"}),(0,n.jsx)("span",{children:(0,o.__)("Add your first Board","quicktasker")})]})})}var Ki=s(12),Vi=s(5575),Gi=s(6304),Bi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Hi({stage:e}){var t,s,r,c;const{dispatch:l,state:{activePipeline:d},fetchAndSetPipelineData:w}=(0,a.useContext)(Jt),{modalDispatch:h}=(0,a.useContext)(cs),{state:{isUserAllowedToDelete:q}}=(0,a.useContext)($s),[m,v]=(0,a.useState)(!1),[x,f]=(0,a.useState)(!1),[g,_]=(0,a.useState)(!1),k=null!==(s=null===(t=null==d?void 0:d.stages)||void 0===t?void 0:t.length)&&void 0!==s?s:0,j=null!==(c=null===(r=e.tasks)||void 0===r?void 0:r.length)&&void 0!==c?c:0,b=+e.stage_order,T=b>0&&b<k,S=b!==k-1,E=t=>Bi(this,void 0,void 0,(function*(){try{v(!0),yield function(e,t){return u()({path:`/wpqt/v1/stages/${e}/move`,method:"PATCH",data:{direction:t},headers:p()})}(e.id,t),yield w(d.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to move a stage","quicktasker"))}finally{v(!1)}}));return(0,n.jsxs)(Oa,{menuBtn:({active:e})=>(0,n.jsx)(Ia,{isActive:e,IconComponent:Ki.A}),children:[T&&(0,n.jsx)(Pa,{text:(0,o.__)("Move left","quicktasker"),loading:m,icon:(0,n.jsx)(Vi.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:()=>E("left")}),S&&(0,n.jsx)(Pa,{text:(0,o.__)("Move right","quicktasker"),loading:m,icon:(0,n.jsx)(Gi.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:()=>E("right")}),(0,n.jsx)(Pa,{text:(0,o.__)("Edit stage","quicktasker"),icon:(0,n.jsx)(ua.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:()=>{h({type:H,payload:{stageToEdit:e}})}}),(0,n.jsx)(Pa,{text:(0,o.__)("Archive all stage tasks","quicktasker"),icon:(0,n.jsx)(Rs.A,{className:"wpqt-icon-blue wpqt-size-4"}),loading:x,onClick:()=>Bi(this,void 0,void 0,(function*(){try{f(!0),yield(t=e.id,u()({path:`/wpqt/v1/stages/${t}/archive-tasks`,method:"PATCH",headers:p()})),yield w(d.id),i.oR.success((0,o.sprintf)((0,o.__)("Archived all %s tasks","quicktasker"),e.name))}catch(t){console.error(t),i.oR.error((0,o.sprintf)((0,o.__)("Failed to archive stage %s tasks","quicktasker"),e.name))}finally{f(!1)}var t})),disabled:0===j,id:`item-dropdown-${e.id}-archive`,tooltipText:0===j?(0,o.__)("No tasks to archive on the stage","quicktasker"):void 0}),q&&(0,n.jsx)(Pa,{text:(0,o.__)("Delete stage","quicktasker"),icon:(0,n.jsx)(Ls.A,{className:"wpqt-icon-red wpqt-size-4"}),loading:g,onClick:()=>Bi(this,void 0,void 0,(function*(){try{_(!0),yield(t=e.id,u()({path:`/wpqt/v1/stages/${t}`,method:"DELETE",data:{stageId:t},headers:p()})),l({type:y,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete a stage","quicktasker"))}finally{_(!1)}var t})),disabled:j>0,className:"!wpqt-mb-0",id:`item-dropdown-${e.id}`,tooltipText:(0,o.__)("Stage can be deleted when there are no tasks on it","quicktasker")})]})}var Wi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Qi({stageId:e}){const[t,s]=(0,a.useState)(""),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),w=(0,a.useRef)(null),h=(0,a.useRef)(null),{state:{activePipeline:q},dispatch:m}=(0,a.useContext)(Jt),{handleExecutedAutomations:v}=ss();(0,a.useEffect)((()=>{const e=e=>{"Enter"===e.key&&document.activeElement===h.current&&x()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[t]),(0,a.useEffect)((()=>{const e=e=>{w.current&&!w.current.contains(e.target)&&f()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),(0,a.useEffect)((()=>{var e;r&&(null===(e=h.current)||void 0===e||e.focus())}),[r]);const x=()=>Wi(this,void 0,void 0,(function*(){if(t)try{d(!0);const s=yield function(e,t,s){return u()({path:"/wpqt/v1/tasks",method:"POST",data:{stageId:e,name:s,pipelineId:t},headers:p()})}(e,q.id,t);m({type:k,payload:s.data.newTask}),i.oR.success((0,o.__)("Task created","quicktasker")),f(),v(s.data.executedAutomations,s.data.newTask.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create task","quicktasker"))}finally{d(!1)}else i.oR.error((0,o.__)("Task name is required","quicktasker"))})),f=()=>{c(!1),s("")};return(0,n.jsx)("div",{ref:w,className:"wpqt-sticky wpqt-bottom-0 wpqt-z-10 wpqt-order-1 wpqt-mt-2 wpqt-flex wpqt-justify-center wpqt-bg-gray-100 wpqt-py-2",children:r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-3",children:[(0,n.jsx)(Hs,{ref:h,value:t,onChange:e=>s(e),wrapperClassName:"!wpqt-mb-0",className:"!wpqt-mb-0"}),l?(0,n.jsx)(It,{width:"24",height:"24"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(na.A,{className:"wpqt-icon-red wpqt-size-6 wpqt-cursor-pointer",onClick:f}),(0,n.jsx)(ia.A,{className:"wpqt-icon-green wpqt-size-6 wpqt-cursor-pointer",onClick:x})]})]}):(0,n.jsxs)("div",{onClick:()=>c(!0),className:"wpqt-main-border wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-p-2 hover:wpqt-bg-white",children:[(0,o.__)("Add task","quicktasker"),(0,n.jsx)(ia.A,{className:"wpqt-size-6 wpqt-text-green-600"})]})})}var Yi=s(1735),Xi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ji({task:e}){const{modalDispatch:t}=(0,a.useContext)(cs),{state:{activePipeline:s},fetchAndSetPipelineData:i}=(0,a.useContext)(Jt),{state:{isUserAllowedToDelete:r}}=(0,a.useContext)($s),{deleteTask:c,archiveTask:l}=ns(),[d,u]=(0,a.useState)(!1);return(0,n.jsxs)(Oa,{menuBtn:({active:e})=>(0,n.jsx)(Ia,{isActive:e,IconComponent:Nn.A}),children:[(0,n.jsx)(Pa,{text:(0,o.__)("Archive task","quicktasker"),icon:(0,n.jsx)(Rs.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),l(e.id,(()=>{i(s.id)}))}}),(0,n.jsx)(Pa,{text:(0,o.__)("Edit task","quicktasker"),icon:(0,n.jsx)(ua.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:K,payload:{taskToEdit:e}})}}),(0,n.jsx)(Pa,{text:(0,o.__)("Move task","quicktasker"),icon:(0,n.jsx)(Yi.zhn,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:se,payload:{task:e}})}}),r&&(0,n.jsx)(Pa,{text:(0,o.__)("Delete task","quicktasker"),icon:(0,n.jsx)(Ls.A,{className:"wpqt-icon-red wpqt-size-4"}),loading:d,onClick:t=>Xi(this,void 0,void 0,(function*(){t.stopPropagation(),u(!0),yield c(e.id,(()=>{i(s.id)})),u(!1)})),className:"!wpqt-mb-0"})]})}var Zi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function eo({task:e,allowToMarkTaskAsDone:t}){const{dispatch:s}=(0,a.useContext)(Jt),{changeTaskDoneStatus:i}=ns(),[o,r]=(0,a.useState)(!1),c=e.is_done,l=t=>Zi(this,void 0,void 0,(function*(){r(!0),yield i(e.id,t,(t=>{s({type:I,payload:{taskId:e.id,done:t}})})),r(!1)}));return t?o?(0,n.jsx)(Dt,{ovalSize:"24"}):(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:c?(0,n.jsx)(Us.A,{className:"wpqt-size-6 wpqt-icon-green",onClick:e=>{e.stopPropagation(),l(!1)}}):(0,n.jsx)(Us.A,{className:"wpqt-size-6 wpqt-icon-gray",onClick:e=>{e.stopPropagation(),l(!0)}})}):null}function to({task:e,index:t,onLastStage:s}){const{modalDispatch:i}=(0,a.useContext)(cs),{state:{activePipeline:o}}=(0,a.useContext)(Jt),r=!(null==o?void 0:o.settings).allow_only_last_stage_task_done||s,c=()=>{i({type:K,payload:{taskToEdit:e,taskModalSettings:{allowToMarkTaskAsDone:r}}})};return(0,n.jsx)(Ri.sx,{draggableId:e.id,index:t,children:t=>(0,n.jsxs)("div",Object.assign({ref:t.innerRef},t.draggableProps,t.dragHandleProps,{className:"wpqt-relative wpqt-mx-4 wpqt-mb-2 wpqt-flex !wpqt-cursor-pointer wpqt-flex-col wpqt-gap-1 wpqt-rounded wpqt-border wpqt-border-gray-200 wpqt-bg-white wpqt-p-3 wpqt-shadow hover:wpqt-shadow-md",onClick:c,children:[(0,n.jsx)("div",{className:"wpqt-absolute wpqt-right-[12px] wpqt-top-[12px]",children:(0,n.jsx)(Ji,{task:e})}),(0,n.jsx)("div",{className:"wpqt-text-base",children:e.name}),e.description&&(0,n.jsx)("div",{className:"wpqt-text-sm wpqt-italic",children:e.description}),(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(Fa,{task:e}),(0,n.jsx)(Bn,{task:e})]}),(0,n.jsx)(eo,{task:e,allowToMarkTaskAsDone:r})]}))},e.id)}function so({tasks:e}){const t=e.length;return(0,n.jsx)("span",{className:"wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-1 wpqt-text-xs",children:t})}function ao({stage:e,isLastStage:t}){return(0,n.jsxs)("div",{"data-stage-id":e.id,className:"wpqt-relative wpqt-mb-3 wpqt-flex wpqt-max-h-full wpqt-w-[360px] wpqt-flex-none wpqt-flex-col wpqt-overflow-hidden wpqt-rounded-md wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-bg-gray-100",children:[(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-flex wpqt-flex-wrap wpqt-items-center wpqt-gap-1 wpqt-px-4 wpqt-pt-3",children:[(0,n.jsxs)("div",{className:"wpqt-mr-auto wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-text-base wpqt-leading-none",children:[e.name," ",(0,n.jsx)(so,{tasks:e.tasks})]}),(0,n.jsx)(Hi,{stage:e}),e.description&&(0,n.jsx)("div",{className:"wpqt-w-full wpqt-flex-shrink-0 wpqt-flex-grow-0 wpqt-text-sm",children:e.description})]}),(0,n.jsx)(Ri.gL,{droppableId:e.id,children:s=>{var a;return(0,n.jsxs)("div",{ref:s.innerRef,className:"wpqt-flex wpqt-h-full wpqt-flex-col wpqt-overflow-y-auto wpqt-overflow-x-hidden",children:[null===(a=e.tasks)||void 0===a?void 0:a.map(((e,s)=>(0,n.jsx)(to,{task:e,index:s,onLastStage:t},e.id))),s.placeholder,(0,n.jsx)(Qi,{stageId:e.id})]})}})]})}const no=()=>{var e,t;const{state:{activePipeline:s},dispatch:r,fetchAndSetPipelineData:c}=(0,a.useContext)(Jt);(0,a.useEffect)((()=>{const e=setInterval((()=>{s&&c(s.id)}),3e4);return()=>clearInterval(e)}),[s]);const l=(e,t)=>{e.droppableId===t.droppableId?r({type:"REORDER_TASK",payload:{source:e,destination:t}}):r({type:_,payload:{source:e,destination:t}})},d=(0,a.useCallback)((e=>{return t=void 0,s=void 0,n=function*(){const{source:t,destination:s,draggableId:a}=e;if(s){l(t,s);try{yield w(a,s.droppableId,s.index)}catch(e){console.error(e),l(s,t),i.oR.error((0,o.__)("Failed to move a task","quicktasker"))}}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n}),[s]);return s?(0,n.jsxs)("div",{className:"wpqt-pipeline-height wpqt-flex wpqt-gap-[24px] wpqt-overflow-x-auto wpqt-overflow-y-hidden",children:[(0,n.jsx)(Ri.JY,{onDragEnd:d,children:null===(e=s.stages)||void 0===e?void 0:e.map(((e,t)=>{const a=t===s.stages.length-1;return(0,n.jsx)(ao,{stage:e,isLastStage:a},e.id)}))}),(0,n.jsx)(zi,{pipelineId:s.id,stagesLength:null===(t=s.stages)||void 0===t?void 0:t.length}),(0,n.jsx)(jn,{deleteTaskCallback:()=>{s&&c(s.id)}}),(0,n.jsx)(Fi,{})]}):(0,n.jsx)($i,{})};var io=s(8932),oo=s(247),ro=s(1203),co=s(2496),lo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function uo(){const{state:{activePipeline:e},fetchAndSetPipelineData:t}=(0,a.useContext)(Jt),{state:{pipelines:s},pipelinesDispatch:r}=(0,a.useContext)($t),{modalDispatch:c}=(0,a.useContext)(cs),l=e=>lo(this,void 0,void 0,(function*(){try{yield(t=e.id,u()({path:`/wpqt/v1/pipelines/${t}/set-primary`,method:"PATCH",headers:p()})),r({type:A,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to set primary board","quicktasker"))}var t}));return(0,n.jsxs)(Oa,{menuBtnClasses:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1 wpqt-rounded-xl wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-p-3",menuBtn:({active:t})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-leading-none",children:null==e?void 0:e.name}),(0,n.jsx)(ro.A,{className:"wpqt-size-4 "+(t?"wpqt-text-qtBlueHover":"")})]}),children:[(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center wpqt-font-bold",children:(0,o.__)("Change board","quicktasker")}),s.map((s=>{const a=s.is_primary,i=(null==e?void 0:e.id)===s.id;return(0,n.jsx)(Na.Dr,{children:(0,n.jsxs)("div",{className:"wpqt-mb-3 wpqt-flex wpqt-gap-2",children:[(0,n.jsx)("div",{className:(0,Qs.$)("wpqt-cursor-pointer wpqt-text-center",{"wpqt-font-bold":i}),onClick:()=>t(s.id),children:s.name}),(0,n.jsx)("div",{className:"wpqt-ml-auto",children:a?(0,n.jsx)(co.A,{className:"wpqt-size-4 wpqt-cursor-pointer wpqt-text-blue-500"}):(0,n.jsx)(oo.A,{className:"wpqt-size-4 wpqt-cursor-pointer wpqt-text-gray-400",onClick:e=>{e.stopPropagation(),l(s)}})})]})},s.id)})),(0,n.jsx)(Na.Dr,{children:(0,n.jsx)("div",{className:"wpqt-mt-4 wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-2",children:(0,n.jsx)(Es,{text:(0,o.__)("Add new board","quicktasker"),onClick:()=>lo(this,void 0,void 0,(function*(){c({type:W})})),icon:(0,n.jsx)(ia.A,{className:"wpqt-size-6 wpqt-icon-green"}),className:"wpqt-bg-white hover:!wpqt-bg-gray-100"})})},"new-pipeline")]})}function po(){const{state:{activePipeline:e,loading:t},fetchAndSetPipelineData:s}=(0,a.useContext)(Jt),{modalDispatch:i}=(0,a.useContext)(cs);return e?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-py-5",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:e.name}),(0,n.jsx)(Ki.A,{className:"wpqt-text-gray-400 wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{e&&i({type:Q,payload:{pipelineToEdit:e}})}})]}),e.description&&(0,n.jsx)("div",{className:"wpqt-italic",children:e.description})]}),(0,n.jsxs)("div",{className:"wpqt-ml-auto wpqt-flex wpqt-items-center wpqt-gap-3",children:[(0,n.jsx)(wo,{}),t?(0,n.jsx)(It,{width:"24",height:"24"}):(0,n.jsx)(tn.A,{className:"wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>s(e.id)}),(0,n.jsx)(uo,{})]})]}):null}function wo(){const{state:{view:e},dispatch:t}=(0,a.useContext)(Jt);return(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-items-center wpqt-cursor-pointer wpqt-text-blue-400 wpqt-text-base :hover:wpqt-text-blue-600",onClick:()=>{t({type:L,payload:e===Yt.PIPELINE?Yt.TASK:Yt.PIPELINE})},children:e===Yt.PIPELINE?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(io.A,{className:"wpqt-size-5 wpqt-text-blue-400"}),(0,o.__)("Switch to Task view","quicktasker")]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Tn.A,{className:"wpqt-size-5 wpqt-text-blue-400"}),(0,o.__)("Switch to Board view","quicktasker")]})})}function ho(){const{modalDispatch:e}=(0,a.useContext)(cs),{activePipelineTasks:t,activePipelineSettings:s,isTaskOnLastStage:i}=ki(),{taskViewFilter:r}=(()=>{const{state:{stageIdFilter:e,userFilter:t}}=(0,a.useContext)(Ti);return{taskViewFilter:s=>{var a,n;const i=!e||s.stage_id===e,o=!t.id||!t.type||t.type===nt.QUICKTASKER&&(null===(a=s.assigned_users)||void 0===a?void 0:a.some((e=>e.id===t.id)))||t.type===nt.WP_USER&&(null===(n=s.assigned_wp_users)||void 0===n?void 0:n.some((e=>e.id===t.id)));return i&&o}}})(),c=t.filter(r);return 0===c.length?(0,n.jsx)(yn,{text:(0,o.__)("No tasks","quictasker")}):(0,n.jsxs)("div",{className:"wpqt-card-grid",children:[c.map((t=>{const a=i(t.id),o=!s.allow_only_last_stage_task_done||a;return(0,n.jsxs)(Sn,{className:"wpqt-cursor-pointer",title:t.name,description:t.description,dropdown:(0,n.jsx)(Ji,{task:t}),onClick:()=>{e({type:K,payload:{taskToEdit:t,taskModalSettings:{allowToMarkTaskAsDone:o}}})},children:[(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(Fa,{task:t}),(0,n.jsx)(Bn,{task:t})]}),(0,n.jsx)(eo,{task:t,allowToMarkTaskAsDone:o})]},t.id)})),(0,n.jsx)(jn,{})]})}const qo=()=>(0,n.jsx)(Zt,{children:(0,n.jsx)(Nt,{children:(0,n.jsx)(mo,{})})}),mo=()=>{const{state:{view:e}}=(0,a.useContext)(Jt),t=e===Yt.PIPELINE;return(0,n.jsxs)(Rt,{children:[(0,n.jsx)(po,{}),t?(0,n.jsx)(no,{}):(0,n.jsxs)(Si,{children:[(0,n.jsx)(Ei,{}),(0,n.jsx)(ho,{})]}),(0,n.jsx)(Ii,{}),(0,n.jsx)(Di,{}),(0,n.jsx)(Ai,{})]})};var vo=s(6197),xo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function fo(){return{saveCustomUserPageStyles:(e,t)=>xo(this,void 0,void 0,(function*(){try{const a=yield(s=e,u()({path:"/wpqt/v1/settings/user-page-custom-styles",method:"PATCH",data:{styles:s},headers:p()}));t&&t(a.data),i.oR.success((0,o.__)("Custom user page styles saved successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to save custom user page styles","quicktasker"))}var s})),saveTaskCompletionDoneSetting:(e,t,s)=>xo(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/settings/task-completion-done-restriction`,method:"PATCH",data:{allow_task_completion_only_on_last_stage:t},headers:p()})}(e,t),s&&s(t)}catch(e){s&&s(!t),console.error(e),i.oR.error((0,o.__)("Failed to save setting","quicktasker"))}}))}}const go=({children:e,title:t,description:s})=>(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-mb-5",children:[(0,n.jsx)("h3",{className:"wpqt-mb-1",children:t}),(0,n.jsx)("p",{children:s}),e]});const _o=()=>{const{state:{userPageCustomStyles:e},appDispatch:t}=(0,a.useContext)($s),[s,i]=(0,a.useState)(""),[r,c]=(0,a.useState)(!1),{saveCustomUserPageStyles:l}=fo();return(0,a.useEffect)((()=>{i(e)}),[e]),(0,n.jsxs)(go,{title:(0,o.__)("Custom style","quicktasker"),description:(0,o.__)("Add custom CSS rules for QuickTasker user page.","quicktasker"),children:[(0,n.jsx)(Ys,{value:s,onChange:i}),(0,n.jsx)(Es,{text:(0,o.__)("Save","quicktasker"),loading:r,onClick:()=>{return e=void 0,a=void 0,i=function*(){c(!0),yield l(s,(e=>{t({type:ke,payload:e})})),c(!1)},new((n=void 0)||(n=Promise))((function(t,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(e,a||[])).next())}));var e,a,n,i},icon:(0,n.jsx)(vo.RZ0,{className:"wpqt-icon-blue wpqt-size-4"})})]})},ko=(e,t)=>{var s,a;switch(t.type){case We:{const s=t.payload.automations;return Object.assign(Object.assign({},e),{automations:s})}case Qe:{const s=t.payload;return Object.assign(Object.assign({},e),{loading:s})}case Ye:{const n=t.payload,i=null!==(a=null===(s=e.automations)||void 0===s?void 0:s.filter((e=>e.id!==n)))&&void 0!==a?a:null;return Object.assign(Object.assign({},e),{automations:i})}case Xe:{const s=t.payload,a=e.automations?[...e.automations,s]:[s];return Object.assign(Object.assign({},e),{automations:a})}default:return e}};const jo={automations:null,loading:!0},yo=(0,a.createContext)({state:jo,pipelineAutomationsDispatch:()=>{}}),bo=({children:e,pipelineId:t})=>{const[s,o]=(0,a.useReducer)(ko,jo),r=()=>{return e=void 0,s=void 0,n=function*(){try{o({type:Qe,payload:!0});const e=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e}/automations`,method:"GET",headers:p()})}(t);o({type:We,payload:{automations:e.data.automations}})}catch(e){console.error(e),i.oR.error("Failed to load board automations")}finally{o({type:Qe,payload:!1})}},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n};return(0,a.useEffect)((()=>{r()}),[]),(0,n.jsx)(yo.Provider,{value:{state:s,pipelineAutomationsDispatch:o},children:e})};var To=s(8046),So=s(1226),Eo=s(6973);const Ao={automationTarget:null,automationTrigger:null,automationAction:null,automationActionTargetId:null,automationActionTargetType:null,metaData:null};function Co(e,t){switch(t.type){case"SET_TARGET":return Object.assign(Object.assign({},e),{automationTarget:t.payload,automationTrigger:null,automationAction:null});case"SET_TRIGGER":return Object.assign(Object.assign({},e),{automationTrigger:t.payload,automationAction:null});case"SET_ACTION":return Object.assign(Object.assign({},e),{automationAction:t.payload});case"RESET":return Ao;case Ze:return Object.assign(Object.assign({},e),{automationActionTargetId:t.payload.automationActionTargetId,automationActionTargetType:t.payload.automationActionTargetType});case Je:return Object.assign(Object.assign({},e),{metaData:t.payload});case et:return Ao;case tt:return Object.assign(Object.assign({},Ao),{automationTarget:e.automationTarget});case st:return Object.assign(Object.assign({},Ao),{automationTarget:e.automationTarget,automationTrigger:e.automationTrigger});default:return e}}const No={[ct.ARCHIVE_TASK]:(0,o.__)("Archive task","quicktasker"),[ct.ASSIGN_USER]:(0,o.__)("Assign user","quickkasker"),[ct.NEW_ENTITY_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[ct.DELETED_ENTITY_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[ct.TASK_ASSIGNED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[ct.TASK_UNASSIGNED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[ct.TASK_PUBLIC_COMMENT_ADDED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[ct.TASK_PRIVATE_COMMENT_ADDED_EMAIL]:(0,o.__)("Send email notification","quicktasker")},Oo={[ot.Task]:(0,o.__)("Task","quicktasker"),[ot.Stage]:(0,o.__)("Stage","quicktasker"),[ot.PIPELINE]:(0,o.__)("Board","quicktasker"),[ot.quicktasker]:"Quicktasker"},Io={[it.TASK_DONE]:(0,o.__)("Task marked as done","quicktasker"),[it.Task_NOT_DONE]:(0,o.__)("Task marked as not done","quicktasker"),[it.TASK_CREATED]:(0,o.__)("Task created","quicktasker"),[it.TASK_DELETED]:(0,o.__)("Task deleted","quicktasker"),[it.TASK_ASSIGNED]:(0,o.__)("Task assigned","quicktasker"),[it.TASK_UNASSIGNED]:(0,o.__)("Task unassigned","quicktasker"),[it.TASK_PUBLIC_COMMENT_ADDED]:(0,o.__)("Public comment added","quicktasker"),[it.TASK_PRIVATE_COMMENT_ADDED]:(0,o.__)("Private comment added","quicktasker")},Po={[it.TASK_DONE]:[{id:ct.ARCHIVE_TASK}],[it.Task_NOT_DONE]:[{id:ct.ARCHIVE_TASK}],[it.TASK_CREATED]:[{id:ct.ASSIGN_USER,requireAutomationTarget:!0,requireAutomationTargetType:!0},{id:ct.NEW_ENTITY_EMAIL,requireMetaData:!0}],[it.TASK_DELETED]:[{id:ct.DELETED_ENTITY_EMAIL,requireMetaData:!0}],[it.TASK_ASSIGNED]:[{id:ct.TASK_ASSIGNED_EMAIL,requireMetaData:!0}],[it.TASK_UNASSIGNED]:[{id:ct.TASK_UNASSIGNED_EMAIL,requireMetaData:!0}],[it.TASK_PUBLIC_COMMENT_ADDED]:[{id:ct.TASK_PUBLIC_COMMENT_ADDED_EMAIL,requireMetaData:!0}],[it.TASK_PRIVATE_COMMENT_ADDED]:[{id:ct.TASK_PRIVATE_COMMENT_ADDED_EMAIL,requireMetaData:!0}]},Do={[ot.Task]:Po};function Ro({actionTargetId:e,actionTargetType:t}){if(null===e||null===t)return null;const{getUser:s}=ji();if(t===rt.QUICKTASKER||t===rt.WP_USER||null!==e){const a=pt(t);if(a){const t=s(e,a);return(0,n.jsx)("div",{className:"wpqt-text-center",children:(null==t?void 0:t.name)||(0,o.__)("User not found","quicktasker")})}}return null}var Lo=s(7613);function Uo({value:e,label:t,onClick:s=()=>{},className:a=""}){return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-font-semibold wpqt-rounded-xl wpqt-px-4 wpqt-py-2 wpqt-border wpqt-border-solid wpqt-cursor-pointer wpqt-border-qtBorder ${a}`,onClick:()=>{s(e)},children:t})}function Mo({children:e,title:t}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-base wpqt-mb-4 wpqt-text-center",children:t}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center wpqt-gap-3",children:e})]})}function Fo({automationDispatch:e,automation:t}){if(!t.automationTarget||!t.automationTrigger)return null;const s=t.automationTarget,a=t.automationTrigger,i=Do[s][a];return(0,n.jsx)(Mo,{title:(0,o.__)("Step 3. Select action","quicktasker"),children:i.map((t=>(0,n.jsx)(Uo,{value:t.id,label:No[t.id],onClick:()=>{e({type:"SET_ACTION",payload:t})}},t.id)))})}function zo({quickTaskerUsers:e,wpUsers:t,assignUser:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-w-[320px] wpqt-flex-col",children:[(0,n.jsx)(La,{sectionTitle:(0,o.__)("Assign a quicktasker","quicktasker"),users:e,onItemSelect:s,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No quicktaskers available to assign","quicktasker")}),(0,n.jsx)(La,{sectionTitle:(0,o.__)("Assign a WordPress user","quicktasker"),users:t,onItemSelect:s,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No WordPress users with required permissions available to assign","quicktasker")})]})}function $o({automationAction:e,onUserAdd:t=()=>{},quickTaskerUserTargets:s=[],wpUserTargets:a=[],menuBtnClasses:i=""}){const o=[...s,...a].length>0;return(0,n.jsx)(Oa,{menuBtnClasses:`wpqt-inline-flex ${i}`,anchor:"bottom start",menuBtn:()=>(0,n.jsx)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1",children:(0,n.jsx)(Ca.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`})}),children:e===ct.ASSIGN_USER&&(0,n.jsx)(zo,{quickTaskerUsers:s,wpUsers:a,assignUser:t})})}const Ko=[ct.ASSIGN_USER];function Vo({automationDispatch:e,automation:t}){var s;const{state:{users:i,wpUsers:r}}=(0,a.useContext)(ws),c=null===(s=t.automationAction)||void 0===s?void 0:s.id,l=void 0!==c&&Ko.includes(c);return(0,n.jsx)(Mo,{title:(0,o.__)("Step 4. Select action target","quicktasker"),children:l&&(0,n.jsx)($o,{automationAction:c,quickTaskerUserTargets:i,wpUserTargets:r,onUserAdd:t=>{e({type:Ze,payload:{automationActionTargetId:t.id,automationActionTargetType:t.user_type}})}})})}const Go=s(4476).z.string().email({message:"Invalid email address"});function Bo({setAutomationMeta:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(e=>{try{Go.parse(e),r(!0)}catch(e){r(!1)}})(t)}),[t]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-justify-center wpqt-items-center",children:[(0,n.jsx)(an,{type:"info",children:(0,o.__)("Make sure your website is configured to send out emails","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("label",{htmlFor:"automation-meta-email-input",children:(0,o.__)("Email will be sent to","quicktasker")}),(0,n.jsx)(Hs,{inputId:"automation-meta-email-input",value:t,onChange:s,wrapperClassName:"!wpqt-mb-0"}),!i&&(0,n.jsx)("div",{className:"wpqt-text-red-500",children:(0,o.__)("Invalid email address","quicktasker")})]}),(0,n.jsx)(Ss,{btnText:(0,o.__)("Set email","quicktasker"),onClick:()=>{i&&e(t)}})]})}function Ho({automationCreationState:e,automationDispatch:t}){var s;const a=null===(s=null==e?void 0:e.automationAction)||void 0===s?void 0:s.id;return a===ct.NEW_ENTITY_EMAIL||a===ct.DELETED_ENTITY_EMAIL||a===ct.TASK_ASSIGNED_EMAIL||a===ct.TASK_UNASSIGNED_EMAIL||a===ct.TASK_PUBLIC_COMMENT_ADDED_EMAIL||a===ct.TASK_PRIVATE_COMMENT_ADDED_EMAIL?(0,n.jsx)(Bo,{setAutomationMeta:e=>{t({type:Je,payload:e})}}):null}function Wo({automationDispatch:e}){const t=Object.keys(Do).map((e=>({value:e,label:Oo[e]||e})));return(0,n.jsx)(Mo,{title:(0,o.__)("Step 1. Select a target","quicktasker"),children:t.map((({value:t,label:s})=>(0,n.jsx)(Uo,{value:t,label:s,onClick:()=>{e({type:"SET_TARGET",payload:t})}},t)))})}function Qo({automationDispatch:e,automation:t}){if(!t.automationTarget)return null;const s=t.automationTarget,a=Object.keys(Do[s]).map((e=>({value:e,label:Io[e]||e})));return(0,n.jsx)(Mo,{title:(0,o.__)("Step 2. Select a trigger","quicktasker"),children:a.map((({value:t,label:s})=>(0,n.jsx)(Uo,{value:t,label:s,onClick:()=>{e({type:"SET_TRIGGER",payload:t})}},t)))})}var Yo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Xo({automation:e,automationDispatch:t,createAutomation:s}){const[i,r]=(0,a.useState)(!1);return null===e.automationTarget?(0,n.jsx)(Wo,{automationDispatch:t}):null===e.automationTrigger?(0,n.jsx)(Qo,{automationDispatch:t,automation:e}):null===e.automationAction?(0,n.jsx)(Fo,{automationDispatch:t,automation:e}):e.automationAction&&e.automationAction.requireAutomationTarget&&e.automationAction.requireAutomationTargetType&&(null===e.automationActionTargetType||null===e.automationActionTargetId)?(0,n.jsx)(Vo,{automationDispatch:t,automation:e}):e.automationAction.requireMetaData&&!e.metaData?(0,n.jsx)(Ho,{automationCreationState:e,automationDispatch:t}):(0,n.jsx)(Es,{text:(0,o.__)("Create automation","quicktasker"),icon:(0,n.jsx)(Lo.ltU,{className:"wpqt-size-6"}),onClick:()=>Yo(this,void 0,void 0,(function*(){r(!0),yield s(),r(!1)})),loading:i})}var Jo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Zo({pipelineId:e}){const{pipelineAutomationsDispatch:t}=(0,a.useContext)(yo),[s,i]=(0,a.useState)(!1),[r,c]=(0,a.useReducer)(Co,Ao),{createAutomation:l}=ss(),d=null!==r.automationActionTargetId&&null!==r.automationActionTargetType,u=null!==r.metaData,p="wpqt-px-3 wpqt-min-w-[60px] wpqt-cursor-pointer",w="wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1",h=()=>{c({type:"RESET"})};return s?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-3 wpqt-p-4 wpqt-justify-center wpqt-items-center",children:[(0,n.jsx)(Sn,{title:(0,o.__)("Target","quicktasker"),className:p,titleClassName:w,onClick:()=>{c({type:et})},children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:r.automationTarget?Oo[r.automationTarget]:(0,n.jsx)(er,{})})}),(0,n.jsx)(To.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(Sn,{title:(0,o.__)("Trigger","quicktasker"),className:p,titleClassName:w,onClick:()=>{c({type:tt})},children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:r.automationTrigger?Io[r.automationTrigger]:(0,n.jsx)(er,{})})}),(0,n.jsx)(To.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(Sn,{title:(0,o.__)("Action","quicktasker"),className:p,titleClassName:w,onClick:()=>{c({type:st})},children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center wpqt-items-center",children:[r.automationAction?No[r.automationAction.id]:(0,n.jsx)(er,{}),d&&(0,n.jsx)(Ro,{actionTargetId:r.automationActionTargetId,actionTargetType:r.automationActionTargetType}),u&&(0,n.jsx)("div",{children:r.metaData})]})})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Xo,{automation:r,automationDispatch:c,createAutomation:()=>Jo(this,void 0,void 0,(function*(){yield l(e,r,((e,s)=>{e&&s&&(h(),t({type:Xe,payload:s}))}))}))})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Es,{icon:(0,n.jsx)(Eo.QK_,{className:"wpqt-size-5"}),text:(0,o.__)("Close automation creator","quicktasker"),onClick:()=>{i(!1),h()}})})]}):(0,n.jsx)("div",{children:(0,n.jsx)(Es,{icon:(0,n.jsx)(Eo.QK_,{className:"wpqt-size-5"}),text:(0,o.__)("Create a new automation","quicktasker"),onClick:()=>i(!0)})})}function er(){return(0,n.jsx)(So.A,{className:"wpqt-size-7 wpqt-text-gray-300"})}var tr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function sr({automation:e}){const{pipelineAutomationsDispatch:t}=(0,a.useContext)(yo),{deleteAutomation:s}=ss(),[i,r]=(0,a.useState)(!1),c="wpqt-px-3 wpqt-pt-1 wpqt-min-w-[60px] wpqt-cursor-default",l="wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1",d=null!==e.automation_action_target_id&&null!==e.automation_action_target_type,u=null!==e.metadata;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-3 wpqt-p-4 wpqt-items-center",children:[(0,n.jsx)(Sn,{title:(0,o.__)("Target","quicktasker"),className:c,titleClassName:l,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:Oo[e.target_type]})}),(0,n.jsx)(To.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(Sn,{title:(0,o.__)("Trigger","quicktasker"),className:c,titleClassName:l,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:Io[e.automation_trigger]})}),(0,n.jsx)(To.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(Sn,{title:(0,o.__)("Action","quicktasker"),className:c,titleClassName:l,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center wpqt-items-center",children:[No[e.automation_action],d&&(0,n.jsx)(Ro,{actionTargetId:e.automation_action_target_id,actionTargetType:e.automation_action_target_type}),u&&(0,n.jsx)("div",{children:e.metadata})]})}),(0,n.jsx)(Sn,{title:(0,o.__)("Controls","quicktasker"),className:`${c} wpqt-ml-6`,titleClassName:l,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-2",children:(0,n.jsx)(Es,{loading:i,text:(0,o.__)("Delete","quicktasker"),icon:(0,n.jsx)(Ls.A,{className:"wpqt-icon-red wpqt-size-5"}),onClick:()=>tr(this,void 0,void 0,(function*(){r(!0),yield s(e.pipeline_id,e.id,(s=>{s&&t({type:Ye,payload:e.id})})),r(!1)}))})})})]})}function ar(){const{state:{automations:e,loading:t}}=(0,a.useContext)(yo),[s,i]=(0,a.useState)(!1);return t?(0,n.jsx)(Dt,{ovalSize:"24"}):e&&0!==e.length?s?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(an,{type:"info",className:"wpqt-mx-auto wpqt-mb-2",children:(0,o.__)("Note that automation won't trigger other automations","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3 wpqt-mb-3",children:e.map((e=>(0,n.jsx)(sr,{automation:e},e.id)))}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Es,{icon:(0,n.jsx)(Eo.QK_,{className:"wpqt-size-5"}),text:(0,o.__)("Hide board automations","quicktasker"),onClick:()=>i(!1)})})]}):(0,n.jsx)("div",{children:(0,n.jsx)(Es,{icon:(0,n.jsx)(Eo.QK_,{className:"wpqt-size-5"}),text:(0,o.__)("Show board automations","quicktasker"),onClick:()=>i(!0)})}):(0,n.jsx)(an,{type:"info",children:(0,o.__)("No automations created for this board","quicktasker")})}function nr({children:e}){return(0,n.jsx)(go,{title:(0,o.__)("Board automations","quicktasker"),description:(0,o.__)("Allows to automate various tasks","quicktasker"),children:e})}function ir({pipelineId:e}){return at?(0,n.jsx)(bo,{pipelineId:e,children:(0,n.jsxs)(nr,{children:[(0,n.jsx)("div",{className:"wpqt-mb-4",children:(0,n.jsx)(ar,{})}),(0,n.jsx)("div",{children:(0,n.jsx)(Zo,{pipelineId:e})})]})}):(0,n.jsx)(aa,{title:(0,o.__)("Board automations","quicktasker"),description:(0,o.__)("Premium feature to automate various tasks.","quicktasker")})}var or=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function rr({allow_only_last_stage_task_done:e,pipelineId:t}){const[s,i]=(0,a.useState)(e),[r,c]=(0,a.useState)(!1),{saveTaskCompletionDoneSetting:l}=fo();return(0,n.jsx)(go,{title:(0,o.__)("Restrict Task Completion","quicktasker"),description:(0,o.__)("Allow to mark task as done only on board last stage. By default, task can be marked as done on any stage. Will apply also to QuickTasker page","quicktasker"),children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(Js,{checked:s,handleChange:e=>or(this,void 0,void 0,(function*(){i(e),c(!0),yield l(t,e,(e=>{i(e)})),c(!1)}))}),r&&(0,n.jsx)(It,{width:"20",height:"20"})]})})}var cr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function lr({pipeline:e}){const[t,s]=(0,a.useState)(!0),[i,o]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(()=>{cr(this,void 0,void 0,(function*(){try{s(!0);const a=yield(t=e.id,u()({path:`/wpqt/v1/pipelines/${t}/settings`,method:"GET",headers:p()}));o(Ut(a.data.settings))}catch(e){console.error(e)}finally{s(!1)}var t}))})()}),[]),t?(0,n.jsx)(Dt,{}):i?(0,n.jsxs)("div",{children:[(0,n.jsx)(rr,{pipelineId:e.id,allow_only_last_stage_task_done:i.allow_only_last_stage_task_done}),(0,n.jsx)(ir,{pipelineId:e.id})]}):null}function dr(){const{state:{pipelines:e}}=(0,a.useContext)($t),t=e.map((e=>e.name)),s=e.map((e=>(0,n.jsx)(lr,{pipeline:e},e.id)));return(0,n.jsx)("div",{children:(0,n.jsx)($a,{tabs:t,tabsContent:s,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})})}const ur=()=>(0,n.jsxs)(Rt,{children:[(0,n.jsx)(l,{description:(0,o.__)("Manage settings, preferences, and configurations.","quicktasker"),children:(0,o.__)("Settings","quicktasker")}),(0,n.jsx)(_o,{}),(0,n.jsx)(dr,{})]});var pr=s(1548),wr=s(1266),hr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function qr(){return{createUser:(e,t,s)=>hr(this,void 0,void 0,(function*(){try{const r=yield(a=e,n=t,u()({path:"/wpqt/v1/users",method:"POST",data:{name:a,description:n},headers:p()}));s&&s(r.data),i.oR.success((0,o.__)("User created successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("User creation failed. Please try again","quicktasker"))}var a,n})),editUser:(e,t)=>hr(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/users/${e.id}`,method:"PATCH",data:{user:e},headers:p()})}(e);t&&t(s.data),i.oR.success((0,o.__)("User edited successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("User edit failed. Please try again","quicktasker"))}})),changeUserStatus:(e,t,s)=>hr(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return u()({path:`/wpqt/v1/users/${e}/status`,method:"PATCH",data:{status:t},headers:p()})}(e,t);s&&s(a.data),i.oR.success((0,o.__)("User status changed successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change user status. Please try again","quicktasker"))}})),deleteUser:(e,t)=>hr(this,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/users/${e}`,method:"DELETE",headers:p()})}(e),t&&t(e),i.oR.success((0,o.__)("User deleted successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete user. Please try again","quicktasker"))}})),resetUserPassword:(e,t)=>hr(this,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/users/${e}/password-reset`,method:"PATCH",headers:p()})}(e),t&&t(e),i.oR.success((0,o.__)("User password reset successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to reset user password. Please try again","quicktasker"))}}))}}var mr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function vr({data:e,changeStatus:t,changeSetUpStatus:s,changePasswordStatus:i}){const{changeUserStatus:r,deleteUser:c,resetUserPassword:l}=qr(),{userDispatch:d}=(0,a.useContext)(ws),{loading1:u,setLoading1:p,loading2:w,setLoading2:h,loading3:q,setLoading3:m}=Ms(),v=e.is_active,x=e.has_password;return(0,n.jsxs)("div",{className:"wpqt-mt-5 wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(Es,{icon:(0,n.jsx)(io.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("User tasks","quicktasker"),onClick:()=>{window.location.hash=`#/users/${e.id}/tasks`}}),!v&&(0,n.jsx)(Es,{icon:(0,n.jsx)(pr.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Activate user","quicktasker"),loading:w,onClick:()=>mr(this,void 0,void 0,(function*(){h(!0),yield r(e.id,!0,(e=>{d({type:ve,payload:Object.assign({},e)}),t(!0)})),h(!1)}))}),v&&(0,n.jsx)(Es,{icon:(0,n.jsx)(pr.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Disable user","quicktasker"),loading:w,onClick:()=>mr(this,void 0,void 0,(function*(){h(!0),yield r(e.id,!1,(e=>{d({type:ve,payload:Object.assign({},e)}),t(!1)})),h(!1)}))}),x&&(0,n.jsx)(Es,{icon:(0,n.jsx)(wr.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:u,text:(0,o.__)("Reset password","quicktasker"),onClick:()=>mr(this,void 0,void 0,(function*(){p(!0),yield l(e.id,(()=>{s(!1),i(!1)})),p(!1)}))}),(0,n.jsx)(Es,{icon:(0,n.jsx)(Ls.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:q,text:(0,o.__)("Delete user","quicktasker"),onClick:()=>mr(this,void 0,void 0,(function*(){m(!0),yield c(e.id,(e=>{d({type:xe,payload:e}),window.location.hash="#/users"})),m(!1)}))})]})}var xr=s(8624),fr=s(3997),gr=s(5028);function _r(){const{state:{siteURL:e,publicUserPageId:t}}=(0,a.useContext)($s);return{userPage:e+`/wpqt?page=${t}&page_id=wpqt`}}function kr({data:e}){const{userPage:t}=_r(),{convertToWPTimezone:s}=Xa(),a=e.is_active,i=t+"&code="+e.page_hash;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)(jr,{label:(0,o.__)("Name","quicktasker"),value:e.name,icon:(0,n.jsx)(xr.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(jr,{label:(0,o.__)("Created at","quicktasker"),value:s(e.created_at),icon:(0,n.jsx)(fr.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(jr,{label:(0,o.__)("Assigned tasks count","quicktasker"),value:e.assigned_tasks_count,icon:(0,n.jsx)(io.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(jr,{label:(0,o.__)("Setup completed","quicktasker"),value:e.setup_completed?(0,o.__)("Yes","quicktasker"):(0,o.__)("No","quicktasker"),icon:(0,n.jsx)(gr.A,{className:"wpqt-size-5 wpqt-text-yellow-600"})}),(0,n.jsx)(jr,{label:(0,o.__)("Is active","quicktasker"),value:a?(0,o.__)("Yes","quicktasker"):(0,o.__)("No","quicktasker"),icon:(0,n.jsx)(pr.A,{className:"wpqt-size-5 "+(a?"wpqt-icon-green":"wpqt-icon-red")})}),(0,n.jsx)(jr,{label:(0,o.__)("User Page","quicktasker"),value:(0,n.jsx)("a",{href:i,rel:"noreferrer",target:"_blank",children:i}),icon:(0,n.jsx)(da.A,{className:"wpqt-size-5 wpqt-icon-blue"})})]})}function jr({label:e,value:t,icon:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[s,(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[e,": "]}),(0,n.jsx)("span",{children:t})]})}var yr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function br({userId:e}){const{loadingDispatch:t}=(0,a.useContext)(kt),[s,r]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(()=>{yr(this,void 0,void 0,(function*(){try{t({type:je,payload:!0});const a=yield function(e){return u()({path:`/wpqt/v1/users/${e}/extended`,method:"GET",headers:p()})}(e);r((s=a.data,Object.assign(Object.assign({},s),{is_active:"1"===s.is_active})))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to get user data. Please try again","quicktasker"))}finally{t({type:je,payload:!1})}var s}))})()}),[]),(0,n.jsx)(Rt,{children:s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{description:(0,o.__)("User details","quicktasker"),children:s.name}),(0,n.jsx)(kr,{data:s}),(0,n.jsx)(vr,{data:s,changeStatus:e=>yr(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{is_active:e}):t))})),changeSetUpStatus:e=>yr(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{setup_completed:e}):t))})),changePasswordStatus:e=>yr(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{has_password:e}):t))}))})]})})}const Tr=e=>Object.assign(Object.assign({},e),{is_active:"1"===e.is_active}),Sr=(e,t)=>{var s;switch(t.type){case ye:return Object.assign(Object.assign({},e),{sessionsSearchValue:null!==(s=t.payload)&&void 0!==s?s:""});case be:{const s=t.payload.map(Tr);return Object.assign(Object.assign({},e),{userSessions:s})}case Te:{const{sessionId:s,status:a}=t.payload;return Object.assign(Object.assign({},e),{userSessions:e.userSessions.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_active:a}):e))})}case Se:{const s=t.payload;return Object.assign(Object.assign({},e),{userSessions:e.userSessions.filter((e=>e.id!==s))})}default:return e}};var Er=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Ar={loading:!0,sessionsSearchValue:"",userSessions:[]},Cr=(0,a.createContext)({state:Ar,usersSessionDispatch:()=>{},loadUserSessions:()=>Er(void 0,void 0,void 0,(function*(){}))}),Nr=({children:e})=>{const[t,s]=(0,a.useReducer)(Sr,Ar),{loadingDispatch:r}=(0,a.useContext)(kt);(0,a.useEffect)((()=>{c()}),[]);const c=()=>Er(void 0,void 0,void 0,(function*(){try{r({type:je,payload:!0});const e=yield u()({path:"/wpqt/v1/users/sessions",method:"GET",headers:p()});s({type:be,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch user sessions","quicktasker"))}finally{r({type:je,payload:!1})}}));return(0,n.jsx)(Cr.Provider,{value:{state:t,usersSessionDispatch:s,loadUserSessions:c},children:e})};function Or(){const{state:{sessionsSearchValue:e},usersSessionDispatch:t}=(0,a.useContext)(Cr);return(0,n.jsx)(Ht,{title:(0,o.__)("Session filtering","quicktasker"),children:(0,n.jsx)(Hs,{value:e,onChange:e=>{t({type:ye,payload:e})}})})}const Ir=()=>{const{state:{sessionsSearchValue:e}}=(0,a.useContext)(Cr);return{filterSessions:t=>t.user_name.toLowerCase().includes(e.toLowerCase())||t.user_description&&t.user_description.toLowerCase().includes(e.toLowerCase())}};var Pr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Dr({session:e}){const{usersSessionDispatch:t}=(0,a.useContext)(Cr),{state:{isUserAllowedToDelete:s}}=(0,a.useContext)($s),{convertToWPTimezone:r}=Xa(),c=e.is_active,l=s=>Pr(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/users/sessions/${e}/status`,method:"PATCH",data:{status:t},headers:p()})}(e.id,s),t({type:Te,payload:{sessionId:e.id,status:s}})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change session status","quicktasker"))}}));return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:e.user_name}),(0,n.jsx)("div",{className:"wpqt-italic",children:e.user_description})]}),(0,n.jsx)("div",{children:r(e.created_at_utc)}),(0,n.jsx)("div",{children:r(e.expires_at_utc)}),(0,n.jsx)("div",{className:c?"wpqt-text-qtTextGreen":"wpqt-text-qtTextRed",children:c?(0,o.__)("On","quicktasker"):(0,o.__)("Off","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-4",children:[c?(0,n.jsx)(pr.A,{className:"wpqt-icon-red wpqt-size-5 wpqt-cursor-pointer",onClick:()=>l(!1),title:(0,o.__)("Turn session off","quicktasker")}):(0,n.jsx)(pr.A,{className:"wpqt-icon-green wpqt-size-5 wpqt-cursor-pointer",onClick:()=>l(!0),title:(0,o.__)("Turn session on","quicktasker")}),s&&(0,n.jsx)(Ls.A,{className:"wpqt-icon-red wpqt-size-5 wpqt-cursor-pointer",title:(0,o.__)("Delete session","quicktasker"),onClick:()=>Pr(this,void 0,void 0,(function*(){try{yield(s=e.id,u()({path:`/wpqt/v1/users/sessions/${s}`,method:"DELETE",headers:p()})),t({type:Se,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete session","quicktasker"))}var s}))})]})]})}function Rr(){const{state:{userSessions:e}}=(0,a.useContext)(Cr),{filterSessions:t}=Ir(),s=e.filter(t);return 0===s.length?(0,n.jsx)(yn,{text:(0,o.__)("No sessions found","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-grid wpqt-grid-cols-5 wpqt-font-bold",children:[(0,n.jsx)("div",{children:(0,o.__)("Session owner","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Created at","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Expires at","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Status","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Actions","quicktasker")})]}),(0,n.jsx)("div",{className:"wpqt-grid wpqt-grid-cols-5 wpqt-items-center wpqt-gap-y-4",children:s.map((e=>(0,n.jsx)(Dr,{session:e},e.id)))})]})}function Lr(){return(0,n.jsx)(Nr,{children:(0,n.jsxs)(Rt,{children:[(0,n.jsx)(l,{children:(0,o.__)("Quicktasker sessions","quicktasker")}),(0,n.jsx)(Or,{}),(0,n.jsx)(Rr,{})]})})}function Ur(){const{state:{usersSearchValue:e},userDispatch:t}=(0,a.useContext)(ws);return(0,n.jsx)(Ht,{title:(0,o.__)("User filtering","quicktasker"),children:(0,n.jsx)(Lt.p,{type:"text",value:e,onChange:e=>{t({type:me,payload:e.target.value})}})})}var Mr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Fr({userId:e}){return(0,n.jsx)(on,{typeId:e,fetchData:()=>Mr(this,void 0,void 0,(function*(){try{return(yield m(e,mt.User)).data}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load log","quicktasker"))}})),renderItem:e=>(0,n.jsx)(Za,{log:e}),noDataMessage:(0,o.__)("No logs available","quicktasker"),explanation:(0,o.__)("Logs can be seen only by WordPress users (with required permissions)","quicktasker")})}var zr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function $r({userId:e}){return(0,n.jsx)(on,{typeId:e,fetchData:()=>zr(this,void 0,void 0,(function*(){try{return(yield h(e,mt.User,!0)).data.map(wn)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load private comments","quicktasker"))}})),onAdd:t=>zr(this,void 0,void 0,(function*(){try{const s=yield q(e,mt.User,!0,t);return wn(s.data.newComment)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add private comment","quicktasker"))}})),renderItem:e=>(0,n.jsx)(cn,{item:e}),noDataMessage:(0,o.__)("No comments available","quicktasker"),explanation:(0,o.__)("Comments that can be added and viewed only by WordPress users (with required permissions).","quicktasker"),enableAdd:!0})}var Kr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Vr({userId:e}){const{addComment:t}=pn();return(0,n.jsx)(on,{typeId:e,fetchData:()=>Kr(this,void 0,void 0,(function*(){try{return(yield h(e,mt.User,!1)).data.map(wn)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load comments","quicktasker"))}})),onAdd:s=>Kr(this,void 0,void 0,(function*(){const a=yield t(e,mt.User,!1,s);if(a)return wn(a)})),renderItem:e=>(0,n.jsx)(cn,{item:e}),noDataMessage:(0,o.__)("No comments available","quicktasker"),explanation:(0,o.__)("Comments that can be added and viewed by WordPress users (with required permissions) and current QuickTasker user (in user page).","quicktasker"),enableAdd:!0})}function Gr({user:e}){const t=[(0,o.__)("Private comments","quicktasker"),(0,o.__)("Public comments","quicktasker"),(0,o.__)("Logs","quicktasker")];return(0,n.jsx)($a,{tabs:t,tabsContent:[(0,n.jsx)($r,{userId:e.id},1),(0,n.jsx)(Vr,{userId:e.id},2),(0,n.jsx)(Fr,{userId:e.id},3)]})}var Br=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Hr=(0,a.forwardRef)((function({modalSaving:e,editUser:t},s){const{state:{userToEdit:i},modalDispatch:r}=(0,a.useContext)(cs),{state:{isUserAllowedToDelete:c}}=(0,a.useContext)($s),[l,d]=(0,a.useState)(""),[u,p]=(0,a.useState)(""),[w,h]=(0,a.useState)(!1),[q,m]=(0,a.useState)(!1),{changeUserStatus:v,deleteUser:x,resetUserPassword:f}=qr(),{userDispatch:g}=(0,a.useContext)(ws),{loading1:_,setLoading1:k,loading2:j,setLoading2:y,loading3:b,setLoading3:T}=Ms();(0,a.useEffect)((()=>{i&&(d(i.name),p(i.description),h(i.is_active),m(i.has_password))}),[i]);const S=()=>{d(""),p("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:S}))),i?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsxs)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:[(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-3 md:wpqt-grid-cols-[auto_1fr]",children:[(0,n.jsx)("div",{children:(0,n.jsxs)(Os,{children:[(0,n.jsx)(Is,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(Hs,{isAutoFocus:!0,value:l,onChange:e=>d(e)})}),(0,n.jsx)(Is,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Ys,{rowsCount:3,value:u,onChange:e=>p(e)})})]})}),(0,n.jsx)(Aa,{entityId:i.id,entityType:Gs.User})]}),(0,n.jsx)(Ps,{onSave:()=>{i&&t(Object.assign(Object.assign({},i),{name:l,description:u}))},saveBtnText:e?(0,o.__)("Saving...","quicktasker"):(0,o.__)("Save","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mt-7",children:(0,n.jsx)(Gr,{user:i})})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)(Es,{icon:(0,n.jsx)(xr.A,{className:"wpqt-icon-blue wpqt-size-4"}),text:(0,o.__)("User details","quicktasker"),onClick:()=>{window.location.hash=`#/users/${i.id}`,r({type:X})}}),(0,n.jsx)(Es,{icon:(0,n.jsx)(io.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("User tasks","quicktasker"),onClick:()=>{window.location.hash=`#/users/${i.id}/tasks`,r({type:X})}}),q&&(0,n.jsx)(Es,{icon:(0,n.jsx)(wr.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Reset password","quicktasker"),loading:_,onClick:()=>Br(this,void 0,void 0,(function*(){k(!0),yield f(i.id,(()=>{g({type:ge,payload:i.id}),m(!1)})),k(!1)}))}),!w&&(0,n.jsx)(Es,{icon:(0,n.jsx)(pr.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Activate user","quicktasker"),loading:j,onClick:()=>Br(this,void 0,void 0,(function*(){y(!0),yield v(i.id,!0,(e=>{g({type:ve,payload:Object.assign({},e)}),h(!0)})),y(!1)}))}),w&&(0,n.jsx)(Es,{icon:(0,n.jsx)(pr.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Disable user","quicktasker"),loading:j,onClick:()=>Br(this,void 0,void 0,(function*(){y(!0),yield v(i.id,!1,(e=>{g({type:ve,payload:Object.assign({},e)}),h(!1)})),y(!1)}))}),c&&(0,n.jsx)(Es,{icon:(0,n.jsx)(Ls.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Delete user","quicktasker"),loading:b,onClick:()=>Br(this,void 0,void 0,(function*(){T(!0),yield x(i.id,(e=>{g({type:xe,payload:e}),r({type:X})})),T(!1)}))})]})]})}):null}));var Wr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Qr(){const{state:{userModalOpen:e}}=(0,a.useContext)(cs),{modalSaving:t,setModalSaving:s,modalContentRef:i,closeModal:o,handleSuccess:r}=ms(X),{editUser:c}=qr();return(0,n.jsx)(Cs,{modalOpen:e,closeModal:o,size:"xl",children:(0,n.jsx)(Hr,{ref:i,modalSaving:t,editUser:e=>Wr(this,void 0,void 0,(function*(){s(!0),yield c(e,(e=>{r(ve,e,qs.USER)})),s(!1)}))})})}function Yr(){const{state:{userSettingsModalOpen:e},modalDispatch:t}=(0,a.useContext)(cs);return(0,n.jsx)(Cs,{modalOpen:e,closeModal:()=>t({type:te,payload:!1}),size:"lg",children:(0,n.jsx)("div",{children:(0,n.jsx)(Aa,{entityId:"null",entityType:Gs.Users})})})}var Xr=s(8316),Jr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Zr(){const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(""),{userDispatch:d}=(0,a.useContext)(ws),{createUser:u}=qr(),p=()=>{r(""),l(""),t(!1)};return(0,n.jsx)("div",{className:"wpqt-mb-6",children:e?(0,n.jsxs)("div",{className:"wpqt-w-1/4",children:[(0,n.jsx)("label",{className:"wpqt-mb-2 wpqt-block wpqt-font-semibold",children:(0,o.__)("User name","quicktasker")}),(0,n.jsx)(Hs,{value:s,onChange:r,className:"wpqt-w-full"}),(0,n.jsx)("label",{className:"wpqt-mb-2 wpqt-block wpqt-font-semibold",children:(0,o.__)("User description","quicktasker")}),(0,n.jsx)(Ys,{value:c,onChange:l,className:"wpqt-w-full"}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:[(0,n.jsx)(Es,{text:(0,o.__)("Cancel","quicktasker"),onClick:p,icon:(0,n.jsx)(js.A,{className:"wpqt-icon-red wpqt-size-5"})}),(0,n.jsx)(Es,{text:(0,o.__)("Add","quicktasker"),onClick:()=>Jr(this,void 0,void 0,(function*(){s?yield u(s,c,(e=>{d({type:qe,payload:e}),p()})):i.oR.error("User name is required")})),icon:(0,n.jsx)(Xr.A,{className:"wpqt-icon-green wpqt-size-5"})})]})]}):(0,n.jsx)(Es,{text:(0,o.__)("Add QuickTasker","quicktasker"),onClick:()=>t(!0),icon:(0,n.jsx)(Xr.A,{className:"wpqt-icon-green wpqt-size-5"})})})}const ec=()=>{const{state:{usersSearchValue:e}}=(0,a.useContext)(ws);return{filterUsers:t=>t.name.toLowerCase().includes(e.toLowerCase())||t.description&&t.description.toLowerCase().includes(e.toLowerCase())}};var tc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function sc({user:e}){const{modalDispatch:t}=(0,a.useContext)(cs),{userDispatch:s}=(0,a.useContext)(ws),{changeUserStatus:i,deleteUser:r,resetUserPassword:c}=qr(),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1),[w,h]=(0,a.useState)(!1),q=e.is_active,m=t=>tc(this,void 0,void 0,(function*(){h(!0),yield i(e.id,t,(()=>{s({type:fe,payload:{userId:e.id,isActive:t}})})),h(!1)}));return(0,n.jsxs)(Oa,{menuBtn:({active:e})=>(0,n.jsx)(Ia,{isActive:e,IconComponent:Nn.A}),children:[(0,n.jsx)(Pa,{text:(0,o.__)("User details","quicktasker"),icon:(0,n.jsx)(xr.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}`}}),(0,n.jsx)(Pa,{text:(0,o.__)("User tasks","quicktasker"),icon:(0,n.jsx)(io.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}/tasks`}}),(0,n.jsx)(Pa,{text:(0,o.__)("Edit user","quicktasker"),icon:(0,n.jsx)(ua.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:J,payload:e})}}),e.has_password&&(0,n.jsx)(Pa,{text:(0,o.__)("Reset password","quicktasker"),loading:l,icon:(0,n.jsx)(wr.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>tc(this,void 0,void 0,(function*(){t.stopPropagation(),d(!0),yield c(e.id,(()=>{s({type:ge,payload:e.id})})),d(!1)}))}),q&&(0,n.jsx)(Pa,{text:(0,o.__)("Disable user","quicktasker"),loading:w,icon:(0,n.jsx)(pr.A,{className:"wpqt-icon-red wpqt-size-4"}),className:"!wpqt-mb-0",onClick:e=>{e.stopPropagation(),m(!1)}}),!q&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Pa,{text:(0,o.__)("Activate user","quicktasker"),loading:w,icon:(0,n.jsx)(pr.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:e=>{e.stopPropagation(),m(!0)}}),(0,n.jsx)(Pa,{text:(0,o.__)("Delete user","quicktasker"),loading:u,icon:(0,n.jsx)(Ls.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>tc(this,void 0,void 0,(function*(){t.stopPropagation(),p(!0),yield r(e.id,(e=>{s({type:xe,payload:e})})),p(!1)}))})]})]})}function ac({user:e}){const{userPage:t}=_r(),{modalDispatch:s}=(0,a.useContext)(cs),i=e.is_active,r=t+"&code="+e.page_hash;return(0,n.jsxs)(Sn,{title:e.name,description:e.description,dropdown:(0,n.jsx)(sc,{user:e}),onClick:()=>{s({type:J,payload:e})},className:"wpqt-cursor-pointer",children:[(0,n.jsx)(Cn,{className:"hover:wpqt-underline wpqt-self-start",label:(0,o.__)("Open user page","quicktasker"),icon:(0,n.jsx)(da.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:e=>{e.stopPropagation(),window.open(r,"_blank")}}),(0,n.jsx)(Cn,{className:"hover:wpqt-underline wpqt-self-start",label:(0,o.__)("View user details","quicktasker"),icon:(0,n.jsx)(da.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}`}}),(0,n.jsx)(Cn,{label:(0,o.__)("Status","quicktasker"),value:i?(0,o.__)("Active","quicktasker"):(0,o.__)("Disabled","quicktasker"),valueClassName:i?"wpqt-text-qtTextGreen wpqt-font-bold":"wpqt-text-qtTextRed wpqt-font-bold",icon:(0,n.jsx)(pr.A,{className:"wpqt-size-5 "+(i?"wpqt-icon-green":"wpqt-icon-red")})})]})}function nc(){const{state:{users:e}}=(0,a.useContext)(ws),{filterUsers:t}=ec(),s=e.filter(t);return e&&0===e.length?(0,n.jsx)(yn,{text:(0,o.__)("No users found","quicktasker")}):s&&0===s.length?(0,n.jsx)(yn,{}):(0,n.jsx)("div",{className:"wpqt-card-grid",children:s.map((e=>(0,n.jsx)(ac,{user:e},e.id)))})}function ic(){return(0,n.jsxs)("div",{children:[(0,n.jsx)(Zr,{}),(0,n.jsx)(Ur,{}),(0,n.jsx)(nc,{}),(0,n.jsx)(Yr,{}),(0,n.jsx)(Qr,{})]})}var oc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};var rc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function cc({user:e}){const[t,s]=(0,a.useState)({quicktasker_admin_role:"quicktasker_admin_role"in e.allcaps,quicktasker_admin_role_allow_delete:"quicktasker_admin_role_allow_delete"in e.allcaps,quicktasker_admin_role_manage_users:"quicktasker_admin_role_manage_users"in e.allcaps,quicktasker_admin_role_manage_settings:"quicktasker_admin_role_manage_settings"in e.allcaps}),[i,r]=(0,a.useState)(!1),{updateWPUserCapabilities:c}=function(){return{updateWPUserCapabilities:(e,t,s,a)=>oc(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/wp-users/${e}/capabilities`,method:"PATCH",data:{quicktasker_admin_role:t.quicktasker_admin_role,quicktasker_admin_role_allow_delete:t.quicktasker_admin_role_allow_delete,quicktasker_admin_role_manage_users:t.quicktasker_admin_role_manage_users,quicktasker_admin_role_manage_settings:t.quicktasker_admin_role_manage_settings},headers:p()})}(e,t),s&&s()}catch(e){a&&a(e)}}))}}(),l=(a,n)=>rc(this,void 0,void 0,(function*(){if(i)return;r(!0);const o=Object.assign({},t),l=Object.assign(Object.assign({},t),{[n]:a});s(l),yield c(e.id,l,(()=>{}),(()=>{s(o)})),r(!1)}));return(0,n.jsxs)(Sn,{title:e.name,description:e.description,children:[(0,n.jsx)(Cn,{label:(0,o.__)("Role","quicktasker"),value:Array.isArray(e.roles)?e.roles.join(", "):""}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to admin areas","quicktasker")}),(0,n.jsx)(Js,{checked:t.quicktasker_admin_role,handleChange:e=>{l(e,"quicktasker_admin_role")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to users page","quicktasker")}),(0,n.jsx)(Js,{checked:t.quicktasker_admin_role_manage_users,handleChange:e=>{l(e,"quicktasker_admin_role_manage_users")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to settings page","quicktasker")}),(0,n.jsx)(Js,{checked:t.quicktasker_admin_role_manage_settings,handleChange:e=>{l(e,"quicktasker_admin_role_manage_settings")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Allow to delete resources","quicktasker")}),(0,n.jsx)(Js,{checked:t.quicktasker_admin_role_allow_delete,handleChange:e=>{l(e,"quicktasker_admin_role_allow_delete")}})]}),i&&(0,n.jsx)(Dt,{ovalSize:"24"})]})}var lc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function dc(){const[e,t]=(0,a.useState)(null),[s,i]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(()=>{lc(this,void 0,void 0,(function*(){try{i(!0);const s=yield(e=ft.Other,u()({path:`/wpqt/v1/wp-users?type=${encodeURIComponent(e)}`,method:"GET",headers:p()}));t(s.data)}catch(e){console.error(e)}finally{i(!1)}var e}))})()}),[]),s||null===e?(0,n.jsx)(Dt,{ovalSize:"48"}):0===e.length?(0,n.jsx)(yn,{text:(0,o.__)("No non-admin WordPress users found","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Displaying non-admin WordPress users.","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-card-grid",children:e.map((e=>(0,n.jsx)(cc,{user:e},e.id)))})]})}function uc(){const{updateUsers:e}=(0,a.useContext)(ws),{loadingDispatch:t}=(0,a.useContext)(kt),{modalDispatch:s}=(0,a.useContext)(cs),i=[(0,n.jsx)(ic,{},0),(0,n.jsx)(dc,{},1)];return(0,a.useEffect)((()=>{(()=>{var s,a,n,i;s=this,a=void 0,i=function*(){t({type:je,payload:!0}),yield e(),t({type:je,payload:!1})},new((n=void 0)||(n=Promise))((function(e,t){function o(e){try{c(i.next(e))}catch(e){t(e)}}function r(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(s,a||[])).next())}))})()}),[]),(0,n.jsxs)(Rt,{children:[(0,n.jsx)(l,{description:(0,o.__)("Manage QuickTaskers and WordPress users. This plugin supports three types of users: WordPress admins, other WordPress users, and QuickTaskers. WordPress admins have full access to all admin areas. Other WordPress users do not have any access by default but can be granted if needed. QuickTaskers are separate users who do not have admin access but can manage tasks through a mobile-friendly webpage.","quicktasker"),icon:(0,n.jsx)(Ki.A,{className:"wpqt-icon-gray wpqt-size-7 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{s({type:te,payload:!0})}}),children:(0,o.__)("Users","quicktasker")}),(0,n.jsx)($a,{tabs:["QuickTaskers","WordPress users"],tabsContent:i,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})]})}const pc=(e,t)=>{switch(t.type){case Ee:{const s=t.payload.map(ht);return Object.assign(Object.assign({},e),{tasks:s})}case Ce:{const s=t.payload;return Object.assign(Object.assign({},e),{tasks:e.tasks.filter((e=>e.id!==s))})}case Ne:{const s=t.payload,a=e.tasks.map((e=>e.id===s.id?ht(s):e));return Object.assign(Object.assign({},e),{tasks:a})}case Ae:{const s=t.payload;return Object.assign(Object.assign({},e),{searchValue:s})}case Oe:{const s=t.payload;return Object.assign(Object.assign({},e),{filteredPipelineId:s})}case Ie:{const{taskId:s,user:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:lt(a)?[a,...e.assigned_users]:e.assigned_users,assigned_wp_users:dt(a)?[a,...e.assigned_wp_users]:e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{tasks:n})}case Pe:{const{taskId:s,user:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:lt(a)?e.assigned_users.filter((e=>e.id!==a.id)):e.assigned_users,assigned_wp_users:dt(a)?e.assigned_wp_users.filter((e=>e.id!==a.id)):e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{tasks:n})}case De:{const{taskId:s,done:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}default:return e}};var wc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const hc={tasks:[],searchValue:"",filteredPipelineId:""},qc=(0,a.createContext)({state:hc,userTasksDispatch:()=>{},fetchAndSetUserTasks:()=>wc(void 0,void 0,void 0,(function*(){}))}),mc=({children:e,userId:t})=>{const[s,r]=(0,a.useReducer)(pc,hc),{loadingDispatch:c}=(0,a.useContext)(kt);(0,a.useEffect)((()=>{l()}),[]);const l=()=>wc(void 0,void 0,void 0,(function*(){try{c({type:je,payload:!0});const e=yield function(e){return u()({path:`/wpqt/v1/users/${e}/tasks`,method:"GET",headers:p()})}(t);r({type:Ee,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch user tasks","quicktasker"))}finally{c({type:je,payload:!1})}}));return(0,n.jsx)(qc.Provider,{value:{state:s,userTasksDispatch:r,fetchAndSetUserTasks:l},children:e})};function vc(){const{state:{searchValue:e,filteredPipelineId:t},userTasksDispatch:s}=(0,a.useContext)(qc);return(0,n.jsxs)(Ht,{title:(0,o.__)("Filter tasks","quicktasker"),children:[(0,n.jsx)(Hs,{value:e,onChange:e=>{s({type:Ae,payload:e})},className:"!wpqt-mb-0"}),(0,n.jsx)(Bt,{selectedOptionValue:t,selectionChange:e=>{s({type:Oe,payload:e})}})]})}var xc=s(7028),fc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function gc({taskId:e,onUnAssignTask:t}){const[s,i]=(0,a.useState)(!1);return(0,n.jsx)(Oa,{menuBtn:({active:e})=>(0,n.jsx)(Ia,{isActive:e,IconComponent:Nn.A}),children:(0,n.jsx)(Pa,{text:(0,o.__)("Unassign from task","quicktasker"),loading:s,icon:(0,n.jsx)(xc.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:s=>fc(this,void 0,void 0,(function*(){s.stopPropagation(),i(!0),yield t(e),i(!1)})),className:"!wpqt-mb-0"})})}const _c=()=>{const{state:{searchValue:e,filteredPipelineId:t}}=(0,a.useContext)(qc);return{filterTasks:s=>{const a=s.name&&s.name.toLowerCase().includes(e.toLowerCase())||s.description&&s.description.toLowerCase().includes(e.toLowerCase()),n=!t||s.pipeline_id===t;return a&&n}}};var kc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function jc({userId:e}){var t;const{filterTasks:s}=_c(),{modalDispatch:i}=(0,a.useContext)(cs),{state:{tasks:r},userTasksDispatch:c}=(0,a.useContext)(qc),{removeTaskFromUser:l}=ns(),d=null!==(t=null==r?void 0:r.filter(s))&&void 0!==t?t:[],u=t=>kc(this,void 0,void 0,(function*(){yield l(e,t,(()=>{c({type:Ce,payload:t})}))}));return r&&0===r.length?(0,n.jsx)(yn,{text:(0,o.__)("User has no tasks","quicktasker")}):d&&0===d.length?(0,n.jsx)(yn,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-card-grid",children:d.map((e=>(0,n.jsxs)(Sn,{className:"wpqt-cursor-pointer",title:e.name,description:e.description,dropdown:(0,n.jsx)(gc,{taskId:e.id,onUnAssignTask:u}),onClick:()=>{i({type:K,payload:{taskToEdit:e}})},children:[(0,n.jsx)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:(0,n.jsx)(Fa,{task:e,onUserAdd:t=>{c({type:Ie,payload:{taskId:e.id,user:t}})},onUserDelete:t=>{c({type:Pe,payload:{taskId:e.id,user:t}})}})}),(0,n.jsx)(An,{task:e,onDoneStatusChange:(e,t)=>{c({type:De,payload:{taskId:e,done:t}})}})]},e.id)))}),(0,n.jsx)(jn,{editTaskCallback:e=>{c({type:Ne,payload:e})}})]})}function yc({userId:e}){return(0,n.jsx)(mc,{userId:e,children:(0,n.jsxs)(Rt,{children:[(0,n.jsx)(l,{description:(0,o.__)("Tasks assigned to user","quicktasker"),children:(0,o.__)("User tasks","quicktasker")}),(0,n.jsx)(vc,{}),(0,n.jsx)(jc,{userId:e})]})})}const bc=()=>{const{page:e,hash:t}=Tc();if("wp-quick-tasks"===e){const e=t.match(/^#\/users\/(\d+)\/tasks$/);if(e){const t=e[1];return(0,n.jsx)(yc,{userId:t})}const s=t.match(/^#\/users\/(\d+)$/);if(s){const e=s[1];return(0,n.jsx)(br,{userId:e})}switch(t){case"#/users":return(0,n.jsx)(uc,{});case"#/overview":return(0,n.jsx)(_i,{});case"#/archive":return(0,n.jsx)(Yn,{});case"#/user-sessions":return(0,n.jsx)(Lr,{});case"#/logs":return(0,n.jsx)(ci,{});case"#/settings":return(0,n.jsx)(ur,{});case"#/guide":return(0,n.jsx)(Xn,{});default:return(0,n.jsx)(qo,{})}}},Tc=()=>({page:new URLSearchParams(window.location.search).get("page"),hash:window.location.hash}),Sc=function(){const e=(()=>{const[e,t]=(0,a.useState)(bc());return(0,a.useEffect)((()=>{const e=()=>{t(bc()),(()=>{const{page:e,hash:t}=Tc();if("wp-quick-tasks"!==e)return;const s=document.querySelectorAll("#toplevel_page_wp-quick-tasks .wp-submenu li");s.forEach((e=>e.classList.remove("wpqt-current")));const a={"#/users":"#/users","#/overview":"#/overview","#/archive":"#/archive","#/user-sessions":"#/user-sessions","#/logs":"#/logs","#/settings":"#/settings","#/guide":"#/guide",default:""};let n=a.default;void 0!==a[t]?n=a[t]:/^#\/users(\/\d+)?(\/tasks)?$/.test(t)&&(n="#/users"),s.forEach((e=>{const t=e.querySelector("a");t&&t.getAttribute("href")&&t.getAttribute("href")===`admin.php?page=wp-quick-tasks${n}`&&e.classList.add("wpqt-current")}))})()};return e(),window.addEventListener("popstate",e),window.addEventListener("hashchange",e),()=>{window.removeEventListener("popstate",e),window.removeEventListener("hashchange",e)}}),[]),e})();return(0,n.jsx)(c,{children:(0,n.jsx)(Ks,{children:(0,n.jsx)(hs,{children:(0,n.jsx)(ls,{children:(0,n.jsx)(Kt,{children:(0,n.jsxs)(jt,{children:[e,(0,n.jsx)(i.N9,{position:"bottom-right",className:"wpqt-z-[999999]"})]})})})})})})};(0,a.render)((0,n.jsx)(Sc,{}),document.getElementById("wpqt-app"))},1609:e=>{e.exports=window.React},5795:e=>{e.exports=window.ReactDOM},790:e=>{e.exports=window.ReactJSXRuntime}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return a[e].call(s.exports,s,s.exports,i),s.exports}i.m=a,e=[],i.O=(t,s,a,n)=>{if(!s){var o=1/0;for(d=0;d<e.length;d++){for(var[s,a,n]=e[d],r=!0,c=0;c<s.length;c++)(!1&n||o>=n)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(r=!1,n<o&&(o=n));if(r){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,a,n]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},s=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var n=Object.create(null);i.r(n);var o={};t=t||[null,s({}),s([]),s(s)];for(var r=2&a&&e;"object"==typeof r&&!~t.indexOf(r);r=s(r))Object.getOwnPropertyNames(r).forEach((t=>o[t]=()=>e[t]));return o.default=()=>e,i.d(n,o),n},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=524,(()=>{var e={524:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[o,r,c]=s,l=0;if(o.some((t=>0!==e[t]))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(c)var d=c(i)}for(t&&t(s);l<o.length;l++)n=o[l],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},s=globalThis.webpackChunkquicktasker=globalThis.webpackChunkquicktasker||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.nc=void 0;var o=i.O(void 0,[96],(()=>i(1004)));o=i.O(o)})();