(()=>{"use strict";var e,t,s,a={1757:(e,t,s)=>{const a=window.wp.element;var n=s(790),i=s(9571);const o=window.wp.i18n;class r extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){var e;return this.state.hasError?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-h-screen wpqt-items-center wpqt-justify-center wpqt-text-center wpqt-text-lg",children:[(0,o.__)("Something went wrong. Please refresh the page.","quicktasker"),(0,n.jsx)("br",{}),null===(e=this.state.error)||void 0===e?void 0:e.message]}):this.props.children}}const c=r;function l({children:e,description:t=null,icon:s=null}){return(0,n.jsx)("div",{className:"wpqt-mb-6 wpqt-inline-grid wpqt-grid-cols-[auto_auto] wpqt-items-center wpqt-gap-2",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("h1",{children:[e,s&&(0,n.jsx)("span",{className:"wpqt-ml-1 wpqt-align-middle",children:s})]}),t&&(0,n.jsx)("div",{children:t})]})})}const d=window.wp.apiFetch;var u=s.n(d);function p(){return{"Content-Type":"application/json","X-WPQT-API-Nonce":window.wpqt.apiNonce}}function m(e,t,s){return u()({path:`/wpqt/v1/tasks/${e}/move`,method:"PATCH",data:{stageId:t,order:s},headers:p()})}function h(e,t,s){const a=new URLSearchParams({typeId:e,type:t,isPrivate:s.toString()}).toString();return u()({path:`/wpqt/v1/comments?${a}`,method:"GET",headers:p()})}function w(e,t,s,a){return u()({path:"/wpqt/v1/comments",data:{comment:a,typeId:e,type:t,isPrivate:s},method:"POST",headers:p()})}function f(e,t){const s=new URLSearchParams({typeId:e,type:t});return u()({path:`/wpqt/v1/logs?${s.toString()}`,method:"GET",headers:p()})}function q(e,t,s){return u()({path:`/wpqt/v1/users/${e}/tasks/${t}`,method:"DELETE",data:{user_type:s},headers:p()})}function x(e,t,s){const a=new URLSearchParams({entityId:e,entityType:t,active:String(s)});return u()({path:`/wpqt/v1/custom-fields?${a.toString()}`,method:"GET",headers:p()})}const g="SET_LOADING",v="SET_PIPELINE",_="MOVE_TASK",k="ADD_TASK",j="ADD_STAGE",y="DELETE_STAGE",b="EDIT_TASK",T="EDIT_STAGE",E="ADD_PIPELINE",S="EDIT_PIPELINE",A="SET_PRIMARY",N="SET_PIPELINES",C="ADD_USER_TO_TASK",O="REMOVE_USER_FROM_TASK",I="CHANGE_TASK_DONE_STATUS",D="REMOVE_PIPELINE",P="REMOVE_ACTIVE_PIPELINE",L="REMOVE_TASK",R="TOGGLE_VIEW",M="ADD_LABEL_TO_TASK",U="REMOVE_LABEL_FROM_TASK",F="EDIT_PIPELINE_LABEL",$="REMOVE_PIPELINE_LABEL",z="SET_TASK_FOCUS_COLOR",K="SET_STAGE_FILTER",V="SET_USER_FILTER",G="OPEN_EDIT_TASK_MODAL",B="CLOSE_TASK_MODAL",H="OPEN_NEW_STAGE_MODAL",W="CLOSE_STAGE_MODAL",Q="OPEN_STAGE_EDIT_MODAL",Y="OPEN_NEW_PIPELINE_MODAL",J="OPEN_EDIT_PIPELINE_MODAL",X="CLOSE_PIPELINE_EDIT_MODAL",Z="CLOSE_USER_MODAL",ee="OPEN_EDIT_USER_MODAL",te="ADD_ASSIGNED_USER_TO_EDITING_TASK",se="REMOVE_ASSIGNED_USER_FROM_EDITING_TASK",ae="CHANGE_USER_SETTINGS_MODAL_OPEN",ne="OPEN_MOVE_TASK_MODAL",ie="CLOSE_MOVE_TASK_MODAL",oe="OPEN_TASK_COLOR_MODAL",re="CLOSE_TASK_COLOR_MODAL",ce="OPEN_TASK_EXPORT_MODAL",le="CLOSE_TASK_EXPORT_MODAL",de="CHANGE_TASK_EXPORT_MODAL_METHOD",ue="OPEN_PIPELINE_IMPORT_MODAL",pe="CLOSE_PIPELINE_IMPORT_MODAL",me="OPEN_AUTOMATION_CREATOR_MODAL",he="CLOSE_AUTOMATION_CREATOR_MODAL",we="OPEN_AUTOMATIONS_MODAL",fe="CLOSE_AUTOMATIONS_MODAL",qe="SET_ARCHIVE_TASKS",xe="SET_ARCHIVE_SEARCH_VALUE",ge="SET_ARCHIVE_FILTERED_PIPELINE",ve="REMOVE_ARCHIVED_TASK",_e="ADD_ASSIGNED_USER_TO_ARCHIVED_TASK",ke="REMOVE_ASSINGED_USER_FROM_ARCHIVED_TASK",je="CHANGE_ARCHIVED_TASK_DONE_STATUS",ye="EDIT_ARCHIVED_TASK",be="CHANGE_ARCHIVE_TASK_DONE_FILTER",Te="ADD_LABEL_ARCHIVED_TASK",Ee="REMOVE_LABEL_ARCHIVED_TASK",Se="SET_USERS",Ae="SET_WP_USERS",Ne="ADD_USER",Ce="SET_USERS_SEARCH_VALUE",Oe="EDIT_USER",Ie="DELETE_USER",De="CHANGE_USER_STATUS",Pe="RESET_PASSWORD",Le="INIT_APP_STATE",Re="SET_CUSTOM_USER_PAGE_STYLES",Me="SET_FULL_PAGE_LOADING",Ue="SET_USER_SESSIONS_SEARCH_VALUE",Fe="SET_USER_SESSIONS",$e="CHANGE_USER_SESSION_STATUS",ze="DELETE_USER_SESSION",Ke="SET_USER_TASKS",Ve="SET_USER_TASKS_SEARCH_VALUE",Ge="REMOVE_USER_TASK",Be="EDIT_USER_TASK",He="SET_USER_TASKS_FILTERED_PIPELINE",We="ADD_ASSIGNED_USER_TO_USER_TASK",Qe="REMOVE_ASSIGNED_USER_FROM_USER_TASK",Ye="CHANGE_USER_TASK_DONE_STATUS",Je="SET_CUSTOM_FIELDS",Xe="ADD_CUSTOM_FIELD",Ze="DELETE_CUSTOM_FIELD",et="SET_CUSTOM_FIELD_LOADING",tt="SET_CUSTOM_FIELD_INITIAL_DATA",st="SET_LABELS",at="ADD_LABEL",nt="REMOVE_LABEL",it="EDIT_LABEL",ot="SET_LABEL_ACTION_STATE_SELECTION",rt="SET_LABEL_ACTION_STATE_EDITING",ct="SET_LABEL_ACTION_STATE_CREATION",lt="RESET_LABEL_CONTEXT",dt="SET_PIPELINE_AUTOMATIONS",ut="SET_PIPELINE_AUTOMATIONS_LOADING",pt="REMOVE_PIPELINE_AUTOMATION",mt="ADD_PIPELINE_AUTOMATION",ht="UPDATE_PIPELINE_AUTOMATION_ACTIVE_STATUS",wt="SET_META",ft="SET_ACTION_TARGET",qt="RESET_AUTOMATION_TO_TARGET",xt="RESET_AUTOMATION_TO_TRIGGER",gt="RESET_AUTOMATION_TO_ACTION",vt="SET_UPLOADS",_t="ADD_UPLOAD",kt="REMOVE_UPLOAD",jt=!0,yt="#ffffff",bt="6px",Tt="solid",Et="#16a34a",St=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","text/plain","image/jpeg","image/png","image/gif","image/bmp","image/svg+xml","audio/mpeg","audio/wav","audio/ogg","video/mp4","video/webm","video/ogg","application/zip","application/x-rar-compressed","application/x-tar","application/gzip"],At=26214400,Nt=/^[a-zA-Z0-9_\-.]+$/;var Ct,Ot,It,Dt,Pt,Lt;function Rt(e){return!e.user_type||e.user_type===Ct.QUICKTASKER}function Mt(e){return e.user_type===Ct.WP_USER}!function(e){e.QUICKTASKER="quicktasker",e.WP_USER="wp-user"}(Ct||(Ct={})),function(e){e.TASK_DONE="task-done",e.Task_NOT_DONE="task-not-done",e.TASK_CREATED="task-created",e.TASK_DELETED="task-deleted",e.TASK_ASSIGNED="task-assigned",e.TASK_UNASSIGNED="task-unassigned",e.TASK_PUBLIC_COMMENT_ADDED="task-public-comment-added",e.TASK_PRIVATE_COMMENT_ADDED="task-private-comment-added",e.TASK_FILE_UPLOADED="task-attachment-added",e.TASK_FILE_DELETED="task-attachment-deleted"}(Ot||(Ot={})),function(e){e.WOOCOMMERCE_ORDER_ADDED="woocommerce-order-added"}(It||(It={})),function(e){e.PIPELINE="pipeline",e.Stage="stage",e.Task="task",e.quicktasker="quicktasker",e.WOOCOMMERCE_ORDER="woocommerce-order"}(Dt||(Dt={})),function(e){e.PIPELINE="pipeline",e.STAGE="stage",e.TASK="task",e.QUICKTASKER="quicktasker",e.WP_USER="wp-user"}(Pt||(Pt={})),function(e){e.ARCHIVE_TASK="archive-task",e.ASSIGN_USER="assign-user",e.NEW_ENTITY_EMAIL="new-entity-email",e.DELETED_ENTITY_EMAIL="deleted-entity-email",e.TASK_ASSIGNED_EMAIL="task-assigned-email",e.TASK_UNASSIGNED_EMAIL="task-unassigned-email",e.TASK_PUBLIC_COMMENT_ADDED_EMAIL="task-public-comment-added-email",e.TASK_PRIVATE_COMMENT_ADDED_EMAIL="task-private-comment-added-email",e.TASK_FILE_UPLOADED_EMAIL="task-attachment-added-email",e.TASK_FILE_DELETED_EMAIL="task-attachment-deleted-email",e.CREATE_TASK="create-task",e.SEND_SLACK_MESSAGE="send-slack-message"}(Lt||(Lt={}));const Ut=e=>Object.assign(Object.assign({},e),{is_active:"1"===e.is_active,has_password:"1"===e.has_password}),Ft=e=>{switch(e){case Pt.QUICKTASKER:return Ct.QUICKTASKER;case Pt.WP_USER:return Ct.WP_USER;default:return null}},$t={[Ct.QUICKTASKER]:"Quicktasker",[Ct.WP_USER]:"WordPress User"},zt=e=>Object.assign(Object.assign({},e),{task_order:Number(e.task_order),free_for_all:"1"===e.free_for_all,is_archived:"1"===e.is_archived,is_done:"1"===e.is_done,assigned_users:e.assigned_users?e.assigned_users.map((e=>Object.assign({},Ut(e)))):[]}),Kt=(e,t)=>{var s,a,n,i,o,r,c;switch(t.type){case qe:{const s=t.payload;return Object.assign(Object.assign({},e),{archivedTasks:s.map(zt)})}case xe:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveSearchValue:s})}case ge:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveFilteredPipelineId:s})}case ve:{const a=(null!==(s=e.archivedTasks)&&void 0!==s?s:[]).filter((e=>e.id!==t.payload));return Object.assign(Object.assign({},e),{archivedTasks:a})}case _e:{const{taskId:s,user:n}=t.payload,i=(null!==(a=e.archivedTasks)&&void 0!==a?a:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:Rt(n)?[n,...e.assigned_users]:e.assigned_users,assigned_wp_users:Mt(n)?[n,...e.assigned_wp_users]:e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{archivedTasks:i})}case ke:{const{taskId:s,user:a}=t.payload,i=(null!==(n=e.archivedTasks)&&void 0!==n?n:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:Rt(a)?e.assigned_users.filter((e=>e.id!==a.id)):e.assigned_users,assigned_wp_users:Mt(a)?e.assigned_wp_users.filter((e=>e.id!==a.id)):e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{archivedTasks:i})}case je:{const{taskId:s,done:a}=t.payload,n=(null!==(i=e.archivedTasks)&&void 0!==i?i:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case ye:{const s=t.payload,a=(null!==(o=e.archivedTasks)&&void 0!==o?o:[]).map((e=>e.id===s.id?zt(s):e));return Object.assign(Object.assign({},e),{archivedTasks:a})}case be:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveTaskDoneFilter:s})}case Te:{const{taskId:s,label:a}=t.payload,n=(null!==(r=e.archivedTasks)&&void 0!==r?r:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:[...e.assigned_labels,a]}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case Ee:{const{taskId:s,labelId:a}=t.payload,n=(null!==(c=e.archivedTasks)&&void 0!==c?c:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:e.assigned_labels.filter((e=>e.id!==a))}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}default:return e}};var Vt,Gt,Bt,Ht;!function(e){e.Task="task",e.User="user"}(Vt||(Vt={})),function(e){e.System="system",e.Admin="admin",e.WPQTUser="quicktasker_user",e.Automation="automation",e.Import="import"}(Gt||(Gt={})),function(e){e.All="all",e.Completed="completed",e.NotCompleted="not completed"}(Bt||(Bt={})),function(e){e.Admin="administrator",e.Other="other"}(Ht||(Ht={}));const Wt=(e,t)=>{if(t.type===Me){const s=t.payload;return Object.assign(Object.assign({},e),{fullPageLoading:s})}return e},Qt={fullPageLoading:!1},Yt=(0,a.createContext)({state:Qt,loadingDispatch:()=>{}}),Jt=({children:e})=>{const[t,s]=(0,a.useReducer)(Wt,Qt);return(0,n.jsx)(Yt.Provider,{value:{state:t,loadingDispatch:s},children:e})};const Xt={archivedTasks:null,archiveLoading:!1,archiveSearchValue:"",archiveFilteredPipelineId:"",archiveTaskDoneFilter:Bt.All},Zt=(0,a.createContext)({state:Xt,archiveDispatch:()=>{}}),es=({children:e})=>{const[t,s]=(0,a.useReducer)(Kt,Xt),{loadingDispatch:r}=(0,a.useContext)(Yt);(0,a.useEffect)((()=>{c()}),[]);const c=()=>{return e=void 0,t=void 0,n=function*(){try{r({type:Me,payload:!0});const{data:e}=yield u()({path:"/wpqt/v1/tasks/archived",method:"GET",headers:p()});s({type:qe,payload:e})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch archived tasks","quicktasker"))}finally{r({type:Me,payload:!1})}},new((a=void 0)||(a=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}c((n=n.apply(e,t||[])).next())}));var e,t,a,n};return(0,n.jsx)(Zt.Provider,{value:{state:t,archiveDispatch:s},children:e})};var ts;!function(e){e.SELECTION="select",e.CREATION="create",e.EDIT="edit"}(ts||(ts={}));const ss=(e,t)=>{switch(t.type){case st:return Object.assign(Object.assign({},e),{labels:t.payload});case at:return Object.assign(Object.assign({},e),{labels:e.labels?[...e.labels,t.payload]:[t.payload],labelActionState:ts.SELECTION});case it:return Object.assign(Object.assign({},e),{labels:e.labels?e.labels.map((e=>e.id===t.payload.id?t.payload:e)):[t.payload]});case nt:return Object.assign(Object.assign({},e),{labels:e.labels?e.labels.filter((e=>e.id!==t.payload.id)):[]});case ot:return Object.assign(Object.assign({},e),{labelActionState:ts.SELECTION,labelToEdit:null});case rt:return Object.assign(Object.assign({},e),{labelActionState:ts.EDIT,labelToEdit:t.payload});case ct:return Object.assign(Object.assign({},e),{labelActionState:ts.CREATION,labelToEdit:null});case lt:return as;default:return e}},as={labels:null,labelActionState:ts.SELECTION,labelToEdit:null},ns=(0,a.createContext)({state:as,labelDispatch:()=>{}}),is=({children:e})=>{const[t,s]=(0,a.useReducer)(ss,as);return(0,n.jsx)(ns.Provider,{value:{state:t,labelDispatch:s},children:e})};var os=s(6061);function rs({width:e="80",height:t="80",className:s="",color:a="#1d4ed8",secondaryColor:i="#2563eb"}){return(0,n.jsx)(os.BM,{visible:!0,height:t,width:e,color:a,secondaryColor:i,ariaLabel:"oval-loading",wrapperStyle:{},wrapperClass:s})}function cs(){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-h-screen-minus-top-bar wpqt-flex-col wpqt-items-center wpqt-justify-center",children:(0,n.jsx)(rs,{})})}function ls({className:e="",ovalSize:t}){const s=t?{width:t,height:t}:{};return(0,n.jsx)("div",{className:`wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center ${e}`,children:(0,n.jsx)(rs,Object.assign({},s))})}function ds({children:e}){const{state:{fullPageLoading:t}}=(0,a.useContext)(Yt);return(0,n.jsx)("div",{className:"wpqt-pr-4",children:t?(0,n.jsx)(cs,{}):e})}var us,ps=s(2912);!function(e){e.TEXT="text",e.PASSWORD="password"}(us||(us={}));const ms=(0,a.forwardRef)((({value:e,onChange:t,isAutoFocus:s,className:a="",wrapperClassName:i="",disabled:o=!1,type:r=us.TEXT,loading:c=!1,inputId:l,name:d},u)=>(0,n.jsxs)("div",{className:`wpqt-inline-block wpqt-relative wpqt-mb-3 ${i}`,children:[(0,n.jsx)(ps.p,{ref:u,autoFocus:s,className:`wpqt-block wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-3 wpqt-py-1.5 wpqt-text-sm/6 focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${a}`,value:e,disabled:o,onChange:e=>t(e.target.value),type:r,id:l,name:d}),c&&(0,n.jsx)(rs,{width:"24",height:"24",className:"wpqt-absolute wpqt-right-[-32px] wpqt-top-1/2 wpqt-transform-y-center"})]}))),hs=e=>Object.assign(Object.assign({},e),{allow_only_last_stage_task_done:"1"===e.allow_only_last_stage_task_done}),ws=e=>Object.assign(Object.assign({},e),{stage_order:Number(e.stage_order),tasks:(e.tasks||[]).map((e=>Object.assign({},zt(e))))}),fs=(e,t)=>{var s;switch(t.type){case N:{const s=t.payload,a=e=>Object.assign({},ws(e)),n=e=>{var t;return Object.assign(Object.assign({},e),{stages:null===(t=e.stages)||void 0===t?void 0:t.map(a),settings:e.settings?hs(e.settings):void 0,is_primary:"1"===e.is_primary})};return Object.assign(Object.assign({},e),{pipelines:s.map(n)})}case E:{const a=t.payload,n=e=>Object.assign({},ws(e)),i=Object.assign(Object.assign({},a),{stages:null===(s=a.stages)||void 0===s?void 0:s.map(n),settings:a.settings?hs(a.settings):void 0,is_primary:!1});return Object.assign(Object.assign({},e),{pipelines:[...e.pipelines,i]})}case A:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.map((e=>Object.assign(Object.assign({},e),{is_primary:e.id===s})))})}case S:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.map((e=>e.id===s.id?s:e))})}case D:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.filter((e=>e.id!==s))})}default:return e}},qs={pipelines:[]},xs=(0,a.createContext)({state:qs,pipelinesDispatch:()=>{}}),gs=({children:e})=>{const[t,s]=(0,a.useReducer)(fs,qs);return(0,a.useEffect)((()=>{const e=window.wpqt.initialPipelines;s({type:N,payload:e})}),[]),(0,n.jsx)(xs.Provider,{value:{state:t,pipelinesDispatch:s},children:e})};var vs=s(3482);function _s({options:e,selectedOptionValue:t,onSelectionChange:s,allSelector:a=!0,className:i="",allSelectorLabel:o="All boards",id:r}){return(0,n.jsxs)(vs.l,{id:r,value:t,onChange:e=>{const t=e.target.value;s(t)},className:`!wpqt-rounded-lg !wpqt-border !wpqt-border-solid !wpqt-border-qtBorder !wpqt-px-2 !wpqt-pr-6 !wpqt-py-1 focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${i}`,children:[a&&(0,n.jsx)("option",{value:"",children:o}),e.map((e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value)))]})}function ks({selectedOptionValue:e,selectionChange:t,extraOptions:s=[]}){const{state:{pipelines:i}}=(0,a.useContext)(xs),o=(0,a.useMemo)((()=>i.map((e=>({value:e.id,label:e.name})))),[i]);return(0,n.jsx)(_s,{options:[...o,...s],selectedOptionValue:e,onSelectionChange:t})}function js({children:e,labelFor:t,className:s=""}){return(0,n.jsx)("label",{className:`wpqt-mb-1 ${s}`,htmlFor:t,children:e})}function ys({children:e,searchChildren:t,applyFilterChildren:s,title:a,childrenClassName:i="",titleClassName:o=""}){return(0,n.jsxs)("div",{className:"wpqt-mb-8",children:[(0,n.jsx)("div",{className:`wpqt-mb-3 wpqt-text-lg wpqt-text-center wpqt-font-semibold ${o}`,children:a}),(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-flex wpqt-items-center wpqt-justify-center wpqt-gap-2",children:t}),(0,n.jsx)("div",{className:`wpqt-flex wpqt-gap-5 wpqt-items-center wpqt-justify-center wpqt-mb-6 ${i}`,children:e}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:s})]})}function bs({children:e,title:t,className:s="",labelIdFor:a}){return(0,n.jsxs)("div",{className:`wpqt-flex wpqt-flex-col ${s}`,children:[(0,n.jsx)(js,{labelFor:a,children:t}),e]})}function Ts(){const{state:{archiveSearchValue:e,archiveFilteredPipelineId:t,archiveTaskDoneFilter:s},archiveDispatch:i}=(0,a.useContext)(Zt);return(0,n.jsxs)(ys,{title:(0,o.__)("Archive filtering","quicktasker"),searchChildren:(0,n.jsx)(bs,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"archive-search",children:(0,n.jsx)(ms,{inputId:"archive-search",value:e,onChange:e=>{i({type:xe,payload:e})}})}),children:[(0,n.jsx)(bs,{title:(0,o.__)("Board","quicktasker"),children:(0,n.jsx)(ks,{selectedOptionValue:t,selectionChange:e=>{i({type:ge,payload:e})},extraOptions:[{value:"DELETED",label:(0,o.__)("DELETED","quicktasker")}]})}),(0,n.jsx)(bs,{title:(0,o.__)("Status","quicktasker"),children:(0,n.jsx)(_s,{allSelector:!1,selectedOptionValue:s,options:[{label:(0,o.__)("All","quicktasker"),value:Bt.All},{label:(0,o.__)("Completed","quicktasker"),value:Bt.Completed},{label:(0,o.__)("Not completed","quicktasker"),value:Bt.NotCompleted}],onSelectionChange:e=>{const t=(e=>{switch(e){case Bt.All:return Bt.All;case Bt.Completed:return Bt.Completed;case Bt.NotCompleted:return Bt.NotCompleted;default:throw new Error(`Invalid selection: ${e}`)}})(e);i({type:be,payload:t})}})})]})}const Es=(e,t)=>{var s,a,n,i,o,r,c,l,d,u,p,m,h,w,f;switch(t.type){case g:return Object.assign(Object.assign({},e),{loading:t.payload});case v:{const s=t.payload,a=(s.stages||[]).map((e=>Object.assign({},ws(e)))),n=s.settings?hs(s.settings):void 0;return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},s),{stages:a,settings:n,is_primary:"1"===s.is_primary})})}case _:{if(!e.activePipeline||!e.activePipeline.stages)return e;const s=((e,t,s)=>{const a=[...e],n=a.find((e=>e.id===t.droppableId)),i=a.find((e=>e.id===s.droppableId));if((null==n?void 0:n.tasks)&&(null==i?void 0:i.tasks)){const[e]=n.tasks.splice(t.index,1);i.tasks.splice(s.index,0,e)}return a})(e.activePipeline.stages,t.payload.source,t.payload.destination);return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:s})})}case"REORDER_TASK":{const{source:n,destination:i}=t.payload,o=i.droppableId,r=i.index;if(!e.activePipeline)return e;const c=null===(s=e.activePipeline.stages)||void 0===s?void 0:s.find((e=>e.id===o));if(!c||!c.tasks)return e;const l=((e,t,s)=>{const a=[...e],[n]=a.splice(t,1);return a.splice(s,0,n),a})(c.tasks,n.index,r),d=null===(a=e.activePipeline.stages)||void 0===a?void 0:a.map((e=>e.id===o?Object.assign(Object.assign({},e),{tasks:l}):e));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:d})})}case k:{const s=zt(t.payload);return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:null===(n=e.activePipeline.stages)||void 0===n?void 0:n.map((e=>e.id===s.stage_id?Object.assign(Object.assign({},e),{tasks:[...e.tasks||[],s]}):e))})}):e}case b:{const s=zt(t.payload);if(!e.activePipeline)return e;const a=null===(i=e.activePipeline.stages)||void 0===i?void 0:i.map((e=>{var t;return e.id===s.stage_id?Object.assign(Object.assign({},e),{tasks:null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s.id?s:e))}):e}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case j:{const{stage:s}=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:[...e.activePipeline.stages||[],s]})}):e}case T:{const s=t.payload;if(!e.activePipeline)return e;const a=e=>e.id===s.id?Object.assign(Object.assign({},e),{name:s.name,description:s.description}):e,n=null===(o=e.activePipeline.stages)||void 0===o?void 0:o.map(a);return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case y:{const s=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:null===(r=e.activePipeline.stages)||void 0===r?void 0:r.filter((e=>e.id!==s))})}):e}case C:{const{taskId:s,user:a}=t.payload;if(!e.activePipeline)return e;const n=null===(c=e.activePipeline.stages)||void 0===c?void 0:c.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>{if(e.id===s){const t=Rt(a)?[a,...e.assigned_users||[]]:e.assigned_users||[],s=Mt(a)?[a,...e.assigned_wp_users||[]]:e.assigned_wp_users||[];return Object.assign(Object.assign({},e),{assigned_users:t,assigned_wp_users:s})}return e}));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case O:{const{taskId:s,userId:a,userType:n}=t.payload;if(!e.activePipeline)return e;const i=null===(l=e.activePipeline.stages)||void 0===l?void 0:l.map((e=>{var t;const i=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>{var t,i;return e.id===s?Object.assign(Object.assign({},e),{assigned_users:n===Ct.QUICKTASKER?null===(t=e.assigned_users)||void 0===t?void 0:t.filter((e=>e.id!==a)):e.assigned_users,assigned_wp_users:n===Ct.WP_USER?null===(i=e.assigned_wp_users)||void 0===i?void 0:i.filter((e=>e.id!==a)):e.assigned_wp_users}):e}));return Object.assign(Object.assign({},e),{tasks:i})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:i})})}case S:{const s=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{name:s.name,description:s.description,is_primary:"1"===s.is_primary})}):e}case I:{const{taskId:s,done:a}=t.payload;if(!e.activePipeline)return e;const n=null===(d=e.activePipeline.stages)||void 0===d?void 0:d.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case P:return Object.assign(Object.assign({},e),{activePipeline:null});case L:{const s=t.payload;if(!e.activePipeline)return e;const a=null===(u=e.activePipeline.stages)||void 0===u?void 0:u.map((e=>{var t;return Object.assign(Object.assign({},e),{tasks:null===(t=e.tasks)||void 0===t?void 0:t.filter((e=>e.id!==s))})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case R:return Object.assign(Object.assign({},e),{view:t.payload});case M:{const{taskId:s,label:a}=t.payload;if(!e.activePipeline)return e;const n=null===(p=e.activePipeline.stages)||void 0===p?void 0:p.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:[...e.assigned_labels||[],a]}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case U:{const{taskId:s,labelId:a}=t.payload;if(!e.activePipeline)return e;const n=null===(m=e.activePipeline.stages)||void 0===m?void 0:m.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).filter((e=>e.id!==a))}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case F:{const{label:s}=t.payload;if(!e.activePipeline)return e;const a=null===(h=e.activePipeline.stages)||void 0===h?void 0:h.map((e=>{var t;const a=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).map((e=>e.id===s.id?s:e))})));return Object.assign(Object.assign({},e),{tasks:a})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case $:{const s=t.payload;if(!e.activePipeline)return e;const a=null===(w=e.activePipeline.stages)||void 0===w?void 0:w.map((e=>{var t;const a=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).filter((e=>e.id!==s))})));return Object.assign(Object.assign({},e),{tasks:a})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case z:{const{taskId:s,color:a}=t.payload;if(!e.activePipeline)return e;const n=null===(f=e.activePipeline.stages)||void 0===f?void 0:f.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{task_focus_color:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}default:return e}};var Ss;!function(e){e.PIPELINE="PIPELINE-VIEW",e.TASK="TASK-VIEW"}(Ss||(Ss={}));const As={loading:!1,view:Ss.PIPELINE,activePipeline:null},Ns=(0,a.createContext)({state:As,dispatch:()=>{},fetchAndSetPipelineData:()=>Promise.resolve()}),Cs=({children:e})=>{const[t,s]=(0,a.useReducer)(Es,As),{loadingDispatch:r}=(0,a.useContext)(Yt);(0,a.useEffect)((()=>{const e=window.wpqt.initialActivePipelineId;e&&l(e,!0)}),[]);const c=(e,t)=>{t?r({type:Me,payload:e}):s({type:g,payload:e})},l=(e,...t)=>{return a=void 0,n=[e,...t],l=function*(e,t=!1){try{c(!0,t);const{data:{pipeline:a}}=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e}`,headers:p()})}(e);s({type:v,payload:a})}catch(e){console.error(e),i.oR.error((0,o.__)("Unable to load the board. Please try again later.","quicktasker"))}finally{c(!1,t)}},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{o(l.next(e))}catch(e){t(e)}}function i(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var a;t.done?e(t.value):(a=t.value,a instanceof r?a:new r((function(e){e(a)}))).then(s,i)}o((l=l.apply(a,n||[])).next())}));var a,n,r,l};return(0,n.jsx)(Ns.Provider,{value:{state:t,dispatch:s,fetchAndSetPipelineData:l},children:e})};var Os=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Is={[Lt.ARCHIVE_TASK]:(0,o.__)("Task archived by automation","quicktasker"),[Lt.ASSIGN_USER]:(0,o.__)("User assigned by automation","quicktasker"),[Lt.NEW_ENTITY_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Lt.DELETED_ENTITY_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Lt.TASK_ASSIGNED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Lt.TASK_UNASSIGNED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Lt.TASK_PUBLIC_COMMENT_ADDED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Lt.TASK_PRIVATE_COMMENT_ADDED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Lt.TASK_FILE_UPLOADED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Lt.TASK_FILE_DELETED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Lt.CREATE_TASK]:(0,o.__)("Task created by automation","quicktasker"),[Lt.SEND_SLACK_MESSAGE]:(0,o.__)("Slack message sent by automation","quicktasker")};function Ds(){const{dispatch:e}=(0,a.useContext)(Ns),t=e=>{e&&e.forEach((e=>{if(e.automation_action.includes("email"))return;const t=Is[e.automation_action]||`Automation executed: ${e.automation_action}`;i.oR.info(t)}))},s=(t,s)=>{t&&s&&t.forEach((t=>{if(t.automation_action===Lt.ARCHIVE_TASK&&e({type:L,payload:s}),t.automation_action===Lt.ASSIGN_USER){const n=t.executionResult;!n||!(a=n)||"object"!=typeof a||a.user_type&&a.user_type!==Ct.QUICKTASKER&&a.user_type!==Ct.WP_USER||e({type:C,payload:{taskId:s,user:n}})}var a}))};return{displayAutomationMessages:t,handleExecutedAnimationsResults:s,handleExecutedAutomations:(e,a)=>{0!==e.length&&(s(e,a),t(e))},createAutomation:(e,t,s)=>Os(this,void 0,void 0,(function*(){try{const a=yield function(e,t){var s;return u()({path:`/wpqt/v1/pipelines/${e}/automations`,method:"POST",data:{automationTargetId:null,automationTarget:t.automationTarget,automationTrigger:t.automationTrigger,automationAction:null===(s=t.automationAction)||void 0===s?void 0:s.id,automationActionTargetId:t.automationActionTargetId,automationActionTargetType:t.automationActionTargetType,automationMetadata:t.metaData},headers:p()})}(e,t);i.oR.success((0,o.__)("Automation created","quicktasker")),s&&s(!0,a.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create automation","quicktasker")),s&&s(!1,null)}})),updateAutomationActiveStatus:(e,t,s)=>Os(this,void 0,void 0,(function*(){try{const a=yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/automations/${t}/active`,method:"PATCH",data:{active:s},headers:p()})}(e,t,s);return i.oR.success(s?(0,o.__)("Automation activated","quicktasker"):(0,o.__)("Automation deactivated","quicktasker")),{success:!0,data:a.data}}catch(e){return console.error(e),i.oR.error(s?(0,o.__)("Failed to activate automation","quicktasker"):(0,o.__)("Failed to deactivate automation","quicktasker")),{success:!1,data:null}}})),deleteAutomation:(e,t,s)=>Os(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/automations/${t}`,method:"DELETE",headers:p()})}(e,t),i.oR.success((0,o.__)("Automation deleted","quicktasker")),s&&s(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete automation","quicktasker")),s&&s(!1)}}))}}var Ps=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Ls=()=>{const{handleExecutedAutomations:e}=Ds(),{displayErrorMessages:t}=function(){return{displayErrorMessages:e=>{return t=this,s=void 0,n=function*(){if(e.messages&&Array.isArray(e.messages)&&e.messages.length>0){const t=e.messages.join(", ");i.oR.error(t)}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n}}}();return{deleteTask:(t,s)=>Ps(void 0,void 0,void 0,(function*(){try{const a=yield function(e){return u()({path:`/wpqt/v1/tasks/${e}`,method:"DELETE",headers:p()})}(t);s&&s(),i.oR.success((0,o.__)("Task deleted","quicktasker")),e(a.data.executedAutomations,t)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete a task","quicktasker"))}})),archiveTask:(e,t)=>Ps(void 0,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/tasks/${e}/archive`,method:"PATCH",headers:p()})}(e),t&&t(),i.oR.success((0,o.__)("Task archived","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to archive a task","quicktasker"))}})),restoreArchivedTask:(e,t)=>Ps(void 0,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/tasks/${e}/archive-restore`,method:"PATCH",headers:p()})}(e),t&&t(),i.oR.success((0,o.__)("Task restored","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to restore a task","quicktasker"))}})),removeTaskFromUser:(t,s,a)=>Ps(void 0,void 0,void 0,(function*(){try{const n=yield q(t,s,Ct.QUICKTASKER);i.oR.success((0,o.__)("Task has been unassigned","quicktasker")),e(n.data.executedAutomations,s),a&&a()}catch(e){console.error(e),i.oR.error((0,o.__)("Task unassignment failed. Try again","quicktasker"))}})),changeTaskDoneStatus:(s,a,n)=>Ps(void 0,void 0,void 0,(function*(){try{const t=a?(0,o.__)("Task marked as completed","quicktasker"):(0,o.__)("Task marked as incomplete","quicktasker"),r=yield function(e,t){return u()({path:`/wpqt/v1/tasks/${e}/done`,method:"PATCH",data:{done:t},headers:p()})}(s,a);n&&n(a),i.oR.success(t),e(r.data.executedAutomations,s)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change task status","quicktasker")),t(e)}})),moveTask:(e,t,s,a)=>Ps(void 0,void 0,void 0,(function*(){try{yield m(e,t,s),i.oR.success((0,o.__)("Task moved","quicktasaker")),a&&a(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to move a task","quicktasker")),a&&a(!1)}})),updateTaskFocusColor:(e,t)=>Ps(void 0,void 0,void 0,(function*(){const s={taskId:e,color:t};try{return yield function(e,t){return u()({path:`/wpqt/v1/tasks/${e}/focus-color`,method:"PATCH",data:{color:t},headers:p()})}(e,t),i.oR.success((0,o.__)("Task focus color changed","quicktasker")),Object.assign({success:!0},s)}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to change task focus color","quicktasker")),Object.assign({success:!1},s)}}))}},Rs=()=>Object.assign({},Fs),Ms=(e,t)=>{var s,a,n,i,o,r,c,l,d,u,p,m,h,w,f,q;switch(t.type){case G:{const{taskToEdit:s,taskModalSettings:a}=t.payload;return Object.assign(Object.assign({},e),{taskModalOpen:!0,taskToEdit:s,targetStageId:s.stage_id,taskModalSettings:Object.assign(Object.assign({},e.taskModalSettings),a)})}case B:return Rs();case te:{const d=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{assigned_users:Rt(d)?[d,...null!==(a=null===(s=e.taskToEdit)||void 0===s?void 0:s.assigned_users)&&void 0!==a?a:[]]:null!==(i=null===(n=e.taskToEdit)||void 0===n?void 0:n.assigned_users)&&void 0!==i?i:[],assigned_wp_users:Mt(d)?[d,...null!==(r=null===(o=e.taskToEdit)||void 0===o?void 0:o.assigned_wp_users)&&void 0!==r?r:[]]:null!==(l=null===(c=e.taskToEdit)||void 0===c?void 0:c.assigned_wp_users)&&void 0!==l?l:[]})})}case se:{const s=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{assigned_users:Rt(s)?(null!==(u=null===(d=e.taskToEdit)||void 0===d?void 0:d.assigned_users)&&void 0!==u?u:[]).filter((e=>e.id!==s.id)):null!==(m=null===(p=e.taskToEdit)||void 0===p?void 0:p.assigned_users)&&void 0!==m?m:[],assigned_wp_users:Mt(s)?(null!==(w=null===(h=e.taskToEdit)||void 0===h?void 0:h.assigned_wp_users)&&void 0!==w?w:[]).filter((e=>e.id!==s.id)):null!==(q=null===(f=e.taskToEdit)||void 0===f?void 0:f.assigned_wp_users)&&void 0!==q?q:[]})})}case H:{const{targetPipelineId:s}=t.payload;return Object.assign(Object.assign({},e),{stageModalOpen:!0,targetPipelineId:s})}case Q:{const{stageToEdit:s}=t.payload;return Object.assign(Object.assign({},e),{stageModalOpen:!0,stageToEdit:s})}case W:return Rs();case Y:return Object.assign(Object.assign({},e),{newPipelineModalOpen:!0});case J:{const{pipelineToEdit:s}=t.payload;return Object.assign(Object.assign({},e),{pipelineModalOpen:!0,pipelineToEdit:s})}case X:return Rs();case"OPEN_ARCHIVE_TASK_MODAL":{const s=t.payload;return Object.assign(Object.assign({},e),{archiveTaskModalOpen:!0,archiveModalTask:s})}case"CLOSE_ARCHIVE_TASK_MODAL":return Rs();case"OPEN_NEW_USER_MODAL":return Object.assign(Object.assign({},e),{userModalOpen:!0});case ee:{const s=t.payload;return Object.assign(Object.assign({},e),{userModalOpen:!0,userToEdit:s})}case Z:return Rs();case ae:return t.payload?Object.assign(Object.assign({},e),{userSettingsModalOpen:!0}):Rs();case"CHANGE_TASK_DONE_STATUS":{const{done:s}=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{is_done:s})})}case ne:{const{task:s}=t.payload;return Object.assign(Object.assign({},e),{moveTaskModalOpen:!0,taskToEdit:s})}case ie:return Rs();case oe:{const{task:s}=t.payload;return Object.assign(Object.assign({},e),{taskColorModalOpen:!0,taskToEdit:s})}case re:return Rs();case ce:{const{selectedMethod:s}=t.payload;return Object.assign(Object.assign({},e),{taskExportModalOpen:!0,taskExportModalSettings:Object.assign(Object.assign({},e.taskExportModalSettings),{selectedMethod:s})})}case le:return Rs();case de:{const{selectedMethod:s}=t.payload;return Object.assign(Object.assign({},e),{taskExportModalSettings:Object.assign(Object.assign({},e.taskExportModalSettings),{selectedMethod:s})})}case ue:return Object.assign(Object.assign({},e),{pipelineImportModalOpen:!0});case pe:return Rs();case me:return Object.assign(Object.assign({},e),{automationCreatorModalOpen:!0});case he:return Rs();case we:return Object.assign(Object.assign({},e),{automationsModalOpen:!0});case fe:return Rs();default:return e}};var Us;!function(e){e.PDF="pdf",e.CSV="csv",e.JSON="json"}(Us||(Us={}));const Fs={taskModalOpen:!1,targetStageId:"",taskToEdit:null,taskModalSettings:{allowToMarkTaskAsDone:!0},moveTaskModalOpen:!1,stageModalOpen:!1,stageToEdit:null,targetPipelineId:"",pipelineModalOpen:!1,newPipelineModalOpen:!1,pipelineToEdit:null,archiveTaskModalOpen:!1,archiveModalTask:null,userModalOpen:!1,userToEdit:null,userSettingsModalOpen:!1,taskColorModalOpen:!1,taskExportModalOpen:!1,taskExportModalSettings:{selectedMethod:Us.PDF},pipelineImportModalOpen:!1,automationCreatorModalOpen:!1,automationsModalOpen:!1},$s=(0,a.createContext)({state:Fs,modalDispatch:()=>{}}),zs=({children:e})=>{const[t,s]=(0,a.useReducer)(Ms,Fs);return(0,n.jsx)($s.Provider,{value:{state:t,modalDispatch:s},children:e})},Ks=(e,t)=>{switch(t.type){case Se:{const s=t.payload.map(Ut);return Object.assign(Object.assign({},e),{users:s})}case Ae:{const s=t.payload.map((e=>Object.assign(Object.assign({},e),{id:String(e.id)})));return Object.assign(Object.assign({},e),{wpUsers:s})}case Ne:{const s=t.payload,a=Ut(s);return Object.assign(Object.assign({},e),{users:[...e.users,a]})}case Oe:{const s=t.payload,a=Ut(s),n=e.users.map((e=>e.id===a.id?a:e));return Object.assign(Object.assign({},e),{users:n})}case De:{const{isActive:s,userId:a}=t.payload,n=e.users.map((e=>e.id===a?Object.assign(Object.assign({},e),{is_active:s}):e));return Object.assign(Object.assign({},e),{users:n})}case Pe:{const s=t.payload,a=e.users.map((e=>e.id===s?Object.assign(Object.assign({},e),{has_password:!1}):e));return Object.assign(Object.assign({},e),{users:a})}case Ie:{const s=t.payload,a=e.users.filter((e=>e.id!==s));return Object.assign(Object.assign({},e),{users:a})}case Ce:{const s=t.payload;return Object.assign(Object.assign({},e),{usersSearchValue:s})}default:return e}};var Vs=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Gs={users:[],wpUsers:[],usersSearchValue:""},Bs=(0,a.createContext)({state:Gs,userDispatch:()=>{},updateUsers:()=>Vs(void 0,void 0,void 0,(function*(){}))}),Hs=({children:e})=>{const[t,s]=(0,a.useReducer)(Ks,Gs);return(0,a.useEffect)((()=>{const e=window.wpqt.initialUsers,t=window.wpqt.initialWPUsers;s({type:Se,payload:e}),s({type:Ae,payload:t})}),[]),(0,n.jsx)(Bs.Provider,{value:{state:t,userDispatch:s,updateUsers:()=>Vs(void 0,void 0,void 0,(function*(){try{const e=yield u()({path:"/wpqt/v1/users",method:"GET",headers:p()});s({type:Se,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch users","quicktasker"))}}))},children:e})};var Ws;!function(e){e.ACTIVE_PIPELINE="ACTIVE_PIPELINE",e.PIPELINES="PIPELINES",e.USER="USER"}(Ws||(Ws={}));const Qs=e=>{const[t,s]=(0,a.useState)(!1),n=(0,a.useRef)(null),{modalDispatch:i}=(0,a.useContext)($s),{dispatch:o}=(0,a.useContext)(Ns),{pipelinesDispatch:r}=(0,a.useContext)(xs),{userDispatch:c}=(0,a.useContext)(Bs);return{modalSaving:t,setModalSaving:s,modalContentRef:n,closeModal:()=>{i({type:e}),n.current&&n.current.clearContent()},handleSuccess:(e,t,a)=>{let n;switch(a){case Ws.PIPELINES:n=r;break;case Ws.ACTIVE_PIPELINE:n=o;break;case Ws.USER:n=c;break;default:n=o}s(!1),n({type:e,payload:t})},handleError:e=>{s(!1),console.error(e)}}},Ys=(e,t)=>{switch(t.type){case vt:return Object.assign(Object.assign({},e),{uploads:t.payload});case _t:return Object.assign(Object.assign({},e),{uploads:[...e.uploads,t.payload]});case kt:return Object.assign(Object.assign({},e),{uploads:e.uploads.filter((e=>e.id!==t.payload))});default:return e}},Js={uploads:[]},Xs=(0,a.createContext)({state:Js,uploadDispatch:()=>{}}),Zs=({children:e})=>{const[t,s]=(0,a.useReducer)(Ys,Js);return(0,n.jsx)(Xs.Provider,{value:{state:t,uploadDispatch:s},children:e})};var ea,ta,sa=s(2922),aa=s(6053),na=s(9828),ia=s(540),oa=s(4576),ra=s(5138),ca=s(7008);function la({id:e}){return(0,n.jsx)(ca.m_,{id:e,className:"wpqt-bg-red-600",children:(0,n.jsx)("span",{children:"Tooltip content"})})}function da({onClick:e=()=>{},btnText:t,className:s,type:a=ea.BUTTON,disabled:i=!1,loading:o=!1,buttonStyleType:r=ta.PRIMARY}){const c=r===ta.PRIMARY?"wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-transparent wpqt-bg-blue-500 wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-text-white wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 focus:wpqt-ring-blue-800 enabled:hover:wpqt-bg-blue-600":r===ta.SECONDARY?"wpqt-inline-flex wpqt-cursor-pointer wpqt-bg-gray-100 wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 enabled:hover:wpqt-bg-gray-200":"wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-transparent wpqt-bg-red-500 wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-text-white wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 focus:wpqt-ring-red-800 enabled:hover:wpqt-bg-red-600";return(0,n.jsx)(ra.$,{disabled:i||o,className:`${c} ${s}`,onClick:e,type:a,children:o?(0,n.jsx)(rs,{width:"24",height:"24",color:"#ffffff",secondaryColor:"#ffffff"}):t})}function ua({icon:e,text:t,onClick:s=()=>{},className:a,tooltipId:i,tooltipText:o,loading:r=!1}){const c=o&&i,l=c?{"data-tooltip-id":i,"data-tooltip-content":o,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info"}:{};return(0,n.jsxs)("div",Object.assign({},l,{className:`wpqt-main-border wpqt-relative wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-bg-gray-100 wpqt-p-2 hover:wpqt-bg-white ${a}`,onClick:s,children:[e,t||r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center wpqt-relative",children:[t&&(0,n.jsx)("span",{className:"wpqt-whitespace-nowrap "+(r?"wpqt-invisible":""),children:t}),r&&(0,n.jsx)(rs,{width:"20",height:"20",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"})]}):null,c&&(0,n.jsx)(la,{id:i})]}))}function pa({icon:e,onClick:t=()=>{},className:s,loading:a=!1}){return(0,n.jsxs)("div",{className:`wpqt-main-border wpqt-p-1 wpqt-relative wpqt-inline-flex wpqt-cursor-pointer wpqt-bg-gray-100 hover:wpqt-bg-white ${s}`,onClick:t,children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center "+(a?"wpqt-invisible":""),children:e}),a&&(0,n.jsx)(rs,{width:"20",height:"20",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"})]})}function ma({modalOpen:e,closeModal:t,children:s,size:a="sm"}){return(0,n.jsxs)(sa.lG,{open:e,as:"div",className:"wpqt-relative wpqt-z-9999 focus:wpqt-outline-none",onClose:t,children:[(0,n.jsx)(sa.Xi,{className:"wpqt-fixed wpqt-inset-0 wpqt-bg-black/40"}),(0,n.jsx)("div",{className:"wpqt-fixed wpqt-inset-0 wpqt-z-10 wpqt-w-screen wpqt-overflow-y-auto",children:(0,n.jsx)("div",{className:"wpqt-mt-[8vh] wpqt-flex wpqt-justify-center",children:(0,n.jsxs)(sa.Lj,{transition:!0,className:`data-[closed]:wpqt-transform-[wpqt-scale(95%)] wpqt-relative wpqt-mt-[20px] wpqt-w-4/5 ${{sm:"wpqt-max-w-sm",md:"wpqt-max-w-lg",lg:"wpqt-max-w-4xl",xl:"wpqt-max-w-6xl"}[a]} wpqt-rounded-xl wpqt-bg-white wpqt-p-8 wpqt-backdrop-blur-2xl wpqt-duration-300 wpqt-ease-out data-[closed]:wpqt-opacity-0`,children:[(0,n.jsx)("div",{className:"wpqt-group wpqt-absolute wpqt-right-[-20px] wpqt-top-[-20px] wpqt-flex wpqt-h-[40px] wpqt-w-[40px] wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-rounded-full wpqt-border wpqt-border-solid wpqt-bg-white wpqt-text-qtBorder",onClick:t,"data-testid":"wpqt-modal-close-button",children:(0,n.jsx)(oa.A,{className:"wpqt-icon-blue group-hover:wpqt-icon-red wpqt-size-5"})}),s]})})})]})}function ha({children:e}){return(0,n.jsx)(sa.L3,{as:"div",className:"wpqt-text-base/7 wpqt-font-medium wpqt-text-black",children:e})}function wa({children:e}){return(0,n.jsx)(aa.L,{children:e})}function fa({label:e,children:t,tooltipId:s,tooltipText:a}){const i=s&&a,o=i?{"data-tooltip-id":s,"data-tooltip-content":a,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info","data-tooltip-place":"top-end"}:{};return(0,n.jsxs)(na.D,{className:"wpqt-mb-3",children:[(0,n.jsx)(ia.JU,Object.assign({className:"wpqt-mb-2 wpqt-block wpqt-text-sm/6 wpqt-font-medium"},o,{children:e})),t,i&&(0,n.jsx)(la,{id:s})]})}function qa({onSave:e,saveBtnText:t,loading:s=!1}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-px-2",children:(0,n.jsx)(da,{btnText:t,loading:s,onClick:e})})}!function(e){e.BUTTON="button",e.SUBMIT="submit",e.RESET="reset"}(ea||(ea={})),function(e){e.PRIMARY="primary",e.SECONDARY="secondary",e.DANGER="danger"}(ta||(ta={}));var xa=s(1489),ga=s(8448),va=s(8176),_a=s(1052),ka=s(4353),ja=s.n(ka),ya=s(4461);function ba(){const[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1);return{loading1:e,loading2:s,setLoading1:t,setLoading2:n,loading3:i,setLoading3:o}}const Ta=(e,t)=>{switch(t.type){case"SET_SITE_URL":{const s=t.payload;return Object.assign(Object.assign({},e),{siteURL:s})}case Le:{const{siteURL:s,publicUserPageId:a,timezone:n,isUserAllowedToDelete:i,userPageCustomStyles:o,pluginURL:r,taskUploadsURL:c}=t.payload;return Object.assign(Object.assign({},e),{siteURL:s,publicUserPageId:a,timezone:n,isUserAllowedToDelete:i,userPageCustomStyles:o,pluginURL:r,taskUploadsURL:c})}case Re:{const s=t.payload;return Object.assign(Object.assign({},e),{userPageCustomStyles:s})}default:return e}},Ea={siteURL:"",pluginURL:"",publicUserPageId:"",is_customFields:!1,timezone:"",isUserAllowedToDelete:!1,userPageCustomStyles:"",taskUploadsURL:""},Sa=(0,a.createContext)({state:Ea,appDispatch:()=>{}}),Aa=({children:e})=>{const[t,s]=(0,a.useReducer)(Ta,Ea);return(0,a.useEffect)((()=>{const e=window.wpqt.siteURL,t=window.wpqt.publicUserPageId,a=window.wpqt.timezone,n="1"===window.wpqt.isUserAllowedToDelete,i=window.wpqt.userPageCustomStyles,o=window.wpqt.pluginURL,r=window.wpqt.taskUploadsURL;s({type:Le,payload:{siteURL:e,publicUserPageId:t,timezone:a,isUserAllowedToDelete:n,userPageCustomStyles:i,pluginURL:o,taskUploadsURL:r}})}),[]),(0,n.jsx)(Sa.Provider,{value:{state:t,appDispatch:s},children:e})};var Na=s(8569),Ca=s.n(Na),Oa=s(3826),Ia=s.n(Oa);ja().extend(Ia()),ja().extend(Ca());const Da=()=>{const{state:{timezone:e}}=(0,a.useContext)(Sa);return{convertToWPTimezone:t=>((e,t)=>{try{return ja().utc(e).tz(t).format("MMMM D, YYYY HH:mm")}catch(t){return console.error("Error: ",t),e+" (UTC)"}})(t,e),convertUTCDateTimeToWPTimezone:t=>((e,t)=>{try{return ja().utc(e).tz(t).toDate()}catch(t){return console.error("Error: ",t),new Date(e)}})(t,e)}};var Pa,La,Ra;!function(e){e.Text="text",e.Select="select",e.Checkbox="checkbox",e.Radio="radio",e.Datetime="datetime",e.File="file"}(Pa||(Pa={})),function(e){e.User="user",e.Pipeline="pipeline",e.Users="users",e.Task="task"}(La||(La={})),function(e){e.TASK="task"}(Ra||(Ra={}));var Ma=s(1062),Ua=s(4164);function Fa({value:e,onChange:t,rowsCount:s=3,colsCount:a,className:i=""}){return(0,n.jsx)(Ma.T,{className:(0,Ua.$)("wpqt-border-1 wpqt-mb-3 wpqt-block wpqt-w-auto wpqt-resize-none wpqt-rounded-lg wpqt-border-qtBorder wpqt-px-3 wpqt-py-1.5 wpqt-text-sm/6",`focus:wpqt-shadow-none focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${i}`),rows:s,cols:a,value:e,onChange:e=>t(e.target.value)})}var $a=s(303);function za({checked:e,handleChange:t,id:s}){return(0,n.jsx)($a.A,{onChange:t,checked:e,uncheckedIcon:!1,checkedIcon:!1,height:20,width:44,id:s})}const Ka=(e,t)=>{switch(t.type){case et:{const s=t.payload;return Object.assign(Object.assign({},e),{loading:s})}case tt:{const{entityId:s,entityType:a}=t.payload;return Object.assign(Object.assign({},e),{entityId:s,entityType:a})}case Je:{const s=t.payload;return Object.assign(Object.assign({},e),{customFields:s})}case Xe:{const s=t.payload;return Object.assign(Object.assign({},e),{customFields:[...e.customFields,s]})}case Ze:{const s=t.payload,a=e.customFields.filter((e=>e.id!==s));return Object.assign(Object.assign({},e),{customFields:a})}default:return e}};const Va={customFields:[],loading:!0,entityId:"",entityType:null},Ga=(0,a.createContext)({state:Va,customFieldsDispatch:()=>{},fetchCustomFields:()=>{}}),Ba=({children:e,entityId:t,entityType:s})=>{const[r,c]=(0,a.useReducer)(Ka,Va);(0,a.useEffect)((()=>{l()}),[]),(0,a.useEffect)((()=>{c({type:tt,payload:{entityType:s,entityId:t}})}),[s,t]);const l=()=>{return e=void 0,a=void 0,r=function*(){try{c({type:et,payload:!0});const e=yield x(t,s,!0);c({type:Je,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch custom fields","quicktasker"))}finally{c({type:et,payload:!1})}},new((n=void 0)||(n=Promise))((function(t,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}c((r=r.apply(e,a||[])).next())}));var e,a,n,r};return(0,n.jsx)(Ga.Provider,{value:{state:r,customFieldsDispatch:c,fetchCustomFields:l},children:e})};var Ha=s(9197),Wa=s(2767),Qa=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ya(){return{addCustomField:(e,t,s,a,n,r)=>Qa(this,void 0,void 0,(function*(){try{const i=yield function(e,t,s,a,n){return u()({path:"/wpqt/v1/custom-fields",method:"POST",data:{entityId:e,entityType:t,type:s,name:a,description:n},headers:p()})}(e,t,s,a,n);r&&r(i.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add a custom field","quicktasker"))}})),markCustomFieldAsDeleted:(e,t)=>Qa(this,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/custom-fields/${e}`,method:"DELETE",headers:p()})}(e),t&&t()}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to mark custom field as deleted","quicktasker"))}})),restoreCustomField:(e,t)=>Qa(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/custom-fields/${e}/restore`,method:"PATCH",headers:p()})}(e);i.oR.success((0,o.__)("Custom field restored","quicktasker")),t&&t(s.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to restore custom field","quicktasker"))}})),updateCustomFieldValue:(e,t,s,a,n)=>Qa(this,void 0,void 0,(function*(){try{yield function(e,t,s,a){return u()({path:`/wpqt/v1/custom-fields/${e}/value`,method:"PATCH",data:{value:t,entityId:String(s),entityType:a},headers:p()})}(e,t,s,a),n&&n()}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to update custom field value","quicktasker"))}}))}}function Ja({title:e,description:t,className:s=""}){return(0,n.jsxs)("div",{className:`wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center wpqt-h-full ${s}`,children:[e&&(0,n.jsx)("h2",{className:"wpqt-font-semibold",children:e}),t&&(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-4",children:t}),(0,n.jsx)("div",{className:"wpqt-text-blue-500 wpqt-font-semibold",children:(0,n.jsx)("a",{href:"https://payhip.com/b/84TLC",target:"_blank",rel:"noreferrer",children:(0,o.__)("Get the premium version","quicktasker")})})]})}var Xa=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Za({description:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(!1),[d,u]=(0,a.useState)(Pa.Text),{addCustomField:p}=Ya(),{state:{entityId:m,entityType:h,customFields:w,loading:f},customFieldsDispatch:q}=(0,a.useContext)(Ga),{state:{is_customFields:x}}=(0,a.useContext)(Sa),[g,v]=(0,a.useState)(!1),_=[{value:Pa.Text,label:"Text"},{value:Pa.Checkbox,label:"Checkbox"}],k=w.length>=1&&!x;return f?null:(0,n.jsxs)("div",{className:"wpqt-mb-6 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom Fields","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-text-center",children:[e,!x&&(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[" ",(0,o.__)("Free version allows only one custom field. To add more, please upgrade to premium.","quicktasker")]})]}),c&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(ms,{value:t,onChange:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Description","quicktasker")}),(0,n.jsx)(Fa,{value:i,onChange:r})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Type","quicktasker")}),(0,n.jsx)(_s,{selectedOptionValue:d,options:_,onSelectionChange:e=>{u(e)},allSelector:!1})]})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:[!k&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ua,{text:c?(0,o.__)("Cancel","quicktasker"):(0,o.__)("Add new custom field","quicktasker"),onClick:()=>l(!c),icon:c?(0,n.jsx)(Ha.A,{className:"wpqt-icon-red wpqt-size-5"}):(0,n.jsx)(Wa.A,{className:"wpqt-icon-green wpqt-size-5"})}),c&&(0,n.jsx)(ua,{text:(0,o.__)("Add","quicktasker"),onClick:()=>Xa(this,void 0,void 0,(function*(){m&&h?(v(!0),yield p(m,h,d,t,i,(e=>{q({type:Xe,payload:e}),s(""),r(""),u(Pa.Text),l(!1)})),v(!1)):console.error("Entity ID or Entity Type is missing")})),loading:g,icon:(0,n.jsx)(Wa.A,{className:"wpqt-icon-green wpqt-size-5"})})]}),k&&(0,n.jsx)(Ja,{})]})]})}var en=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function tn({data:e,onSave:t,locationOfCustomFields:s,onDelete:i,actionLoading:r}){const{state:{isUserAllowedToDelete:c}}=(0,a.useContext)(Sa),l=e.entity_type===s,d=s===La.Task||s===La.User,u=e.entity_type===La.Pipeline?"board":e.entity_type;return r?(0,n.jsx)(ls,{ovalSize:"24"}):(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-gap-2",children:[d&&(0,n.jsx)(da,{onClick:t,btnText:(0,o.__)("Save","quicktasker")}),c&&(0,n.jsx)(ua,Object.assign({onClick:()=>en(this,void 0,void 0,(function*(){l&&i()})),className:l?"":"!wpqt-cursor-not-allowed",icon:(0,n.jsx)(va.A,{className:"wpqt-icon-red wpqt-size-4"})},!l&&{tooltipId:`custom-field-${e.id}-delete`,tooltipText:(0,o.sprintf)((0,o.__)("This custom field is inherited from %s settings and can't be deleted here","quicktasker"),u)}))]})}var sn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function an({data:e}){const[t,s]=(0,a.useState)(""),{state:{entityType:i,entityId:o},customFieldsDispatch:r}=(0,a.useContext)(Ga),{updateCustomFieldValue:c,markCustomFieldAsDeleted:l}=Ya(),[d,u]=(0,a.useState)(!1);let p;switch((0,a.useEffect)((()=>{e.value&&s(e.value)}),[e.value]),e.type){case Pa.Text:p=(0,n.jsx)(nn,{data:e,value:t,onChange:s});break;case Pa.Checkbox:p=(0,n.jsx)(on,{data:e,value:t,onChange:s})}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{}),p,(0,n.jsx)(tn,{data:e,locationOfCustomFields:i,onSave:()=>sn(this,void 0,void 0,(function*(){i===La.User||i===La.Task?(u(!0),yield c(e.id,t,o,i),u(!1)):console.error("Invalid entity type for saving custom field value")})),onDelete:()=>sn(this,void 0,void 0,(function*(){u(!0),yield l(e.id,(()=>{r({type:Ze,payload:e.id})})),u(!1)})),actionLoading:d})]})}function nn({data:e,value:t,onChange:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center",children:[(0,n.jsx)(rn,{name:e.name,description:e.description}),(0,n.jsx)(ms,{value:t,onChange:s})]})}function on({data:e,value:t,onChange:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(rn,{name:e.name,description:e.description}),(0,n.jsx)("input",{type:"checkbox",checked:"true"===t,className:"!wpqt-block",onChange:e=>s(e.target.checked?"true":"false")})]})}function rn({name:e,description:t=""}){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-mb-1 wpqt-text-base wpqt-font-semibold",children:e}),t&&(0,n.jsx)("div",{className:"wpqt-mb-2 wpqt-italic",children:t})]})}function cn(){const{state:{loading:e,customFields:t}}=(0,a.useContext)(Ga);return e?(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(rs,{width:"36",height:"36"})}):t&&0===t.length?(0,n.jsx)("div",{className:"wpqt-text-center wpqt-font-semibold",children:(0,o.__)("No related custom fields created","quicktasker")}):(0,n.jsx)("div",{className:"wpqt-my-4 wpqt-grid wpqt-grid-cols-[100px_1fr_100px] wpqt-items-center wpqt-gap-3",children:t.map((e=>(0,n.jsx)(an,{data:e},e.id)))})}var ln=s(5066);const dn={[La.Pipeline]:(0,o.__)("Board","quicktasker"),[La.Task]:(0,o.__)("Task","quicktasker"),[La.User]:(0,o.__)("User","quicktasker"),[La.Users]:(0,o.__)("Global users","quicktasker")};var un=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function pn({customField:e,refreshDeletedFields:t}){const{customFieldsDispatch:s}=(0,a.useContext)(Ga),[i,r]=(0,a.useState)(!1),{restoreCustomField:c}=Ya(),{convertToWPTimezone:l}=Da();return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Name:","quicktasker")})," ",e.name]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Description:","quicktasker")})," ",e.description]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Level:","quicktasker")})," ",dn[e.entity_type]]}),e.deleted_at&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Deleted:","quicktasker")})," ",l(e.deleted_at)]}),(0,n.jsx)("div",{children:(0,n.jsx)(pa,{onClick:()=>un(this,void 0,void 0,(function*(){r(!0),yield c(e.id,(e=>{s({type:Xe,payload:e}),t()})),r(!1)})),loading:i,icon:(0,n.jsx)(ln.HCd,{className:"wpqt-icon-green wpqt-size-5"})})})]})}var mn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function hn(){const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(!0),[c,l]=(0,a.useState)(null),{state:{entityId:d,entityType:u}}=(0,a.useContext)(Ga);(0,a.useEffect)((()=>{e&&p()}),[e]);const p=()=>mn(this,void 0,void 0,(function*(){if(d&&u)try{r(!0);const e=yield x(d,u,!1);l(e.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load deleted custom fields","quicktasker"))}finally{r(!1)}else console.error("Entity ID or Entity Type is missing")}));return(0,n.jsxs)("div",{className:"wpqt-my-3 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom Field recovery","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:(0,o.__)("Deleted custom field by accident? No worries! You can recover it here.","quicktasker")}),e&&(0,n.jsx)("div",{className:"wpqt-mb-3",children:s?(0,n.jsx)(ls,{ovalSize:"36"}):c&&0===c.length?(0,n.jsx)("div",{className:"wpqt-text-center wpqt-font-semibold",children:(0,o.__)("No deleted custom fields","quicktasker")}):c&&c.length>0?(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:c.map((e=>(0,n.jsx)(pn,{customField:e,refreshDeletedFields:p},e.id)))}):null}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:(0,n.jsx)(ua,{text:e?(0,o.__)("Close recovery","quicktasker"):(0,o.__)("Open recovery","quicktasker"),onClick:()=>t(!e),icon:(0,n.jsx)(ln.HCd,{className:"wpqt-icon-green wpqt-size-5"})})})]})}const wn={[La.User]:(0,o.__)("Add user-specific custom fields. If you want to add custom fields to all users, please go to users settings.","quicktasker"),[La.Users]:(0,o.__)("Add custom fields to all users. If you want to add custom fields to a specific user only, please go to that user settings.","quicktasker"),[La.Pipeline]:(0,o.__)("Add board level custom fields.","quicktasker"),[La.Task]:(0,o.__)("Add task-specific custom fields. If you want to add custom fields to all tasks in this board, please go to board settings.","quicktasker")},fn={[La.User]:(0,o.__)("Custom fields applied to this user, including both user-specific and global users fields.","quicktasker"),[La.Users]:(0,o.__)("Global user custom field are applied to all users.","quicktasker"),[La.Pipeline]:(0,o.__)("Board level fields are applied to all tasks in this board.","quicktasker"),[La.Task]:(0,o.__)("Custom fields applied to this task, including both task-specific and board-level fields.","quicktasker")},qn={[La.User]:(0,o.__)("User custom fields","quicktasker"),[La.Users]:(0,o.__)("Global users custom fields","quicktasker"),[La.Pipeline]:(0,o.__)("Board custom fields","quicktasker"),[La.Task]:(0,o.__)("Task custom fields","quicktasker")};function xn({entityId:e,entityType:t}){const s=wn[t],a=qn[t],i=fn[t];return(0,n.jsx)("div",{children:(0,n.jsxs)(Ba,{entityId:e,entityType:t,children:[(0,n.jsx)("h2",{className:"wpqt-text-center",children:a}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:i}),(0,n.jsx)(cn,{}),(0,n.jsx)(Za,{description:s}),(0,n.jsx)(hn,{})]})})}var gn=s(5785);function vn({children:e,inlineStyle:t,className:s=""}){return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-py-1 wpqt-px-2 wpqt-font-semibold wpqt-text-xs wpqt-leading-none wpqt-shopping-tag ${s}`,style:t,children:e})}var _n=s(2185);function kn({children:e,menuBtn:t,menuBtnClasses:s="",anchor:a="bottom end"}){return(0,n.jsxs)(_n.W1,{children:[(0,n.jsx)(_n.IU,{as:"div",className:`wpqt-cursor-pointer ${s}`,onClick:e=>e.stopPropagation(),children:({active:e})=>(0,n.jsx)(n.Fragment,{children:t({active:e})})}),(0,n.jsx)(_n.c,{anchor:a,transition:!0,className:"wpqt-z-20 wpqt-origin-top wpqt-rounded-xl wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-bg-white wpqt-p-4 wpqt-transition wpqt-duration-200 wpqt-ease-out data-[closed]:wpqt-scale-95 data-[closed]:wpqt-opacity-0",children:e})]})}function jn({isActive:e,IconComponent:t}){return(0,n.jsx)(t,{className:"wpqt-size-6 wpqt-text-gray-400 hover:wpqt-text-qtBlueHover "+(e?"wpqt-text-qtBlueHover":"")})}function yn({text:e,onClick:t,icon:s,className:a,disabled:i=!1,id:o="",tooltipText:r="",loading:c=!1}){const l=""!==r&&""!==o?{"data-tooltip-id":o,"data-tooltip-content":r,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info"}:{};return(0,n.jsx)(_n.Dr,{children:(0,n.jsxs)("div",Object.assign({},l,{className:`wpqt-mb-3 wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-relative ${i?"wpqt-cursor-not-allowed wpqt-line-through":"wpqt-cursor-pointer hover:wpqt-underline"} ${a}`,onClick:e=>{!i&&t&&t(e)},children:[s,(0,n.jsx)("span",{className:c?"wpqt-invisible":"",children:e}),c&&(0,n.jsx)(rs,{width:"16",height:"16",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-y-center wpqt-transform-x-center"}),(0,n.jsx)(la,{id:o})]}))})}var bn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};var Tn=s(3858);function En({labelCreated:e,loading:t=!1}){const{labelDispatch:s}=(0,a.useContext)(ns),[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)("");return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Create new label","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(js,{labelFor:"new-label-name",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(ms,{value:i,onChange:r,inputId:"new-label-name"})]}),(0,n.jsx)(Tn.A,{color:c,disableAlpha:!0,onChange:e=>{l(e.hex)}}),(0,n.jsx)(da,{btnText:(0,o.__)("Create","quicktasker"),onClick:()=>{i&&c&&e(i,c)},loading:t}),(0,n.jsx)(da,{btnText:(0,o.__)("Cancel","quicktasker"),buttonStyleType:ta.SECONDARY,onClick:()=>{s({type:ot})}})]})}var Sn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function An({labelToEdit:e,editLabel:t,deleteLabe:s,closeEdit:i=()=>{}}){if(!e)return null;const[r,c]=(0,a.useState)(Object.assign({},e)),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Edit label","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(js,{labelFor:"edit-label-name",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(ms,{value:r.name,onChange:e=>{c(Object.assign(Object.assign({},r),{name:e}))},inputId:"edit-label-name"})]}),(0,n.jsx)(Tn.A,{color:r.color,disableAlpha:!0,onChange:e=>{c(Object.assign(Object.assign({},r),{color:e.hex}))}}),(0,n.jsx)(da,{btnText:(0,o.__)("Save","quicktasker"),onClick:()=>Sn(this,void 0,void 0,(function*(){r.name&&r.color&&(d(!0),yield t(r),d(!1))})),loading:l}),(0,n.jsx)(da,{btnText:(0,o.__)("Delete","quicktasker"),onClick:()=>Sn(this,void 0,void 0,(function*(){p(!0),yield s(r.id),p(!1)})),loading:u,buttonStyleType:ta.DANGER}),(0,n.jsx)(da,{btnText:(0,o.__)("Cancel","quicktasker"),buttonStyleType:ta.SECONDARY,onClick:i})]})}var Nn=s(2601),Cn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function On({labels:e,title:t,labelSelected:s,labelDeSelection:i,loading:r=!1}){const{labelDispatch:c}=(0,a.useContext)(ns);return e?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-4",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:t}),r?(0,n.jsx)(ls,{ovalSize:"24"}):0===e.length?(0,n.jsx)("div",{className:"wpqt-text-gray-500",children:(0,o.__)("There are no labels created for this board","quicktasker")}):e.map((e=>(0,n.jsx)(In,{label:e,labelSelected:s,labelDeSelection:i},e.id))),(0,n.jsx)(da,{btnText:(0,o.__)("Create new label","quicktasker"),className:"wpqt-mt-3",buttonStyleType:ta.SECONDARY,onClick:()=>{c({type:ct})}})]}):null}function In({label:e,labelSelected:t,labelDeSelection:s}){const{labelDispatch:i}=(0,a.useContext)(ns),[o,r]=(0,a.useState)(e.selected);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-between wpqt-gap-2 wpqt-w-full",children:[(0,n.jsx)("input",{type:"checkbox",checked:o,onChange:a=>Cn(this,void 0,void 0,(function*(){const n=a.target.checked;r(n),n?t(e.id):s(e.id)}))}),(0,n.jsx)(vn,{inlineStyle:{backgroundColor:e.color},className:"wpqt-py-2",children:e.name}),(0,n.jsx)(Nn.A,{className:"wpqt-size-5 wpqt-icon-green wpqt-cursor-pointer",onClick:()=>{i({type:rt,payload:e})}})]})}var Dn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Pn=(0,a.memo)((({task:e,labelSelected:t,labelDeselected:s,labelDeleted:r})=>{const{state:{labels:c,labelActionState:l,labelToEdit:d},labelDispatch:m}=(0,a.useContext)(ns),{archiveDispatch:h}=(0,a.useContext)(Zt),{dispatch:w}=(0,a.useContext)(Ns),[f,q]=(0,a.useState)(!0),[x,g]=(0,a.useState)(!1),{getPipelineLabels:v,createPipelineLabel:_,assignLabelToTask:k,usassignLabelFromTask:j,editLabel:y,deleteLabel:b}=function(){return{deleteLabel:(e,t,s)=>bn(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/labels/${t}`,method:"DELETE",headers:p()})}(e,t);i.oR.success((0,o.__)("Label deleted from the board","quicktasker")),s&&s(!0,a.data.deletedLabel)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete label","quicktasker")),s&&s(!1)}})),getPipelineLabels:(e,t)=>bn(this,void 0,void 0,(function*(){try{const a=yield(s=e,u()({path:`/wpqt/v1/pipelines/${s}/labels`,method:"GET",headers:p()}));t&&t(!0,a.data.labels)}catch(e){console.error(e),t&&t(!1)}var s})),createPipelineLabel:(e,t,s,a)=>bn(this,void 0,void 0,(function*(){try{const n=yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/labels`,method:"POST",headers:p(),data:{name:t,color:s}})}(e,t,s);i.oR.success((0,o.__)("Label created successfully","quicktasker")),a&&a(!0,n.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create label","quicktasker")),a&&a(!1)}})),editLabel:(e,t,s)=>bn(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/labels/${t.id}`,method:"PATCH",headers:p(),data:{name:t.name,color:t.color}})}(e,t);i.oR.success((0,o.__)("Label updated successfully","quicktasker")),s&&s(!0,a.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to update label","quicktasker")),s&&s(!1)}})),assignLabelToTask:(e,t,s,a)=>bn(this,void 0,void 0,(function*(){try{const n=yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/tasks/${t}/labels`,method:"POST",headers:p(),data:{labelId:s}})}(e,t,s);i.oR.success((0,o.__)("Label added to task","quicktasker")),a&&a(!0,n.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add label to task","quicktasker")),a&&a(!1)}})),usassignLabelFromTask:(e,t,s,a)=>bn(this,void 0,void 0,(function*(){try{yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/tasks/${t}/labels/${s}`,method:"DELETE",headers:p()})}(e,t,s),i.oR.success((0,o.__)("Label removed from task","quicktasker")),a&&a(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to remove label from task","quicktasker")),a&&a(!1)}}))}}();(0,a.useEffect)((()=>(Dn(void 0,void 0,void 0,(function*(){q(!0),yield v(e.pipeline_id,((e,t)=>{e&&t&&m({type:st,payload:t})})),q(!1)})),()=>{m({type:lt})})),[]);const T=()=>{const t=e.assigned_labels||[];return(c||[]).map((e=>Object.assign(Object.assign({},e),{selected:t.some((t=>t.id===e.id))})))},E=s=>Dn(void 0,void 0,void 0,(function*(){yield k(e.pipeline_id,e.id,s,((s,a)=>{s&&a&&(w({type:M,payload:{taskId:e.id,label:a}}),h({type:Te,payload:{taskId:e.id,label:a}}),t(a))}))})),S=t=>Dn(void 0,void 0,void 0,(function*(){yield j(e.pipeline_id,e.id,t,(a=>{a&&(w({type:U,payload:{taskId:e.id,labelId:t}}),h({type:Ee,payload:{taskId:e.id,labelId:t}}),s(t))}))})),A=(t,s)=>Dn(void 0,void 0,void 0,(function*(){g(!0),yield _(e.pipeline_id,t,s,((e,t)=>{e&&t&&m({type:at,payload:t})})),g(!1)})),N=t=>Dn(void 0,void 0,void 0,(function*(){yield y(e.pipeline_id,t,((e,t)=>{e&&t&&(m({type:it,payload:t}),w({type:F,payload:{label:t}}))}))})),C=t=>Dn(void 0,void 0,void 0,(function*(){yield b(e.pipeline_id,t,((e,s)=>{e&&s&&(m({type:ot}),m({type:nt,payload:s}),w({type:$,payload:t}),r(t))}))}));return(0,n.jsx)("div",{className:"wpqt-min-w-56 wpqt-flex wpqt-flex-col wpqt-gap-4",onClick:e=>e.stopPropagation(),children:(()=>{switch(l){case ts.SELECTION:return(0,n.jsx)(On,{title:(0,o.__)("Task label selection","quicktasker"),labels:T(),loading:f,labelSelected:E,labelDeSelection:S});case ts.CREATION:return(0,n.jsx)(En,{labelCreated:A,loading:x});case ts.EDIT:return(0,n.jsx)(An,{labelToEdit:d,editLabel:N,deleteLabe:C,closeEdit:()=>{m({type:ot})}});default:return null}})()})}));function Ln({task:e,labelSelected:t=()=>{},labelDeselected:s=()=>{},labelDeleted:a=()=>{}}){const i=e.assigned_labels||[],o=Array.isArray(i)&&i.length>0;return(0,n.jsx)(kn,{menuBtnClasses:"wpqt-inline-flex",anchor:"bottom start",menuBtn:()=>(0,n.jsxs)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1.5",children:[(0,n.jsx)(gn.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`}),o&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-flex-wrap",children:i.map((e=>(0,n.jsx)(vn,{inlineStyle:{backgroundColor:e.color},children:e.name},e.id)))})]}),children:e&&(0,n.jsx)(Pn,{task:e,labelSelected:t,labelDeselected:s,labelDeleted:a})})}var Rn=s(2792),Mn=s(6797),Un=s(4403);function Fn({sectionTitle:e,onItemSelect:t=()=>{},users:s=[],ActionIcon:a=Un.A,actionIconClasses:i,noUsersText:o}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2 wpqt-text-lg",children:e}),s.map(((e,s)=>{var o;return(0,n.jsxs)("div",{onClick:s=>{s.stopPropagation(),t(e)},className:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-px-2 wpqt-py-1 hover:wpqt-bg-gray-100",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("div",{children:e.name}),(0,n.jsx)("div",{className:"wpqt-italic",children:e.description}),Mt(e)&&(0,n.jsx)("div",{children:null===(o=e.roles)||void 0===o?void 0:o.join(",")})]}),(0,n.jsx)(a,{className:`wpqt-ml-auto wpqt-size-5 ${i}`})]},s)})),0===s.length&&(0,n.jsx)("div",{children:o})]})}var $n=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function zn({task:e,onUserAdd:t,onUserDelete:s}){const{state:{users:r,wpUsers:c}}=(0,a.useContext)(Bs),{handleExecutedAutomations:l}=Ds(),{dispatch:d}=(0,a.useContext)(Ns),[m,h]=(0,a.useState)(!1),w=r.filter((t=>{var s;return!(null!==(s=e.assigned_users)&&void 0!==s?s:[]).some((e=>e.id===t.id))})),f=c.filter((t=>{var s;return!(null!==(s=e.assigned_wp_users)&&void 0!==s?s:[]).some((e=>e.id===t.id))})),x=s=>$n(this,void 0,void 0,(function*(){try{h(!0);const a=s.user_type,n=yield function(e,t,s){return u()({path:`/wpqt/v1/users/${e}/tasks/${t}`,method:"POST",data:{user_type:s},headers:p()})}(s.id,e.id,a);d({type:C,payload:{taskId:e.id,user:s}}),t(s),l(n.data.executedAutomations,e.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to assign user","quicktasker"))}finally{h(!1)}})),g=t=>$n(this,void 0,void 0,(function*(){try{h(!0);const a=t.user_type,n=yield q(t.id,e.id,a);d({type:O,payload:{taskId:e.id,userId:t.id,userType:a}}),s(t),l(n.data.executedAutomations,e.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to remove user","quicktasker"))}finally{h(!1)}}));return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-w-[320px] wpqt-flex-col",children:[(0,n.jsx)(Fn,{sectionTitle:(0,o.__)("Assigned quicktaskers","quicktasker"),users:e.assigned_users,onItemSelect:g,ActionIcon:Mn.A,actionIconClasses:"wpqt-icon-red",noUsersText:(0,o.__)("No quicktaskers assigned","quicktasker")}),(0,n.jsx)(Fn,{sectionTitle:(0,o.__)("Assigned WordPress users","quicktasker"),users:e.assigned_wp_users,onItemSelect:g,ActionIcon:Mn.A,actionIconClasses:"wpqt-icon-red",noUsersText:(0,o.__)("No WordPress users assigned","quicktasker")}),(0,n.jsx)(Fn,{sectionTitle:(0,o.__)("Assign a quicktasker","quicktasker"),users:w,onItemSelect:x,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No quicktaskers available to assign","quicktasker")}),(0,n.jsx)(Fn,{sectionTitle:(0,o.__)("Assign a WordPress user","quicktasker"),users:f,onItemSelect:x,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No WordPress users with required permissions available to assign","quicktasker")}),m&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(rs,{width:"30",height:"30"})})]})}function Kn({task:e,onUserAdd:t=()=>{},onUserDelete:s=()=>{},menuBtnClasses:a=""}){const i=[...e.assigned_users||[],...e.assigned_wp_users||[]],o=i.length>0;return(0,n.jsx)(kn,{menuBtnClasses:`wpqt-inline-flex ${a}`,anchor:"bottom start",menuBtn:()=>(0,n.jsxs)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1",children:[(0,n.jsx)(Rn.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`}),o&&(0,n.jsx)("div",{children:i.map(((e,t)=>(0,n.jsxs)("span",{children:[e.name,t<i.length-1&&", "]},t)))})]}),children:(0,n.jsx)(zn,{task:e,onUserAdd:t,onUserDelete:s})})}var Vn=s(1848);function Gn({tabs:e,tabsContent:t,tabClassName:s="",tabListClassName:a=""}){return(0,n.jsxs)(Vn.fu,{children:[(0,n.jsx)(Vn.wb,{className:`wpqt-mb-6 wpqt-flex wpqt-border-0 wpqt-border-b wpqt-border-solid wpqt-border-b-gray-300 ${a}`,children:e.map((e=>(0,n.jsx)(Bn,{className:s,children:e},e)))}),(0,n.jsx)(Vn.T2,{children:t.map(((e,t)=>(0,n.jsx)(Hn,{children:e},t)))})]})}function Bn({children:e,className:t}){return(0,n.jsx)(Vn.oz,{as:"div",className:`wpqt-flex-1 wpqt-cursor-pointer wpqt-p-1 wpqt-pb-[10px] wpqt-text-center wpqt-text-lg data-[selected]:wpqt-border-b-2 data-[selected]:wpqt-border-l-0 data-[selected]:wpqt-border-r-0 data-[selected]:wpqt-border-t-0 data-[selected]:wpqt-border-solid data-[selected]:wpqt-border-b-blue-500 ${t}`,children:e})}function Hn({children:e}){return(0,n.jsx)(Vn.Kp,{children:e})}const Wn={[Gt.Admin]:(0,o.__)("Admin","quicktasker"),[Gt.Automation]:(0,o.__)("Automation","quicktasker"),[Gt.System]:(0,o.__)("System","quicktasker"),[Gt.WPQTUser]:"Quicktasker",[Gt.Import]:(0,o.__)("Import","quicktasker")},Qn=({log:e,showStatus:t=!1})=>{const{convertToWPTimezone:s}=Da(),a=Wn[e.created_by];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-1",children:e.author_name}),(0,n.jsx)("div",{className:"wpqt-text-center",children:a})]}),(0,n.jsx)("div",{children:s(e.created_at)}),t&&(0,n.jsx)("div",{children:e.log_status}),(0,n.jsx)("div",{children:e.text})]})};function Yn({title:e}){return(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-lg wpqt-underline",children:e})}var Jn=s(3338),Xn=s(3211);const Zn={success:"wpqt-bg-green-100 wpqt-border-green-400 wpqt-text-green-700",error:"wpqt-bg-red-100 wpqt-border-red-400 wpqt-text-red-700",warning:"wpqt-bg-yellow-100 wpqt-border-yellow-400 wpqt-text-yellow-700",info:"wpqt-bg-blue-100 wpqt-border-blue-400 wpqt-text-blue-700",primary:"wpqt-bg-gray-100 wpqt-border-gray-400 wpqt-text-gray-700"};function ei({type:e="primary",className:t="",children:s}){const a=Zn[e];return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-p-2 wpqt-border wpqt-border-solid wpqt-rounded-md ${a} ${t}`,children:s})}var ti=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function si({typeId:e,fetchData:t,renderItem:s,noDataMessage:i,explanation:r,onAdd:c=()=>ti(this,void 0,void 0,(function*(){})),enableAdd:l=!1}){const[d,u]=(0,a.useState)(null),[p,m]=(0,a.useState)(""),[h,w]=(0,a.useState)(!0),[f,q]=(0,a.useState)(!1);(0,a.useEffect)((()=>{x()}),[e]);const x=()=>ti(this,void 0,void 0,(function*(){w(!0);const e=yield t();e&&u(e),w(!1)}));return null===d?(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(rs,{width:"30",height:"30"})}):(0,n.jsxs)("div",{children:[r&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(ei,{type:"info",className:"wpqt-mb-3 wpqt-text-center",children:r})}),0===d.length&&(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-text-center",children:i}),(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-mt-3 wpqt-flex wpqt-justify-center",children:(0,n.jsx)(ai,{isLoading:h,refreshComemnts:x})}),l&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-w-2/3 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(Fa,{rowsCount:3,value:p,onChange:e=>m(e),className:"wpqt-mb-4 wpqt-w-full"}),(0,n.jsx)(ua,{text:"Add comment",loading:f,onClick:()=>ti(this,void 0,void 0,(function*(){if(!p)return;q(!0);const e=yield c(p);e&&(u((t=>t?[e,...t]:[e])),m("")),q(!1)})),icon:(0,n.jsx)(Jn.A,{className:"wpqt-icon-blue wpqt-size-5"})})]})}),d.length>0&&(0,n.jsxs)("div",{className:"wpqt-mb-[28px] wpqt-mt-[56px] wpqt-logs-grid",children:[(0,n.jsx)(Yn,{title:(0,o.__)("Author","quicktasker")}),(0,n.jsx)(Yn,{title:(0,o.__)("Date","quicktasker")}),(0,n.jsx)(Yn,{title:(0,o.__)("Text","quicktasker")}),d.map((e=>s(e)))]})]})}function ai({isLoading:e,refreshComemnts:t}){return(0,n.jsx)(n.Fragment,{children:e?(0,n.jsx)(rs,{width:"32",height:"32"}):(0,n.jsx)(Xn.A,{className:"wpqt-icon-blue wpqt-size-8 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:t})})}function ni({item:e}){const{convertToWPTimezone:t}=Da(),s=null===e.author_name&&null===e.author_id;return(0,n.jsxs)(n.Fragment,{children:[!s&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-1",children:e.author_name}),(0,n.jsx)("div",{className:"wpqt-text-center",children:e.is_admin_comment?(0,o.__)("Admin","quicktasker"):(0,o.__)("QuickTasker","quicktasker")})]}),s&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-1",children:(0,o.__)("Unknown","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-text-center",children:(0,o.__)("Author not found","quicktasker")})]}),(0,n.jsx)("div",{children:t(e.created_at)}),(0,n.jsx)("div",{children:e.text})]})}var ii=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function oi({taskId:e}){return(0,n.jsx)(si,{typeId:e,fetchData:()=>ii(this,void 0,void 0,(function*(){try{return(yield f(e,Vt.Task)).data}catch(e){console.error(e),i.oR.error("Failed to get log")}})),renderItem:e=>(0,n.jsx)(Qn,{log:e}),noDataMessage:"No logs available",explanation:"Logs can be seen only by WordPress users (with required permissions)"})}var ri=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ci(){return{addComment:(e,t,s,a)=>ri(this,void 0,void 0,(function*(){try{const n=yield w(e,t,s,a);return i.oR.success((0,o.__)("Comment added","quicktasker")),n.data.newComment}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add comment","quicktasker"))}}))}}const li=e=>Object.assign(Object.assign({},e),{is_admin_comment:"1"===e.is_admin_comment});var di=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ui({taskId:e}){const{addComment:t}=ci();return(0,n.jsx)(si,{typeId:e,fetchData:()=>di(this,void 0,void 0,(function*(){try{return(yield h(e,Vt.Task,!0)).data.map(li)}catch(e){console.error(e),i.oR.error("Failed to load comments")}})),onAdd:s=>di(this,void 0,void 0,(function*(){const a=yield t(e,Vt.Task,!0,s);if(a)return li(a)})),renderItem:e=>(0,n.jsx)(ni,{item:e}),noDataMessage:"No comments available",explanation:"Comments that can be added and viewed only by WordPress users (with required permissions).",enableAdd:!0})}var pi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function mi({taskId:e}){const{addComment:t}=ci();return(0,n.jsx)(si,{typeId:e,fetchData:()=>pi(this,void 0,void 0,(function*(){try{return(yield h(e,Vt.Task,!1)).data.map(li)}catch(e){console.error(e),i.oR.error("Failed to load comments")}})),onAdd:s=>pi(this,void 0,void 0,(function*(){const a=yield t(e,Vt.Task,!1,s);if(a)return li(a)})),renderItem:e=>(0,n.jsx)(ni,{item:e}),noDataMessage:"No comments available",explanation:"Comments that can be added and viewed by WordPress users (with required permissions) and quicktaskers (in quicktasker user page) who have been assigned to the task.",enableAdd:!0})}function hi({task:e}){return(0,n.jsx)(Gn,{tabs:["Private comments","Public comments","Logs"],tabsContent:[(0,n.jsx)(ui,{taskId:e.id},1),(0,n.jsx)(mi,{taskId:e.id},2),(0,n.jsx)(oi,{taskId:e.id},3)]})}var wi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function fi(){return{getUplaods:(e,t)=>wi(this,void 0,void 0,(function*(){try{const s=yield function(e,t){const s=new URLSearchParams({entity_id:e,entity_type:t});return u()({path:`/wpqt/v1/uploads?${s.toString()}`,method:"GET"})}(e,t);return{data:s.data,error:null}}catch(e){return console.error(e),{data:null,error:e}}})),uploadFile:e=>wi(this,void 0,void 0,(function*(){try{const t=yield function(e){return u()({path:"/wpqt/v1/uploads",method:"POST",body:e})}(e);return i.oR.success((0,o.__)("File uploaded successfully","quicktasker")),{data:t.data,error:null}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to upload a file","quicktasker")),{data:null,error:e}}})),deleteUpload:e=>wi(this,void 0,void 0,(function*(){try{const t=yield function(e){return u()({path:`/wpqt/v1/uploads/${e}`,method:"DELETE"})}(e);return i.oR.success((0,o.__)("File deleted successfully","quicktasker")),{data:t.data,error:null}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to delete a file","quicktasker")),{data:null,error:e}}})),checkFileExists:e=>wi(this,void 0,void 0,(function*(){try{return(yield fetch(e,{method:"HEAD"})).ok}catch(e){return!1}}))}}var qi=s(2944),xi=s(4015);function gi({upload:e,menuBtnClasses:t=""}){const{state:{taskUploadsURL:s}}=(0,a.useContext)(Sa),i=`${s}/${e.upload_uuid}/${e.file_name}`;return(0,n.jsx)(kn,{menuBtnClasses:`wpqt-inline-flex ${t}`,anchor:"top",menuBtn:()=>(0,n.jsx)(xi.A,{className:"wpqt-size-5 wpqt-icon-blue"}),children:(0,n.jsxs)("div",{children:[(0,n.jsx)(vi,{title:(0,o.__)("File name","quicktasker"),children:e.file_name}),(0,n.jsx)(vi,{title:(0,o.__)("File link","quicktasker"),children:(0,n.jsx)("a",{href:i,target:"_blank",rel:"noreferrer",children:i})}),(0,n.jsx)(vi,{title:(0,o.__)("Created at","quicktasker"),children:e.created_at}),(0,n.jsx)(vi,{title:(0,o.__)("Created by","quicktasker"),children:e.uploader_name})]})})}function vi({title:e,children:t}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-uppercase",children:e}),(0,n.jsx)("div",{children:t})]})}var _i=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ki({upload:e}){const{state:{isUserAllowedToDelete:t,taskUploadsURL:s}}=(0,a.useContext)(Sa),{uploadDispatch:r}=(0,a.useContext)(Xs),[c,l]=(0,a.useState)(!1),{checkFileExists:d,deleteUpload:u}=fi(),p=`${s}/${e.upload_uuid}/${e.file_name}`,m=(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-4 wpqt-justify-end wpqt-items-center",children:[(0,n.jsx)("a",{href:p,download:!0,onClick:()=>_i(this,void 0,void 0,(function*(){(yield d(p))||i.oR.error((0,o.__)("File was not found","quicktasker"))})),className:"focus:wpqt-shadow-none",children:(0,n.jsx)(qi.A,{className:"wpqt-icon-blue wpqt-size-5 :hover:wpqt-text-blue-800 wpqt-cursor-pointer"})}),(0,n.jsx)(gi,{upload:e}),t&&(0,n.jsx)(va.A,{className:"wpqt-icon-red wpqt-size-5 :hover:wpqt-text-red-800 wpqt-cursor-pointer",onClick:()=>_i(this,void 0,void 0,(function*(){l(!0);const{data:t}=yield u(e.id);t&&r({type:kt,payload:e.id}),l(!1)}))})]});return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-main-border wpqt-p-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:e.file_name}),c?(0,n.jsx)(ls,{ovalSize:"22",className:"!wpqt-items-end"}):m]})}var ji=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function yi({entityId:e,entityType:t}){const{uploadDispatch:s}=(0,a.useContext)(Xs),[r,c]=(0,a.useState)(null),[l,d]=(0,a.useState)(!1),{uploadFile:u}=fi(),p=(0,a.useRef)(null);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsxs)("div",{className:"wpqt-max-w-[300px]",children:[(0,o.sprintf)((0,o.__)("Select file to upload (Max size: %d MB)","quicktasker"),At/1024/1024),(0,n.jsx)("br",{}),(0,o.__)("Allowed characters in file name: Latin letters, numbers, underscores, hyphens, and dots.","quicktasker")]}),(0,n.jsx)("input",{type:"file",onChange:e=>{if(e.target.files){const t=e.target.files[0];if(t.size>At)return void i.oR.error((0,o.sprintf)((0,o.__)("File size exceeds the maximum limit of %d MB","quicktasker"),At));if(!Nt.test(t.name))return void i.oR.error((0,o.__)("Invalid file name","quicktasker"));if(0===t.size)return void i.oR.error((0,o.__)("The selected file is empty","quicktasker"));c(t)}},ref:p,accept:St.join(",")}),r&&(0,n.jsx)(da,{btnText:(0,o.__)("Upload","quicktasker"),loading:l,onClick:()=>ji(this,void 0,void 0,(function*(){const a=(()=>{if(!r)return null;const s=new FormData;return s.append("file_to_upload",r),s.append("entity_id",e),s.append("entity_type",t),s})();if(a){d(!0);const{data:e}=yield u(a);e&&(s({type:_t,payload:e.upload}),c(null),p.current&&(p.current.value="")),d(!1)}}))})]})}function bi({entityId:e,entityType:t}){const{state:{uploads:s},uploadDispatch:r}=(0,a.useContext)(Xs),[c,l]=(0,a.useState)(!0),{getUplaods:d}=fi(),u=()=>{return s=this,a=void 0,c=function*(){l(!0);const{data:s,error:a}=yield d(e,t);l(!1),s&&s.uploads&&r({type:vt,payload:s.uploads}),a&&i.oR.error((0,o.__)("Failed to fetch uploads","quicktasker"))},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}r((c=c.apply(s,a||[])).next())}));var s,a,n,c};return(0,a.useEffect)((()=>{u()}),[]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(yi,{entityId:e,entityType:t}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-flex-wrap wpqt-items-start",children:c?(0,n.jsx)(ls,{ovalSize:"24"}):s.map((e=>(0,n.jsx)(ki,{upload:e},e.id)))})]})}var Ti=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Ei=(0,a.forwardRef)((({taskModalSaving:e,editTask:t,deleteTask:s},i)=>{const{state:{taskToEdit:r,taskModalSettings:c},modalDispatch:l}=(0,a.useContext)($s),{state:{isUserAllowedToDelete:d}}=(0,a.useContext)(Sa),{state:{activePipeline:u},fetchAndSetPipelineData:p}=(0,a.useContext)(Ns),{archiveDispatch:m}=(0,a.useContext)(Zt),[h,w]=(0,a.useState)(""),[f,q]=(0,a.useState)(""),[x,g]=(0,a.useState)(!1),[v,_]=(0,a.useState)(null),[k,j]=(0,a.useState)([]),{archiveTask:y,restoreArchivedTask:b}=Ls(),{loading1:T,setLoading1:E,loading2:S,setLoading2:A}=ba(),{convertUTCDateTimeToWPTimezone:N}=Da(),C=null==r?void 0:r.is_archived,O=null!==(null==r?void 0:r.pipeline_name);(0,a.useEffect)((()=>{if(r){const e=r.due_date?N(r.due_date):null;w(r.name),q(r.description),g(r.free_for_all),_(e),j(r.assigned_labels)}}),[r]);const I=()=>{w(""),q("")};return(0,a.useImperativeHandle)(i,(()=>({clearContent:I}))),r?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsxs)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:[(0,n.jsxs)("div",{className:"wpqt-mb-2 wpqt-grid wpqt-grid-cols-1 wpqt-gap-4 md:wpqt-grid-cols-[1fr_2fr]",children:[(0,n.jsxs)(wa,{children:[(0,n.jsx)(fa,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(ms,{isAutoFocus:!0,value:h,onChange:e=>w(e),wrapperClassName:"wpqt-w-full",className:"wpqt-w-full"})}),(0,n.jsx)(fa,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Fa,{rowsCount:3,value:f,className:"wpqt-w-full",onChange:e=>q(e)})}),(0,n.jsx)(fa,{label:(0,o.__)("Assigned users","quicktasker"),children:(0,n.jsx)(Kn,{task:r,onUserAdd:e=>{l({type:te,payload:e})},onUserDelete:e=>{l({type:se,payload:e})}})}),(0,n.jsx)(fa,{label:(0,o.__)("Labels","quicktasker"),children:(0,n.jsx)(Ln,{task:Object.assign(Object.assign({},r),{assigned_labels:k}),labelSelected:e=>{j((t=>[...t,e]))},labelDeselected:e=>{j((t=>t.filter((t=>t.id!==e))))},labelDeleted:e=>{j((t=>t.filter((t=>t.id!==e))))}})}),(0,n.jsx)(fa,{label:(0,o.__)("Free for all task","quicktasker"),tooltipId:`free-for-all-${r.id}-tooltip`,tooltipText:(0,o.__)("When enabled, all QuickTasker users have the ability to self-assign or unassign this task.","quicktasker"),children:(0,n.jsx)(za,{checked:x,handleChange:g})}),(0,n.jsx)(fa,{label:(0,o.__)("Due date","quicktasker"),children:(0,n.jsx)(ya.A,{onChange:e=>{_(e)},value:v,format:"y-MM-dd HH:mm"})}),c.allowToMarkTaskAsDone&&(0,n.jsx)(Si,{taskId:r.id,isCompleted:r.is_done})]}),(0,n.jsx)("div",{children:(0,n.jsx)(xn,{entityId:r.id,entityType:La.Task})})]}),(0,n.jsx)("div",{className:"wpqt-mb-4",children:(0,n.jsx)(qa,{onSave:()=>{r&&t(Object.assign(Object.assign({},r),{name:h,description:f,free_for_all:x,due_date:v?ja()(v).utc().format("YYYY-MM-DD HH:mm:ss"):null}))},saveBtnText:e?(0,o.__)("Saving...","quicktasker"):(0,o.__)("Save","quicktasker")})}),(0,n.jsx)(fa,{label:(0,o.__)("File attachment","quicktasker"),children:(0,n.jsx)(bi,{entityId:r.id,entityType:Ra.TASK})}),(0,n.jsx)("div",{className:"wpqt-mt-7 md:wpqt-pr-3",children:(0,n.jsx)(hi,{task:r})})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[C&&O&&(0,n.jsx)(ua,{icon:(0,n.jsx)(xa.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Restore task","quicktasker"),onClick:()=>{b(r.id,(()=>{l({type:B}),m({type:ve,payload:r.id})}))}}),!C&&(0,n.jsx)(ua,{icon:(0,n.jsx)(ga.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("Archive task","quicktasker"),loading:S,onClick:()=>{A(!0),y(r.id,(()=>{l({type:B}),p(u.id),A(!1)}))}}),d&&(0,n.jsx)(ua,{icon:(0,n.jsx)(va.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Delete task","quicktasker"),loading:T,onClick:()=>Ti(void 0,void 0,void 0,(function*(){E(!0),yield s(r),l({type:B}),E(!1)}))})]})]})}):null}));function Si({isCompleted:e,taskId:t}){const{modalDispatch:s}=(0,a.useContext)($s),{dispatch:i}=(0,a.useContext)(Ns),[r,c]=(0,a.useState)(!1),{changeTaskDoneStatus:l}=Ls();return(0,n.jsx)(fa,{label:e?(0,o.__)("Task completed","quicktasker"):(0,o.__)("Task not completed","quicktasker"),children:r?(0,n.jsx)(rs,{width:"24",height:"24"}):(0,n.jsx)(_a.A,{onClick:()=>Ti(this,void 0,void 0,(function*(){c(!0),yield l(t,!e,(e=>{s({type:I,payload:{done:e}}),i({type:I,payload:{taskId:t,done:e}})})),c(!1)})),className:`wpqt-size-6 ${e?"wpqt-icon-green":"wpqt-text-gray-300"} wpqt-cursor-pointer`})})}var Ai=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ni({editTaskCallback:e,deleteTaskCallback:t}){const{state:{taskModalOpen:s}}=(0,a.useContext)($s),{deleteTask:i}=Ls(),{modalSaving:o,setModalSaving:r,modalContentRef:c,closeModal:l,handleSuccess:d,handleError:m}=Qs(B);return(0,n.jsx)(ma,{modalOpen:s,closeModal:l,size:"xl",children:(0,n.jsx)(Zs,{children:(0,n.jsx)(Ei,{ref:c,editTask:t=>Ai(this,void 0,void 0,(function*(){try{r(!0);const s=yield function(e){return u()({path:`/wpqt/v1/tasks/${e.id}`,method:"PATCH",data:{id:e.id,name:e.name,description:e.description,freeForAll:e.free_for_all,dueDate:e.due_date},headers:p()})}(t);d(b,s.data,Ws.ACTIVE_PIPELINE),e&&e(s.data)}catch(e){m(e)}})),deleteTask:e=>Ai(this,void 0,void 0,(function*(){i(e.id,(()=>{t&&t(e)}))})),taskModalSaving:o})})})}function Ci({text:e=(0,o.__)("No results found","quicktasker")}){return(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-center wpqt-text-xl",children:e})}const Oi=()=>{const{state:{archiveSearchValue:e,archiveFilteredPipelineId:t,archiveTaskDoneFilter:s}}=(0,a.useContext)(Zt);return{filterArchive:a=>{const n=a.name.toLowerCase().includes(e.toLowerCase())||a.description&&a.description.toLowerCase().includes(e.toLowerCase()),i=!t||("DELETED"===t?null===a.pipeline_name:a.pipeline_id===t),o=s===Bt.All||s===Bt.Completed&&a.is_done||s===Bt.NotCompleted&&!a.is_done;return n&&i&&o}}};var Ii=s(3033),Di=s(587);function Pi({className:e,onClick:t,title:s,description:a,children:i,dropdown:o,titleClassName:r="",style:c={}}){const l=void 0!==o;return(0,n.jsxs)("div",{className:(0,Ua.$)("wpqt-relative wpqt-flex wpqt-flex-col wpqt-rounded wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-p-4",l&&"wpqt-pr-[24px]",e),style:c,onClick:t,children:[(0,n.jsxs)("div",{className:"wpqt-mb-3",children:[(0,n.jsx)("div",{className:`wpqt-text-lg ${r}`,children:s}),a&&(0,n.jsx)("div",{className:"wpqt-italic wpqt-text-gray-500",children:a})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-h-full",children:i}),l&&(0,n.jsx)("div",{className:"wpqt-absolute wpqt-right-2 wpqt-top-1 wpqt-z-10",children:o})]})}var Li=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ri({task:e,onDoneStatusChange:t,className:s=""}){const{changeTaskDoneStatus:i}=Ls(),[o,r]=(0,a.useState)(!1),c=e.is_done,l=s=>Li(this,void 0,void 0,(function*(){r(!0),yield i(e.id,s,(s=>{t(e.id,s)})),r(!1)}));return o?(0,n.jsx)(ls,{ovalSize:"24",className:"wpqt-mt-auto"}):(0,n.jsx)("div",{className:`wpqt-flex wpqt-justify-center wpqt-mt-auto ${s}`,children:c?(0,n.jsx)(_a.A,{className:"wpqt-size-6 wpqt-icon-green",onClick:e=>{e.stopPropagation(),l(!1)}}):(0,n.jsx)(_a.A,{className:"wpqt-size-6 wpqt-text-gray-300",onClick:e=>{e.stopPropagation(),l(!0)}})})}function Mi({label:e,value:t,valueClassName:s="",valueLink:a,icon:i,onClick:o=()=>{},className:r="",labelClassName:c=""}){return(0,n.jsxs)("div",{className:`wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center ${r}`,onClick:o,children:[i&&i,(0,n.jsx)("div",{className:c,children:t?`${e}:`:e}),(0,n.jsx)("div",{className:`${s}`,children:a?(0,n.jsx)("a",{href:a,target:"_blank",className:"wpqt-text-qtTextBlue wpqt-no-underline",rel:"noreferrer",onClick:e=>e.stopPropagation(),children:t}):t})]})}var Ui=s(6436),Fi=s(72),$i=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function zi({task:e}){const{state:{isUserAllowedToDelete:t}}=(0,a.useContext)(Sa),{archiveDispatch:s}=(0,a.useContext)(Zt),{deleteTask:i,restoreArchivedTask:o}=Ls(),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),u=null!==e.pipeline_name;return(0,n.jsxs)(kn,{menuBtn:({active:e})=>(0,n.jsx)(jn,{isActive:e,IconComponent:Ui.A}),children:[(0,n.jsx)(yn,{text:"View task",icon:(0,n.jsx)(Fi.A,{className:"wpqt-icon-blue wpqt-size-4"})}),(0,n.jsx)(yn,{text:"Restore task",loading:r,icon:(0,n.jsx)(xa.A,{className:"wpqt-icon-green wpqt-size-4"}),disabled:!u,id:`restore-task-${e.id}-dropdown-item`,tooltipText:"Task cannot be restored because the board has been deleted.",onClick:t=>$i(this,void 0,void 0,(function*(){t.stopPropagation(),c(!0),yield o(e.id,(()=>{s({type:ve,payload:e.id})})),c(!1)}))}),t&&(0,n.jsx)(yn,{text:"Delete",loading:l,icon:(0,n.jsx)(va.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>$i(this,void 0,void 0,(function*(){t.stopPropagation(),d(!0),yield i(e.id,(()=>{s({type:ve,payload:e.id})})),d(!1)})),className:"!wpqt-mb-0"})]})}function Ki({task:e}){const{modalDispatch:t}=(0,a.useContext)($s),{archiveDispatch:s}=(0,a.useContext)(Zt),{convertToWPTimezone:i}=Da(),r=e.due_date?i(e.due_date):null;return(0,n.jsxs)(Pi,{title:e.name,description:e.description,dropdown:(0,n.jsx)(zi,{task:e}),className:"wpqt-cursor-pointer",onClick:()=>{t({type:G,payload:{taskToEdit:e}})},children:[(0,n.jsx)(Mi,{label:(0,o.__)("Board","quicktasker"),value:e.pipeline_name?e.pipeline_name:(0,o.__)("Board is deleted!","quicktasker"),icon:(0,n.jsx)(Ii.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(Kn,{menuBtnClasses:"wpqt-self-start",task:e,onUserAdd:t=>{s({type:_e,payload:{taskId:e.id,user:t}})},onUserDelete:t=>{s({type:ke,payload:{taskId:e.id,user:t}})}}),(0,n.jsx)(Ln,{task:e})]}),r&&(0,n.jsx)(Mi,{label:(0,o.__)("Due date","quicktasker"),value:r,icon:(0,n.jsx)(Di.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(Ri,{task:e,onDoneStatusChange:(e,t)=>{s({type:je,payload:{taskId:e,done:t}})}})]})}function Vi(){var e;const{state:{archivedTasks:t=[]}}=(0,a.useContext)(Zt),{filterArchive:s}=Oi(),i=null!==(e=null==t?void 0:t.filter(s))&&void 0!==e?e:[];return t&&0===t.length?(0,n.jsx)(Ci,{text:(0,o.__)("No tasks archived","quicktasker")}):i&&0===i.length?(0,n.jsx)(Ci,{}):(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"wpqt-card-grid",children:i.map((e=>(0,n.jsx)(Ki,{task:e},e.id)))})})}function Gi(){const{state:{archivedTasks:e},archiveDispatch:t}=(0,a.useContext)(Zt);return e?(0,n.jsxs)("div",{children:[(0,n.jsx)(Ts,{}),(0,n.jsx)(Vi,{}),(0,n.jsx)(Ni,{editTaskCallback:e=>{t({type:ye,payload:e})},deleteTaskCallback:e=>{t({type:ve,payload:e.id})}})]}):(0,n.jsx)(ls,{className:"wpqt-h-[200px]"})}function Bi(){return(0,n.jsx)(es,{children:(0,n.jsx)(is,{children:(0,n.jsxs)(ds,{children:[(0,n.jsx)(l,{description:(0,o.__)("Archived tasks management page.","quicktasker"),children:(0,o.__)("Archive","quicktasker")}),(0,n.jsx)(Gi,{})]})})})}const Hi=()=>{const{state:{pluginURL:e}}=(0,a.useContext)(Sa);return(0,n.jsxs)(ds,{children:[(0,n.jsx)(l,{description:(0,o.__)("Reading material about QuickTasker features and usage.","quicktasker"),children:(0,o.__)("Guide","quicktasker")}),(0,n.jsx)("div",{children:(0,n.jsx)("a",{target:"_blank",rel:"noreferrer",href:e+"help/index.html",children:(0,o.__)("View Guide","quicktasker")})})]})};var Wi=s(4175);const Qi=({filterSettings:e,setFilterSettings:t})=>{const{state:{pipelines:s}}=(0,a.useContext)(xs),[i,r]=(0,a.useState)(e),c=(0,n.jsx)(bs,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"log-search",children:(0,n.jsx)(ms,{inputId:"log-search",value:i.search,onChange:e=>{r(Object.assign(Object.assign({},i),{search:e}))}})}),l=(0,n.jsx)(ua,{text:(0,o.__)("Apply filter","quicktasker"),icon:(0,n.jsx)(Wi.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:()=>t(i)});return(0,n.jsxs)(ys,{title:(0,o.__)("Logs filtering","quicktasker"),searchChildren:c,applyFilterChildren:l,children:[(0,n.jsx)(bs,{title:(0,o.__)("Type","quicktasker"),children:(0,n.jsx)(_s,{allSelector:!1,selectedOptionValue:i.type,options:[{label:(0,o.__)("All types","quicktasker"),value:Yi.All},{label:(0,o.__)("Board","quicktasker"),value:Yi.Pipeline},{label:(0,o.__)("Task","quicktasker"),value:Yi.Task}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{type:e,typeId:""}))}})}),i.type===Yi.Pipeline&&(0,n.jsx)(bs,{title:(0,o.__)("Board","quicktasker"),children:(0,n.jsx)(_s,{allSelector:!0,selectedOptionValue:i.typeId,options:s.map((e=>({label:e.name,value:e.id}))),onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{typeId:e}))}})}),(0,n.jsx)(bs,{title:(0,o.__)("Created by","quicktasker"),children:(0,n.jsx)(_s,{allSelector:!1,selectedOptionValue:i.createdBy,options:[{label:(0,o.__)("Everyone","quicktasker"),value:Xi.All},{label:(0,o.__)("Admin","quicktasker"),value:Xi.Admin},{label:"QuickTasker",value:Xi.Quicktasker},{label:(0,o.__)("Automation","quicktasker"),value:Xi.Automation},{label:(0,o.__)("Import","quicktasker"),value:Xi.Import},{label:(0,o.__)("System","quicktasker"),value:Xi.System}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{createdBy:e}))}})}),(0,n.jsx)(bs,{title:(0,o.__)("Number of logs","quicktasker"),children:(0,n.jsx)(_s,{allSelector:!1,selectedOptionValue:i.numberOfLogs,options:[{label:(0,o.__)("Show 100","quicktasker"),value:to.Hundred},{label:(0,o.__)("Show 200","quicktasker"),value:to.TwoHundred},{label:"Show 500",value:to.FiveHundred},{label:"Show all",value:to.All}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{numberOfLogs:e}))}})}),(0,n.jsx)(bs,{title:(0,o.__)("Order","quicktasker"),children:(0,n.jsx)(_s,{allSelector:!1,selectedOptionValue:i.order,options:[{label:(0,o.__)("Ascending","quicktasker"),value:eo.Asc},{label:(0,o.__)("Descending","quicktasker"),value:eo.Desc}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{order:e}))}})}),(0,n.jsx)(bs,{title:(0,o.__)("Status","quicktasker"),children:(0,n.jsx)(_s,{allSelector:!1,selectedOptionValue:i.status,options:[{label:(0,o.__)("All","quicktasker"),value:so.All},{label:(0,o.__)("Success","quicktasker"),value:so.Success},{label:(0,o.__)("Error","quicktasker"),value:so.Error}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{status:e}))}})})]})};var Yi,Ji,Xi;!function(e){e.Pipeline="pipeline",e.Stage="stage",e.Task="task",e.All="all"}(Yi||(Yi={})),function(e){e.Success="success",e.Error="error"}(Ji||(Ji={})),function(e){e.Admin="admin",e.Quicktasker="quicktasker_user",e.Automation="automation",e.Import="import",e.System="system",e.All="all"}(Xi||(Xi={}));const Zi=({logs:e,loading:t})=>t?(0,n.jsx)(ls,{ovalSize:"64",className:"wpqt-mt-12"}):0===e.length?(0,n.jsx)(Ci,{text:(0,o.__)("No logs found","quicktasker")}):(0,n.jsxs)("div",{className:"wpqt-logs-page-grid",children:[(0,n.jsx)(Yn,{title:(0,o.__)("Author","quicktasker")}),(0,n.jsx)(Yn,{title:(0,o.__)("Created at","quicktasker")}),(0,n.jsx)(Yn,{title:(0,o.__)("Status","quicktasker")}),(0,n.jsx)(Yn,{title:(0,o.__)("Text","quicktasker")}),e.map((e=>(0,n.jsx)(Qn,{log:e,showStatus:!0},e.id)))]});var eo,to,so,ao=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};!function(e){e.Asc="ASC",e.Desc="DESC"}(eo||(eo={})),function(e){e.Hundred="100",e.TwoHundred="200",e.FiveHundred="500",e.All="all"}(to||(to={})),function(e){e.All="all",e.Success="success",e.Error="error"}(so||(so={}));const no=()=>{const[e,t]=(0,a.useState)([]),[s,o]=(0,a.useState)({numberOfLogs:to.Hundred,type:Yi.All,typeId:"",createdBy:Xi.All,order:eo.Desc,search:"",status:so.All}),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!0);(0,a.useEffect)((()=>{l&&(m(),d(!1))}),[s,l]);const m=()=>ao(void 0,void 0,void 0,(function*(){try{c(!0);const e=Object.assign({},s);e.numberOfLogs===to.All&&delete e.numberOfLogs,e.type===Yi.All&&delete e.type,""===e.typeId&&delete e.typeId,e.createdBy===Xi.All&&delete e.createdBy,e.status===so.All&&delete e.status;const a=yield function(e){const t=new URLSearchParams(Object.entries(e).reduce(((e,[t,s])=>(e[t]=String(s),e)),{}));return u()({path:`/wpqt/v1/global-logs?${t.toString()}`,method:"GET",headers:p()})}(e);t(a.data)}catch(e){console.error(e),i.oR.error("Failed to fetch logs")}finally{c(!1)}}));return(0,n.jsxs)("div",{children:[(0,n.jsx)(Qi,{filterSettings:s,setFilterSettings:e=>ao(void 0,void 0,void 0,(function*(){o(e),d(!0)}))}),(0,n.jsx)(Zi,{logs:e,loading:r})]})},io=()=>(0,n.jsxs)(ds,{children:[(0,n.jsx)(l,{description:(0,o.__)("The logs page where you can see all logs and filter them.","quicktasker"),children:(0,o.__)("Logs","quicktasker")}),(0,n.jsx)(no,{})]});function oo({infoText:e,infoDescription:t,actionIcon:s,infoActionClick:a,secondaryInfoText:i,secondaryInfoActionClick:o}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-h-screen-minus-top-bar wpqt-items-center wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-1",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-cursor-pointer",onClick:a,children:[s,(0,n.jsx)("p",{className:"wpqt-m-0 wpqt-font-semibold wpqt-text-lg",children:e})]}),(0,n.jsx)("p",{children:t}),i&&(0,n.jsx)("p",{className:"wpqt-m-0 wpqt-blue-text wpqt-blue-text-hover "+(o?"wpqt-cursor-pointer":""),onClick:o||void 0,children:i})]})})}function ro({overviewFilter:e,onCreationDateChange:t,onDoneDateChange:s}){const a=e=>e instanceof Date?ja()(e).format("YYYY-MM-DD"):"";return(0,n.jsx)("div",{children:(0,n.jsxs)(ys,{title:(0,o.__)("Statistics filtering","quicktasker"),titleClassName:"wpqt-text-center",childrenClassName:"wpqt-gap-6 wpqt-justify-center",searchChildren:null,children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:(0,o.__)("Task creation date","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("(Filter tasks that have creation date equal or bigger than)","quicktasker")})]}),(0,n.jsx)(ya.A,{onChange:e=>{const s=a(e);t(s)},value:e.taskCreationDate,format:"y-MM-dd",id:"taskCreationDate"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:(0,o.__)("Task done date","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("(Filter tasks that have done date equal or smaller than)","quicktasker")})]}),(0,n.jsx)(ya.A,{onChange:e=>{const t=a(e);s(t)},value:e.taskDoneDate,format:"y-MM-dd",id:"taskCreationDate"})]})]})})}var co=s(2298);function lo(e){const t=e.slice(1).some((e=>e[1]>0));return e.length>1&&t}function uo({text:e}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center wpqt-items-center wpqt-h-[400px] wpqt-w-[500px] wpqt-font-semibold",children:e})}function po({pipelineOverviewData:e,options:t,width:s}){var a,i;const r=[["Archived tasks","Task Count"],["Archived tasks",parseInt(null!==(a=null==e?void 0:e.archivedTasksCount)&&void 0!==a?a:"0")||0],["Not archived tasks",parseInt(null!==(i=null==e?void 0:e.notArchivedTasksCount)&&void 0!==i?i:"0")||0]];return lo(r)?(0,n.jsx)(co.t1,{chartType:"PieChart",data:r,options:Object.assign(Object.assign({},t),{title:"Archived tasks"}),width:s,height:"400px"}):(0,n.jsx)(uo,{text:(0,o.__)("Not enough data to display archived tasks chart","quicktasker")})}function mo({pipelineOverviewData:e,options:t,width:s}){var a;const i=[["Stage","Task Count"],...null!==(a=null==e?void 0:e.stages.map((e=>[e.name,parseInt(e.tasksCount)||0])))&&void 0!==a?a:[]];return lo(i)?(0,n.jsx)(co.t1,{chartType:"PieChart",data:i,options:Object.assign(Object.assign({},t),{title:"Task distribution by stages"}),width:s,height:"400px"}):(0,n.jsx)(uo,{text:(0,o.__)("Not enough data to display task distribution by stages chart","quicktasker")})}function ho({pipelineOverviewData:e,options:t,width:s}){var a,i;const r=[["Task status","Task Count"],["Done",parseInt(null!==(a=null==e?void 0:e.doneTasksCount)&&void 0!==a?a:"0")||0],["Not Done",parseInt(null!==(i=null==e?void 0:e.notDoneTasksCount)&&void 0!==i?i:"0")||0]];return lo(r)?(0,n.jsx)(co.t1,{chartType:"PieChart",data:r,options:Object.assign(Object.assign({},t),{title:"Task status"}),width:s,height:"400px"}):(0,n.jsx)(uo,{text:(0,o.__)("Not enough data to display task status chart","quicktasker")})}var wo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const fo={legend:{position:"left",alignment:"center",textStyle:{color:"#233238",fontSize:14}}};function qo({pipeline:e,overviewFilter:t}){const[s,i]=(0,a.useState)(null),[o,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(()=>{wo(this,void 0,void 0,(function*(){try{r(!0);const s=yield function(e,t){const s=new URLSearchParams({taskStartDate:t.taskCreationDate||"",taskDoneDate:t.taskDoneDate||"",taskAssignees:t.taskAssignees.join(",")});return u()({path:`/wpqt/v1/pipelines/${e}/overview?${s.toString()}`,method:"GET",headers:p()})}(e.id,t);i(s.data)}catch(e){console.error(e)}finally{r(!1)}}))})()}),[e.id,t]),o||!s?(0,n.jsx)(ls,{ovalSize:"48"}):(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-wrap wpqt-justify-center xl:wpqt-justify-start",children:[(0,n.jsx)(mo,{pipelineOverviewData:s,options:fo,width:"500px"}),(0,n.jsx)(ho,{pipelineOverviewData:s,options:fo,width:"500px"}),(0,n.jsx)(po,{pipelineOverviewData:s,options:fo,width:"500px"})]})}function xo({pipeline:e}){const[t,s]=(0,a.useState)({taskCreationDate:null,taskDoneDate:null,taskAssignees:[]});return(0,n.jsxs)("div",{children:[(0,n.jsx)(ro,{overviewFilter:t,onCreationDateChange:e=>{s(Object.assign(Object.assign({},t),{taskCreationDate:e}))},onDoneDateChange:e=>{s(Object.assign(Object.assign({},t),{taskDoneDate:e}))}}),(0,n.jsx)(qo,{pipeline:e,overviewFilter:t})]})}function go(){const{state:{pipelines:e}}=(0,a.useContext)(xs),t=e.map((e=>e.name)),s=e.map((e=>(0,n.jsx)(xo,{pipeline:e},e.id)));return(0,n.jsx)(ds,{children:s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{description:(0,o.__)("Get overview of the tasks.","quicktasker"),children:(0,o.__)("Overview","quicktasker")}),(0,n.jsx)(Gn,{tabs:t,tabsContent:s,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})]}):(0,n.jsx)(oo,{infoText:(0,o.__)("No overview to display","quicktasker"),infoDescription:(0,o.__)("You need to first create a board to see the overview.","quicktasker")})})}function vo(){const{state:{activePipeline:e}}=(0,a.useContext)(Ns),t=()=>(null==e?void 0:e.stages)||[],s=e=>{const s=t();let a=null;return s?(s.forEach((t=>{t.tasks&&!a&&t.tasks.find((t=>t.id===e))&&(a=t)})),a):null},n=(0,a.useMemo)((()=>{const e=t();return e?e.map((e=>({label:e.name,value:e.id}))):[]}),[e]),i=(0,a.useMemo)((()=>{const e=t(),s=[];return e?(e.forEach((e=>{e.tasks&&s.push(...e.tasks)})),s):s}),[e]),o=null==e?void 0:e.settings;return{getActivePipelineStages:t,getActivePipelinStageTasksLength:e=>{const s=t();if(!s)return 0;const a=s.find((t=>t.id===e));return a&&a.tasks?a.tasks.length:0},getTaskStage:s,getTaskOrderInStage:e=>{const t=s(e);if(!t||!t.tasks)return null;const a=t.tasks.findIndex((t=>t.id===e));return-1!==a?a:null},activePipelineTasks:i,activePipelineSettings:o,isTaskOnLastStage:e=>{const a=t();if(!a)return!1;const n=s(e);if(!n)return!1;const i=a[a.length-1];return n.id===i.id},stageOptions:n}}const _o=()=>{const{state:{users:e,wpUsers:t}}=(0,a.useContext)(Bs);return{getUser:(s,a)=>a===Ct.QUICKTASKER?e.find((e=>e.id===s)):a===Ct.WP_USER?t.find((e=>e.id===s)):void 0,combinedUsers:(0,a.useMemo)((()=>[...e,...t]),[e,t])}},ko=(e,t)=>{switch(t.type){case V:{const{id:s,type:a}=t.payload;return Object.assign(Object.assign({},e),{userFilter:{id:s,type:a}})}case K:return Object.assign(Object.assign({},e),{stageIdFilter:t.payload});default:return e}},jo={stageIdFilter:"",userFilter:{id:null,type:null}},yo=(0,a.createContext)({state:jo,taskViewDispatch:()=>{}}),bo=({children:e})=>{const[t,s]=(0,a.useReducer)(ko,jo);return(0,n.jsx)(yo.Provider,{value:{state:t,taskViewDispatch:s},children:e})};function To(){const{state:{stageIdFilter:e,userFilter:t},taskViewDispatch:s}=(0,a.useContext)(yo),{stageOptions:i}=vo(),{combinedUsers:r}=_o(),c=r.map((e=>({value:`${e.id}:${e.user_type}`,label:`${e.name} (${$t[e.user_type]})`}))),l=t.id&&t.type?`${t.id}:${t.type}`:"";return(0,n.jsxs)(ys,{title:(0,o.__)("Filter tasks","quicktasker"),searchChildren:null,children:[(0,n.jsx)(bs,{title:(0,o.__)("Stage","quicktasker"),children:(0,n.jsx)(_s,{id:"task-view-stage-filter",allSelectorLabel:(0,o.__)("All stages","quicktasker"),selectedOptionValue:e,options:i,onSelectionChange:e=>{s({type:K,payload:e})}})}),(0,n.jsx)(bs,{title:(0,o.__)("Assigned user","quicktasker"),children:(0,n.jsx)(_s,{id:"task-view-assigned-user-filter",allSelectorLabel:(0,o.__)("All users","quicktasker"),selectedOptionValue:l,options:c,onSelectionChange:e=>{const[t,a]=e.split(":");s({type:V,payload:{id:t,type:a}})}})})]})}var Eo,So,Ao=s(9879),No=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Co(e){return e.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"")}function Oo(e){const t=[];let s="",a=!1;for(let n=0;n<e.length;n++){const i=e[n];'"'===i?a&&n+1<e.length&&'"'===e[n+1]?(s+='"',n++):a=!a:","!==i||a?s+=i:(t.push(s.trim()),s="")}return t.push(s.trim()),t}function Io(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}!function(e){e.ADD_CARD="addCard",e.UPDATE_CARD="updateCard",e.Comment_CARD="commentCard"}(Eo||(Eo={})),function(e){e.TRELLO="TRELLO-IMPORT",e.ASANA="ASANA-IMPORT",e.PIPEDRIVE="PIPEDRIVE-IMPORT",e.QUICKTASKER="QUICKTASKER-IMPORT"}(So||(So={}));const Do={pipelineName:"",pipelineDescription:"",stages:[],tasks:[],labels:[],sourcePipelines:[],taskComments:[]},Po=e=>{switch(e){case So.TRELLO:return(0,o.__)("Import from Trello.","quicktasker");case So.ASANA:return(0,o.__)("Import from Asana.","quicktasker");case So.PIPEDRIVE:return(0,o.__)("Import from Pipedrive.","quicktasker");case So.QUICKTASKER:return(0,o.__)("Import from QuickTasker.","quicktasker");default:return(0,o.__)("Select import source","quicktasker")}},Lo=e=>{switch(e){case So.TRELLO:return(0,o.__)("Export your Trello board as JSON format and use it for import.","quicktasker");case So.ASANA:return(0,o.__)("Export your Asana project as JSON format and use it for import","quicktasker");case So.PIPEDRIVE:return(0,o.__)("Export your Pipedrive deals as CSV format and use it for import. Please not that generated CSV file column headers should be in English.","quicktasker");case So.QUICKTASKER:return(0,o.__)("Import your QuickTasker board from JSON format.","quicktasker");default:return(0,o.__)("Select an import source to get started","quicktasker")}};function Ro({importData:e,importDataFilter:t,selectedImportSource:s,onNameChange:a,onDescriptionChange:i,onImportDataFilterChange:r,validation:c}){const l=s===So.PIPEDRIVE;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3 wpqt-mb-3",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-1",children:[(0,n.jsx)(Mo,{title:(0,o.__)("Board name","quicktasker")}),(0,n.jsx)(ms,{value:e.pipelineName,onChange:a,wrapperClassName:"wpqt-w-[200px] !wpqt-mb-0",className:"wpqt-w-full wpqt-mb-0"}),c.pipelineNameExists&&(0,n.jsx)("div",{className:"wpqt-text-red-500 wpqt-text-sm",children:(0,o.__)("This board name already exists.","quicktasker")})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-1",children:[(0,n.jsx)(Mo,{title:(0,o.__)("Board description","quicktasker")}),(0,n.jsx)(Fa,{value:e.pipelineDescription,onChange:i,rowsCount:2,className:"!wpqt-w-[200px] !wpqt-mb-0"})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-2 wpqt-w-[200px]",children:[(0,n.jsx)(Mo,{title:(0,o.__)("Import archived tasks?","quicktasker")}),(0,n.jsx)(za,{checked:t.includeArchivedTasks,handleChange:()=>{r(Object.assign(Object.assign({},t),{includeArchivedTasks:!t.includeArchivedTasks}))}})]}),l&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-2 wpqt-w-[200px]",children:[(0,n.jsx)(Mo,{title:(0,o.__)("Filter by source","quicktasker")}),e.sourcePipelines.map((e=>{const s=t.sourcePipelinesFilter.some((t=>t.id===e.id)),a=`source-${e.id}`;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)("label",{htmlFor:a,children:e.name}),(0,n.jsx)("input",{type:"checkbox",value:e.name,id:a,checked:s,onChange:()=>{let a;a=s?t.sourcePipelinesFilter.filter((t=>t.id!==e.id)):[...t.sourcePipelinesFilter,e],r(Object.assign(Object.assign({},t),{sourcePipelinesFilter:a}))}})]},e.id)}))]})]})}function Mo({title:e}){return(0,n.jsx)("div",{className:"wpqt-font-semibold",children:e})}function Uo({importData:e}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-2",children:[(0,n.jsxs)("div",{children:[(0,o.__)("Number of tasks","quicktasker"),":"," ",(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[e.tasks.length," (",(0,o.__)("archived","quicktasker")," ",e.tasks.filter((e=>e.archived)).length,")"]})]}),(0,n.jsxs)("div",{children:[(0,o.__)("Number of stages","quicktasker"),":"," ",(0,n.jsx)("span",{className:"wpqt-font-semibold",children:e.stages.length})]}),(0,n.jsxs)("div",{children:[(0,o.__)("Number of labels","quicktasker"),":"," ",(0,n.jsx)("span",{className:"wpqt-font-semibold"}),e.labels.length]})]})}var Fo=s(1578),$o=s(7613);const zo=s.p+"images/icon-80x80.78f40056.png";function Ko({selectedImportSource:e,handleImportSourceChange:t}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(e===So.TRELLO?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>t(So.TRELLO),children:(0,n.jsx)(Fo.IK4,{className:"wpqt-size-6 wpqt-trello-blue"})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(e===So.ASANA?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>t(So.ASANA),children:(0,n.jsx)(ln.OpO,{className:"wpqt-size-6 wpqt-asana-pink"})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(e===So.PIPEDRIVE?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>t(So.PIPEDRIVE),children:(0,n.jsx)($o.nad,{className:"wpqt-size-6 wpqt-pipedrive-green"})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(e===So.QUICKTASKER?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>t(So.QUICKTASKER),children:(0,n.jsx)("img",{src:zo,className:"wpqt-size-6"})})]})}const Vo={includeArchivedTasks:!0,sourcePipelinesFilter:[]};function Go(){const{state:{pipelineImportModalOpen:e},modalDispatch:t}=(0,a.useContext)($s),{pipelinesDispatch:s,checkIfPipelineNameExists:r}=function(){const{state:{pipelines:e},pipelinesDispatch:t}=(0,a.useContext)(xs);return{pipelines:e,pipelinesDispatch:t,checkIfPipelineNameExists:function(t){return e.some((e=>e.name.toLowerCase()===t.toLowerCase()))}}}(),{fetchAndSetPipelineData:c}=(0,a.useContext)(Ns),[l,d]=(0,a.useState)(So.TRELLO),[m,h]=(0,a.useState)(null),[w,f]=(0,a.useState)(Object.assign({},Vo)),[q,x]=(0,a.useState)(null),[g,v]=(0,a.useState)(!1),_=(0,a.useRef)(null),{importPipeline:k}=function(){return{importPipeline:(e,t)=>No(this,void 0,void 0,(function*(){try{const s=yield function(e,t){return u()({path:"/wpqt/v1/import",method:"POST",data:{source:e,data:t},headers:p()})}(e,t);return{success:!0,data:s.data}}catch(e){return console.error(e),i.oR.error((0,o.__)("Import failed","quicktasker")),{success:!1,error:e}}}))}}(),j=(0,a.useMemo)((()=>!!(null==m?void 0:m.pipelineName)&&r(m.pipelineName)),[null==m?void 0:m.pipelineName]),y=q&&!j,b=()=>{h(null),x(null),f(Object.assign({},Vo))};return(0,a.useEffect)((()=>{if(m){const e=Object.assign(Object.assign({},m),{tasks:m.tasks.filter((e=>w.includeArchivedTasks||!e.archived))});w.sourcePipelinesFilter.length>0&&(e.tasks=e.tasks.filter((e=>w.sourcePipelinesFilter.some((t=>e.sourcePipeline&&t.id===e.sourcePipeline.id)))),e.stages=e.stages.filter((e=>w.sourcePipelinesFilter.some((t=>e.sourcePipeline.id===t.id))))),x(e)}}),[m,w]),(0,n.jsx)(ma,{modalOpen:e,closeModal:()=>{t({type:pe}),b()},children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-4",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Import board","quicktasker")}),(0,n.jsx)(Ko,{selectedImportSource:l,handleImportSourceChange:e=>{d(e),b()}}),(0,n.jsxs)("div",{className:"wpqt-text-center wp-mb-4",children:[(0,n.jsx)("p",{className:"wpqt-my-0",children:Po(l)}),(0,n.jsx)("p",{className:"wpqt-my-0",children:Lo(l)})]}),!m&&(0,n.jsx)(ua,{text:(0,o.__)("Select import file","quicktasker"),onClick:()=>{_.current&&_.current.click()},icon:(0,n.jsx)(Ao.t76,{className:"wpqt-size-5 wpqt-text-blue-500"})}),m&&(0,n.jsx)(Ro,{importData:m,importDataFilter:w,validation:{pipelineNameExists:j},selectedImportSource:l,onNameChange:e=>{h((t=>t?Object.assign(Object.assign({},t),{pipelineName:e}):t))},onDescriptionChange:e=>{h((t=>t?Object.assign(Object.assign({},t),{pipelineDescription:e}):t))},onImportDataFilterChange:f}),q&&(0,n.jsx)(Uo,{importData:q}),y&&(0,n.jsx)(ua,{text:(0,o.__)("Start import","quicktasker"),onClick:()=>{return e=this,a=void 0,r=function*(){if(!q||j)return;v(!0);const{data:e}=yield k(l,q);e&&(s({type:E,payload:e.pipeline}),yield c(e.pipeline.id),b(),t({type:pe}),i.oR.success((0,o.__)("Board imported","quicktasker"))),v(!1)},new((n=void 0)||(n=Promise))((function(t,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}c((r=r.apply(e,a||[])).next())}));var e,a,n,r},loading:g}),(0,n.jsx)("input",{type:"file",ref:_,id:"import-upload",className:"wpqt-hidden",accept:(()=>{switch(l){case So.PIPEDRIVE:return".csv";case So.TRELLO:case So.ASANA:case So.QUICKTASKER:default:return".json"}})(),onChange:e=>{var t,s;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){const e=new FileReader,t=null===(s=a.name.split(".").pop())||void 0===s?void 0:s.toLowerCase();e.onload=e=>{var s,a;try{let n,r;switch(n="csv"===t?function(e){if(!e||"string"!=typeof e)return[];const t=e.split("\n").filter((e=>""!==e.trim()));if(0===t.length)return[];const s=Oo(t[0]).map(Co),a=[];for(let e=1;e<t.length;e++){const n=Oo(t[e]);if(0===n.length)continue;const i={};for(let e=0;e<s.length;e++)i[s[e]]=e<n.length?n[e]:"";a.push(i)}return a}(null===(s=e.target)||void 0===s?void 0:s.result):JSON.parse(null===(a=e.target)||void 0===a?void 0:a.result),l){case So.TRELLO:{const e=function(e){if(!e||"object"!=typeof e)return"Import data is missing or not an object";const t=e;if(!t.name)return"Missing board name";if(!t.cards)return"Missing cards array";if(!t.lists)return"Missing lists array";if(!t.labels)return"Missing labels array";if(!Array.isArray(t.cards))return"Cards property is not an array";if(!Array.isArray(t.lists))return"Lists property is not an array";if(!Array.isArray(t.labels))return"Labels property is not an array";if(t.lists.length>0&&!t.lists.some((e=>!e.closed)))return"All lists are closed, at least one open list is required";for(const e of t.cards){if(!e.id)return`Card missing ID: ${JSON.stringify(e).substring(0,100)}...`;if(!e.name)return`Card missing name: ${e.id}`;if(!e.idList)return`Card missing list ID: ${e.id}`;if(!Array.isArray(e.labels))return`Card labels is not an array: ${e.id}`}for(const e of t.lists){if(!e.id)return`List missing ID: ${JSON.stringify(e).substring(0,100)}...`;if(!e.name)return`List missing name: ${e.id}`;if("boolean"!=typeof e.closed)return`List closed status is not boolean: ${e.id}`}for(const e of t.labels){if(!e.id)return`Label missing ID: ${JSON.stringify(e).substring(0,100)}...`;if(!e.name&&""!==e.name)return`Label missing name: ${e.id}`;if(!e.color)return`Label missing color: ${e.id}`}return!0}(n);if(!0!==e)return void i.oR.error(`${(0,o.__)("Invalid Trello import","quicktasker")}: ${e}`);r=function(e){const t=[{name:e.name,id:e.id}],s=e.actions.filter((e=>e.type===Eo.Comment_CARD));return{pipelineName:e.name,pipelineDescription:e.desc,stages:e.lists.filter((e=>!e.closed)).map((t=>({stageName:t.name,stageDescription:"",stageId:t.id,sourcePipeline:{name:e.name,id:e.id}}))),tasks:e.cards.map((t=>{var s,a;return{taskId:t.id,taskName:t.name,taskDescription:"",stageId:t.idList,archived:t.closed,assignedLabels:t.labels.map((e=>({labelName:e.name,labelId:e.id,color:e.color}))),dueDate:t.due?t.due:null,taskCompletedAt:t.dateCompleted?t.dateCompleted:null,taskFocusColor:null!==(a=null===(s=t.cover)||void 0===s?void 0:s.color)&&void 0!==a?a:null,sourcePipeline:{name:e.name,id:e.id}}})),labels:e.labels.map((e=>({labelName:e.name,labelId:e.id,color:e.color}))),sourcePipelines:t,taskComments:s.map((e=>{var t,s,a;return{commentId:e.id,taskId:null!==(s=null===(t=e.data.card)||void 0===t?void 0:t.id)&&void 0!==s?s:"",createdAt:e.date,commentText:null!==(a=e.data.text)&&void 0!==a?a:"",authorId:e.idMemberCreator,isAuthorAdmin:!1,isPrivate:!0}}))}}(n);break}case So.ASANA:{const e=function(e){if(!e||"object"!=typeof e)return"Import data is missing or not an object";const t=e;if(!t.data)return"Missing data array";if(!Array.isArray(t.data))return"Data property is not an array";if(0===t.data.length)return"Data array is empty";for(const e of t.data){if(!e.gid)return`Task missing GID: ${JSON.stringify(e).substring(0,100)}...`;if(!e.name)return`Task missing name: ${e.gid}`;if("boolean"!=typeof e.completed)return`Task completed status is not boolean: ${e.gid}`;if(!Array.isArray(e.projects))return`Task projects is not an array: ${e.gid}`;if(0===e.projects.length)return`Task has no projects: ${e.gid}`;if(!Array.isArray(e.memberships))return`Task memberships is not an array: ${e.gid}`;if(!Array.isArray(e.tags))return`Task tags is not an array: ${e.gid}`;for(const t of e.projects){if(!t.gid)return`Project missing GID in task ${e.gid}`;if(!t.name)return`Project missing name in task ${e.gid}`}for(const t of e.memberships){if(!t.project)return`Membership missing project in task ${e.gid}`;if(!t.section)return`Membership missing section in task ${e.gid}`;const s=t.project,a=t.section;if(!s.gid)return`Membership project missing GID in task ${e.gid}`;if(!s.name)return`Membership project missing name in task ${e.gid}`;if(!a.gid)return`Membership section missing GID in task ${e.gid}`;if(!a.name)return`Membership section missing name in task ${e.gid}`}for(const t of e.tags){if(!t.gid)return`Tag missing GID in task ${e.gid}`;if(!t.name)return`Tag missing name in task ${e.gid}`}}return!0}(n);if(!0!==e)return void i.oR.error(`${(0,o.__)("Invalid Asana import","quicktasker")}: ${e}`);r=function(e){if(!e.data||0===e.data.length)return Object.assign({},Do);const t=e.data[0].projects[0].gid,s=e.data[0].projects[0].name,a=new Map,n=new Map,i=[{name:s,id:t}];e.data.forEach((e=>{e.memberships.forEach((e=>{if(e.project.gid===t){const t=e.section;a.has(t.gid)||a.set(t.gid,t)}})),e.tags.forEach((e=>{n.has(e.gid)||n.set(e.gid,e)}))}));const o=Array.from(a.values()).map((e=>({stageId:e.gid,stageName:e.name,stageDescription:"",sourcePipeline:{name:s,id:t}}))),r=Array.from(n.values()).map((e=>({labelId:e.gid,labelName:e.name||"",color:Et}))),c=e.data.map((e=>{var a;const n=e.memberships.find((e=>e.project.gid===t)),i=(null==n?void 0:n.section.gid)||(null===(a=o[0])||void 0===a?void 0:a.stageId)||"";return{taskId:e.gid,taskName:e.name,taskDescription:"",stageId:i,archived:e.completed,dueDate:e.due_at||e.due_on||null,taskCompletedAt:e.completed_at||null,assignedLabels:e.tags.map((e=>({labelName:e.name,labelId:e.gid,color:Et}))),taskFocusColor:null,sourcePipeline:{name:s,id:t}}}));return{pipelineName:s,pipelineDescription:"",stages:o,tasks:c,labels:r,sourcePipelines:i,taskComments:[]}}(n);break}case So.PIPEDRIVE:{const e=function(e){if(!e||!Array.isArray(e))return"Import data is missing or not an array";if(0===e.length)return"Deals array is empty";for(const t of e){if(!t.title)return`Deal missing title: ${JSON.stringify(t).substring(0,100)}...`;if(!t.stage)return`Deal missing stage: ${t.title||"Unknown"}`;if(!t.status)return`Deal missing status: ${t.title||"Unknown"}`;const e=String(t.status).toLowerCase();if(!["open","won","lost","deleted"].includes(e))return`Invalid deal status: ${e} for deal: ${t.title||"Unknown"}`;if(void 0!==t.label&&null!==t.label&&"string"!=typeof t.label)return`Deal label must be a string: ${t.title||"Unknown"}`;if(void 0!==t.expected_close_date&&null!==t.expected_close_date&&"string"!=typeof t.expected_close_date)return`Deal expected_close_date must be a string or null: ${t.title||"Unknown"}`;if(void 0!==t.deal_closed_on&&null!==t.deal_closed_on&&"string"!=typeof t.deal_closed_on)return`Deal deal_closed_on must be a string or null: ${t.title||"Unknown"}`}const t=new Set;for(const s of e)s.stage&&"string"==typeof s.stage&&t.add(s.stage);return 0!==t.size||"No valid stages found in deals"}(n);if(!0!==e)return void i.oR.error(`${(0,o.__)("Invalid Pipedrive import","quicktasker")}: ${e}`);r=function(e){if(!e)return Object.assign({},Do);const t=new Map,s=new Map,a=new Map;e.forEach((e=>{e.pipeline&&!a.has(e.pipeline)&&a.set(e.pipeline,{name:e.pipeline,id:Io()})})),e.forEach((e=>{e.stage&&!t.has(e.stage)&&t.set(e.stage,{stageId:Io(),stageName:e.stage,stageDescription:"",sourcePipeline:a.get(e.pipeline)||{name:"",id:Io()}}),e.label&&e.label.split(",").map((e=>e.trim())).filter(Boolean).forEach((e=>{e&&!s.has(e)&&s.set(e,{labelId:Io(),labelName:e,color:Et})}))}));const n=Array.from(t.values()).map((e=>({stageId:e.stageId,stageName:e.stageName,stageDescription:"",sourcePipeline:{name:e.sourcePipeline.name,id:e.sourcePipeline.id}}))),i=Array.from(s.values()).map((e=>({labelId:e.labelId,labelName:e.labelName,color:e.color}))),o=Array.from(a.values()).map((e=>({name:e.name,id:e.id}))),r=e.map((e=>{var i;const o=t.get(e.stage),r=e.status.toLocaleLowerCase(),c=[];let l=null;if(e.label&&e.label.split(",").map((e=>e.trim())).filter(Boolean).forEach((e=>{const t=s.get(e);t&&c.push({labelId:t.labelId,labelName:t.labelName,color:t.color})})),e.pipeline){const t=a.get(e.pipeline);t&&(l={name:t.name,id:t.id})}return{taskId:e.id,taskName:e.title,taskDescription:"",stageId:o?o.stageId:(null===(i=n[0])||void 0===i?void 0:i.stageId)||"",archived:"lost"===r||"deleted"===r,assignedLabels:c,dueDate:e.expected_close_date||null,taskFocusColor:null,taskCompletedAt:"won"===r&&e.deal_closed_on||null,sourcePipeline:l}}));return{pipelineName:"",pipelineDescription:"",stages:n,tasks:r,labels:i,sourcePipelines:o,taskComments:[]}}(n);break}case So.QUICKTASKER:{const e=function(e){if(!e||"object"!=typeof e)return"Invalid import data: Not a valid object";const t=e;if(!t.pipelineName)return"Pipeline name is required";if(!Array.isArray(t.stages))return"Stages must be an array";for(let e=0;e<t.stages.length;e++){const s=t.stages[e];if(!s.stageName||"string"!=typeof s.stageName||!s.stageName.trim())return`Stage #${e+1} is missing a name`;if(void 0===s.stageId||null===s.stageId)return`Stage #${e+1} is missing an ID`}if(t.tasks&&Array.isArray(t.tasks))for(let e=0;e<t.tasks.length;e++){const s=t.tasks[e];if(!s.taskName||"string"!=typeof s.taskName||!s.taskName.trim())return`Task #${e+1} is missing a name`;if(void 0===s.stageId||null===s.stageId)return`Task #${e+1} is missing a stage ID`;if(!t.stages.some((e=>e.stageId==s.stageId)))return`Task "${s.taskName}" references a stage ID that does not exist in the import data`;if(s.assignedLabels&&Array.isArray(s.assignedLabels))for(let e=0;e<s.assignedLabels.length;e++){const t=s.assignedLabels[e];if(void 0===t.labelId||null===t.labelId||!t.labelName)return`Task "${s.taskName}" has an invalid label at position ${e+1}`}}if(t.labels&&Array.isArray(t.labels))for(let e=0;e<t.labels.length;e++){const s=t.labels[e];if(!s.labelName||"string"!=typeof s.labelName||!s.labelName.trim())return`Label #${e+1} is missing a name`;if(void 0===s.labelId||null===s.labelId)return`Label #${e+1} is missing an ID`;if(!s.color||"string"!=typeof s.color||!s.color.trim())return`Label "${s.labelName||e+1}" is missing a color`}return!0}(n);if(!0!==e)return void i.oR.error(`${(0,o.__)("Invalid Quicktasker import","quicktasker")}: ${e}`);r=n;break}default:throw new Error("Unsupported import source")}h(r)}catch(e){console.error("Error parsing import file:",e),i.oR.error((0,o.__)("Failed to parse import file","quicktasker"))}},e.readAsText(a)}}})]})})}function Bo(){const{state:{moveTaskModalOpen:e,taskToEdit:t},modalDispatch:s}=(0,a.useContext)($s),{dispatch:i}=(0,a.useContext)(Ns),{getActivePipelineStages:r,getActivePipelinStageTasksLength:c,getTaskStage:l,getTaskOrderInStage:d}=vo(),{moveTask:u}=Ls(),[p,m]=(0,a.useState)(0),[h,w]=(0,a.useState)(""),[f,q]=(0,a.useState)(!1),x=c(h),g=Array.from({length:x+1},((e,t)=>({value:t.toString(),label:(t+1).toString()}))),v=r().map((e=>({value:e.id,label:e.name}))),k=()=>{s({type:ie})};return(0,a.useEffect)((()=>{if(t){const e=l(t.id),s=d(t.id);e&&null!==s&&(w(e.id),m(s))}}),[t]),(0,n.jsx)(ma,{modalOpen:e,closeModal:k,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)("h2",{children:(0,o.__)("Change task location on board","quicktasker")}),(0,n.jsx)("label",{htmlFor:"move-task-stage-selection",children:(0,o.__)("Select stage","quicktasker")}),(0,n.jsx)(_s,{id:"move-task-stage-selection",allSelector:!1,selectedOptionValue:h,options:v,onSelectionChange:e=>{w(e),m(0)}}),(0,n.jsx)("label",{htmlFor:"move-task-order-selection",children:(0,o.__)("Select order","quicktasker")}),(0,n.jsx)(_s,{id:"move-task-order-selection",allSelector:!1,selectedOptionValue:String(p),options:g,onSelectionChange:e=>m(Number(e))}),(0,n.jsx)(da,{btnText:(0,o.__)("Apply","quicktasker"),loading:f,onClick:()=>{return e=this,s=void 0,n=function*(){if(!t)return;const e=l(t.id),s=d(t.id);e&&null!==s&&(q(!0),yield u(t.id,h,p,(t=>{t&&(i({type:_,payload:{source:{droppableId:e.id,index:s},destination:{droppableId:h,index:p}}}),k())})),q(!1))},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n}})]})})}const Ho=(0,a.forwardRef)((({addPipeline:e,modalSaving:t},s)=>{const[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(""),d=()=>{r(""),l("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:d}))),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(wa,{children:[(0,n.jsx)(fa,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(ms,{isAutoFocus:!0,value:i,onChange:e=>r(e),className:"wpqt-w-full",wrapperClassName:"wpqt-w-full"})}),(0,n.jsx)(fa,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Fa,{rowsCount:3,value:c,onChange:e=>l(e),className:"wpqt-w-full"})})]}),(0,n.jsx)(qa,{onSave:()=>{e(i,c)},loading:t,saveBtnText:(0,o.__)("Add board","quicktasker")})]})}));var Wo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Qo(){return{deletePipeline:(e,t)=>Wo(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e}`,method:"DELETE",headers:p()})}(e);t&&t(s.data.deletedPipelineId,s.data.pipelineIdToLoad)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete board","quicktasker"))}})),addPipeline:(e,t,s,a)=>Wo(this,void 0,void 0,(function*(){try{const a=yield(n=e,r=t,u()({path:"/wpqt/v1/pipelines",method:"POST",data:{name:n,description:r},headers:p()}));i.oR.success((0,o.__)("Board created successfully","quicktasker")),s&&s(a.data)}catch(e){i.oR.error((0,o.__)("Failed to create a board","quicktasker")),a&&a(e)}var n,r})),editPipeline:(e,t,s)=>Wo(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e.id}`,method:"PATCH",data:{name:e.name,description:e.description,is_primary:e.is_primary},headers:p()})}(e);i.oR.success((0,o.__)("Board updated successfully","quicktasker")),t&&t(s.data)}catch(e){i.oR.error((0,o.__)("Failed to update board","quicktasker")),s&&s(e)}}))}}function Yo(){const{state:{newPipelineModalOpen:e}}=(0,a.useContext)($s),{fetchAndSetPipelineData:t}=(0,a.useContext)(Ns),{modalSaving:s,setModalSaving:i,modalContentRef:o,closeModal:r,handleSuccess:c,handleError:l}=Qs(X),{addPipeline:d}=Qo();return(0,n.jsx)(ma,{modalOpen:e,closeModal:r,size:"sm",children:(0,n.jsx)(Ho,{ref:o,addPipeline:(e,s)=>{return a=this,n=void 0,u=function*(){i(!0),yield d(e,s,(e=>{c(E,e,Ws.PIPELINES),t(e.id),r()}),(e=>{l(e)}))},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{r(u.next(e))}catch(e){t(e)}}function i(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){var a;t.done?e(t.value):(a=t.value,a instanceof o?a:new o((function(e){e(a)}))).then(s,i)}r((u=u.apply(a,n||[])).next())}));var a,n,o,u},modalSaving:s,setModalSaving:i})})}const Jo=(0,a.forwardRef)((({editPipeline:e,modalSaving:t},s)=>{const{state:{pipelineToEdit:r},modalDispatch:c}=(0,a.useContext)($s),{fetchAndSetPipelineData:l,dispatch:d}=(0,a.useContext)(Ns),{pipelinesDispatch:u}=(0,a.useContext)(xs),{deletePipeline:p}=Qo(),[m,h]=(0,a.useState)(""),[w,f]=(0,a.useState)(""),{loading1:q,setLoading1:x}=ba();(0,a.useEffect)((()=>{r&&(h(r.name),f(r.description||""))}),[r]);const g=()=>{h(""),f("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:g}))),r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsx)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:(0,n.jsxs)("div",{className:"wpqt-mb-5 wpqt-grid wpqt-grid-cols-1 wpqt-gap-4 md:wpqt-grid-cols-[auto_1fr]",children:[(0,n.jsxs)(wa,{children:[(0,n.jsx)(fa,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(ms,{isAutoFocus:!0,value:m,onChange:e=>h(e),className:"wpqt-w-full",wrapperClassName:"wpqt-w-full"})}),(0,n.jsx)(fa,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Fa,{rowsCount:3,value:w,onChange:e=>f(e)})})]}),(0,n.jsx)(xn,{entityId:r.id,entityType:La.Pipeline})]})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:(0,n.jsx)(ua,{icon:(0,n.jsx)(va.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:q,text:(0,o.__)("Delete board","quicktasker"),onClick:()=>{r&&(x(!0),p(r.id,((e,t)=>{c({type:X}),x(!1),i.oR.success((0,o.__)("Board deleted","quicktasker")),u({type:D,payload:e}),null!==t?(u({type:A,payload:t}),l(t)):d({type:P})})))}})})]}),(0,n.jsx)(qa,{onSave:()=>{r&&e(Object.assign(Object.assign({},r),{name:m,description:w}))},loading:t,saveBtnText:(0,o.__)("Save","quicktasker")})]}):null}));function Xo(){const{state:{pipelineModalOpen:e}}=(0,a.useContext)($s),{modalSaving:t,setModalSaving:s,modalContentRef:i,closeModal:o,handleSuccess:r,handleError:c}=Qs(X),{editPipeline:l}=Qo();return(0,n.jsx)(ma,{modalOpen:e,closeModal:o,size:"xl",children:(0,n.jsx)(Jo,{ref:i,editPipeline:e=>{return t=this,a=void 0,i=function*(){s(!0),yield l(e,(e=>{r(S,e,Ws.ACTIVE_PIPELINE)}),(e=>{c(e)}))},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i},modalSaving:t,setModalSaving:s})})}function Zo(e){switch(e){case Us.PDF:return(0,o.__)("Export as PDF","quicktasker");case Us.JSON:return(0,o.__)("Export as JSON","quicktasker");default:return(0,o.__)("Export","quicktasker")}}var er=s(6973);function tr(){const{modalDispatch:e,state:{taskExportModalSettings:t}}=(0,a.useContext)($s);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(t.selectedMethod===Us.PDF?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>e({type:de,payload:{selectedMethod:Us.PDF}}),"data-testid":"task-export-pdf-icon",children:(0,n.jsx)(Fo.uNb,{className:"wpqt-size-5 wpqt-pdf-red"})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(t.selectedMethod===Us.JSON?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>e({type:de,payload:{selectedMethod:Us.JSON}}),"data-testid":"task-export-json-icon",children:(0,n.jsx)(er.Qio,{className:"wpqt-size-5"})})]})}function sr({pipelineId:e}){const{state:{taskExportModalOpen:t,taskExportModalSettings:s},modalDispatch:i}=(0,a.useContext)($s),{state:{siteURL:r}}=(0,a.useContext)(Sa),[c,l]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1);return(0,n.jsx)(ma,{modalOpen:t,closeModal:()=>{i({type:le})},size:"md",children:(0,n.jsxs)("form",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",action:r,target:"_blank",method:"GET",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Tasks export","quicktasker")}),(0,n.jsx)(tr,{}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(js,{labelFor:"export-search-filter",children:(0,o.__)("Filter by task name and desription","quicktasker")}),(0,n.jsx)(ms,{value:c,onChange:l,inputId:"export-search-filter",name:"task_search",wrapperClassName:"wpqt-mb-0"})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(js,{labelFor:"export-include-archive-filter",children:(0,o.__)("Include board archived tasks","quicktasker")}),(0,n.jsx)(za,{checked:d,handleChange:u,id:"export-include-archive-filter"})]}),(0,n.jsx)(da,{btnText:Zo(s.selectedMethod),type:ea.SUBMIT}),e&&(0,n.jsx)("input",{type:"hidden",name:"pipeline_id",value:e}),(0,n.jsx)("input",{type:"hidden",name:"wpqt-page",value:`${s.selectedMethod}-export`}),(0,n.jsx)("input",{type:"hidden",name:"include_archive",value:d?"1":"0"})]})})}var ar=s(9919),nr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const ir=(0,a.forwardRef)((({editStage:e,addStage:t,stageModalSaving:s},i)=>{const{state:{stageToEdit:r}}=(0,a.useContext)($s),[c,l]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),p=!!r;(0,a.useEffect)((()=>{r&&(l(r.name),u(r.description))}),[r]);const m=()=>{l(""),u("")};return(0,a.useImperativeHandle)(i,(()=>({clearContent:m}))),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ha,{children:p?(0,o.__)("Edit Stage","quicktasker"):(0,o.__)("Add Stage","quicktasker")}),(0,n.jsxs)(wa,{children:[(0,n.jsx)(fa,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(ms,{isAutoFocus:!0,value:c,onChange:e=>l(e)})}),(0,n.jsx)(fa,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Fa,{rowsCount:3,value:d,onChange:e=>u(e)})})]}),(0,n.jsx)(qa,{onSave:()=>{p?e(Object.assign(Object.assign({},r),{name:c,description:d})):t(c,d)},loading:s,saveBtnText:p?(0,o.__)("Save","quicktasker"):(0,o.__)("Add stage","quicktasker")})]})}));var or=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function rr(){const{state:{stageModalOpen:e,targetPipelineId:t}}=(0,a.useContext)($s),{modalSaving:s,setModalSaving:r,modalContentRef:c,closeModal:l,handleSuccess:d,handleError:m}=Qs(W),{editStage:h,addStage:w}=function(){return{editStage:(e,t,s)=>nr(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/stages/${e.id}`,method:"PATCH",data:{name:e.name,description:e.description},headers:p()})}(e);i.oR.success((0,o.__)("Stage updated successfully","quicktasker")),t&&t(s.data)}catch(e){i.oR.error((0,o.__)("Failed to update stage","quicktasker")),s&&s(e)}})),addStage:(e,t,s,a,n)=>nr(this,void 0,void 0,(function*(){try{const n=yield(r=e,c=t,l=s,u()({path:"/wpqt/v1/stages",method:"POST",data:{pipelineId:r,name:c,description:l},headers:p()}));i.oR.success((0,o.__)("Stage created successfully","quicktasker")),a&&a(n.data)}catch(e){i.oR.error((0,o.__)("Failed to create stage","quicktasker")),n&&n(e)}var r,c,l}))}}();return(0,n.jsx)(ma,{modalOpen:e,closeModal:l,children:(0,n.jsx)(ir,{ref:c,editStage:e=>or(this,void 0,void 0,(function*(){r(!0),yield h(e,(e=>{d(T,e,Ws.ACTIVE_PIPELINE),l()}),(e=>{m(e)}))})),addStage:(e,s)=>or(this,void 0,void 0,(function*(){try{r(!0),yield w(t,e,s,(e=>{d(j,{stage:Object.assign(Object.assign({},e),{tasks:[]})},Ws.ACTIVE_PIPELINE),l()}))}catch(e){m(e)}})),stageModalSaving:s,stageTaskModalSaving:r})})}var cr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function lr(){const{state:{taskColorModalOpen:e,taskToEdit:t},modalDispatch:s}=(0,a.useContext)($s),{dispatch:i}=(0,a.useContext)(Ns),{updateTaskFocusColor:r}=Ls(),[c,l]=(0,a.useState)(yt),[d,u]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{t&&t.task_focus_color&&l(t.task_focus_color)}),[t]),(0,n.jsx)(ma,{modalOpen:e,closeModal:()=>{s({type:re})},size:"sm",children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-4 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Task focus color","quicktasker")}),(0,n.jsx)(Tn.A,{color:c||void 0,disableAlpha:!0,onChange:e=>{l(e.hex)}}),(0,n.jsx)(da,{btnText:(0,o.__)("Apply changes","quicktasker"),onClick:()=>cr(this,void 0,void 0,(function*(){if(!t)return;u(!0);const{success:e}=yield r(t.id,c);u(!1),e&&i({type:z,payload:{taskId:t.id,color:c}})})),loading:d}),(0,n.jsx)(da,{buttonStyleType:ta.DANGER,btnText:(0,o.__)("Reset color","quicktasker"),onClick:()=>{l(yt)}})]})})}var dr=s(1609);function ur({pipelineId:e,stagesLength:t=0}){const{modalDispatch:s}=(0,a.useContext)($s),i=()=>{return t=this,a=void 0,i=function*(){s({type:H,payload:{targetPipelineId:e}})},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i};return 0===t?(0,n.jsx)("div",{className:"wpqt-pipeline-height wpqt-flex wpqt-w-full wpqt-items-center wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-main-border wpqt-flex wpqt-cursor-pointer wpqt-flex-col wpqt-items-center wpqt-justify-start wpqt-gap-y-1 wpqt-p-3 hover:wpqt-bg-gray-100",onClick:i,children:[(0,n.jsx)(Wa.A,{className:"wpqt-size-6 wpqt-text-green-600"}),(0,n.jsx)("div",{className:"wpqt-whitespace-nowrap",children:(0,o.__)("Add first stage","quicktasker")})]})}):(0,n.jsxs)("div",{className:"wpqt-main-border wpqt-mb-3 wpqt-flex wpqt-cursor-pointer wpqt-flex-col wpqt-items-center wpqt-justify-start wpqt-self-start wpqt-p-3 hover:wpqt-bg-gray-100",onClick:i,children:[(0,n.jsx)(Wa.A,{className:"wpqt-size-6 wpqt-text-green-600"}),(0,n.jsx)("div",{className:"wpqt-whitespace-nowrap",children:(0,o.__)("Add stage","quicktasker")})]})}var pr=s(12),mr=s(5575),hr=s(6304),wr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function fr({stage:e}){var t,s,r,c;const{dispatch:l,state:{activePipeline:d},fetchAndSetPipelineData:m}=(0,a.useContext)(Ns),{modalDispatch:h}=(0,a.useContext)($s),{state:{isUserAllowedToDelete:w}}=(0,a.useContext)(Sa),[f,q]=(0,a.useState)(!1),[x,g]=(0,a.useState)(!1),[v,_]=(0,a.useState)(!1),k=null!==(s=null===(t=null==d?void 0:d.stages)||void 0===t?void 0:t.length)&&void 0!==s?s:0,j=null!==(c=null===(r=e.tasks)||void 0===r?void 0:r.length)&&void 0!==c?c:0,b=+e.stage_order,T=b>0&&b<k,E=b!==k-1,S=t=>wr(this,void 0,void 0,(function*(){try{q(!0),yield function(e,t){return u()({path:`/wpqt/v1/stages/${e}/move`,method:"PATCH",data:{direction:t},headers:p()})}(e.id,t),yield m(d.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to move a stage","quicktasker"))}finally{q(!1)}}));return(0,n.jsxs)(kn,{menuBtn:({active:e})=>(0,n.jsx)(jn,{isActive:e,IconComponent:pr.A}),children:[T&&(0,n.jsx)(yn,{text:(0,o.__)("Move left","quicktasker"),loading:f,icon:(0,n.jsx)(mr.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:()=>S("left")}),E&&(0,n.jsx)(yn,{text:(0,o.__)("Move right","quicktasker"),loading:f,icon:(0,n.jsx)(hr.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:()=>S("right")}),(0,n.jsx)(yn,{text:(0,o.__)("Edit stage","quicktasker"),icon:(0,n.jsx)(Nn.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:()=>{h({type:Q,payload:{stageToEdit:e}})}}),(0,n.jsx)(yn,{text:(0,o.__)("Archive all stage tasks","quicktasker"),icon:(0,n.jsx)(ga.A,{className:"wpqt-icon-blue wpqt-size-4"}),loading:x,onClick:()=>wr(this,void 0,void 0,(function*(){try{g(!0),yield(t=e.id,u()({path:`/wpqt/v1/stages/${t}/archive-tasks`,method:"PATCH",headers:p()})),yield m(d.id),i.oR.success((0,o.sprintf)((0,o.__)("Archived all %s tasks","quicktasker"),e.name))}catch(t){console.error(t),i.oR.error((0,o.sprintf)((0,o.__)("Failed to archive stage %s tasks","quicktasker"),e.name))}finally{g(!1)}var t})),disabled:0===j,id:`item-dropdown-${e.id}-archive`,tooltipText:0===j?(0,o.__)("No tasks to archive on the stage","quicktasker"):void 0}),w&&(0,n.jsx)(yn,{text:(0,o.__)("Delete stage","quicktasker"),icon:(0,n.jsx)(va.A,{className:"wpqt-icon-red wpqt-size-4"}),loading:v,onClick:()=>wr(this,void 0,void 0,(function*(){try{_(!0),yield(t=e.id,u()({path:`/wpqt/v1/stages/${t}`,method:"DELETE",data:{stageId:t},headers:p()})),l({type:y,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete a stage","quicktasker"))}finally{_(!1)}var t})),disabled:j>0,className:"!wpqt-mb-0",id:`item-dropdown-${e.id}`,tooltipText:(0,o.__)("Stage can be deleted when there are no tasks on it","quicktasker")})]})}var qr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function xr({stageId:e}){const[t,s]=(0,a.useState)(""),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),m=(0,a.useRef)(null),h=(0,a.useRef)(null),{state:{activePipeline:w},dispatch:f}=(0,a.useContext)(Ns),{handleExecutedAutomations:q}=Ds();(0,a.useEffect)((()=>{const e=e=>{"Enter"===e.key&&document.activeElement===h.current&&x()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[t]),(0,a.useEffect)((()=>{const e=e=>{m.current&&!m.current.contains(e.target)&&g()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),(0,a.useEffect)((()=>{var e;r&&(null===(e=h.current)||void 0===e||e.focus())}),[r]);const x=()=>qr(this,void 0,void 0,(function*(){if(t)try{d(!0);const s=yield function(e,t,s){return u()({path:"/wpqt/v1/tasks",method:"POST",data:{stageId:e,name:s,pipelineId:t},headers:p()})}(e,w.id,t);f({type:k,payload:s.data.newTask}),i.oR.success((0,o.__)("Task created","quicktasker")),g(),q(s.data.executedAutomations,s.data.newTask.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create task","quicktasker"))}finally{d(!1)}else i.oR.error((0,o.__)("Task name is required","quicktasker"))})),g=()=>{c(!1),s("")};return(0,n.jsx)("div",{ref:m,className:"wpqt-sticky wpqt-bottom-0 wpqt-z-10 wpqt-order-1 wpqt-mt-2 wpqt-flex wpqt-justify-center wpqt-bg-gray-100 wpqt-py-2",children:r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-3",children:[(0,n.jsx)(ms,{ref:h,value:t,onChange:e=>s(e),wrapperClassName:"!wpqt-mb-0",className:"!wpqt-mb-0"}),l?(0,n.jsx)(rs,{width:"24",height:"24"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Ha.A,{className:"wpqt-icon-red wpqt-size-6 wpqt-cursor-pointer",onClick:g}),(0,n.jsx)(Wa.A,{className:"wpqt-icon-green wpqt-size-6 wpqt-cursor-pointer",onClick:x})]})]}):(0,n.jsxs)("div",{onClick:()=>c(!0),className:"wpqt-main-border wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-p-2 hover:wpqt-bg-white",children:[(0,o.__)("Add task","quicktasker"),(0,n.jsx)(Wa.A,{className:"wpqt-size-6 wpqt-text-green-600"})]})})}var gr=s(7959),vr=s(1735),_r=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function kr({task:e}){const{modalDispatch:t}=(0,a.useContext)($s),{state:{activePipeline:s},fetchAndSetPipelineData:i}=(0,a.useContext)(Ns),{state:{isUserAllowedToDelete:r}}=(0,a.useContext)(Sa),{deleteTask:c,archiveTask:l}=Ls(),[d,u]=(0,a.useState)(!1);return(0,n.jsxs)(kn,{menuBtn:({active:e})=>(0,n.jsx)(jn,{isActive:e,IconComponent:Ui.A}),children:[(0,n.jsx)(yn,{text:(0,o.__)("Archive task","quicktasker"),icon:(0,n.jsx)(ga.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),l(e.id,(()=>{i(s.id)}))}}),(0,n.jsx)(yn,{text:(0,o.__)("Edit task","quicktasker"),icon:(0,n.jsx)(Nn.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:G,payload:{taskToEdit:e}})}}),(0,n.jsx)(yn,{text:(0,o.__)("Color","quicktasker"),icon:(0,n.jsx)(gr.A,{className:"wpqt-icon-orange wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:oe,payload:{task:e}})}}),(0,n.jsx)(yn,{text:(0,o.__)("Move task","quicktasker"),icon:(0,n.jsx)(vr.zhn,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:ne,payload:{task:e}})}}),r&&(0,n.jsx)(yn,{text:(0,o.__)("Delete task","quicktasker"),icon:(0,n.jsx)(va.A,{className:"wpqt-icon-red wpqt-size-4"}),loading:d,onClick:t=>_r(this,void 0,void 0,(function*(){t.stopPropagation(),u(!0),yield c(e.id,(()=>{i(s.id)})),u(!1)})),className:"!wpqt-mb-0"})]})}function jr({task:e}){const{convertToWPTimezone:t}=Da();return e.due_date?(0,n.jsxs)("div",{className:"wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(Di.A,{className:`wpqt-size-5 ${function(e){const t=function(e,t){const s=new Date(e),a=new Date(t).getTime()-s.getTime(),n=Math.floor(a/1e3),i=Math.floor(n/60),o=Math.floor(i/60);return{milliseconds:a,seconds:n,minutes:i,hours:o,days:Math.floor(o/24)}}(ja()().utc().format("YYYY-MM-DD HH:mm:ss"),e);return t.milliseconds<0?"wpqt-text-red-600":t.hours<24?"wpqt-text-amber-500":t.hours<72?"wpqt-text-yellow-500":"wpqt-icon-blue"}(e.due_date)}`}),(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[(0,o.__)("Due date","quicktasker"),":"]}),t(e.due_date)]}):null}var yr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function br({task:e,allowToMarkTaskAsDone:t}){const{dispatch:s}=(0,a.useContext)(Ns),{changeTaskDoneStatus:i}=Ls(),[o,r]=(0,a.useState)(!1),c=e.is_done,l=t=>yr(this,void 0,void 0,(function*(){r(!0),yield i(e.id,t,(t=>{s({type:I,payload:{taskId:e.id,done:t}})})),r(!1)}));return t?o?(0,n.jsx)(ls,{ovalSize:"24"}):(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:c?(0,n.jsx)(_a.A,{className:"wpqt-size-6 wpqt-icon-green",onClick:e=>{e.stopPropagation(),l(!1)}}):(0,n.jsx)(_a.A,{className:"wpqt-size-6 wpqt-icon-gray",onClick:e=>{e.stopPropagation(),l(!0)}})}):null}function Tr({task:e,index:t,onLastStage:s}){const{modalDispatch:i}=(0,a.useContext)($s),{state:{activePipeline:o}}=(0,a.useContext)(Ns),r=!(null==o?void 0:o.settings).allow_only_last_stage_task_done||s,c=()=>{i({type:G,payload:{taskToEdit:e,taskModalSettings:{allowToMarkTaskAsDone:r}}})},l=e.task_focus_color?{borderTopColor:e.task_focus_color,borderTopWidth:bt,borderTopStyle:Tt}:{};return(0,n.jsx)(ar.sx,{draggableId:e.id,index:t,children:t=>(0,n.jsx)("div",Object.assign({ref:t.innerRef},t.draggableProps,t.dragHandleProps,{children:(0,n.jsxs)("div",{className:"wpqt-relative wpqt-mx-4 wpqt-mb-2 wpqt-flex !wpqt-cursor-pointer wpqt-flex-col wpqt-gap-1 wpqt-rounded wpqt-border wpqt-border-gray-200 wpqt-bg-white wpqt-p-3 wpqt-shadow hover:wpqt-shadow-md",style:l,onClick:c,children:[(0,n.jsx)("div",{className:"wpqt-absolute wpqt-right-[12px] wpqt-top-[12px]",children:(0,n.jsx)(kr,{task:e})}),(0,n.jsx)("div",{className:"wpqt-text-base",children:e.name}),e.description&&(0,n.jsx)("div",{className:"wpqt-text-sm wpqt-italic",children:e.description}),(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(Kn,{task:e}),(0,n.jsx)(Ln,{task:e})]}),(0,n.jsx)(jr,{task:e}),(0,n.jsx)(br,{task:e,allowToMarkTaskAsDone:r})]})}))},e.id)}function Er({tasks:e}){const t=e.length;return(0,n.jsx)("span",{className:"wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-1 wpqt-text-xs",children:t})}function Sr({stage:e,isLastStage:t}){return(0,n.jsxs)("div",{"data-stage-id":e.id,className:"wpqt-relative wpqt-mb-3 wpqt-flex wpqt-max-h-full wpqt-w-[360px] wpqt-flex-none wpqt-flex-col wpqt-overflow-hidden wpqt-rounded-md wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-bg-gray-100",children:[(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-flex wpqt-flex-wrap wpqt-items-center wpqt-gap-1 wpqt-px-4 wpqt-pt-3",children:[(0,n.jsxs)("div",{className:"wpqt-mr-auto wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-text-base wpqt-leading-none",children:[e.name," ",(0,n.jsx)(Er,{tasks:e.tasks})]}),(0,n.jsx)(fr,{stage:e}),e.description&&(0,n.jsx)("div",{className:"wpqt-w-full wpqt-flex-shrink-0 wpqt-flex-grow-0 wpqt-text-sm",children:e.description})]}),(0,n.jsx)(ar.gL,{droppableId:e.id,children:s=>{var a;return(0,n.jsxs)("div",{ref:s.innerRef,className:"wpqt-flex wpqt-h-full wpqt-flex-col wpqt-overflow-y-auto wpqt-overflow-x-hidden",children:[null===(a=e.tasks)||void 0===a?void 0:a.map(((e,s)=>(0,n.jsx)(Tr,{task:e,index:s,onLastStage:t},e.id))),s.placeholder,(0,n.jsx)(xr,{stageId:e.id})]})}})]})}const Ar=()=>{var e,t;const{state:{activePipeline:s},dispatch:r,fetchAndSetPipelineData:c}=(0,a.useContext)(Ns),{isTabVisible:l}=(()=>{const[e,t]=(0,dr.useState)(!document.hidden);return(0,dr.useEffect)((()=>{const e=()=>{t(!document.hidden)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),{isTabVisible:e}})(),{modalDispatch:d}=(0,a.useContext)($s);(0,a.useEffect)((()=>{const e=setInterval((()=>{s&&l&&c(s.id)}),3e4);return()=>clearInterval(e)}),[s,l]);const u=(e,t)=>{e.droppableId===t.droppableId?r({type:"REORDER_TASK",payload:{source:e,destination:t}}):r({type:_,payload:{source:e,destination:t}})},p=(0,a.useCallback)((e=>{return t=void 0,s=void 0,n=function*(){const{source:t,destination:s,draggableId:a}=e;if(s){u(t,s);try{yield m(a,s.droppableId,s.index)}catch(e){console.error(e),u(s,t),i.oR.error((0,o.__)("Failed to move a task","quicktasker"))}}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n}),[s]);return s?(0,n.jsxs)("div",{className:"wpqt-pipeline-height wpqt-flex wpqt-gap-[24px] wpqt-overflow-x-auto wpqt-overflow-y-hidden",children:[(0,n.jsx)(ar.JY,{onDragEnd:p,children:null===(e=s.stages)||void 0===e?void 0:e.map(((e,t)=>{const a=t===s.stages.length-1;return(0,n.jsx)(Sr,{stage:e,isLastStage:a},e.id)}))}),(0,n.jsx)(ur,{pipelineId:s.id,stagesLength:null===(t=s.stages)||void 0===t?void 0:t.length}),(0,n.jsx)(Ni,{deleteTaskCallback:()=>{s&&c(s.id)}}),(0,n.jsx)(lr,{}),(0,n.jsx)(rr,{})]}):(0,n.jsx)(oo,{infoText:(0,o.__)("Create a new board","quicktasker"),infoDescription:(0,o.__)("No boards found. Start by creating your first board to organize and manage your tasks effectively.","quicktasker"),actionIcon:(0,n.jsx)(Wa.A,{className:"wpqt-icon-green wpqt-size-6 wpqt-cursor-pointer"}),infoActionClick:()=>{d({type:Y})},secondaryInfoText:(0,o.__)("Import an existing board","quicktasker"),secondaryInfoActionClick:()=>{d({type:ue})}})};var Nr=s(8932),Cr=s(247),Or=s(1203),Ir=s(2496),Dr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Pr(){const{state:{activePipeline:e},fetchAndSetPipelineData:t}=(0,a.useContext)(Ns),{state:{pipelines:s},pipelinesDispatch:r}=(0,a.useContext)(xs),{modalDispatch:c}=(0,a.useContext)($s),l=e=>Dr(this,void 0,void 0,(function*(){try{yield(t=e.id,u()({path:`/wpqt/v1/pipelines/${t}/set-primary`,method:"PATCH",headers:p()})),r({type:A,payload:e.id}),i.oR.success((0,o.__)("Primary board has been set successfully.","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to set primary board","quicktasker"))}var t}));return(0,n.jsxs)(kn,{menuBtnClasses:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1 wpqt-rounded-xl wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-p-3",menuBtn:({active:t})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-leading-none",children:null==e?void 0:e.name}),(0,n.jsx)(Or.A,{className:"wpqt-size-4 "+(t?"wpqt-text-qtBlueHover":"")})]}),children:[(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center wpqt-font-bold",children:(0,o.__)("Change board","quicktasker")}),s.map((s=>{const a=s.is_primary,i=(null==e?void 0:e.id)===s.id;return(0,n.jsx)(_n.Dr,{children:(0,n.jsxs)("div",{className:"wpqt-mb-3 wpqt-flex wpqt-gap-2",children:[(0,n.jsx)("div",{className:(0,Ua.$)("wpqt-cursor-pointer wpqt-text-center",{"wpqt-font-bold":i}),onClick:()=>t(s.id),children:s.name}),(0,n.jsx)("div",{className:"wpqt-ml-auto",children:a?(0,n.jsx)(Ir.A,{className:"wpqt-size-4 wpqt-cursor-pointer wpqt-text-blue-500"}):(0,n.jsx)(Cr.A,{className:"wpqt-size-4 wpqt-cursor-pointer wpqt-text-gray-400",onClick:e=>{e.stopPropagation(),l(s)}})})]})},s.id)})),(0,n.jsx)(_n.Dr,{children:(0,n.jsx)("div",{className:"wpqt-my-4 wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-2",children:(0,n.jsx)(ua,{text:(0,o.__)("Add new board","quicktasker"),onClick:()=>Dr(this,void 0,void 0,(function*(){c({type:Y})})),icon:(0,n.jsx)(Wa.A,{className:"wpqt-size-6 wpqt-icon-green"}),className:"wpqt-bg-white hover:!wpqt-bg-gray-100"})})},"new-pipeline"),(0,n.jsx)(_n.Dr,{children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-justify-center wpqt-cursor-pointer wpqt-blue-text wpqt-blue-text-hover",onClick:()=>{c({type:ue})},children:(0,o.__)("Import existing","quicktasker")})},"export-pipeline")]})}function Lr(){const{modalDispatch:e}=(0,a.useContext)($s),t=t=>{e({type:ce,payload:{selectedMethod:t}})};return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-mr-5 wpqt-gap-2",children:[(0,n.jsx)(Fo.uNb,{className:"wpqt-size-5 wpqt-pdf-red wpqt-cursor-pointer","data-testid":"task-export-pdf-icon",onClick:()=>{t(Us.PDF)}}),(0,n.jsx)(er.Qio,{className:"wpqt-size-5 wpqt-cursor-pointer","data-testid":"task-export-pdf-json-icon",onClick:()=>{t(Us.JSON)}})]})}function Rr(){const{state:{activePipeline:e,loading:t},fetchAndSetPipelineData:s}=(0,a.useContext)(Ns),{modalDispatch:i}=(0,a.useContext)($s);return e?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-py-5",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:e.name}),(0,n.jsx)(pr.A,{className:"wpqt-text-gray-400 wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{e&&i({type:J,payload:{pipelineToEdit:e}})}})]}),e.description&&(0,n.jsx)("div",{className:"wpqt-italic",children:e.description})]}),(0,n.jsxs)("div",{className:"wpqt-ml-auto wpqt-flex wpqt-items-center wpqt-gap-3",children:[(0,n.jsx)(Lr,{}),(0,n.jsx)(Mr,{}),t?(0,n.jsx)(rs,{width:"24",height:"24"}):(0,n.jsx)(Xn.A,{className:"wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>s(e.id)}),(0,n.jsx)(Pr,{})]})]}):null}function Mr(){const{state:{view:e},dispatch:t}=(0,a.useContext)(Ns);return(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-items-center wpqt-cursor-pointer wpqt-text-blue-400 wpqt-text-base :hover:wpqt-text-blue-600",onClick:()=>{t({type:R,payload:e===Ss.PIPELINE?Ss.TASK:Ss.PIPELINE})},children:e===Ss.PIPELINE?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Nr.A,{className:"wpqt-size-5 wpqt-text-blue-400"}),(0,o.__)("Switch to Task view","quicktasker")]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Ii.A,{className:"wpqt-size-5 wpqt-text-blue-400"}),(0,o.__)("Switch to Board view","quicktasker")]})})}function Ur(){const{modalDispatch:e}=(0,a.useContext)($s),{activePipelineTasks:t,activePipelineSettings:s,isTaskOnLastStage:i}=vo(),{taskViewFilter:r}=(()=>{const{state:{stageIdFilter:e,userFilter:t}}=(0,a.useContext)(yo);return{taskViewFilter:s=>{var a,n;const i=!e||s.stage_id===e,o=!t.id||!t.type||t.type===Ct.QUICKTASKER&&(null===(a=s.assigned_users)||void 0===a?void 0:a.some((e=>e.id===t.id)))||t.type===Ct.WP_USER&&(null===(n=s.assigned_wp_users)||void 0===n?void 0:n.some((e=>e.id===t.id)));return i&&o}}})(),c=t.filter(r);return 0===c.length?(0,n.jsx)(Ci,{text:(0,o.__)("No tasks","quictasker")}):(0,n.jsxs)("div",{className:"wpqt-card-grid",children:[c.map((t=>{const a=i(t.id),o=!s.allow_only_last_stage_task_done||a,r=t.task_focus_color?{borderTopColor:t.task_focus_color,borderTopWidth:bt,borderTopStyle:Tt}:{};return(0,n.jsxs)(Pi,{className:"wpqt-cursor-pointer",style:r,title:t.name,description:t.description,dropdown:(0,n.jsx)(kr,{task:t}),onClick:()=>{e({type:G,payload:{taskToEdit:t,taskModalSettings:{allowToMarkTaskAsDone:o}}})},children:[(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(Kn,{task:t}),(0,n.jsx)(Ln,{task:t})]}),(0,n.jsx)(jr,{task:t}),(0,n.jsx)(br,{task:t,allowToMarkTaskAsDone:o})]},t.id)})),(0,n.jsx)(Ni,{}),(0,n.jsx)(lr,{})]})}const Fr=()=>(0,n.jsx)(Cs,{children:(0,n.jsx)(is,{children:(0,n.jsx)($r,{})})}),$r=()=>{const{state:{view:e,activePipeline:t}}=(0,a.useContext)(Ns),s=e===Ss.PIPELINE;return(0,n.jsxs)(ds,{children:[(0,n.jsx)(Rr,{}),s?(0,n.jsx)(Ar,{}):(0,n.jsxs)(bo,{children:[(0,n.jsx)(To,{}),(0,n.jsx)(Ur,{})]}),(0,n.jsx)(Yo,{}),(0,n.jsx)(Xo,{}),(0,n.jsx)(Bo,{}),(0,n.jsx)(sr,{pipelineId:(null==t?void 0:t.id)||null}),(0,n.jsx)(Go,{})]})};var zr=s(6197),Kr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Vr(){return{saveCustomUserPageStyles:(e,t)=>Kr(this,void 0,void 0,(function*(){try{const a=yield(s=e,u()({path:"/wpqt/v1/settings/user-page-custom-styles",method:"PATCH",data:{styles:s},headers:p()}));t&&t(a.data),i.oR.success((0,o.__)("Custom user page styles saved successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to save custom user page styles","quicktasker"))}var s})),saveTaskCompletionDoneSetting:(e,t,s)=>Kr(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/settings/task-completion-done-restriction`,method:"PATCH",data:{allow_task_completion_only_on_last_stage:t},headers:p()})}(e,t),s&&s(t)}catch(e){s&&s(!t),console.error(e),i.oR.error((0,o.__)("Failed to save setting","quicktasker"))}}))}}const Gr=({children:e,title:t,description:s})=>(0,n.jsxs)("div",{className:"wpqt-mb-5",children:[(0,n.jsx)("h3",{className:"wpqt-mb-1",children:t}),(0,n.jsx)("p",{children:s}),e]});const Br=()=>{const{state:{userPageCustomStyles:e},appDispatch:t}=(0,a.useContext)(Sa),[s,i]=(0,a.useState)(""),[r,c]=(0,a.useState)(!1),{saveCustomUserPageStyles:l}=Vr();return(0,a.useEffect)((()=>{i(e)}),[e]),(0,n.jsxs)(Gr,{title:(0,o.__)("Custom style","quicktasker"),description:(0,o.__)("Add custom CSS rules for QuickTasker user page.","quicktasker"),children:[(0,n.jsx)(Fa,{value:s,onChange:i,colsCount:40}),(0,n.jsx)(ua,{text:(0,o.__)("Save","quicktasker"),loading:r,onClick:()=>{return e=void 0,a=void 0,i=function*(){c(!0),yield l(s,(e=>{t({type:Re,payload:e})})),c(!1)},new((n=void 0)||(n=Promise))((function(t,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(e,a||[])).next())}));var e,a,n,i},icon:(0,n.jsx)(zr.RZ0,{className:"wpqt-icon-blue wpqt-size-4"})})]})};var Hr=s(8046),Wr=s(1226);const Qr=(e,t)=>{var s,a;switch(t.type){case dt:{const s=t.payload.automations;return Object.assign(Object.assign({},e),{automations:s})}case ut:{const s=t.payload;return Object.assign(Object.assign({},e),{loading:s})}case pt:{const n=t.payload,i=null!==(a=null===(s=e.automations)||void 0===s?void 0:s.filter((e=>e.id!==n)))&&void 0!==a?a:null;return Object.assign(Object.assign({},e),{automations:i})}case ht:{const s=e.automations?e.automations.map((e=>e.id===t.payload.id?Object.assign(Object.assign({},e),{active:t.payload.active}):e)):null;return Object.assign(Object.assign({},e),{automations:s})}case mt:{const s=t.payload,a=e.automations?[...e.automations,s]:[s];return Object.assign(Object.assign({},e),{automations:a})}default:return e}},Yr={[Lt.ARCHIVE_TASK]:(0,o.__)("Archive task","quicktasker"),[Lt.ASSIGN_USER]:(0,o.__)("Assign user","quickkasker"),[Lt.NEW_ENTITY_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Lt.DELETED_ENTITY_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Lt.TASK_ASSIGNED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Lt.TASK_UNASSIGNED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Lt.TASK_PUBLIC_COMMENT_ADDED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Lt.TASK_PRIVATE_COMMENT_ADDED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Lt.TASK_FILE_UPLOADED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Lt.TASK_FILE_DELETED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Lt.CREATE_TASK]:(0,o.__)("Create task","quicktasker"),[Lt.SEND_SLACK_MESSAGE]:(0,o.__)("Send Slack message","quicktasker")},Jr={[Dt.Task]:(0,o.__)("Task","quicktasker"),[Dt.Stage]:(0,o.__)("Stage","quicktasker"),[Dt.PIPELINE]:(0,o.__)("Board","quicktasker"),[Dt.quicktasker]:"Quicktasker",[Dt.WOOCOMMERCE_ORDER]:(0,o.__)("WooCommerce Order","quicktasker")},Xr={[Ot.TASK_DONE]:(0,o.__)("Task marked as done","quicktasker"),[Ot.Task_NOT_DONE]:(0,o.__)("Task marked as not done","quicktasker"),[Ot.TASK_CREATED]:(0,o.__)("Task created","quicktasker"),[Ot.TASK_DELETED]:(0,o.__)("Task deleted","quicktasker"),[Ot.TASK_ASSIGNED]:(0,o.__)("Task assigned","quicktasker"),[Ot.TASK_UNASSIGNED]:(0,o.__)("Task unassigned","quicktasker"),[Ot.TASK_PUBLIC_COMMENT_ADDED]:(0,o.__)("Public comment added","quicktasker"),[Ot.TASK_PRIVATE_COMMENT_ADDED]:(0,o.__)("Private comment added","quicktasker"),[Ot.TASK_FILE_UPLOADED]:(0,o.__)("File attached","quicktasker"),[Ot.TASK_FILE_DELETED]:(0,o.__)("Attached file deleted","quicktasker"),[It.WOOCOMMERCE_ORDER_ADDED]:(0,o.__)("Order added","quicktasker")},Zr=(It.WOOCOMMERCE_ORDER_ADDED,(0,o.__)("Order added","quicktasker"),{[Ot.TASK_DONE]:[{id:Lt.ARCHIVE_TASK},{id:Lt.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Ot.Task_NOT_DONE]:[{id:Lt.ARCHIVE_TASK}],[Ot.TASK_CREATED]:[{id:Lt.ASSIGN_USER,requireAutomationTarget:!0,requireAutomationTargetType:!0},{id:Lt.NEW_ENTITY_EMAIL,requireMetaData:!0},{id:Lt.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Ot.TASK_DELETED]:[{id:Lt.DELETED_ENTITY_EMAIL,requireMetaData:!0},{id:Lt.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Ot.TASK_ASSIGNED]:[{id:Lt.TASK_ASSIGNED_EMAIL,requireMetaData:!0},{id:Lt.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Ot.TASK_UNASSIGNED]:[{id:Lt.TASK_UNASSIGNED_EMAIL,requireMetaData:!0},{id:Lt.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Ot.TASK_PUBLIC_COMMENT_ADDED]:[{id:Lt.TASK_PUBLIC_COMMENT_ADDED_EMAIL,requireMetaData:!0},{id:Lt.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Ot.TASK_PRIVATE_COMMENT_ADDED]:[{id:Lt.TASK_PRIVATE_COMMENT_ADDED_EMAIL,requireMetaData:!0},{id:Lt.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Ot.TASK_FILE_UPLOADED]:[{id:Lt.TASK_FILE_UPLOADED_EMAIL,requireMetaData:!0}],[Ot.TASK_FILE_DELETED]:[{id:Lt.TASK_FILE_DELETED_EMAIL,requireMetaData:!0}]}),ec={[It.WOOCOMMERCE_ORDER_ADDED]:[{id:Lt.CREATE_TASK}]},tc={[Dt.Task]:Zr,[Dt.WOOCOMMERCE_ORDER]:ec};const sc={automations:null,loading:!0},ac=(0,a.createContext)({state:sc,pipelineAutomationsDispatch:()=>{}}),nc=({children:e,pipelineId:t})=>{const[s,r]=(0,a.useReducer)(Qr,sc),c=()=>{return e=void 0,s=void 0,n=function*(){try{r({type:ut,payload:!0});const s=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e}/automations`,method:"GET",headers:p()})}(t);r({type:dt,payload:{automations:(e=s.data.automations,e.map((e=>Object.assign(Object.assign({},e),{active:"1"===e.active,verify_success:"1"===e.verify_success}))))}})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load board automations","quicktasker"))}finally{r({type:ut,payload:!1})}var e},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n};return(0,a.useEffect)((()=>{c()}),[]),(0,n.jsx)(ac.Provider,{value:{state:s,pipelineAutomationsDispatch:r},children:e})},ic={automationTarget:null,automationTrigger:null,automationAction:null,automationActionTargetId:null,automationActionTargetType:null,metaData:null};function oc(e,t){switch(t.type){case"SET_TARGET":return Object.assign(Object.assign({},e),{automationTarget:t.payload,automationTrigger:null,automationAction:null});case"SET_TRIGGER":return Object.assign(Object.assign({},e),{automationTrigger:t.payload,automationAction:null});case"SET_ACTION":return Object.assign(Object.assign({},e),{automationAction:t.payload});case"RESET":return ic;case ft:return Object.assign(Object.assign({},e),{automationActionTargetId:t.payload.automationActionTargetId,automationActionTargetType:t.payload.automationActionTargetType});case wt:return Object.assign(Object.assign({},e),{metaData:t.payload});case qt:return ic;case xt:return Object.assign(Object.assign({},ic),{automationTarget:e.automationTarget});case gt:return Object.assign(Object.assign({},ic),{automationTarget:e.automationTarget,automationTrigger:e.automationTrigger});default:return e}}function rc({actionTargetId:e,actionTargetType:t}){if(null===e||null===t)return null;const{getUser:s}=_o();if(t===Pt.QUICKTASKER||t===Pt.WP_USER||null!==e){const a=Ft(t);if(a){const t=s(e,a);return(0,n.jsx)("div",{className:"wpqt-text-center",children:(null==t?void 0:t.name)||(0,o.__)("User not found","quicktasker")})}}return null}function cc({value:e,label:t,onClick:s=()=>{},className:a=""}){return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-text-center wpqt-font-semibold wpqt-rounded-xl wpqt-px-4 wpqt-py-2 wpqt-border wpqt-border-solid wpqt-cursor-pointer wpqt-border-qtBorder ${a}`,onClick:()=>{s(e)},children:t})}function lc({children:e,title:t}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-base wpqt-mb-4 wpqt-text-center",children:t}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center wpqt-gap-3 wpqt-flex-wrap",children:e})]})}function dc({automationDispatch:e,automation:t}){if(!t.automationTarget||!t.automationTrigger)return null;const s=t.automationTarget,a=t.automationTrigger,i=tc[s],r=i&&a in i?i[a]:[];return(0,n.jsx)(lc,{title:(0,o.__)("Step 3. Select action","quicktasker"),children:r.map((t=>(0,n.jsx)(cc,{value:t.id,label:Yr[t.id],onClick:()=>{e({type:"SET_ACTION",payload:t})}},t.id)))})}function uc({quickTaskerUsers:e,wpUsers:t,assignUser:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-w-[320px] wpqt-flex-col",children:[(0,n.jsx)(Fn,{sectionTitle:(0,o.__)("Assign a quicktasker","quicktasker"),users:e,onItemSelect:s,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No quicktaskers available to assign","quicktasker")}),(0,n.jsx)(Fn,{sectionTitle:(0,o.__)("Assign a WordPress user","quicktasker"),users:t,onItemSelect:s,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No WordPress users with required permissions available to assign","quicktasker")})]})}function pc({automationAction:e,onUserAdd:t=()=>{},quickTaskerUserTargets:s=[],wpUserTargets:a=[],menuBtnClasses:i=""}){const o=[...s,...a].length>0;return(0,n.jsx)(kn,{menuBtnClasses:`wpqt-inline-flex ${i}`,anchor:"bottom start",menuBtn:()=>(0,n.jsx)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1",children:(0,n.jsx)(Rn.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`})}),children:e===Lt.ASSIGN_USER&&(0,n.jsx)(uc,{quickTaskerUsers:s,wpUsers:a,assignUser:t})})}const mc=[Lt.ASSIGN_USER];function hc({automationDispatch:e,automation:t}){var s;const{state:{users:i,wpUsers:r}}=(0,a.useContext)(Bs),c=null===(s=t.automationAction)||void 0===s?void 0:s.id,l=void 0!==c&&mc.includes(c);return(0,n.jsx)(lc,{title:(0,o.__)("Step 4. Select action target","quicktasker"),children:l&&(0,n.jsx)(pc,{automationAction:c,quickTaskerUserTargets:i,wpUserTargets:r,onUserAdd:t=>{e({type:ft,payload:{automationActionTargetId:t.id,automationActionTargetType:t.user_type}})}})})}var wc=s(4476);const fc=wc.z.string().email({message:"Invalid email address"});function qc({setAutomationMeta:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(e=>{try{fc.parse(e),r(!0)}catch(e){r(!1)}})(t)}),[t]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-justify-center wpqt-items-center",children:[(0,n.jsx)(ei,{type:"info",children:(0,o.__)("Make sure your website is configured to send out emails","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("label",{htmlFor:"automation-meta-email-input",children:(0,o.__)("Email will be sent to","quicktasker")}),(0,n.jsx)(ms,{inputId:"automation-meta-email-input",value:t,onChange:s,wrapperClassName:"!wpqt-mb-0"}),!i&&(0,n.jsx)("div",{className:"wpqt-text-red-500",children:(0,o.__)("Invalid email address","quicktasker")})]}),(0,n.jsx)(da,{btnText:(0,o.__)("Set email","quicktasker"),onClick:()=>{i&&e(t)}})]})}const xc=wc.z.string().url({message:"Invalid URL"}).refine((e=>e.startsWith("https://hooks.slack.com/services/")),{message:"Invalid Slack webhook URL"}),gc=function({setAutomationMeta:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(e=>{try{xc.parse(e),r(!0)}catch(e){r(!1)}})(t)}),[t]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-justify-center wpqt-items-center",children:[(0,n.jsxs)(ei,{type:"info",children:[(0,o.__)("Make sure your have configured your Slack webhook URL.","quicktasker"),(0,n.jsx)("a",{href:"https://api.slack.com/messaging/webhooks",target:"_blank",rel:"noopener noreferrer",className:"wpqt-text-blue-500 hover:underline wpqt-ml-1",children:(0,o.__)("Read more about Slack webhooks.","quicktasker")})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("label",{htmlFor:"automation-meta-slack-webhook-input",children:(0,o.__)("Slack webhook URL","quicktasker")}),(0,n.jsx)(ms,{inputId:"automation-meta-slack-webhook-input",value:t,onChange:s,wrapperClassName:"!wpqt-mb-0"}),!i&&(0,n.jsx)("div",{className:"wpqt-text-red-500",children:(0,o.__)("Invalid Slack webhook","quicktasker")})]}),(0,n.jsx)(da,{btnText:(0,o.__)("Set webhook URL","quicktasker"),onClick:()=>{i&&e(t)}})]})};function vc({automationCreationState:e,automationDispatch:t}){var s;const a=null===(s=null==e?void 0:e.automationAction)||void 0===s?void 0:s.id,i=a===Lt.NEW_ENTITY_EMAIL||a===Lt.DELETED_ENTITY_EMAIL||a===Lt.TASK_ASSIGNED_EMAIL||a===Lt.TASK_UNASSIGNED_EMAIL||a===Lt.TASK_PUBLIC_COMMENT_ADDED_EMAIL||a===Lt.TASK_PRIVATE_COMMENT_ADDED_EMAIL||a===Lt.TASK_FILE_UPLOADED_EMAIL||a===Lt.TASK_FILE_DELETED_EMAIL,o=a===Lt.SEND_SLACK_MESSAGE,r=e=>{t({type:wt,payload:e})};return i?(0,n.jsx)(qc,{setAutomationMeta:r}):o?(0,n.jsx)(gc,{setAutomationMeta:r}):null}function _c({automationDispatch:e}){const t=Object.keys(tc).map((e=>({value:e,label:Jr[e]||e})));return(0,n.jsx)(lc,{title:(0,o.__)("Step 1. Select a target","quicktasker"),children:t.map((({value:t,label:s})=>(0,n.jsx)(cc,{value:t,label:s,onClick:()=>{e({type:"SET_TARGET",payload:t})}},t)))})}function kc({automationDispatch:e,automation:t}){if(!t.automationTarget)return null;const s=t.automationTarget,a=Object.keys(tc[s]).map((e=>({value:e,label:Xr[e]||e})));return(0,n.jsx)(lc,{title:(0,o.__)("Step 2. Select a trigger","quicktasker"),children:a.map((({value:t,label:s})=>(0,n.jsx)(cc,{value:t,label:s,onClick:()=>{e({type:"SET_TRIGGER",payload:t})}},t)))})}var jc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function yc({automation:e,automationDispatch:t,createAutomation:s}){const[i,r]=(0,a.useState)(!1);return null===e.automationTarget?(0,n.jsx)(_c,{automationDispatch:t}):null===e.automationTrigger?(0,n.jsx)(kc,{automationDispatch:t,automation:e}):null===e.automationAction?(0,n.jsx)(dc,{automationDispatch:t,automation:e}):e.automationAction&&e.automationAction.requireAutomationTarget&&e.automationAction.requireAutomationTargetType&&(null===e.automationActionTargetType||null===e.automationActionTargetId)?(0,n.jsx)(hc,{automationDispatch:t,automation:e}):e.automationAction.requireMetaData&&!e.metaData?(0,n.jsx)(vc,{automationCreationState:e,automationDispatch:t}):(0,n.jsx)(ua,{text:(0,o.__)("Create automation","quicktasker"),icon:(0,n.jsx)($o.ltU,{className:"wpqt-size-6"}),onClick:()=>jc(this,void 0,void 0,(function*(){r(!0),yield s(),r(!1)})),loading:i})}var bc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Tc({pipelineId:e}){const{pipelineAutomationsDispatch:t,state:{loading:s,automations:i}}=(0,a.useContext)(ac),[r,c]=(0,a.useReducer)(oc,ic),{createAutomation:l}=Ds(),d=null!==r.automationActionTargetId&&null!==r.automationActionTargetType,u=null!==r.metaData,p=!jt&&i&&i.length>=1,m="wpqt-px-3 wpqt-min-w-[60px] wpqt-cursor-pointer",h="wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1";return s?null:p?(0,n.jsx)(Ja,{description:(0,o.__)("Free version limit reached. Upgrade to premium to create more automations.","quicktasker")}):(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-3 wpqt-p-4 wpqt-justify-center wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-start"}),(0,n.jsx)(Pi,{title:(0,o.__)("Target","quicktasker"),className:m,titleClassName:h,onClick:()=>{c({type:qt})},children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:r.automationTarget?Jr[r.automationTarget]:(0,n.jsx)(Ec,{})})}),(0,n.jsx)(Hr.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(Pi,{title:(0,o.__)("Trigger","quicktasker"),className:m,titleClassName:h,onClick:()=>{c({type:xt})},children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:r.automationTrigger?Xr[r.automationTrigger]:(0,n.jsx)(Ec,{})})}),(0,n.jsx)(Hr.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(Pi,{title:(0,o.__)("Action","quicktasker"),className:m,titleClassName:h,onClick:()=>{c({type:gt})},children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center wpqt-items-center",children:[r.automationAction?Yr[r.automationAction.id]:(0,n.jsx)(Ec,{}),d&&(0,n.jsx)(rc,{actionTargetId:r.automationActionTargetId,actionTargetType:r.automationActionTargetType}),u&&(0,n.jsx)("div",{children:r.metaData})]})})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(yc,{automation:r,automationDispatch:c,createAutomation:()=>bc(this,void 0,void 0,(function*(){yield l(e,r,((e,s)=>{e&&s&&(c({type:"RESET"}),t({type:mt,payload:s}))}))}))})})]})})}function Ec(){return(0,n.jsx)(Wr.A,{className:"wpqt-size-7 wpqt-text-gray-300"})}function Sc({pipelineId:e}){const{state:{automationCreatorModalOpen:t},modalDispatch:s}=(0,a.useContext)($s);return(0,n.jsx)(ma,{modalOpen:t,closeModal:()=>{s({type:he})},size:"lg",children:(0,n.jsx)(Tc,{pipelineId:e})})}var Ac=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Nc({automation:e,className:t="",titleClassName:s=""}){const{deleteAutomation:i,updateAutomationActiveStatus:r}=Ds(),{pipelineAutomationsDispatch:c}=(0,a.useContext)(ac),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1);return(0,n.jsx)(Pi,{title:(0,o.__)("Controls","quicktasker"),className:`${t} wpqt-ml-6`,titleClassName:s,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3 wpqt-justify-center",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-1 wpqt-justify-center wpqt-items-center wpqt-h-[40px]",children:u?(0,n.jsx)(ls,{ovalSize:"32"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Active","quicktasker")}),(0,n.jsx)(za,{checked:e.active,handleChange:t=>Ac(this,void 0,void 0,(function*(){p(!0);const s=yield r(e.pipeline_id,e.id,t);p(!1),s.success&&c({type:ht,payload:{id:e.id,active:t}})}))})]})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-2",children:(0,n.jsx)(ua,{loading:l,icon:(0,n.jsx)(va.A,{className:"wpqt-icon-red wpqt-size-5"}),onClick:()=>Ac(this,void 0,void 0,(function*(){d(!0),yield i(e.pipeline_id,e.id,(t=>{t&&c({type:pt,payload:e.id})})),d(!1)})),text:(0,o.__)("Delete","quicktasker")})})]})})}function Cc({automation:e}){const t="wpqt-px-3 wpqt-pt-1 wpqt-min-w-[60px] wpqt-cursor-default",s="wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1",a=null!==e.automation_action_target_id&&null!==e.automation_action_target_type,i=null!==e.metadata;return(0,n.jsxs)("div",{className:"wpqt-flex",children:[(0,n.jsxs)("div",{className:"wpqt-flex-1 wpqt-flex wpqt-p-4 wpqt-items-center wpqt-justify-center wpqt-gap-3",children:[(0,n.jsx)(Pi,{title:(0,o.__)("Target","quicktasker"),className:t,titleClassName:s,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:Jr[e.target_type]})}),(0,n.jsx)(Hr.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(Pi,{title:(0,o.__)("Trigger","quicktasker"),className:t,titleClassName:s,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:Xr[e.automation_trigger]})}),(0,n.jsx)(Hr.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(Pi,{title:(0,o.__)("Action","quicktasker"),className:t,titleClassName:s,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center wpqt-items-center",children:[Yr[e.automation_action],a&&(0,n.jsx)(rc,{actionTargetId:e.automation_action_target_id,actionTargetType:e.automation_action_target_type}),i&&(0,n.jsx)("div",{children:e.metadata})]})})]}),(0,n.jsx)(Nc,{automation:e,className:`${t}`,titleClassName:s})]})}function Oc(){const{state:{automations:e,loading:t}}=(0,a.useContext)(ac);return t?(0,n.jsx)(ls,{ovalSize:"24"}):e&&0!==e.length?(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-4 wpqt-mx-auto wpqt-max-w-7xl",children:e.map((e=>(0,n.jsx)(Cc,{automation:e},e.id)))}):(0,n.jsx)(ei,{type:"info",children:(0,o.__)("No automations created for this board","quicktasker")})}function Ic(){const{state:{automationsModalOpen:e},modalDispatch:t}=(0,a.useContext)($s);return(0,n.jsx)(ma,{modalOpen:e,closeModal:()=>{t({type:fe})},size:"lg",children:(0,n.jsx)(Oc,{})})}function Dc({pipelineId:e}){const t=jt?(0,o.__)("Set up automated processes to help manage your board.","quicktasker"):(0,o.__)("Set up automated processes to help manage your board. To create more than one automation, please upgrade to the premium version.","quicktasker");return(0,n.jsx)(nc,{pipelineId:e,children:(0,n.jsxs)(Gr,{title:(0,o.__)("Board automations","quicktasker"),description:t,children:[(0,n.jsx)(Pc,{}),(0,n.jsx)(Ic,{}),(0,n.jsx)(Sc,{pipelineId:e})]})})}function Pc(){const{automations:e,loading:t}=function(){const{state:{automations:e,loading:t}}=(0,a.useContext)(ac);return{automations:e,loading:t}}(),{modalDispatch:s}=(0,a.useContext)($s),i=(null==e?void 0:e.length)||0,r=jt||i<1;return t?(0,n.jsx)(ls,{ovalSize:"24",className:"!wpqt-items-start"}):(0,n.jsxs)("div",{className:"wpqt-text-left",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:0===i?(0,n.jsx)("p",{children:(0,o.__)("There are no automations configured for this board.","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:(0,o.sprintf)((0,o.__)("There are %d automations configured for this board.","quicktasker"),i)}),(0,n.jsx)("div",{className:"wpqt-cursor-pointer wpqt-text-blue-500 hover:wpqt-underline",onClick:()=>{s({type:we})},children:(0,o.__)("Manage board automations","quicktasker")})]})}),r&&(0,n.jsx)("div",{className:"wpqt-cursor-pointer wpqt-text-blue-500 hover:wpqt-underline wpqt-flex",onClick:()=>{s({type:me})},children:(0,o.__)("Create a new automation","quicktasker")})]})}var Lc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Rc({allow_only_last_stage_task_done:e,pipelineId:t}){const[s,i]=(0,a.useState)(e),[r,c]=(0,a.useState)(!1),{saveTaskCompletionDoneSetting:l}=Vr();return(0,n.jsx)(Gr,{title:(0,o.__)("Restrict Task Completion","quicktasker"),description:(0,o.__)("Allow to mark task as done only on board last stage. By default, task can be marked as done on any stage. Will apply also to QuickTasker page.","quicktasker"),children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(za,{checked:s,handleChange:e=>Lc(this,void 0,void 0,(function*(){i(e),c(!0),yield l(t,e,(e=>{i(e)})),c(!1)}))}),r&&(0,n.jsx)(rs,{width:"20",height:"20"})]})})}var Mc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Uc({pipeline:e}){const[t,s]=(0,a.useState)(!0),[i,o]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(()=>{Mc(this,void 0,void 0,(function*(){try{s(!0);const a=yield(t=e.id,u()({path:`/wpqt/v1/pipelines/${t}/settings`,method:"GET",headers:p()}));o(hs(a.data.settings))}catch(e){console.error(e)}finally{s(!1)}var t}))})()}),[]),t?(0,n.jsx)(ls,{}):i?(0,n.jsxs)("div",{children:[(0,n.jsx)(Rc,{pipelineId:e.id,allow_only_last_stage_task_done:i.allow_only_last_stage_task_done}),(0,n.jsx)(Dc,{pipelineId:e.id})]}):null}function Fc(){const{state:{pipelines:e}}=(0,a.useContext)(xs),t=e.map((e=>e.name)),s=e.map((e=>(0,n.jsx)(Uc,{pipeline:e},e.id)));return(0,n.jsx)("div",{children:(0,n.jsx)(Gn,{tabs:t,tabsContent:s,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})})}const $c=()=>(0,n.jsxs)(ds,{children:[(0,n.jsx)(l,{description:(0,o.__)("Manage settings, preferences, and configurations.","quicktasker"),children:(0,o.__)("Settings","quicktasker")}),(0,n.jsx)(Br,{}),(0,n.jsx)(Fc,{})]});var zc=s(1548),Kc=s(1266),Vc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Gc(){return{createUser:(e,t,s)=>Vc(this,void 0,void 0,(function*(){try{const r=yield(a=e,n=t,u()({path:"/wpqt/v1/users",method:"POST",data:{name:a,description:n},headers:p()}));s&&s(r.data),i.oR.success((0,o.__)("User created successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("User creation failed. Please try again","quicktasker"))}var a,n})),editUser:(e,t)=>Vc(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/users/${e.id}`,method:"PATCH",data:{user:e},headers:p()})}(e);t&&t(s.data),i.oR.success((0,o.__)("User edited successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("User edit failed. Please try again","quicktasker"))}})),changeUserStatus:(e,t,s)=>Vc(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return u()({path:`/wpqt/v1/users/${e}/status`,method:"PATCH",data:{status:t},headers:p()})}(e,t);s&&s(a.data),i.oR.success((0,o.__)("User status changed successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change user status. Please try again","quicktasker"))}})),deleteUser:(e,t)=>Vc(this,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/users/${e}`,method:"DELETE",headers:p()})}(e),t&&t(e),i.oR.success((0,o.__)("User deleted successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete user. Please try again","quicktasker"))}})),resetUserPassword:(e,t)=>Vc(this,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/users/${e}/password-reset`,method:"PATCH",headers:p()})}(e),t&&t(e),i.oR.success((0,o.__)("User password reset successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to reset user password. Please try again","quicktasker"))}}))}}var Bc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Hc({data:e,changeStatus:t,changeSetUpStatus:s,changePasswordStatus:i}){const{changeUserStatus:r,deleteUser:c,resetUserPassword:l}=Gc(),{userDispatch:d}=(0,a.useContext)(Bs),{loading1:u,setLoading1:p,loading2:m,setLoading2:h,loading3:w,setLoading3:f}=ba(),q=e.is_active,x=e.has_password;return(0,n.jsxs)("div",{className:"wpqt-mt-5 wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(ua,{icon:(0,n.jsx)(Nr.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("User tasks","quicktasker"),onClick:()=>{window.location.hash=`#/users/${e.id}/tasks`}}),!q&&(0,n.jsx)(ua,{icon:(0,n.jsx)(zc.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Activate user","quicktasker"),loading:m,onClick:()=>Bc(this,void 0,void 0,(function*(){h(!0),yield r(e.id,!0,(e=>{d({type:Oe,payload:Object.assign({},e)}),t(!0)})),h(!1)}))}),q&&(0,n.jsx)(ua,{icon:(0,n.jsx)(zc.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Disable user","quicktasker"),loading:m,onClick:()=>Bc(this,void 0,void 0,(function*(){h(!0),yield r(e.id,!1,(e=>{d({type:Oe,payload:Object.assign({},e)}),t(!1)})),h(!1)}))}),x&&(0,n.jsx)(ua,{icon:(0,n.jsx)(Kc.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:u,text:(0,o.__)("Reset password","quicktasker"),onClick:()=>Bc(this,void 0,void 0,(function*(){p(!0),yield l(e.id,(()=>{s(!1),i(!1)})),p(!1)}))}),(0,n.jsx)(ua,{icon:(0,n.jsx)(va.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:w,text:(0,o.__)("Delete user","quicktasker"),onClick:()=>Bc(this,void 0,void 0,(function*(){f(!0),yield c(e.id,(e=>{d({type:Ie,payload:e}),window.location.hash="#/users"})),f(!1)}))})]})}var Wc=s(8624),Qc=s(3997),Yc=s(5028);function Jc(){const{state:{siteURL:e,publicUserPageId:t}}=(0,a.useContext)(Sa);return{userPage:e+`/wpqt?page=${t}&page_id=wpqt`}}function Xc({data:e}){const{userPage:t}=Jc(),{convertToWPTimezone:s}=Da(),a=e.is_active,i=t+"&code="+e.page_hash;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)(Zc,{label:(0,o.__)("Name","quicktasker"),value:e.name,icon:(0,n.jsx)(Wc.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(Zc,{label:(0,o.__)("Created at","quicktasker"),value:s(e.created_at),icon:(0,n.jsx)(Qc.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(Zc,{label:(0,o.__)("Assigned tasks count","quicktasker"),value:e.assigned_tasks_count,icon:(0,n.jsx)(Nr.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(Zc,{label:(0,o.__)("Setup completed","quicktasker"),value:e.setup_completed?(0,o.__)("Yes","quicktasker"):(0,o.__)("No","quicktasker"),icon:(0,n.jsx)(Yc.A,{className:"wpqt-size-5 wpqt-text-yellow-600"})}),(0,n.jsx)(Zc,{label:(0,o.__)("Is active","quicktasker"),value:a?(0,o.__)("Yes","quicktasker"):(0,o.__)("No","quicktasker"),icon:(0,n.jsx)(zc.A,{className:"wpqt-size-5 "+(a?"wpqt-icon-green":"wpqt-icon-red")})}),(0,n.jsx)(Zc,{label:(0,o.__)("User Page","quicktasker"),value:(0,n.jsx)("a",{href:i,rel:"noreferrer",target:"_blank",children:i}),icon:(0,n.jsx)(Fi.A,{className:"wpqt-size-5 wpqt-icon-blue"})})]})}function Zc({label:e,value:t,icon:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[s,(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[e,": "]}),(0,n.jsx)("span",{children:t})]})}var el=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function tl({userId:e}){const{loadingDispatch:t}=(0,a.useContext)(Yt),[s,r]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(()=>{el(this,void 0,void 0,(function*(){try{t({type:Me,payload:!0});const a=yield function(e){return u()({path:`/wpqt/v1/users/${e}/extended`,method:"GET",headers:p()})}(e);r((s=a.data,Object.assign(Object.assign({},s),{is_active:"1"===s.is_active})))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to get user data. Please try again","quicktasker"))}finally{t({type:Me,payload:!1})}var s}))})()}),[]),(0,n.jsx)(ds,{children:s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{description:(0,o.__)("User details","quicktasker"),children:s.name}),(0,n.jsx)(Xc,{data:s}),(0,n.jsx)(Hc,{data:s,changeStatus:e=>el(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{is_active:e}):t))})),changeSetUpStatus:e=>el(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{setup_completed:e}):t))})),changePasswordStatus:e=>el(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{has_password:e}):t))}))})]})})}const sl=e=>Object.assign(Object.assign({},e),{is_active:"1"===e.is_active}),al=(e,t)=>{var s;switch(t.type){case Ue:return Object.assign(Object.assign({},e),{sessionsSearchValue:null!==(s=t.payload)&&void 0!==s?s:""});case Fe:{const s=t.payload.map(sl);return Object.assign(Object.assign({},e),{userSessions:s})}case $e:{const{sessionId:s,status:a}=t.payload;return Object.assign(Object.assign({},e),{userSessions:e.userSessions.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_active:a}):e))})}case ze:{const s=t.payload;return Object.assign(Object.assign({},e),{userSessions:e.userSessions.filter((e=>e.id!==s))})}default:return e}};var nl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const il={loading:!0,sessionsSearchValue:"",userSessions:[]},ol=(0,a.createContext)({state:il,usersSessionDispatch:()=>{},loadUserSessions:()=>nl(void 0,void 0,void 0,(function*(){}))}),rl=({children:e})=>{const[t,s]=(0,a.useReducer)(al,il),{loadingDispatch:r}=(0,a.useContext)(Yt);(0,a.useEffect)((()=>{c()}),[]);const c=()=>nl(void 0,void 0,void 0,(function*(){try{r({type:Me,payload:!0});const e=yield u()({path:"/wpqt/v1/users/sessions",method:"GET",headers:p()});s({type:Fe,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch user sessions","quicktasker"))}finally{r({type:Me,payload:!1})}}));return(0,n.jsx)(ol.Provider,{value:{state:t,usersSessionDispatch:s,loadUserSessions:c},children:e})};function cl(){const{state:{sessionsSearchValue:e},usersSessionDispatch:t}=(0,a.useContext)(ol);return(0,n.jsx)(ys,{title:(0,o.__)("Session filtering","quicktasker"),searchChildren:(0,n.jsx)(bs,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"session-search",children:(0,n.jsx)(ms,{inputId:"session-search",value:e,onChange:e=>{t({type:Ue,payload:e})}})})})}const ll=()=>{const{state:{sessionsSearchValue:e}}=(0,a.useContext)(ol);return{filterSessions:t=>t.user_name.toLowerCase().includes(e.toLowerCase())||t.user_description&&t.user_description.toLowerCase().includes(e.toLowerCase())}};var dl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ul({session:e}){const{usersSessionDispatch:t}=(0,a.useContext)(ol),{state:{isUserAllowedToDelete:s}}=(0,a.useContext)(Sa),{convertToWPTimezone:r}=Da(),c=e.is_active,l=s=>dl(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/users/sessions/${e}/status`,method:"PATCH",data:{status:t},headers:p()})}(e.id,s),t({type:$e,payload:{sessionId:e.id,status:s}})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change session status","quicktasker"))}}));return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:e.user_name}),(0,n.jsx)("div",{className:"wpqt-italic",children:e.user_description})]}),(0,n.jsx)("div",{children:r(e.created_at_utc)}),(0,n.jsx)("div",{children:r(e.expires_at_utc)}),(0,n.jsx)("div",{className:c?"wpqt-text-qtTextGreen":"wpqt-text-qtTextRed",children:c?(0,o.__)("On","quicktasker"):(0,o.__)("Off","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-4",children:[c?(0,n.jsx)(zc.A,{className:"wpqt-icon-red wpqt-size-5 wpqt-cursor-pointer",onClick:()=>l(!1),title:(0,o.__)("Turn session off","quicktasker")}):(0,n.jsx)(zc.A,{className:"wpqt-icon-green wpqt-size-5 wpqt-cursor-pointer",onClick:()=>l(!0),title:(0,o.__)("Turn session on","quicktasker")}),s&&(0,n.jsx)(va.A,{className:"wpqt-icon-red wpqt-size-5 wpqt-cursor-pointer",title:(0,o.__)("Delete session","quicktasker"),onClick:()=>dl(this,void 0,void 0,(function*(){try{yield(s=e.id,u()({path:`/wpqt/v1/users/sessions/${s}`,method:"DELETE",headers:p()})),t({type:ze,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete session","quicktasker"))}var s}))})]})]})}function pl(){const{state:{userSessions:e}}=(0,a.useContext)(ol),{filterSessions:t}=ll(),s=e.filter(t);return 0===s.length?(0,n.jsx)(Ci,{text:(0,o.__)("No sessions found","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-grid wpqt-grid-cols-5 wpqt-font-bold",children:[(0,n.jsx)("div",{children:(0,o.__)("Session owner","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Created at","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Expires at","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Status","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Actions","quicktasker")})]}),(0,n.jsx)("div",{className:"wpqt-grid wpqt-grid-cols-5 wpqt-items-center wpqt-gap-y-4",children:s.map((e=>(0,n.jsx)(ul,{session:e},e.id)))})]})}function ml(){return(0,n.jsx)(rl,{children:(0,n.jsx)(ds,{children:(0,n.jsx)(hl,{})})})}function hl(){const{state:{userSessions:e}}=(0,a.useContext)(ol);return e.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{children:(0,o.__)("Quicktasker sessions","quicktasker")}),(0,n.jsx)(cl,{}),(0,n.jsx)(pl,{})]}):(0,n.jsx)(oo,{infoText:(0,o.__)("No sessions","quicktasker"),infoDescription:(0,o.__)("No QuickTasker sessions found","quicktasker")})}function wl(){const{state:{usersSearchValue:e},userDispatch:t}=(0,a.useContext)(Bs);return(0,n.jsx)(ys,{title:(0,o.__)("User filtering","quicktasker"),searchChildren:(0,n.jsx)(bs,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"user-search",children:(0,n.jsx)(ms,{inputId:"user-search",value:e,onChange:e=>{t({type:Ce,payload:e})}})})})}var fl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ql({userId:e}){return(0,n.jsx)(si,{typeId:e,fetchData:()=>fl(this,void 0,void 0,(function*(){try{return(yield f(e,Vt.User)).data}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load log","quicktasker"))}})),renderItem:e=>(0,n.jsx)(Qn,{log:e}),noDataMessage:(0,o.__)("No logs available","quicktasker"),explanation:(0,o.__)("Logs can be seen only by WordPress users (with required permissions)","quicktasker")})}var xl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function gl({userId:e}){return(0,n.jsx)(si,{typeId:e,fetchData:()=>xl(this,void 0,void 0,(function*(){try{return(yield h(e,Vt.User,!0)).data.map(li)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load private comments","quicktasker"))}})),onAdd:t=>xl(this,void 0,void 0,(function*(){try{const s=yield w(e,Vt.User,!0,t);return li(s.data.newComment)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add private comment","quicktasker"))}})),renderItem:e=>(0,n.jsx)(ni,{item:e}),noDataMessage:(0,o.__)("No comments available","quicktasker"),explanation:(0,o.__)("Comments that can be added and viewed only by WordPress users (with required permissions).","quicktasker"),enableAdd:!0})}var vl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function _l({userId:e}){const{addComment:t}=ci();return(0,n.jsx)(si,{typeId:e,fetchData:()=>vl(this,void 0,void 0,(function*(){try{return(yield h(e,Vt.User,!1)).data.map(li)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load comments","quicktasker"))}})),onAdd:s=>vl(this,void 0,void 0,(function*(){const a=yield t(e,Vt.User,!1,s);if(a)return li(a)})),renderItem:e=>(0,n.jsx)(ni,{item:e}),noDataMessage:(0,o.__)("No comments available","quicktasker"),explanation:(0,o.__)("Comments that can be added and viewed by WordPress users (with required permissions) and current QuickTasker user (in user page).","quicktasker"),enableAdd:!0})}function kl({user:e}){const t=[(0,o.__)("Private comments","quicktasker"),(0,o.__)("Public comments","quicktasker"),(0,o.__)("Logs","quicktasker")];return(0,n.jsx)(Gn,{tabs:t,tabsContent:[(0,n.jsx)(gl,{userId:e.id},1),(0,n.jsx)(_l,{userId:e.id},2),(0,n.jsx)(ql,{userId:e.id},3)]})}var jl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const yl=(0,a.forwardRef)((function({modalSaving:e,editUser:t},s){const{state:{userToEdit:i},modalDispatch:r}=(0,a.useContext)($s),{state:{isUserAllowedToDelete:c}}=(0,a.useContext)(Sa),[l,d]=(0,a.useState)(""),[u,p]=(0,a.useState)(""),[m,h]=(0,a.useState)(!1),[w,f]=(0,a.useState)(!1),{changeUserStatus:q,deleteUser:x,resetUserPassword:g}=Gc(),{userDispatch:v}=(0,a.useContext)(Bs),{loading1:_,setLoading1:k,loading2:j,setLoading2:y,loading3:b,setLoading3:T}=ba();(0,a.useEffect)((()=>{i&&(d(i.name),p(i.description),h(i.is_active),f(i.has_password))}),[i]);const E=()=>{d(""),p("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:E}))),i?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsxs)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:[(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-3 md:wpqt-grid-cols-[auto_1fr]",children:[(0,n.jsx)("div",{children:(0,n.jsxs)(wa,{children:[(0,n.jsx)(fa,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(ms,{isAutoFocus:!0,value:l,onChange:e=>d(e)})}),(0,n.jsx)(fa,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Fa,{rowsCount:3,value:u,onChange:e=>p(e)})})]})}),(0,n.jsx)(xn,{entityId:i.id,entityType:La.User})]}),(0,n.jsx)(qa,{onSave:()=>{i&&t(Object.assign(Object.assign({},i),{name:l,description:u}))},saveBtnText:e?(0,o.__)("Saving...","quicktasker"):(0,o.__)("Save","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mt-7",children:(0,n.jsx)(kl,{user:i})})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)(ua,{icon:(0,n.jsx)(Wc.A,{className:"wpqt-icon-blue wpqt-size-4"}),text:(0,o.__)("User details","quicktasker"),onClick:()=>{window.location.hash=`#/users/${i.id}`,r({type:Z})}}),(0,n.jsx)(ua,{icon:(0,n.jsx)(Nr.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("User tasks","quicktasker"),onClick:()=>{window.location.hash=`#/users/${i.id}/tasks`,r({type:Z})}}),w&&(0,n.jsx)(ua,{icon:(0,n.jsx)(Kc.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Reset password","quicktasker"),loading:_,onClick:()=>jl(this,void 0,void 0,(function*(){k(!0),yield g(i.id,(()=>{v({type:Pe,payload:i.id}),f(!1)})),k(!1)}))}),!m&&(0,n.jsx)(ua,{icon:(0,n.jsx)(zc.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Activate user","quicktasker"),loading:j,onClick:()=>jl(this,void 0,void 0,(function*(){y(!0),yield q(i.id,!0,(e=>{v({type:Oe,payload:Object.assign({},e)}),h(!0)})),y(!1)}))}),m&&(0,n.jsx)(ua,{icon:(0,n.jsx)(zc.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Disable user","quicktasker"),loading:j,onClick:()=>jl(this,void 0,void 0,(function*(){y(!0),yield q(i.id,!1,(e=>{v({type:Oe,payload:Object.assign({},e)}),h(!1)})),y(!1)}))}),c&&(0,n.jsx)(ua,{icon:(0,n.jsx)(va.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Delete user","quicktasker"),loading:b,onClick:()=>jl(this,void 0,void 0,(function*(){T(!0),yield x(i.id,(e=>{v({type:Ie,payload:e}),r({type:Z})})),T(!1)}))})]})]})}):null}));var bl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Tl(){const{state:{userModalOpen:e}}=(0,a.useContext)($s),{modalSaving:t,setModalSaving:s,modalContentRef:i,closeModal:o,handleSuccess:r}=Qs(Z),{editUser:c}=Gc();return(0,n.jsx)(ma,{modalOpen:e,closeModal:o,size:"xl",children:(0,n.jsx)(yl,{ref:i,modalSaving:t,editUser:e=>bl(this,void 0,void 0,(function*(){s(!0),yield c(e,(e=>{r(Oe,e,Ws.USER)})),s(!1)}))})})}function El(){const{state:{userSettingsModalOpen:e},modalDispatch:t}=(0,a.useContext)($s);return(0,n.jsx)(ma,{modalOpen:e,closeModal:()=>t({type:ae,payload:!1}),size:"lg",children:(0,n.jsx)("div",{children:(0,n.jsx)(xn,{entityId:"null",entityType:La.Users})})})}var Sl=s(8316),Al=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Nl(){const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(""),{userDispatch:d}=(0,a.useContext)(Bs),{createUser:u}=Gc(),p=()=>{r(""),l(""),t(!1)};return(0,n.jsx)("div",{className:"wpqt-mb-6",children:e?(0,n.jsxs)("div",{className:"wpqt-w-1/4",children:[(0,n.jsx)("label",{className:"wpqt-mb-2 wpqt-block wpqt-font-semibold",children:(0,o.__)("User name","quicktasker")}),(0,n.jsx)(ms,{value:s,onChange:r,className:"wpqt-w-full"}),(0,n.jsx)("label",{className:"wpqt-mb-2 wpqt-block wpqt-font-semibold",children:(0,o.__)("User description","quicktasker")}),(0,n.jsx)(Fa,{value:c,onChange:l,className:"wpqt-w-full"}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:[(0,n.jsx)(ua,{text:(0,o.__)("Cancel","quicktasker"),onClick:p,icon:(0,n.jsx)(oa.A,{className:"wpqt-icon-red wpqt-size-5"})}),(0,n.jsx)(ua,{text:(0,o.__)("Add","quicktasker"),onClick:()=>Al(this,void 0,void 0,(function*(){s?yield u(s,c,(e=>{d({type:Ne,payload:e}),p()})):i.oR.error("User name is required")})),icon:(0,n.jsx)(Sl.A,{className:"wpqt-icon-green wpqt-size-5"})})]})]}):(0,n.jsx)(ua,{text:(0,o.__)("Add QuickTasker","quicktasker"),onClick:()=>t(!0),icon:(0,n.jsx)(Sl.A,{className:"wpqt-icon-green wpqt-size-5"})})})}const Cl=()=>{const{state:{usersSearchValue:e}}=(0,a.useContext)(Bs);return{filterUsers:t=>t.name.toLowerCase().includes(e.toLowerCase())||t.description&&t.description.toLowerCase().includes(e.toLowerCase())}};var Ol=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Il({user:e}){const{modalDispatch:t}=(0,a.useContext)($s),{userDispatch:s}=(0,a.useContext)(Bs),{changeUserStatus:i,deleteUser:r,resetUserPassword:c}=Gc(),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),w=e.is_active,f=t=>Ol(this,void 0,void 0,(function*(){h(!0),yield i(e.id,t,(()=>{s({type:De,payload:{userId:e.id,isActive:t}})})),h(!1)}));return(0,n.jsxs)(kn,{menuBtn:({active:e})=>(0,n.jsx)(jn,{isActive:e,IconComponent:Ui.A}),children:[(0,n.jsx)(yn,{text:(0,o.__)("User details","quicktasker"),icon:(0,n.jsx)(Wc.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}`}}),(0,n.jsx)(yn,{text:(0,o.__)("User tasks","quicktasker"),icon:(0,n.jsx)(Nr.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}/tasks`}}),(0,n.jsx)(yn,{text:(0,o.__)("Edit user","quicktasker"),icon:(0,n.jsx)(Nn.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:ee,payload:e})}}),e.has_password&&(0,n.jsx)(yn,{text:(0,o.__)("Reset password","quicktasker"),loading:l,icon:(0,n.jsx)(Kc.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>Ol(this,void 0,void 0,(function*(){t.stopPropagation(),d(!0),yield c(e.id,(()=>{s({type:Pe,payload:e.id})})),d(!1)}))}),w&&(0,n.jsx)(yn,{text:(0,o.__)("Disable user","quicktasker"),loading:m,icon:(0,n.jsx)(zc.A,{className:"wpqt-icon-red wpqt-size-4"}),className:"!wpqt-mb-0",onClick:e=>{e.stopPropagation(),f(!1)}}),!w&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(yn,{text:(0,o.__)("Activate user","quicktasker"),loading:m,icon:(0,n.jsx)(zc.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:e=>{e.stopPropagation(),f(!0)}}),(0,n.jsx)(yn,{text:(0,o.__)("Delete user","quicktasker"),loading:u,icon:(0,n.jsx)(va.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>Ol(this,void 0,void 0,(function*(){t.stopPropagation(),p(!0),yield r(e.id,(e=>{s({type:Ie,payload:e})})),p(!1)}))})]})]})}function Dl({user:e}){const{userPage:t}=Jc(),{modalDispatch:s}=(0,a.useContext)($s),i=e.is_active,r=t+"&code="+e.page_hash;return(0,n.jsxs)(Pi,{title:e.name,description:e.description,dropdown:(0,n.jsx)(Il,{user:e}),onClick:()=>{s({type:ee,payload:e})},className:"wpqt-cursor-pointer",children:[(0,n.jsx)(Mi,{className:"hover:wpqt-underline wpqt-self-start",label:(0,o.__)("Open user page","quicktasker"),icon:(0,n.jsx)(Fi.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:e=>{e.stopPropagation(),window.open(r,"_blank")}}),(0,n.jsx)(Mi,{className:"hover:wpqt-underline wpqt-self-start",label:(0,o.__)("View user details","quicktasker"),icon:(0,n.jsx)(Fi.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}`}}),(0,n.jsx)(Mi,{label:(0,o.__)("Status","quicktasker"),value:i?(0,o.__)("Active","quicktasker"):(0,o.__)("Disabled","quicktasker"),valueClassName:i?"wpqt-text-qtTextGreen wpqt-font-bold":"wpqt-text-qtTextRed wpqt-font-bold",icon:(0,n.jsx)(zc.A,{className:"wpqt-size-5 "+(i?"wpqt-icon-green":"wpqt-icon-red")})})]})}function Pl(){const{state:{users:e}}=(0,a.useContext)(Bs),{filterUsers:t}=Cl(),s=e.filter(t);return e&&0===e.length?(0,n.jsx)(Ci,{text:(0,o.__)("No users found","quicktasker")}):s&&0===s.length?(0,n.jsx)(Ci,{}):(0,n.jsx)("div",{className:"wpqt-card-grid",children:s.map((e=>(0,n.jsx)(Dl,{user:e},e.id)))})}function Ll(){return(0,n.jsxs)("div",{children:[(0,n.jsx)(Nl,{}),(0,n.jsx)(wl,{}),(0,n.jsx)(Pl,{}),(0,n.jsx)(El,{}),(0,n.jsx)(Tl,{})]})}var Rl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};var Ml=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ul({user:e}){const[t,s]=(0,a.useState)({quicktasker_admin_role:"quicktasker_admin_role"in e.allcaps,quicktasker_admin_role_allow_delete:"quicktasker_admin_role_allow_delete"in e.allcaps,quicktasker_admin_role_manage_users:"quicktasker_admin_role_manage_users"in e.allcaps,quicktasker_admin_role_manage_settings:"quicktasker_admin_role_manage_settings"in e.allcaps}),[i,r]=(0,a.useState)(!1),{updateWPUserCapabilities:c}=function(){return{updateWPUserCapabilities:(e,t,s,a)=>Rl(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/wp-users/${e}/capabilities`,method:"PATCH",data:{quicktasker_admin_role:t.quicktasker_admin_role,quicktasker_admin_role_allow_delete:t.quicktasker_admin_role_allow_delete,quicktasker_admin_role_manage_users:t.quicktasker_admin_role_manage_users,quicktasker_admin_role_manage_settings:t.quicktasker_admin_role_manage_settings},headers:p()})}(e,t),s&&s()}catch(e){a&&a(e)}}))}}(),l=(a,n)=>Ml(this,void 0,void 0,(function*(){if(i)return;r(!0);const o=Object.assign({},t),l=Object.assign(Object.assign({},t),{[n]:a});s(l),yield c(e.id,l,(()=>{}),(()=>{s(o)})),r(!1)}));return(0,n.jsxs)(Pi,{title:e.name,description:e.description,children:[(0,n.jsx)(Mi,{label:(0,o.__)("Role","quicktasker"),value:Array.isArray(e.roles)?e.roles.join(", "):""}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to admin areas","quicktasker")}),(0,n.jsx)(za,{checked:t.quicktasker_admin_role,handleChange:e=>{l(e,"quicktasker_admin_role")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to users page","quicktasker")}),(0,n.jsx)(za,{checked:t.quicktasker_admin_role_manage_users,handleChange:e=>{l(e,"quicktasker_admin_role_manage_users")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to settings page","quicktasker")}),(0,n.jsx)(za,{checked:t.quicktasker_admin_role_manage_settings,handleChange:e=>{l(e,"quicktasker_admin_role_manage_settings")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Allow to delete resources","quicktasker")}),(0,n.jsx)(za,{checked:t.quicktasker_admin_role_allow_delete,handleChange:e=>{l(e,"quicktasker_admin_role_allow_delete")}})]}),i&&(0,n.jsx)(ls,{ovalSize:"24"})]})}var Fl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function $l(){const[e,t]=(0,a.useState)(null),[s,i]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(()=>{Fl(this,void 0,void 0,(function*(){try{i(!0);const s=yield(e=Ht.Other,u()({path:`/wpqt/v1/wp-users?type=${encodeURIComponent(e)}`,method:"GET",headers:p()}));t(s.data)}catch(e){console.error(e)}finally{i(!1)}var e}))})()}),[]),s||null===e?(0,n.jsx)(ls,{ovalSize:"48"}):0===e.length?(0,n.jsx)(Ci,{text:(0,o.__)("No non-admin WordPress users found","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Displaying non-admin WordPress users.","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-card-grid",children:e.map((e=>(0,n.jsx)(Ul,{user:e},e.id)))})]})}function zl(){const{updateUsers:e}=(0,a.useContext)(Bs),{loadingDispatch:t}=(0,a.useContext)(Yt),{modalDispatch:s}=(0,a.useContext)($s),i=[(0,n.jsx)(Ll,{},0),(0,n.jsx)($l,{},1)];return(0,a.useEffect)((()=>{(()=>{var s,a,n,i;s=this,a=void 0,i=function*(){t({type:Me,payload:!0}),yield e(),t({type:Me,payload:!1})},new((n=void 0)||(n=Promise))((function(e,t){function o(e){try{c(i.next(e))}catch(e){t(e)}}function r(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(s,a||[])).next())}))})()}),[]),(0,n.jsxs)(ds,{children:[(0,n.jsx)(l,{description:(0,o.__)("Manage QuickTaskers and WordPress users. This plugin supports three types of users: WordPress admins, other WordPress users, and QuickTaskers. WordPress admins have full access to all admin areas. Other WordPress users do not have any access by default but can be granted if needed. QuickTaskers are separate users who do not have admin access but can manage tasks through a mobile-friendly webpage.","quicktasker"),icon:(0,n.jsx)(pr.A,{className:"wpqt-icon-gray wpqt-size-7 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{s({type:ae,payload:!0})}}),children:(0,o.__)("Users","quicktasker")}),(0,n.jsx)(Gn,{tabs:["QuickTaskers","WordPress users"],tabsContent:i,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})]})}const Kl=(e,t)=>{switch(t.type){case Ke:{const s=t.payload.map(zt);return Object.assign(Object.assign({},e),{tasks:s})}case Ge:{const s=t.payload;return Object.assign(Object.assign({},e),{tasks:e.tasks.filter((e=>e.id!==s))})}case Be:{const s=t.payload,a=e.tasks.map((e=>e.id===s.id?zt(s):e));return Object.assign(Object.assign({},e),{tasks:a})}case Ve:{const s=t.payload;return Object.assign(Object.assign({},e),{searchValue:s})}case He:{const s=t.payload;return Object.assign(Object.assign({},e),{filteredPipelineId:s})}case We:{const{taskId:s,user:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:Rt(a)?[a,...e.assigned_users]:e.assigned_users,assigned_wp_users:Mt(a)?[a,...e.assigned_wp_users]:e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{tasks:n})}case Qe:{const{taskId:s,user:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:Rt(a)?e.assigned_users.filter((e=>e.id!==a.id)):e.assigned_users,assigned_wp_users:Mt(a)?e.assigned_wp_users.filter((e=>e.id!==a.id)):e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{tasks:n})}case Ye:{const{taskId:s,done:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}default:return e}};var Vl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Gl={tasks:[],searchValue:"",filteredPipelineId:""},Bl=(0,a.createContext)({state:Gl,userTasksDispatch:()=>{},fetchAndSetUserTasks:()=>Vl(void 0,void 0,void 0,(function*(){}))}),Hl=({children:e,userId:t})=>{const[s,r]=(0,a.useReducer)(Kl,Gl),{loadingDispatch:c}=(0,a.useContext)(Yt);(0,a.useEffect)((()=>{l()}),[]);const l=()=>Vl(void 0,void 0,void 0,(function*(){try{c({type:Me,payload:!0});const e=yield function(e){return u()({path:`/wpqt/v1/users/${e}/tasks`,method:"GET",headers:p()})}(t);r({type:Ke,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch user tasks","quicktasker"))}finally{c({type:Me,payload:!1})}}));return(0,n.jsx)(Bl.Provider,{value:{state:s,userTasksDispatch:r,fetchAndSetUserTasks:l},children:e})};function Wl(){const{state:{searchValue:e,filteredPipelineId:t},userTasksDispatch:s}=(0,a.useContext)(Bl);return(0,n.jsx)(ys,{title:(0,o.__)("Filter tasks","quicktasker"),searchChildren:(0,n.jsx)(bs,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"user-tasks-search",children:(0,n.jsx)(ms,{inputId:"user-tasks-search",value:e,onChange:e=>{s({type:Ve,payload:e})},className:"!wpqt-mb-0"})}),children:(0,n.jsx)(bs,{title:(0,o.__)("Board","quicktasker"),children:(0,n.jsx)(ks,{selectedOptionValue:t,selectionChange:e=>{s({type:He,payload:e})}})})})}var Ql=s(7028),Yl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Jl({taskId:e,onUnAssignTask:t}){const[s,i]=(0,a.useState)(!1);return(0,n.jsx)(kn,{menuBtn:({active:e})=>(0,n.jsx)(jn,{isActive:e,IconComponent:Ui.A}),children:(0,n.jsx)(yn,{text:(0,o.__)("Unassign from task","quicktasker"),loading:s,icon:(0,n.jsx)(Ql.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:s=>Yl(this,void 0,void 0,(function*(){s.stopPropagation(),i(!0),yield t(e),i(!1)})),className:"!wpqt-mb-0"})})}const Xl=()=>{const{state:{searchValue:e,filteredPipelineId:t}}=(0,a.useContext)(Bl);return{filterTasks:s=>{const a=s.name&&s.name.toLowerCase().includes(e.toLowerCase())||s.description&&s.description.toLowerCase().includes(e.toLowerCase()),n=!t||s.pipeline_id===t;return a&&n}}};var Zl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ed({userId:e}){var t;const{filterTasks:s}=Xl(),{modalDispatch:i}=(0,a.useContext)($s),{state:{tasks:r},userTasksDispatch:c}=(0,a.useContext)(Bl),{removeTaskFromUser:l}=Ls(),d=null!==(t=null==r?void 0:r.filter(s))&&void 0!==t?t:[],u=t=>Zl(this,void 0,void 0,(function*(){yield l(e,t,(()=>{c({type:Ge,payload:t})}))}));return r&&0===r.length?(0,n.jsx)(Ci,{text:(0,o.__)("User has no tasks","quicktasker")}):d&&0===d.length?(0,n.jsx)(Ci,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-card-grid",children:d.map((e=>(0,n.jsxs)(Pi,{className:"wpqt-cursor-pointer",title:e.name,description:e.description,dropdown:(0,n.jsx)(Jl,{taskId:e.id,onUnAssignTask:u}),onClick:()=>{i({type:G,payload:{taskToEdit:e}})},children:[(0,n.jsx)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:(0,n.jsx)(Kn,{task:e,onUserAdd:t=>{c({type:We,payload:{taskId:e.id,user:t}})},onUserDelete:t=>{c({type:Qe,payload:{taskId:e.id,user:t}})}})}),(0,n.jsx)(Ri,{task:e,onDoneStatusChange:(e,t)=>{c({type:Ye,payload:{taskId:e,done:t}})}})]},e.id)))}),(0,n.jsx)(Ni,{editTaskCallback:e=>{c({type:Be,payload:e})}})]})}function td({userId:e}){return(0,n.jsx)(Hl,{userId:e,children:(0,n.jsxs)(ds,{children:[(0,n.jsx)(l,{description:(0,o.__)("Tasks assigned to user","quicktasker"),children:(0,o.__)("User tasks","quicktasker")}),(0,n.jsx)(Wl,{}),(0,n.jsx)(ed,{userId:e})]})})}const sd=()=>{const{page:e,hash:t}=ad();if("wp-quick-tasks"===e){const e=t.match(/^#\/users\/(\d+)\/tasks$/);if(e){const t=e[1];return(0,n.jsx)(td,{userId:t})}const s=t.match(/^#\/users\/(\d+)$/);if(s){const e=s[1];return(0,n.jsx)(tl,{userId:e})}switch(t){case"#/users":return(0,n.jsx)(zl,{});case"#/overview":return(0,n.jsx)(go,{});case"#/archive":return(0,n.jsx)(Bi,{});case"#/user-sessions":return(0,n.jsx)(ml,{});case"#/logs":return(0,n.jsx)(io,{});case"#/settings":return(0,n.jsx)($c,{});case"#/guide":return(0,n.jsx)(Hi,{});default:return(0,n.jsx)(Fr,{})}}},ad=()=>({page:new URLSearchParams(window.location.search).get("page"),hash:window.location.hash}),nd=function(){const e=(()=>{const[e,t]=(0,a.useState)(sd());return(0,a.useEffect)((()=>{const e=()=>{t(sd()),(()=>{const{page:e,hash:t}=ad();if("wp-quick-tasks"!==e)return;const s=document.querySelectorAll("#toplevel_page_wp-quick-tasks .wp-submenu li");s.forEach((e=>e.classList.remove("wpqt-current")));const a={"#/users":"#/users","#/overview":"#/overview","#/archive":"#/archive","#/user-sessions":"#/user-sessions","#/logs":"#/logs","#/settings":"#/settings","#/guide":"#/guide",default:""};let n=a.default;void 0!==a[t]?n=a[t]:/^#\/users(\/\d+)?(\/tasks)?$/.test(t)&&(n="#/users"),s.forEach((e=>{const t=e.querySelector("a");t&&t.getAttribute("href")&&t.getAttribute("href")===`admin.php?page=wp-quick-tasks${n}`&&e.classList.add("wpqt-current")}))})()};return e(),window.addEventListener("popstate",e),window.addEventListener("hashchange",e),()=>{window.removeEventListener("popstate",e),window.removeEventListener("hashchange",e)}}),[]),e})();return(0,n.jsx)(c,{children:(0,n.jsx)(Aa,{children:(0,n.jsx)(Hs,{children:(0,n.jsx)(zs,{children:(0,n.jsx)(gs,{children:(0,n.jsxs)(Jt,{children:[e,(0,n.jsx)(i.N9,{position:"bottom-right",className:"wpqt-z-[999999]"})]})})})})})})};(0,a.render)((0,n.jsx)(nd,{}),document.getElementById("wpqt-app"))},1609:e=>{e.exports=window.React},5795:e=>{e.exports=window.ReactDOM},790:e=>{e.exports=window.ReactJSXRuntime}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return a[e].call(s.exports,s,s.exports,i),s.exports}i.m=a,e=[],i.O=(t,s,a,n)=>{if(!s){var o=1/0;for(d=0;d<e.length;d++){for(var[s,a,n]=e[d],r=!0,c=0;c<s.length;c++)(!1&n||o>=n)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(r=!1,n<o&&(o=n));if(r){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,a,n]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},s=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var n=Object.create(null);i.r(n);var o={};t=t||[null,s({}),s([]),s(s)];for(var r=2&a&&e;"object"==typeof r&&!~t.indexOf(r);r=s(r))Object.getOwnPropertyNames(r).forEach((t=>o[t]=()=>e[t]));return o.default=()=>e,i.d(n,o),n},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=524,(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var a=s.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=s[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={524:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[o,r,c]=s,l=0;if(o.some((t=>0!==e[t]))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(c)var d=c(i)}for(t&&t(s);l<o.length;l++)n=o[l],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},s=globalThis.webpackChunkquicktasker=globalThis.webpackChunkquicktasker||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.nc=void 0;var o=i.O(void 0,[96],(()=>i(1757)));o=i.O(o)})();