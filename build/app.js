(()=>{"use strict";var e,t,s,a={4720(e,t,s){const a=window.wp.element;var n=s(790),i=s(9571);const o=window.wp.i18n;class r extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){var e;return this.state.hasError?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-h-screen wpqt-items-center wpqt-justify-center wpqt-text-center wpqt-text-lg",children:[(0,o.__)("Something went wrong. Please refresh the page.","quicktasker"),(0,n.jsx)("br",{}),null===(e=this.state.error)||void 0===e?void 0:e.message]}):this.props.children}}const c=r;var l=s(12);function d({children:e,description:t=null,icon:s=null}){return(0,n.jsx)("div",{className:"wpqt-mb-6 wpqt-inline-grid wpqt-grid-cols-[auto_auto] wpqt-items-center wpqt-gap-2",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("h1",{children:[e,s&&(0,n.jsx)("span",{className:"wpqt-ml-1 wpqt-align-middle",children:s})]}),t&&(0,n.jsx)("div",{children:t})]})})}var u=s(7908);const p="SET_LOADING",h="SET_PIPELINE",m="MOVE_TASK",w="ADD_TASK",f="ADD_STAGE",k="DELETE_STAGE",q="EDIT_TASK",g="EDIT_STAGE",x="ADD_PIPELINE",_="EDIT_PIPELINE",v="SET_PRIMARY",j="SET_PIPELINES",b="ADD_USER_TO_TASK",y="REMOVE_USER_FROM_TASK",E="CHANGE_TASK_DONE_STATUS",T="REMOVE_PIPELINE",S="REMOVE_ACTIVE_PIPELINE",A="REMOVE_TASK",O="TOGGLE_VIEW",N="ADD_LABEL_TO_TASK",C="REMOVE_LABEL_FROM_TASK",I="EDIT_PIPELINE_LABEL",D="REMOVE_PIPELINE_LABEL",P="SET_TASK_FOCUS_COLOR",R="EDIT_PIPELINE_SETTINGS",L="SET_STAGE_FILTER",M="SET_USER_FILTER",U="SET_TASK_VIEW_SEARCH_TEXT",F="OPEN_EDIT_TASK_MODAL",K="CLOSE_TASK_MODAL",$="OPEN_NEW_STAGE_MODAL",z="CLOSE_STAGE_MODAL",G="OPEN_STAGE_EDIT_MODAL",V="OPEN_NEW_PIPELINE_MODAL",B="OPEN_EDIT_PIPELINE_MODAL",H="CLOSE_PIPELINE_EDIT_MODAL",W="CLOSE_USER_MODAL",Q="OPEN_EDIT_USER_MODAL",Y="ADD_ASSIGNED_USER_TO_EDITING_TASK",J="REMOVE_ASSIGNED_USER_FROM_EDITING_TASK",X="CHANGE_USER_SETTINGS_MODAL_OPEN",Z="OPEN_MOVE_TASK_MODAL",ee="CLOSE_MOVE_TASK_MODAL",te="OPEN_TASK_COLOR_MODAL",se="CLOSE_TASK_COLOR_MODAL",ae="OPEN_TASK_EXPORT_MODAL",ne="CLOSE_TASK_EXPORT_MODAL",ie="CHANGE_TASK_EXPORT_MODAL_METHOD",oe="OPEN_PIPELINE_IMPORT_MODAL",re="CLOSE_PIPELINE_IMPORT_MODAL",ce="ARCHIVE_SETTINGS_MODAL_OPEN",le="OPEN_TASK_RESTORE_MODAL",de="CLOSE_TASK_RESTORE_MODAL",ue="SET_CUSTOM_FIELD_CREATOR_MODAL_OPEN",pe="SET_CUSTOM_FIELD_RECOVERY_MODAL_OPEN",he="OPEN_WEBHOOKS_LOGS_MODAL",me="CLOSE_WEBHOOKS_LOGS_MODAL",we="OPEN_AUTOMATION_LOGS_MODAL",fe="CLOSE_AUTOMATION_LOGS_MODAL",ke="SET_ARCHIVE_TASKS",qe="SET_ARCHIVE_SEARCH_VALUE",ge="SET_ARCHIVE_FILTERED_PIPELINE",xe="REMOVE_ARCHIVED_TASK",_e="REMOVE_ARCHIVED_TASKS",ve="ADD_ASSIGNED_USER_TO_ARCHIVED_TASK",je="REMOVE_ASSINGED_USER_FROM_ARCHIVED_TASK",be="CHANGE_ARCHIVED_TASK_DONE_STATUS",ye="EDIT_ARCHIVED_TASK",Ee="CHANGE_ARCHIVE_TASK_DONE_FILTER",Te="ADD_LABEL_ARCHIVED_TASK",Se="REMOVE_LABEL_ARCHIVED_TASK",Ae="CHANGE_ARCHIVED_TASKS_LIMIT_FILTER",Oe="SET_ARCHIVE_LOADING",Ne="SET_ARCHIVE_FILTER_ORDER",Ce="SET_USERS",Ie="SET_WP_USERS",De="ADD_USER",Pe="SET_USERS_SEARCH_VALUE",Re="EDIT_USER",Le="DELETE_USER",Me="CHANGE_USER_STATUS",Ue="RESET_PASSWORD",Fe="INIT_APP_STATE",Ke="SET_CUSTOM_USER_PAGE_STYLES",$e="SET_FULL_PAGE_LOADING",ze="SET_USER_SESSIONS_SEARCH_VALUE",Ge="SET_USER_SESSIONS",Ve="CHANGE_USER_SESSION_STATUS",Be="DELETE_USER_SESSION",He="SET_USER_TASKS",We="SET_USER_TASKS_SEARCH_VALUE",Qe="REMOVE_USER_TASK",Ye="EDIT_USER_TASK",Je="SET_USER_TASKS_FILTERED_PIPELINE",Xe="ADD_ASSIGNED_USER_TO_USER_TASK",Ze="REMOVE_ASSIGNED_USER_FROM_USER_TASK",et="CHANGE_USER_TASK_DONE_STATUS",tt="SET_CUSTOM_FIELDS",st="ADD_CUSTOM_FIELD",at="DELETE_CUSTOM_FIELD",nt="SET_CUSTOM_FIELD_LOADING",it="SET_CUSTOM_FIELD_INITIAL_DATA",ot="SET_LABELS",rt="ADD_LABEL",ct="REMOVE_LABEL",lt="EDIT_LABEL",dt="SET_LABEL_ACTION_STATE_SELECTION",ut="SET_LABEL_ACTION_STATE_EDITING",pt="SET_LABEL_ACTION_STATE_CREATION",ht="RESET_LABEL_CONTEXT",mt="SET_PIPELINE_AUTOMATIONS",wt="SET_PIPELINE_AUTOMATIONS_LOADING",ft="REMOVE_PIPELINE_AUTOMATION",kt="ADD_PIPELINE_AUTOMATION",qt="UPDATE_PIPELINE_AUTOMATION_ACTIVE_STATUS",gt="SET_META",xt="SET_ACTION_TARGET",_t="RESET_AUTOMATION_TO_TARGET",vt="RESET_AUTOMATION_TO_TRIGGER",jt="RESET_AUTOMATION_TO_ACTION",bt="SET_PIPELINE_WEBHOOKS",yt="SET_PIPELINE_WEBHOOKS_LOADING",Et="REMOVE_PIPELINE_WEBHOOK",Tt="ADD_PIPELINE_WEBHOOK",St="EDIT_PIPELINE_WEBHOOK",At="SET_UPLOADS",Ot="ADD_UPLOAD",Nt="REMOVE_UPLOAD",Ct="#ffffff",It="solid",Dt="#16a34a",Pt=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","text/plain","image/jpeg","image/png","image/gif","image/bmp","image/svg+xml","audio/mpeg","audio/wav","audio/ogg","video/mp4","video/webm","video/ogg","application/zip","application/x-rar-compressed","application/x-tar","application/gzip"],Rt=26214400,Lt=/^[a-zA-Z0-9_\-.]+$/,Mt=window.wp.apiFetch;var Ut,Ft=s.n(Mt);function Kt(){return{"Content-Type":"application/json","X-WPQT-API-Nonce":window.wpqt.apiNonce}}function $t(e,t,s){return Ft()({path:`/wpqt/v1/tasks/${e}/move`,method:"PATCH",data:{stageId:t,order:s},headers:Kt()})}function zt(e,t,s){const a=new URLSearchParams({typeId:e,type:t,isPrivate:s.toString()}).toString();return Ft()({path:`/wpqt/v1/comments?${a}`,method:"GET",headers:Kt()})}function Gt(e,t,s,a){return Ft()({path:"/wpqt/v1/comments",data:{comment:a,typeId:e,type:t,isPrivate:s},method:"POST",headers:Kt()})}function Vt(e,t){const s=new URLSearchParams({typeId:e,type:t});return Ft()({path:`/wpqt/v1/logs?${s.toString()}`,method:"GET",headers:Kt()})}function Bt(e){const t=new URLSearchParams(Object.entries(e).reduce(((e,[t,s])=>(e[t]=String(s),e)),{}));return Ft()({path:`/wpqt/v1/global-logs?${t.toString()}`,method:"GET",headers:Kt()})}function Ht(e,t,s){return Ft()({path:`/wpqt/v1/users/${e}/tasks/${t}`,method:"DELETE",data:{user_type:s},headers:Kt()})}function Wt(e,t,s){const a=new URLSearchParams({entityId:e,entityType:t,active:String(s)});return Ft()({path:`/wpqt/v1/custom-fields?${a.toString()}`,method:"GET",headers:Kt()})}!function(e){e.QUICKTASKER="quicktasker",e.WP_USER="wp-user"}(Ut||(Ut={}));function Qt(e){return!e.user_type||e.user_type===Ut.QUICKTASKER}function Yt(e){return e.user_type===Ut.WP_USER}const Jt=e=>Object.assign(Object.assign({},e),{allow_only_last_stage_task_done:"1"===e.allow_only_last_stage_task_done});var Xt,Zt,es,ts,ss,as;!function(e){e.TASK_DONE="task-done",e.Task_NOT_DONE="task-not-done",e.TASK_CREATED="task-created",e.TASK_DELETED="task-deleted",e.TASK_ASSIGNED="task-assigned",e.TASK_UNASSIGNED="task-unassigned",e.TASK_PUBLIC_COMMENT_ADDED="task-public-comment-added",e.TASK_PRIVATE_COMMENT_ADDED="task-private-comment-added",e.TASK_FILE_UPLOADED="task-attachment-added",e.TASK_FILE_DELETED="task-attachment-deleted"}(Xt||(Xt={})),function(e){e.WOOCOMMERCE_ORDER_ADDED="woocommerce-order-added"}(Zt||(Zt={})),function(e){e.SEATREG_BOOKING_CREATED="seatreg-booking-created",e.SEATREG_BOOKING_APPROVED="seatreg-booking-approved",e.SEATREG_BOOKING_APPROVED_VIA_MANAGER="seatreg-booking-approved-via-manager",e.SEATREG_BOOKING_PENDING="seatreg-booking-pending",e.SEATREG_BOOKING_PENDING_VIA_MANAGER="seatreg-booking-pending-via-manager"}(es||(es={})),function(e){e.PIPELINE="pipeline",e.Stage="stage",e.Task="task",e.quicktasker="quicktasker",e.WOOCOMMERCE_ORDER="woocommerce-order",e.SEATREG_BOOKING="seatreg-booking"}(ts||(ts={})),function(e){e.PIPELINE="pipeline",e.STAGE="stage",e.TASK="task",e.QUICKTASKER="quicktasker",e.WP_USER="wp-user"}(ss||(ss={})),function(e){e.ARCHIVE_TASK="archive-task",e.ASSIGN_USER="assign-user",e.NEW_ENTITY_EMAIL="new-entity-email",e.DELETED_ENTITY_EMAIL="deleted-entity-email",e.TASK_ASSIGNED_EMAIL="task-assigned-email",e.TASK_UNASSIGNED_EMAIL="task-unassigned-email",e.TASK_PUBLIC_COMMENT_ADDED_EMAIL="task-public-comment-added-email",e.TASK_PRIVATE_COMMENT_ADDED_EMAIL="task-private-comment-added-email",e.TASK_FILE_UPLOADED_EMAIL="task-attachment-added-email",e.TASK_FILE_DELETED_EMAIL="task-attachment-deleted-email",e.CREATE_TASK="create-task",e.SEND_SLACK_MESSAGE="send-slack-message"}(as||(as={}));const ns=e=>Object.assign(Object.assign({},e),{is_active:"1"===e.is_active,has_password:"1"===e.has_password}),is={[Ut.QUICKTASKER]:"Quicktasker",[Ut.WP_USER]:"WordPress User"},os=e=>Object.assign(Object.assign({},e),{task_order:Number(e.task_order),free_for_all:"1"===e.free_for_all,is_archived:"1"===e.is_archived,is_done:"1"===e.is_done,assigned_users:e.assigned_users?e.assigned_users.map((e=>Object.assign({},ns(e)))):[]}),rs=e=>Object.assign(Object.assign({},e),{stage_order:Number(e.stage_order),tasks:(e.tasks||[]).map((e=>Object.assign({},os(e))))}),cs=(e,t)=>{var s,a,n,i,o,r,c,l,d,u,x,v,j,T,L;switch(t.type){case p:return Object.assign(Object.assign({},e),{loading:t.payload});case h:{const s=t.payload,a=(s.stages||[]).map((e=>Object.assign({},rs(e)))),n=s.settings?Jt(s.settings):void 0;return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},s),{stages:a,settings:n,is_primary:"1"===s.is_primary})})}case R:{if(!e.activePipeline||!e.activePipeline.settings)return e;const s=t.payload;return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{settings:Object.assign(Object.assign({},e.activePipeline.settings),s)})})}case m:{if(!e.activePipeline||!e.activePipeline.stages)return e;const s=((e,t,s)=>{const a=[...e],n=a.find((e=>e.id===t.droppableId)),i=a.find((e=>e.id===s.droppableId));if((null==n?void 0:n.tasks)&&(null==i?void 0:i.tasks)){const[e]=n.tasks.splice(t.index,1);i.tasks.splice(s.index,0,e)}return a})(e.activePipeline.stages,t.payload.source,t.payload.destination);return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:s})})}case"REORDER_TASK":{const{source:n,destination:i}=t.payload,o=i.droppableId,r=i.index;if(!e.activePipeline)return e;const c=null===(s=e.activePipeline.stages)||void 0===s?void 0:s.find((e=>e.id===o));if(!c||!c.tasks)return e;const l=((e,t,s)=>{const a=[...e],[n]=a.splice(t,1);return a.splice(s,0,n),a})(c.tasks,n.index,r),d=null===(a=e.activePipeline.stages)||void 0===a?void 0:a.map((e=>e.id===o?Object.assign(Object.assign({},e),{tasks:l}):e));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:d})})}case w:{const s=os(t.payload);return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:null===(n=e.activePipeline.stages)||void 0===n?void 0:n.map((e=>e.id===s.stage_id?Object.assign(Object.assign({},e),{tasks:[...e.tasks||[],s]}):e))})}):e}case q:{const s=os(t.payload);if(!e.activePipeline)return e;const a=null===(i=e.activePipeline.stages)||void 0===i?void 0:i.map((e=>{var t;return e.id===s.stage_id?Object.assign(Object.assign({},e),{tasks:null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s.id?Object.assign(Object.assign({},e),s):e))}):e}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case f:{const{stage:s}=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:[...e.activePipeline.stages||[],s]})}):e}case g:{const s=t.payload;if(!e.activePipeline)return e;const a=e=>e.id===s.id?Object.assign(Object.assign({},e),{name:s.name,description:s.description}):e,n=null===(o=e.activePipeline.stages)||void 0===o?void 0:o.map(a);return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case k:{const s=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:null===(r=e.activePipeline.stages)||void 0===r?void 0:r.filter((e=>e.id!==s))})}):e}case b:{const{taskId:s,user:a}=t.payload;if(!e.activePipeline)return e;const n=null===(c=e.activePipeline.stages)||void 0===c?void 0:c.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>{if(e.id===s){const t=Qt(a)?[a,...e.assigned_users||[]]:e.assigned_users||[],s=Yt(a)?[a,...e.assigned_wp_users||[]]:e.assigned_wp_users||[];return Object.assign(Object.assign({},e),{assigned_users:t,assigned_wp_users:s})}return e}));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case y:{const{taskId:s,userId:a,userType:n}=t.payload;if(!e.activePipeline)return e;const i=null===(l=e.activePipeline.stages)||void 0===l?void 0:l.map((e=>{var t;const i=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>{var t,i;return e.id===s?Object.assign(Object.assign({},e),{assigned_users:n===Ut.QUICKTASKER?null===(t=e.assigned_users)||void 0===t?void 0:t.filter((e=>e.id!==a)):e.assigned_users,assigned_wp_users:n===Ut.WP_USER?null===(i=e.assigned_wp_users)||void 0===i?void 0:i.filter((e=>e.id!==a)):e.assigned_wp_users}):e}));return Object.assign(Object.assign({},e),{tasks:i})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:i})})}case _:{const s=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{name:s.name,description:s.description,is_primary:"1"===s.is_primary})}):e}case E:{const{taskId:s,done:a}=t.payload;if(!e.activePipeline)return e;const n=null===(d=e.activePipeline.stages)||void 0===d?void 0:d.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case S:return Object.assign(Object.assign({},e),{activePipeline:null});case A:{const s=t.payload;if(!e.activePipeline)return e;const a=null===(u=e.activePipeline.stages)||void 0===u?void 0:u.map((e=>{var t;return Object.assign(Object.assign({},e),{tasks:null===(t=e.tasks)||void 0===t?void 0:t.filter((e=>e.id!==s))})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case O:return Object.assign(Object.assign({},e),{view:t.payload});case N:{const{taskId:s,label:a}=t.payload;if(!e.activePipeline)return e;const n=null===(x=e.activePipeline.stages)||void 0===x?void 0:x.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:[...e.assigned_labels||[],a]}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case C:{const{taskId:s,labelId:a}=t.payload;if(!e.activePipeline)return e;const n=null===(v=e.activePipeline.stages)||void 0===v?void 0:v.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).filter((e=>e.id!==a))}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case I:{const{label:s}=t.payload;if(!e.activePipeline)return e;const a=null===(j=e.activePipeline.stages)||void 0===j?void 0:j.map((e=>{var t;const a=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).map((e=>e.id===s.id?s:e))})));return Object.assign(Object.assign({},e),{tasks:a})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case D:{const s=t.payload;if(!e.activePipeline)return e;const a=null===(T=e.activePipeline.stages)||void 0===T?void 0:T.map((e=>{var t;const a=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).filter((e=>e.id!==s))})));return Object.assign(Object.assign({},e),{tasks:a})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case P:{const{taskId:s,color:a}=t.payload;if(!e.activePipeline)return e;const n=null===(L=e.activePipeline.stages)||void 0===L?void 0:L.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{task_focus_color:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}default:return e}};var ls;!function(e){e.PIPELINE="PIPELINE-VIEW",e.TASK="TASK-VIEW"}(ls||(ls={}));const ds=(e,t)=>{if(t.type===$e){const s=t.payload;return Object.assign(Object.assign({},e),{fullPageLoading:s})}return e},us={fullPageLoading:!1},ps=(0,a.createContext)({state:us,loadingDispatch:()=>{}}),hs=({children:e})=>{const[t,s]=(0,a.useReducer)(ds,us);return(0,n.jsx)(ps.Provider,{value:{state:t,loadingDispatch:s},children:e})};const ms={loading:!1,view:ls.PIPELINE,activePipeline:null},ws=(0,a.createContext)({state:ms,dispatch:()=>{},fetchAndSetPipelineData:()=>Promise.resolve()}),fs=({children:e})=>{const[t,s]=(0,a.useReducer)(cs,ms),{loadingDispatch:r}=(0,a.useContext)(ps);(0,a.useEffect)((()=>{const e=window.wpqt.initialActivePipelineId;e&&l(e,!0)}),[]);const c=(e,t)=>{t?r({type:$e,payload:e}):s({type:p,payload:e})},l=(e,...t)=>{return a=void 0,n=[e,...t],l=function*(e,t=!1){try{c(!0,t);const{data:{pipeline:a}}=yield function(e){return Ft()({path:`/wpqt/v1/pipelines/${e}`,headers:Kt()})}(e);s({type:h,payload:a})}catch(e){console.error(e),i.oR.error((0,o.__)("Unable to load the board. Please try again later.","quicktasker"))}finally{c(!1,t)}},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{o(l.next(e))}catch(e){t(e)}}function i(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var a;t.done?e(t.value):(a=t.value,a instanceof r?a:new r((function(e){e(a)}))).then(s,i)}o((l=l.apply(a,n||[])).next())}));var a,n,r,l};return(0,n.jsx)(ws.Provider,{value:{state:t,dispatch:s,fetchAndSetPipelineData:l},children:e})};var ks=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const qs={[as.ARCHIVE_TASK]:(0,o.__)("Task archived by automation","quicktasker"),[as.ASSIGN_USER]:(0,o.__)("User assigned by automation","quicktasker"),[as.NEW_ENTITY_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[as.DELETED_ENTITY_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[as.TASK_ASSIGNED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[as.TASK_UNASSIGNED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[as.TASK_PUBLIC_COMMENT_ADDED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[as.TASK_PRIVATE_COMMENT_ADDED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[as.TASK_FILE_UPLOADED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[as.TASK_FILE_DELETED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[as.CREATE_TASK]:(0,o.__)("Task created by automation","quicktasker"),[as.SEND_SLACK_MESSAGE]:(0,o.__)("Slack message sent by automation","quicktasker")};function gs(){const{dispatch:e}=(0,a.useContext)(ws),t=e=>{e&&e.forEach((e=>{if(e.automation_action.includes("email"))return;const t=qs[e.automation_action]||`Automation executed: ${e.automation_action}`;i.oR.info(t)}))},s=(t,s)=>{t&&s&&t.forEach((t=>{if(t.automation_action===as.ARCHIVE_TASK&&e({type:A,payload:s}),t.automation_action===as.ASSIGN_USER){const n=t.executionResult;n&&"object"==typeof n&&"user"in n&&(a=n.user)&&"object"==typeof a&&(!a.user_type||a.user_type===Ut.QUICKTASKER||a.user_type===Ut.WP_USER)&&e({type:b,payload:{taskId:s,user:n.user}})}var a}))};return{displayAutomationMessages:t,handleExecutedAnimationsResults:s,handleExecutedAutomations:(e,a)=>{0!==e.length&&(console.log("Handing"),s(e,a),t(e))},createAutomation:(e,t,s)=>ks(this,void 0,void 0,(function*(){try{const a=yield function(e,t){var s;return Ft()({path:`/wpqt/v1/pipelines/${e}/automations`,method:"POST",data:{automationTargetId:null,automationTarget:t.automationTarget,automationTrigger:t.automationTrigger,automationAction:null===(s=t.automationAction)||void 0===s?void 0:s.id,automationActionTargetId:t.automationActionTargetId,automationActionTargetType:t.automationActionTargetType,automationMetadata:t.metaData},headers:Kt()})}(e,t);i.oR.success((0,o.__)("Automation created","quicktasker")),s&&s(!0,a.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create automation","quicktasker")),s&&s(!1,null)}})),updateAutomationActiveStatus:(e,t,s)=>ks(this,void 0,void 0,(function*(){try{const a=yield function(e,t,s){return Ft()({path:`/wpqt/v1/pipelines/${e}/automations/${t}/active`,method:"PATCH",data:{active:s},headers:Kt()})}(e,t,s);return i.oR.success(s?(0,o.__)("Automation activated","quicktasker"):(0,o.__)("Automation deactivated","quicktasker")),{success:!0,data:a.data}}catch(e){return console.error(e),i.oR.error(s?(0,o.__)("Failed to activate automation","quicktasker"):(0,o.__)("Failed to deactivate automation","quicktasker")),{success:!1,data:null}}})),deleteAutomation:(e,t,s)=>ks(this,void 0,void 0,(function*(){try{yield function(e,t){return Ft()({path:`/wpqt/v1/pipelines/${e}/automations/${t}`,method:"DELETE",headers:Kt()})}(e,t),i.oR.success((0,o.__)("Automation deleted","quicktasker")),s&&s(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete automation","quicktasker")),s&&s(!1)}}))}}var xs=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const _s=()=>{const{handleExecutedAutomations:e}=gs(),{displayErrorMessages:t,getMessagesFromResponse:s}=function(){return{displayErrorMessages:e=>{return t=this,s=void 0,n=function*(){if(e.messages&&Array.isArray(e.messages)&&e.messages.length>0){const t=e.messages.join(", ");i.oR.error(t)}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n},getMessagesFromResponse:e=>null!==e&&"object"==typeof e&&"messages"in e&&Array.isArray(e.messages)?e.messages:[]}}();return{editTask:(e,t)=>xs(void 0,void 0,void 0,(function*(){try{const s=yield function(e,t){return Ft()({path:`/wpqt/v1/tasks/${e}`,method:"PATCH",data:t,headers:Kt()})}(e,t);return{success:!0,task:s.data}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to update task","quicktasker")),{success:!1,task:null}}})),deleteTask:(t,s)=>xs(void 0,void 0,void 0,(function*(){try{const a=yield function(e){return Ft()({path:`/wpqt/v1/tasks/${e}`,method:"DELETE",headers:Kt()})}(t);s&&s({success:!0,taskId:t}),i.oR.success((0,o.__)("Task deleted","quicktasker")),e(a.data.executedAutomations,t)}catch(e){s&&s({success:!1,taskId:t}),console.error(e),i.oR.error((0,o.__)("Failed to delete a task","quicktasker"))}})),archiveTask:(e,t)=>xs(void 0,void 0,void 0,(function*(){try{yield function(e){return Ft()({path:`/wpqt/v1/tasks/${e}/archive`,method:"PATCH",headers:Kt()})}(e),t&&t({success:!0,taskId:e}),i.oR.success((0,o.__)("Task archived","quicktasker"))}catch(s){t&&t({success:!1,taskId:e}),console.error(s),i.oR.error((0,o.__)("Failed to archive a task","quicktasker"))}})),restoreArchivedTask:(e,t,a)=>xs(void 0,void 0,void 0,(function*(){try{yield function(e,t){return Ft()({path:`/wpqt/v1/tasks/${e}/archive-restore`,method:"PATCH",data:{boardId:t},headers:Kt()})}(e,t),a&&a({success:!0,messages:[]}),i.oR.success((0,o.__)("Task restored","quicktasker"))}catch(e){console.error(e),a&&a({success:!1,messages:s(e)}),i.oR.error((0,o.__)("Failed to restore a task","quicktasker"))}})),removeTaskFromUser:(t,s,a)=>xs(void 0,void 0,void 0,(function*(){try{const n=yield Ht(t,s,Ut.QUICKTASKER);i.oR.success((0,o.__)("Task has been unassigned","quicktasker")),e(n.data.executedAutomations,s),a&&a()}catch(e){console.error(e),i.oR.error((0,o.__)("Task unassignment failed. Try again","quicktasker"))}})),changeTaskDoneStatus:(s,a,n)=>xs(void 0,void 0,void 0,(function*(){try{const t=a?(0,o.__)("Task marked as completed","quicktasker"):(0,o.__)("Task marked as incomplete","quicktasker"),r=yield function(e,t){return Ft()({path:`/wpqt/v1/tasks/${e}/done`,method:"PATCH",data:{done:t},headers:Kt()})}(s,a);n&&n(a),i.oR.success(t),e(r.data.executedAutomations,s)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change task status","quicktasker")),t(e)}})),moveTask:(e,t,s,a)=>xs(void 0,void 0,void 0,(function*(){try{yield $t(e,t,s),i.oR.success((0,o.__)("Task moved","quicktasaker")),a&&a(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to move a task","quicktasker")),a&&a(!1)}})),updateTaskFocusColor:(e,t)=>xs(void 0,void 0,void 0,(function*(){const s={taskId:e,color:t};try{return yield function(e,t){return Ft()({path:`/wpqt/v1/tasks/${e}/focus-color`,method:"PATCH",data:{color:t},headers:Kt()})}(e,t),i.oR.success((0,o.__)("Task focus color changed","quicktasker")),Object.assign({success:!0},s)}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to change task focus color","quicktasker")),Object.assign({success:!1},s)}})),cleanupTaskArchive:()=>xs(void 0,void 0,void 0,(function*(){try{const e=(yield Ft()({path:"/wpqt/v1/archive/settings/task-cleanup",method:"PATCH",headers:Kt()})).data.deletedTaskIds;return i.oR.success((0,o.sprintf)((0,o.__)("Removed %d orphaned tasks from archive","quicktasker"),e.length)),{success:!0,deletedTaskIds:e}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to clean up task archive","quicktasker")),{success:!1,deletedTaskIds:[]}}}))}},vs=(e,t)=>{var s,a,n,i,o,r,c,l;switch(t.type){case ke:{const s=t.payload;return Object.assign(Object.assign({},e),{archivedTasks:s.map(os)})}case qe:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveSearchValue:s})}case ge:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveFilteredPipelineId:s})}case xe:{const a=(null!==(s=e.archivedTasks)&&void 0!==s?s:[]).filter((e=>e.id!==t.payload));return Object.assign(Object.assign({},e),{archivedTasks:a})}case _e:{const s=t.payload,n=(null!==(a=e.archivedTasks)&&void 0!==a?a:[]).filter((e=>!s.includes(e.id)));return Object.assign(Object.assign({},e),{archivedTasks:n})}case ve:{const{taskId:s,user:a}=t.payload,i=(null!==(n=e.archivedTasks)&&void 0!==n?n:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:Qt(a)?[a,...e.assigned_users]:e.assigned_users,assigned_wp_users:Yt(a)?[a,...e.assigned_wp_users]:e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{archivedTasks:i})}case je:{const{taskId:s,user:a}=t.payload,n=(null!==(i=e.archivedTasks)&&void 0!==i?i:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:Qt(a)?e.assigned_users.filter((e=>e.id!==a.id)):e.assigned_users,assigned_wp_users:Yt(a)?e.assigned_wp_users.filter((e=>e.id!==a.id)):e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case be:{const{taskId:s,done:a}=t.payload,n=(null!==(o=e.archivedTasks)&&void 0!==o?o:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case ye:{const s=t.payload,a=(null!==(r=e.archivedTasks)&&void 0!==r?r:[]).map((e=>e.id===s.id?os(s):e));return Object.assign(Object.assign({},e),{archivedTasks:a})}case Ee:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveTaskDoneFilter:s})}case Te:{const{taskId:s,label:a}=t.payload,n=(null!==(c=e.archivedTasks)&&void 0!==c?c:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:[...e.assigned_labels,a]}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case Se:{const{taskId:s,labelId:a}=t.payload,n=(null!==(l=e.archivedTasks)&&void 0!==l?l:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:e.assigned_labels.filter((e=>e.id!==a))}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case Ae:{const s=t.payload;return Object.assign(Object.assign({},e),{archivedTaskLimit:s})}case Oe:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveLoading:s})}case Ne:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveFilterOrder:s})}default:return e}};var js,bs,ys,Es,Ts,Ss;!function(e){e.Task="task",e.User="user"}(js||(js={})),function(e){e.System="system",e.Admin="admin",e.WPQTUser="quicktasker_user",e.Automation="automation",e.Import="import",e.Webhook="webhook"}(bs||(bs={})),function(e){e.All="",e.Completed="1",e.NotCompleted="0"}(ys||(ys={})),function(e){e.Admin="administrator",e.Other="other"}(Es||(Es={})),function(e){e.ALL="",e.ONE_HUNDRED="100",e.TWO_HUNDRED="200",e.FIVE_HUNDRED="500"}(Ts||(Ts={})),function(e){e.ASC="ASC",e.DESC="DESC"}(Ss||(Ss={}));var As=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Os={archivedTasks:null,archiveLoading:!1,archiveSearchValue:"",archiveFilteredPipelineId:"",archiveTaskDoneFilter:ys.All,archivedTaskLimit:Ts.ONE_HUNDRED,archiveFilterOrder:Ss.DESC},Ns=(0,a.createContext)({state:Os,archiveDispatch:()=>{},fetchAndSetArchivedTasks:()=>As(void 0,void 0,void 0,(function*(){}))}),Cs=({children:e})=>{const[t,s]=(0,a.useReducer)(vs,Os);(0,a.useEffect)((()=>{r()}),[]);const r=()=>As(void 0,void 0,void 0,(function*(){try{s({type:Oe,payload:!0});const{data:e}=yield function(e){const t=new URLSearchParams;return e.search&&t.set("search",e.search),e.pipelineId&&t.set("pipelineId",e.pipelineId),e.doneFilter&&t.set("status",e.doneFilter),null!==e.limit&&t.set("limit",String(e.limit)),e.order&&t.set("order",e.order),Ft()({path:`/wpqt/v1/tasks/archived?${t}`,method:"GET",headers:Kt()})}({search:t.archiveSearchValue,pipelineId:t.archiveFilteredPipelineId,doneFilter:t.archiveTaskDoneFilter,limit:t.archivedTaskLimit,order:t.archiveFilterOrder});s({type:ke,payload:e})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch archived tasks","quicktasker"))}finally{s({type:Oe,payload:!1})}}));return(0,n.jsx)(Ns.Provider,{value:{state:t,archiveDispatch:s,fetchAndSetArchivedTasks:r},children:e})},Is=()=>Object.assign({},Rs),Ds=(e,t)=>{var s,a,n,i,o,r,c,l,d,u,p,h,m,w,f,k;switch(t.type){case F:{const{taskToEdit:s,taskModalSettings:a}=t.payload;return Object.assign(Object.assign({},e),{taskModalOpen:!0,taskToEdit:s,targetStageId:s.stage_id,taskModalSettings:Object.assign(Object.assign({},e.taskModalSettings),a)})}case K:return Is();case Y:{const d=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{assigned_users:Qt(d)?[d,...null!==(a=null===(s=e.taskToEdit)||void 0===s?void 0:s.assigned_users)&&void 0!==a?a:[]]:null!==(i=null===(n=e.taskToEdit)||void 0===n?void 0:n.assigned_users)&&void 0!==i?i:[],assigned_wp_users:Yt(d)?[d,...null!==(r=null===(o=e.taskToEdit)||void 0===o?void 0:o.assigned_wp_users)&&void 0!==r?r:[]]:null!==(l=null===(c=e.taskToEdit)||void 0===c?void 0:c.assigned_wp_users)&&void 0!==l?l:[]})})}case J:{const s=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{assigned_users:Qt(s)?(null!==(u=null===(d=e.taskToEdit)||void 0===d?void 0:d.assigned_users)&&void 0!==u?u:[]).filter((e=>e.id!==s.id)):null!==(h=null===(p=e.taskToEdit)||void 0===p?void 0:p.assigned_users)&&void 0!==h?h:[],assigned_wp_users:Yt(s)?(null!==(w=null===(m=e.taskToEdit)||void 0===m?void 0:m.assigned_wp_users)&&void 0!==w?w:[]).filter((e=>e.id!==s.id)):null!==(k=null===(f=e.taskToEdit)||void 0===f?void 0:f.assigned_wp_users)&&void 0!==k?k:[]})})}case $:{const{targetPipelineId:s}=t.payload;return Object.assign(Object.assign({},e),{stageModalOpen:!0,targetPipelineId:s})}case G:{const{stageToEdit:s}=t.payload;return Object.assign(Object.assign({},e),{stageModalOpen:!0,stageToEdit:s})}case z:return Is();case V:return Object.assign(Object.assign({},e),{newPipelineModalOpen:!0});case B:{const{pipelineToEdit:s}=t.payload;return Object.assign(Object.assign({},e),{pipelineModalOpen:!0,pipelineToEdit:s})}case H:return Is();case"OPEN_ARCHIVE_TASK_MODAL":{const s=t.payload;return Object.assign(Object.assign({},e),{archiveTaskModalOpen:!0,archiveModalTask:s})}case"CLOSE_ARCHIVE_TASK_MODAL":return Is();case"OPEN_NEW_USER_MODAL":return Object.assign(Object.assign({},e),{userModalOpen:!0});case Q:{const s=t.payload;return Object.assign(Object.assign({},e),{userModalOpen:!0,userToEdit:s})}case W:return Is();case X:return t.payload?Object.assign(Object.assign({},e),{userSettingsModalOpen:!0}):Is();case"CHANGE_TASK_DONE_STATUS":{const{done:s}=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{is_done:s})})}case Z:{const{task:s}=t.payload;return Object.assign(Object.assign({},e),{moveTaskModalOpen:!0,taskToEdit:s})}case ee:return Is();case te:{const{task:s}=t.payload;return Object.assign(Object.assign({},e),{taskColorModalOpen:!0,taskToEdit:s})}case se:return Is();case ae:{const{selectedMethod:s}=t.payload;return Object.assign(Object.assign({},e),{taskExportModalOpen:!0,taskExportModalSettings:Object.assign(Object.assign({},e.taskExportModalSettings),{selectedMethod:s})})}case ne:return Is();case ie:{const{selectedMethod:s}=t.payload;return Object.assign(Object.assign({},e),{taskExportModalSettings:Object.assign(Object.assign({},e.taskExportModalSettings),{selectedMethod:s})})}case oe:return Object.assign(Object.assign({},e),{pipelineImportModalOpen:!0});case re:return Is();case ce:return t.payload?Object.assign(Object.assign({},e),{archiveSettingsModalOpen:!0}):Is();case le:{const{taskToRestore:s}=t.payload;return Object.assign(Object.assign({},e),{taskRestoreModalOpen:!0,taskRestoreModalSettings:Object.assign(Object.assign({},e.taskRestoreModalSettings),{taskToRestore:s})})}case ue:{const s=t.payload;return Object.assign(Object.assign({},e),{customFieldCreatorModalOpen:s})}case pe:{const s=t.payload;return Object.assign(Object.assign({},e),{customFieldRecoveryModalOpen:s})}case de:return Is();case he:{const{webhookId:s}=t.payload;return Object.assign(Object.assign({},e),{webhooksLogsModalOpen:!0,webhooksLogsModalSettings:Object.assign(Object.assign({},e.webhooksLogsModalSettings),{webhookId:s})})}case me:return Object.assign(Object.assign({},e),{webhooksLogsModalOpen:!1,webhooksLogsModalSettings:Object.assign({},Rs.webhooksLogsModalSettings)});case"UPDATE_WEBHOOKS_LOGS_MODAL_SETTINGS":{const s=t.payload;return Object.assign(Object.assign({},e),{webhooksLogsModalSettings:Object.assign(Object.assign({},e.webhooksLogsModalSettings),s)})}case we:{const{automationId:s}=t.payload;return Object.assign(Object.assign({},e),{automationLogsModalOpen:!0,automationLogsModalSettings:Object.assign(Object.assign({},e.automationLogsModalSettings),{automationId:s})})}case fe:return Object.assign(Object.assign({},e),{automationLogsModalOpen:!1,automationLogsModalSettings:Object.assign({},Rs.automationLogsModalSettings)});case"UPDATE_AUTOMATION_LOGS_MODAL_SETTINGS":{const s=t.payload;return Object.assign(Object.assign({},e),{automationLogsModalSettings:Object.assign(Object.assign({},e.automationLogsModalSettings),s)})}default:return e}};var Ps;!function(e){e.PDF="pdf",e.CSV="csv",e.JSON="json"}(Ps||(Ps={}));const Rs={taskModalOpen:!1,targetStageId:"",taskToEdit:null,taskModalSettings:{allowToMarkTaskAsDone:!0},moveTaskModalOpen:!1,stageModalOpen:!1,stageToEdit:null,targetPipelineId:"",pipelineModalOpen:!1,newPipelineModalOpen:!1,pipelineToEdit:null,archiveTaskModalOpen:!1,archiveModalTask:null,userModalOpen:!1,userToEdit:null,userSettingsModalOpen:!1,taskColorModalOpen:!1,taskExportModalOpen:!1,taskExportModalSettings:{selectedMethod:Ps.PDF},pipelineImportModalOpen:!1,automationCreatorModalOpen:!1,automationsModalOpen:!1,archiveSettingsModalOpen:!1,taskRestoreModalOpen:!1,taskRestoreModalSettings:{taskToRestore:null},customFieldCreatorModalOpen:!1,customFieldRecoveryModalOpen:!1,webhookCreationModalOpen:!1,webhooksModalOpen:!1,webhooksLogsModalOpen:!1,webhooksLogsModalSettings:{webhookId:null},automationLogsModalOpen:!1,automationLogsModalSettings:{automationId:null}},Ls=(0,a.createContext)({state:Rs,modalDispatch:()=>{}}),Ms=({children:e})=>{const[t,s]=(0,a.useReducer)(Ds,Rs);return(0,n.jsx)(Ls.Provider,{value:{state:t,modalDispatch:s},children:e})};var Us,Fs,Ks=s(2922),$s=s(6053),zs=s(9828),Gs=s(540),Vs=s(4576),Bs=s(5138),Hs=s(6061);function Ws({width:e="80",height:t="80",className:s="",color:a="#1d4ed8",secondaryColor:i="#2563eb"}){return(0,n.jsx)(Hs.BM,{visible:!0,height:t,width:e,color:a,secondaryColor:i,ariaLabel:"oval-loading",wrapperStyle:{},wrapperClass:s})}function Qs(){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-h-screen-minus-top-bar wpqt-flex-col wpqt-items-center wpqt-justify-center",children:(0,n.jsx)(Ws,{})})}function Ys({className:e="",ovalSize:t}){const s=t?{width:t,height:t}:{};return(0,n.jsx)("div",{className:`wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center ${e}`,"data-testid":"loading-oval",children:(0,n.jsx)(Ws,Object.assign({},s))})}function Js({onClick:e=()=>{},btnText:t,className:s,type:a=Us.BUTTON,disabled:i=!1,loading:o=!1,buttonStyleType:r=Fs.PRIMARY}){const c=r===Fs.PRIMARY?"wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-transparent wpqt-bg-blue-500 wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-text-white wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 focus:wpqt-ring-blue-800 enabled:hover:wpqt-bg-blue-600":r===Fs.SECONDARY?"wpqt-inline-flex wpqt-cursor-pointer wpqt-bg-gray-100 wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 enabled:hover:wpqt-bg-gray-200":"wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-transparent wpqt-bg-red-500 wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-text-white wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 focus:wpqt-ring-red-800 enabled:hover:wpqt-bg-red-600";return(0,n.jsx)(Bs.$,{disabled:i||o,className:`${c} ${s} ${i||o?"wpqt-opacity-60 wpqt-cursor-not-allowed":""}`,onClick:e,type:a,children:o?(0,n.jsx)(Ws,{width:"24",height:"24",color:"#ffffff",secondaryColor:"#ffffff"}):t})}!function(e){e.BUTTON="button",e.SUBMIT="submit",e.RESET="reset"}(Us||(Us={})),function(e){e.PRIMARY="primary",e.SECONDARY="secondary",e.DANGER="danger"}(Fs||(Fs={}));var Xs=s(7008);const Zs={background:"#2b74da",color:"#fff",borderRadius:"4px",padding:"8px 12px",fontSize:"14px",border:"1px solid #1e40af",opacity:1};function ea({id:e,style:t}){return(0,n.jsx)(Xs.m_,{id:e,style:Object.assign(Object.assign({},Zs),t),children:(0,n.jsx)("span",{children:"Tooltip content"})})}function ta({modalOpen:e,closeModal:t,children:s,size:a="sm"}){return(0,n.jsxs)(Ks.lG,{open:e,as:"div",className:"wpqt-relative wpqt-z-9999 focus:wpqt-outline-none",onClose:t,children:[(0,n.jsx)(Ks.Xi,{className:"wpqt-fixed wpqt-inset-0 wpqt-bg-black/40"}),(0,n.jsx)("div",{className:"wpqt-fixed wpqt-inset-0 wpqt-z-10 wpqt-w-screen wpqt-overflow-y-auto",children:(0,n.jsx)("div",{className:"wpqt-mt-[8vh] wpqt-flex wpqt-justify-center",children:(0,n.jsxs)(Ks.Lj,{transition:!0,className:`data-[closed]:wpqt-transform-[wpqt-scale(95%)] wpqt-relative wpqt-mt-[20px] wpqt-w-4/5 ${{sm:"wpqt-max-w-sm",md:"wpqt-max-w-lg",lg:"wpqt-max-w-4xl",xl:"wpqt-max-w-6xl"}[a]} wpqt-rounded-xl wpqt-bg-white wpqt-p-8 wpqt-backdrop-blur-2xl wpqt-duration-300 wpqt-ease-out data-[closed]:wpqt-opacity-0`,children:[(0,n.jsx)("div",{className:"wpqt-group wpqt-absolute wpqt-right-[-20px] wpqt-top-[-20px] wpqt-flex wpqt-h-[40px] wpqt-w-[40px] wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-rounded-full wpqt-border wpqt-border-solid wpqt-bg-white wpqt-text-qtBorder",onClick:t,"data-testid":"wpqt-modal-close-button",children:(0,n.jsx)(Vs.A,{className:"wpqt-icon-blue group-hover:wpqt-icon-red wpqt-size-5"})}),s]})})})]})}function sa({children:e,className:t=""}){return(0,n.jsx)(Ks.L3,{as:"div",className:`wpqt-text-base wpqt-font-semibold wpqt-text-black wpqt-mb-2 ${t}`,children:e})}function aa({children:e}){return(0,n.jsx)($s.L,{children:e})}function na({label:e,description:t,children:s,tooltipId:a,tooltipText:i}){const o=a&&i,r=o?{"data-tooltip-id":a,"data-tooltip-content":i,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info","data-tooltip-place":"top-end"}:{};return(0,n.jsxs)(zs.D,{className:"wpqt-mb-4",children:[(0,n.jsx)(Gs.JU,Object.assign({className:"wpqt-mb-2 wpqt-block wpqt-text-sm/6 wpqt-font-medium"},r,{children:e})),t&&(0,n.jsx)("p",{className:"wpqt-mb-2 wpqt-mt-0 wpqt-text-xs wpqt-text-gray-500",children:t}),s,o&&(0,n.jsx)(ea,{id:a})]})}function ia({onSave:e,saveBtnText:t,loading:s=!1}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-px-2",children:(0,n.jsx)(Js,{btnText:t,loading:s,onClick:e})})}function oa({icon:e,text:t,onClick:s,className:a,tooltipId:i,tooltipText:o,loading:r=!1,disabled:c=!1}){const l=o&&i,d=l?{"data-tooltip-id":i,"data-tooltip-content":o,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info"}:{};return(0,n.jsxs)("div",Object.assign({},d,{className:`wpqt-main-border wpqt-relative wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-bg-gray-100 wpqt-p-2 hover:wpqt-bg-white ${c?"wpqt-opacity-50":""} ${a}`,onClick:c||r?void 0:s,"aria-disabled":c,children:[e,t||r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center wpqt-relative",children:[t&&(0,n.jsx)("span",{className:"wpqt-whitespace-nowrap "+(r?"wpqt-invisible":""),children:t}),r&&(0,n.jsx)(Ws,{width:"20",height:"20",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"})]}):null,l&&(0,n.jsx)(ea,{id:i})]}))}function ra({title:e,description:t,onSave:s,icon:i,saveBtnText:r=(0,o.__)("Clean","quicktask")}){const[c,l]=(0,a.useState)(!1);return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-lg",children:e}),(0,n.jsx)("p",{className:"wpqt-mt-0",children:t}),(0,n.jsx)(oa,{onClick:()=>{return e=this,t=void 0,n=function*(){c||(l(!0),yield s(),l(!1))},new((a=void 0)||(a=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}c((n=n.apply(e,t||[])).next())}));var e,t,a,n},icon:i,loading:c,text:r})]})}function ca(){const{state:{archiveSettingsModalOpen:e},modalDispatch:t}=(0,a.useContext)(Ls),{cleanupTaskArchive:s}=_s(),{archiveDispatch:i}=function(){const{archiveDispatch:e}=(0,a.useContext)(Ns);return{archiveDispatch:e}}();return(0,n.jsx)(ta,{modalOpen:e,closeModal:()=>{t({type:ce,payload:!1})},size:"md",children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:(0,n.jsx)(ra,{title:(0,o.__)("Archive cleanup","quicktasker"),description:(0,o.__)("Remove tasks from archive that have no parent board.","quicktasker"),icon:(0,n.jsx)(u.xWQ,{className:"wpqt-size-6"}),onSave:()=>{return e=this,t=void 0,n=function*(){const{success:e,deletedTaskIds:t}=yield s();e&&t.length>0&&i({type:_e,payload:t})},new((a=void 0)||(a=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}c((n=n.apply(e,t||[])).next())}));var e,t,a,n}})})})}var la=s(1489);const da=(e,t)=>{var s;switch(t.type){case j:{const s=t.payload,a=e=>Object.assign({},rs(e)),n=e=>{var t;return Object.assign(Object.assign({},e),{stages:null===(t=e.stages)||void 0===t?void 0:t.map(a),settings:e.settings?Jt(e.settings):void 0,is_primary:"1"===e.is_primary})};return Object.assign(Object.assign({},e),{pipelines:s.map(n)})}case x:{const a=t.payload,n=e=>Object.assign({},rs(e)),i=Object.assign(Object.assign({},a),{stages:null===(s=a.stages)||void 0===s?void 0:s.map(n),settings:a.settings?Jt(a.settings):void 0,is_primary:!1});return Object.assign(Object.assign({},e),{pipelines:[...e.pipelines,i]})}case v:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.map((e=>Object.assign(Object.assign({},e),{is_primary:e.id===s})))})}case _:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.map((e=>e.id===s.id?Object.assign(Object.assign({},e),{name:s.name,description:s.description}):e))})}case T:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.filter((e=>e.id!==s))})}default:return e}},ua={pipelines:[]},pa=(0,a.createContext)({state:ua,pipelinesDispatch:()=>{}}),ha=({children:e})=>{const[t,s]=(0,a.useReducer)(da,ua);return(0,a.useEffect)((()=>{const e=window.wpqt.initialPipelines;s({type:j,payload:e})}),[]),(0,n.jsx)(pa.Provider,{value:{state:t,pipelinesDispatch:s},children:e})};function ma(){const{state:{pipelines:e},pipelinesDispatch:t}=(0,a.useContext)(pa);return{pipelines:e,pipelinesDispatch:t,checkIfPipelineNameExists:function(t){return e.some((e=>e.name.toLowerCase()===t.toLowerCase()))}}}function wa(e){var{children:t,labelFor:s,className:a=""}=e,i=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(s[a[n]]=e[a[n]])}return s}(e,["children","labelFor","className"]);return(0,n.jsx)("label",Object.assign({htmlFor:s,className:`wpqt-mb-1 ${a}`},i,{children:t}))}var fa=s(3482);function ka({options:e,selectedOptionValue:t,onSelectionChange:s,allSelector:a=!0,className:i="",allSelectorLabel:o="All boards",id:r}){return(0,n.jsxs)(fa.l,{id:r,value:t,onChange:e=>{const t=e.target.value;s(t)},className:`!wpqt-rounded-lg !wpqt-border !wpqt-border-solid !wpqt-border-qtBorder !wpqt-px-2 !wpqt-pr-6 !wpqt-py-1 focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${i}`,children:[a&&(0,n.jsx)("option",{value:"",children:o}),e.map((e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value)))]})}var qa;function ga(){var e;const{state:{taskRestoreModalOpen:t,taskRestoreModalSettings:s},modalDispatch:i}=(0,a.useContext)(Ls),{archiveDispatch:r}=(0,a.useContext)(Ns),{pipelines:c}=ma(),{restoreArchivedTask:l}=_s(),d=(0,a.useMemo)((()=>c.map((e=>({value:e.id,label:e.name})))),[c]),[u,p]=(0,a.useState)(""),[h,m]=(0,a.useState)(!1),[w,f]=(0,a.useState)([]);return(0,a.useEffect)((()=>{var e;const t=(null===(e=null==s?void 0:s.taskToRestore)||void 0===e?void 0:e.pipeline_id)||"";t?p(t):d.length>0&&p(d[0].value)}),[s,d]),(0,n.jsx)(ta,{modalOpen:t,closeModal:()=>{i({type:de}),f([])},children:(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start",children:[(0,n.jsx)(sa,{children:(0,o.sprintf)((0,o.__)("Restore %s","quicktasker"),(null===(e=null==s?void 0:s.taskToRestore)||void 0===e?void 0:e.name)||"")}),(0,n.jsx)(wa,{labelFor:"task-restore-pipeline-select",children:(0,o.__)("Select the board to restore to","quicktasker")}),(0,n.jsx)(ka,{options:d,className:"wpqt-mb-2",allSelector:!1,selectedOptionValue:u,id:"task-restore-pipeline-select",onSelectionChange:e=>{p(e),f([])}}),w.length>0&&(0,n.jsx)("div",{className:"wpqt-text-red-500",children:w.map(((e,t)=>(0,n.jsx)("p",{className:"wpqt-mt-0 wpqt-mb-1",children:e},t)))}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-w-full",children:(0,n.jsx)(oa,{icon:(0,n.jsx)(la.A,{className:"wpqt-icon-green wpqt-size-4"}),loading:h,text:(0,o.__)("Restore","quicktasker"),onClick:()=>{return e=this,t=void 0,n=function*(){const e=null==s?void 0:s.taskToRestore;e&&u&&!h&&(m(!0),yield l(e.id,u,(({success:t,messages:s})=>{t?(r({type:xe,payload:e.id}),i({type:de})):s&&s.length>0&&f(s)})),m(!1))},new((a=void 0)||(a=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}c((n=n.apply(e,t||[])).next())}));var e,t,a,n}})})]})})})}!function(e){e.SELECTION="select",e.CREATION="create",e.EDIT="edit"}(qa||(qa={}));const xa=(e,t)=>{switch(t.type){case ot:return Object.assign(Object.assign({},e),{labels:t.payload});case rt:return Object.assign(Object.assign({},e),{labels:e.labels?[...e.labels,t.payload]:[t.payload],labelActionState:qa.SELECTION});case lt:return Object.assign(Object.assign({},e),{labels:e.labels?e.labels.map((e=>e.id===t.payload.id?t.payload:e)):[t.payload]});case ct:return Object.assign(Object.assign({},e),{labels:e.labels?e.labels.filter((e=>e.id!==t.payload.id)):[]});case dt:return Object.assign(Object.assign({},e),{labelActionState:qa.SELECTION,labelToEdit:null});case ut:return Object.assign(Object.assign({},e),{labelActionState:qa.EDIT,labelToEdit:t.payload});case pt:return Object.assign(Object.assign({},e),{labelActionState:qa.CREATION,labelToEdit:null});case ht:return _a;default:return e}},_a={labels:null,labelActionState:qa.SELECTION,labelToEdit:null},va=(0,a.createContext)({state:_a,labelDispatch:()=>{}}),ja=({children:e})=>{const[t,s]=(0,a.useReducer)(xa,_a);return(0,n.jsx)(va.Provider,{value:{state:t,labelDispatch:s},children:e})};function ba({children:e}){const{state:{fullPageLoading:t}}=(0,a.useContext)(ps);return(0,n.jsx)("div",{className:"wpqt-pr-4",children:t?(0,n.jsx)(Qs,{}):e})}var ya=s(4175),Ea=s(2912);function Ta({errorText:e}){return e?(0,n.jsx)("div",{className:"wpqt-text-qtTextRed wpqt-mt-1",children:e}):null}var Sa;!function(e){e.TEXT="text",e.PASSWORD="password"}(Sa||(Sa={}));const Aa=(0,a.forwardRef)(((e,t)=>{var{value:s,onChange:a,isAutoFocus:i,className:o="",wrapperClassName:r="",disabled:c=!1,type:l=Sa.TEXT,loading:d=!1,inputId:u,name:p,errorText:h}=e,m=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(s[a[n]]=e[a[n]])}return s}(e,["value","onChange","isAutoFocus","className","wrapperClassName","disabled","type","loading","inputId","name","errorText"]);return(0,n.jsxs)("div",{className:`wpqt-inline-block wpqt-relative wpqt-mb-3 ${r}`,children:[(0,n.jsx)(Ea.p,Object.assign({ref:t,autoFocus:i,className:`wpqt-block !wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-3 wpqt-py-1.5 wpqt-text-sm/6 focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${o}`,value:s,disabled:c,onChange:e=>a(e.target.value),type:l,id:u,name:p},m)),d&&(0,n.jsx)(Ws,{width:"24",height:"24",className:"wpqt-absolute wpqt-right-[-32px] wpqt-top-1/2 wpqt-transform-y-center"}),h&&(0,n.jsx)(Ta,{errorText:h})]})}));function Oa({selectedOptionValue:e,selectionChange:t,extraOptions:s=[]}){const{state:{pipelines:i}}=(0,a.useContext)(pa),o=(0,a.useMemo)((()=>i.map((e=>({value:e.id,label:e.name})))),[i]);return(0,n.jsx)(ka,{options:[...o,...s],selectedOptionValue:e,onSelectionChange:t})}function Na({children:e,searchChildren:t,applyFilterChildren:s,title:a,childrenClassName:i="",titleClassName:o=""}){return(0,n.jsxs)("div",{className:"wpqt-mb-8",children:[(0,n.jsx)("div",{className:`wpqt-mb-3 wpqt-text-lg wpqt-text-center wpqt-font-semibold ${o}`,children:a}),(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-flex wpqt-items-center wpqt-justify-center wpqt-gap-2",children:t}),(0,n.jsx)("div",{className:`wpqt-flex wpqt-gap-5 wpqt-items-center wpqt-justify-center wpqt-mb-6 ${i}`,children:e}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:s})]})}function Ca({children:e,title:t,className:s="",labelIdFor:a}){return(0,n.jsxs)("div",{className:`wpqt-flex wpqt-flex-col ${s}`,children:[(0,n.jsx)(wa,{labelFor:a,children:t}),e]})}function Ia(){const{state:{archiveSearchValue:e,archiveFilteredPipelineId:t,archiveTaskDoneFilter:s,archivedTaskLimit:i,archiveFilterOrder:r},archiveDispatch:c,fetchAndSetArchivedTasks:l}=(0,a.useContext)(Ns),d=(0,n.jsx)(oa,{text:(0,o.__)("Apply filter","quicktasker"),icon:(0,n.jsx)(ya.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:l});return(0,n.jsxs)(Na,{title:(0,o.__)("Archive filtering","quicktasker"),applyFilterChildren:d,searchChildren:(0,n.jsx)(Ca,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"archive-search",children:(0,n.jsx)(Aa,{inputId:"archive-search",value:e,onChange:e=>{c({type:qe,payload:e})}})}),children:[(0,n.jsx)(Ca,{title:(0,o.__)("Task board","quicktasker"),children:(0,n.jsx)(Oa,{selectedOptionValue:t,selectionChange:e=>{c({type:ge,payload:e})}})}),(0,n.jsx)(Ca,{title:(0,o.__)("Task status","quicktasker"),children:(0,n.jsx)(ka,{allSelector:!1,selectedOptionValue:s,options:[{label:(0,o.__)("All","quicktasker"),value:ys.All},{label:(0,o.__)("Completed","quicktasker"),value:ys.Completed},{label:(0,o.__)("Not completed","quicktasker"),value:ys.NotCompleted}],onSelectionChange:e=>{const t=(e=>{switch(e){case ys.All:return ys.All;case ys.Completed:return ys.Completed;case ys.NotCompleted:return ys.NotCompleted;default:throw new Error(`Invalid selection: ${e}`)}})(e);c({type:Ee,payload:t})}})}),(0,n.jsx)(Ca,{title:(0,o.__)("Number of tasks","quicktasker"),children:(0,n.jsx)(ka,{allSelector:!1,selectedOptionValue:i,options:[{label:(0,o.__)("Show all","quicktasker"),value:Ts.ALL},{label:(0,o.__)("Show 100","quicktasker"),value:Ts.ONE_HUNDRED},{label:(0,o.__)("Show 200","quicktasker"),value:Ts.TWO_HUNDRED},{label:(0,o.__)("Show 500","quicktasker"),value:Ts.FIVE_HUNDRED}],onSelectionChange:e=>{c({type:Ae,payload:e})}})}),(0,n.jsx)(Ca,{title:(0,o.__)("Task order","quicktasker"),children:(0,n.jsx)(ka,{allSelector:!1,selectedOptionValue:r,options:[{label:(0,o.__)("Desc","quicktasker"),value:Ss.DESC},{label:(0,o.__)("Asc","quicktasker"),value:Ss.ASC}],onSelectionChange:e=>{c({type:Ne,payload:e})}})})]})}const Da=(e,t)=>{switch(t.type){case Ce:{const s=t.payload.map(ns);return Object.assign(Object.assign({},e),{users:s})}case Ie:{const s=t.payload.map((e=>Object.assign(Object.assign({},e),{id:String(e.id)})));return Object.assign(Object.assign({},e),{wpUsers:s})}case De:{const s=t.payload,a=ns(s);return Object.assign(Object.assign({},e),{users:[...e.users,a]})}case Re:{const s=t.payload,a=ns(s),n=e.users.map((e=>e.id===a.id?Object.assign(Object.assign({},e),a):e));return Object.assign(Object.assign({},e),{users:n})}case Me:{const{isActive:s,userId:a}=t.payload,n=e.users.map((e=>e.id===a?Object.assign(Object.assign({},e),{is_active:s}):e));return Object.assign(Object.assign({},e),{users:n})}case Ue:{const s=t.payload,a=e.users.map((e=>e.id===s?Object.assign(Object.assign({},e),{has_password:!1}):e));return Object.assign(Object.assign({},e),{users:a})}case Le:{const s=t.payload,a=e.users.filter((e=>e.id!==s));return Object.assign(Object.assign({},e),{users:a})}case Pe:{const s=t.payload;return Object.assign(Object.assign({},e),{usersSearchValue:s})}default:return e}};var Pa=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Ra={users:[],wpUsers:[],usersSearchValue:""},La=(0,a.createContext)({state:Ra,userDispatch:()=>{},updateUsers:()=>Pa(void 0,void 0,void 0,(function*(){}))}),Ma=({children:e})=>{const[t,s]=(0,a.useReducer)(Da,Ra);return(0,a.useEffect)((()=>{const e=window.wpqt.initialUsers,t=window.wpqt.initialWPUsers;s({type:Ce,payload:e}),s({type:Ie,payload:t})}),[]),(0,n.jsx)(La.Provider,{value:{state:t,userDispatch:s,updateUsers:()=>Pa(void 0,void 0,void 0,(function*(){try{const e=yield Ft()({path:"/wpqt/v1/users",method:"GET",headers:Kt()});s({type:Ce,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch users","quicktasker"))}}))},children:e})};var Ua;!function(e){e.ACTIVE_PIPELINE="ACTIVE_PIPELINE",e.PIPELINES="PIPELINES",e.USER="USER"}(Ua||(Ua={}));const Fa=e=>{const[t,s]=(0,a.useState)(!1),n=(0,a.useRef)(null),{modalDispatch:i}=(0,a.useContext)(Ls),{dispatch:o}=(0,a.useContext)(ws),{pipelinesDispatch:r}=(0,a.useContext)(pa),{userDispatch:c}=(0,a.useContext)(La);return{modalSaving:t,setModalSaving:s,modalContentRef:n,closeModal:()=>{i({type:e}),n.current&&n.current.clearContent()},handleSuccess:(e,t,a)=>{let n;switch(a){case Ua.PIPELINES:n=r;break;case Ua.ACTIVE_PIPELINE:n=o;break;case Ua.USER:n=c;break;default:n=o}s(!1),n({type:e,payload:t})},handleError:e=>{s(!1),console.error(e)}}},Ka=(e,t)=>{switch(t.type){case At:return Object.assign(Object.assign({},e),{uploads:t.payload});case Ot:return Object.assign(Object.assign({},e),{uploads:[...e.uploads,t.payload]});case Nt:return Object.assign(Object.assign({},e),{uploads:e.uploads.filter((e=>e.id!==t.payload))});default:return e}},$a={uploads:[]},za=(0,a.createContext)({state:$a,uploadDispatch:()=>{}}),Ga=({children:e})=>{const[t,s]=(0,a.useReducer)(Ka,$a);return(0,n.jsx)(za.Provider,{value:{state:t,uploadDispatch:s},children:e})};var Va=s(8448),Ba=s(8176),Ha=s(1052);function Wa(){const[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1);return{loading1:e,loading2:s,setLoading1:t,setLoading2:n,loading3:i,setLoading3:o}}const Qa=(e,t)=>{switch(t.type){case"SET_SITE_URL":{const s=t.payload;return Object.assign(Object.assign({},e),{siteURL:s})}case Fe:{const{siteURL:s,publicUserPageId:a,timezone:n,isUserAllowedToDelete:i,isUserAllowedToManageSettings:o,userPageCustomStyles:r,pluginURL:c,taskUploadsURL:l}=t.payload;return Object.assign(Object.assign({},e),{siteURL:s,publicUserPageId:a,timezone:n,isUserAllowedToDelete:i,isUserAllowedToManageSettings:o,userPageCustomStyles:r,pluginURL:c,taskUploadsURL:l})}case Ke:{const s=t.payload;return Object.assign(Object.assign({},e),{userPageCustomStyles:s})}default:return e}},Ya={siteURL:"",pluginURL:"",publicUserPageId:"",is_customFields:!0,timezone:"",isUserAllowedToDelete:!1,isUserAllowedToManageSettings:!1,userPageCustomStyles:"",taskUploadsURL:""},Ja=(0,a.createContext)({state:Ya,appDispatch:()=>{}}),Xa=({children:e})=>{const[t,s]=(0,a.useReducer)(Qa,Ya);return(0,a.useEffect)((()=>{const e=window.wpqt.siteURL,t=window.wpqt.publicUserPageId,a=window.wpqt.timezone,n="1"===window.wpqt.isUserAllowedToDelete,i="1"===window.wpqt.isUserAllowedToManageSettings,o=window.wpqt.userPageCustomStyles,r=window.wpqt.pluginURL,c=window.wpqt.taskUploadsURL;s({type:Fe,payload:{siteURL:e,publicUserPageId:t,timezone:a,isUserAllowedToDelete:n,isUserAllowedToManageSettings:i,userPageCustomStyles:o,pluginURL:r,taskUploadsURL:c}})}),[]),(0,n.jsx)(Ja.Provider,{value:{state:t,appDispatch:s},children:e})};var Za,en,tn;!function(e){e.Text="text",e.Select="select",e.Checkbox="checkbox",e.Radio="radio",e.Datetime="datetime",e.File="file"}(Za||(Za={})),function(e){e.QUICKTASKER="quicktasker",e.WP_USER="wp-user",e.Pipeline="pipeline",e.Users="users",e.Task="task"}(en||(en={})),function(e){e.TASK="task"}(tn||(tn={}));function sn({value:e,onChange:t,debounceTimeout:s=700,isAutoFocus:i=!1,wrapperClassName:o,className:r}){const[c,l]=(0,a.useState)(e),[d,u]=(0,a.useState)(!1),[p,h]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{l(e)}),[e]),(0,a.useEffect)((()=>{if(!p)return;const e=setTimeout((()=>{return e=this,s=void 0,n=function*(){h(!1),u(!0),yield t(c),u(!1)},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n}),s);return()=>clearTimeout(e)}),[c,p,s,t]),(0,n.jsx)(Aa,{isAutoFocus:i,value:c,onChange:e=>{l(e),h(!0)},wrapperClassName:o,className:r,loading:d,disabled:d})}var an=s(1062),nn=s(4164);function on({value:e,onChange:t,rowsCount:s=3,colsCount:a,className:i="",disabled:o=!1,loading:r=!1,wrapperClassName:c="",placeholder:l=""}){return(0,n.jsxs)("div",{className:`wpqt-relative wpqt-mb-3 ${c}`,children:[(0,n.jsx)(an.T,{className:(0,nn.$)("wpqt-border-1 wpqt-mb-3 wpqt-block wpqt-w-auto wpqt-resize-none wpqt-rounded-lg wpqt-border-qtBorder wpqt-px-3 wpqt-py-1.5 wpqt-text-sm/6",`focus:wpqt-shadow-none focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${i}`),rows:s,cols:a,value:e,onChange:e=>t(e.target.value),disabled:o,placeholder:l}),r&&(0,n.jsx)(Ws,{width:"24",height:"24",className:"wpqt-absolute wpqt-right-[-32px] wpqt-top-1/2 wpqt-transform-y-center"})]})}function rn({value:e,onChange:t,debounceTimeout:s=700,className:i}){const[o,r]=(0,a.useState)(e),[c,l]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{r(e)}),[e]),(0,a.useEffect)((()=>{if(!d)return;const e=setTimeout((()=>{return e=this,s=void 0,n=function*(){u(!1),l(!0),yield t(o),l(!1)},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n}),s);return()=>clearTimeout(e)}),[o,d,s,t]),(0,n.jsx)(on,{rowsCount:3,value:o,className:i,onChange:e=>{r(e),u(!0)},disabled:c,loading:c})}const cn=(e,t)=>{switch(t.type){case nt:{const s=t.payload;return Object.assign(Object.assign({},e),{loading:s})}case it:{const{entityId:s,entityType:a}=t.payload;return Object.assign(Object.assign({},e),{entityId:s,entityType:a})}case tt:{const s=t.payload;return Object.assign(Object.assign({},e),{customFields:s})}case st:{const s=t.payload;return Object.assign(Object.assign({},e),{customFields:[...e.customFields,s]})}case at:{const s=t.payload,a=e.customFields.filter((e=>e.id!==s));return Object.assign(Object.assign({},e),{customFields:a})}default:return e}};const ln={customFields:[],loading:!0,entityId:"",entityType:null},dn=(0,a.createContext)({state:ln,customFieldsDispatch:()=>{},fetchCustomFields:()=>{}}),un=({children:e,entityId:t,entityType:s})=>{const[r,c]=(0,a.useReducer)(cn,ln);(0,a.useEffect)((()=>{l()}),[]),(0,a.useEffect)((()=>{c({type:it,payload:{entityType:s,entityId:t}})}),[s,t]);const l=()=>{return e=void 0,a=void 0,r=function*(){try{c({type:nt,payload:!0});const e=yield Wt(t,s,!0);c({type:tt,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch custom fields","quicktasker"))}finally{c({type:nt,payload:!1})}},new((n=void 0)||(n=Promise))((function(t,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}c((r=r.apply(e,a||[])).next())}));var e,a,n,r};return(0,n.jsx)(dn.Provider,{value:{state:r,customFieldsDispatch:c,fetchCustomFields:l},children:e})};var pn=s(2767),hn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function mn(){return{addCustomField:(e,t,s,a,n,r)=>hn(this,void 0,void 0,(function*(){try{const i=yield function(e,t,s,a,n){return Ft()({path:"/wpqt/v1/custom-fields",method:"POST",data:{entityId:e,entityType:t,type:s,name:a,description:n},headers:Kt()})}(e,t,s,a,n);r&&r(i.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add a custom field","quicktasker"))}})),markCustomFieldAsDeleted:(e,t)=>hn(this,void 0,void 0,(function*(){try{yield function(e){return Ft()({path:`/wpqt/v1/custom-fields/${e}`,method:"DELETE",headers:Kt()})}(e),t&&t()}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to mark custom field as deleted","quicktasker"))}})),restoreCustomField:(e,t)=>hn(this,void 0,void 0,(function*(){try{const s=yield function(e){return Ft()({path:`/wpqt/v1/custom-fields/${e}/restore`,method:"PATCH",headers:Kt()})}(e);i.oR.success((0,o.__)("Custom field restored","quicktasker")),t&&t(s.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to restore custom field","quicktasker"))}})),updateCustomFieldValue:(e,t,s,a,n)=>hn(this,void 0,void 0,(function*(){try{yield function(e,t,s,a){return Ft()({path:`/wpqt/v1/custom-fields/${e}/value`,method:"PATCH",data:{value:t,entityId:String(s),entityType:a},headers:Kt()})}(e,t,s,a),i.oR.success((0,o.__)("Custom field value updated","quicktasker")),n&&n()}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to update custom field value","quicktasker"))}})),updateCustomFieldDefaultValue:(e,t)=>hn(this,void 0,void 0,(function*(){try{return yield function(e,t){return Ft()({path:`/wpqt/v1/custom-fields/${e}/default-value`,method:"PATCH",data:{value:t},headers:Kt()})}(e,t),i.oR.success((0,o.__)("Custom field default value updated","quicktasker")),{success:!0}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to update custom field default value","quicktasker")),{success:!1}}}))}}function wn({description:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(Za.Text),{addCustomField:d}=mn(),{state:{entityId:u,entityType:p,loading:h},customFieldsDispatch:m}=(0,a.useContext)(dn),[w,f]=(0,a.useState)(!1),{modalDispatch:k}=(0,a.useContext)(Ls),q=[{value:Za.Text,label:"Text"},{value:Za.Checkbox,label:"Checkbox"}];return h?null:(0,n.jsxs)("div",{className:"wpqt-mb-6 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom Fields","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:e}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(Aa,{value:t,onChange:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Description","quicktasker")}),(0,n.jsx)(on,{value:i,onChange:r})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Type","quicktasker")}),(0,n.jsx)(ka,{selectedOptionValue:c,options:q,onSelectionChange:e=>{l(e)},allSelector:!1})]})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:(0,n.jsx)(oa,{text:(0,o.__)("Add","quicktasker"),onClick:()=>{return e=this,a=void 0,o=function*(){u&&p?(f(!0),yield d(u,p,c,t,i,(e=>{m({type:st,payload:e}),s(""),r(""),l(Za.Text),k({type:ue,payload:!1})})),f(!1)):console.error("Entity ID or Entity Type is missing")},new((n=void 0)||(n=Promise))((function(t,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,r)}c((o=o.apply(e,a||[])).next())}));var e,a,n,o},loading:w,icon:(0,n.jsx)(pn.A,{className:"wpqt-icon-green wpqt-size-5"})})})]})}function fn({description:e}){const{state:{customFieldCreatorModalOpen:t},modalDispatch:s}=(0,a.useContext)(Ls);return(0,n.jsx)(ta,{modalOpen:t,closeModal:()=>{s({type:ue,payload:!1})},size:"lg",children:(0,n.jsx)(wn,{description:e})})}var kn=s(5066),qn=s(4353),gn=s.n(qn),xn=s(8569),_n=s.n(xn),vn=s(3826),jn=s.n(vn);gn().extend(jn()),gn().extend(_n());const bn=(e,t)=>{try{return gn().utc(e).tz(t).format("MMMM D, YYYY HH:mm")}catch(t){return console.error("Error: ",t),e+" (UTC)"}},yn=()=>{const{state:{timezone:e}}=(0,a.useContext)(Ja);return{convertToWPTimezone:t=>bn(t,e),convertUTCDateTimeToWPTimezone:t=>((e,t)=>{try{return gn().utc(e).tz(t).toDate()}catch(t){return console.error("Error: ",t),new Date(e)}})(t,e)}},En={[en.Pipeline]:(0,o.__)("Board","quicktasker"),[en.Task]:(0,o.__)("Task","quicktasker"),[en.QUICKTASKER]:(0,o.__)("Quicktasker","quicktasker"),[en.WP_USER]:(0,o.__)("WordPress user","quicktasker"),[en.Users]:(0,o.__)("Global users","quicktasker")};function Tn({icon:e,onClick:t=()=>{},className:s,loading:a=!1}){return(0,n.jsxs)("div",{className:`wpqt-main-border wpqt-p-1 wpqt-relative wpqt-inline-flex wpqt-cursor-pointer wpqt-bg-gray-100 hover:wpqt-bg-white ${s}`,onClick:t,children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center "+(a?"wpqt-invisible":""),children:e}),a&&(0,n.jsx)(Ws,{width:"20",height:"20",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"})]})}function Sn({customField:e,refreshDeletedFields:t}){const{customFieldsDispatch:s}=(0,a.useContext)(dn),[i,r]=(0,a.useState)(!1),{restoreCustomField:c}=mn(),{convertToWPTimezone:l}=yn();return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Name:","quicktasker")})," ",e.name]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Description:","quicktasker")})," ",e.description]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Level:","quicktasker")})," ",En[e.entity_type]]}),e.deleted_at&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Deleted:","quicktasker")})," ",l(e.deleted_at)]}),(0,n.jsx)("div",{children:(0,n.jsx)(Tn,{onClick:()=>{return a=this,n=void 0,o=function*(){r(!0),yield c(e.id,(e=>{s({type:st,payload:e}),t()})),r(!1)},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{c(o.next(e))}catch(e){t(e)}}function r(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var a;t.done?e(t.value):(a=t.value,a instanceof i?a:new i((function(e){e(a)}))).then(s,r)}c((o=o.apply(a,n||[])).next())}));var a,n,i,o},loading:i,icon:(0,n.jsx)(kn.HCd,{className:"wpqt-icon-green wpqt-size-5"})})})]})}function An(){const[e,t]=(0,a.useState)(!0),[s,r]=(0,a.useState)(null),{state:{entityId:c,entityType:l}}=(0,a.useContext)(dn);(0,a.useEffect)((()=>{d()}),[]);const d=()=>{return e=this,s=void 0,n=function*(){if(c&&l)try{t(!0);const e=yield Wt(c,l,!1);r(e.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load deleted custom fields","quicktasker"))}finally{t(!1)}else console.error("Entity ID or Entity Type is missing")},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n};return(0,n.jsxs)("div",{className:"wpqt-my-3 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom Field recovery","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:(0,o.__)("Deleted custom field by accident? No worries! You can recover it here.","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mb-3",children:e?(0,n.jsx)(Ys,{ovalSize:"36"}):s&&0===s.length?(0,n.jsx)("div",{className:"wpqt-text-center wpqt-font-semibold",children:(0,o.__)("No deleted custom fields","quicktasker")}):s&&s.length>0?(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:s.map((e=>(0,n.jsx)(Sn,{customField:e,refreshDeletedFields:d},e.id)))}):null})]})}function On(){const{state:{customFieldRecoveryModalOpen:e},modalDispatch:t}=(0,a.useContext)(Ls);return(0,n.jsx)(ta,{modalOpen:e,closeModal:()=>{t({type:pe,payload:!1})},size:"lg",children:(0,n.jsx)(An,{})})}function Nn({data:e,locationOfCustomFields:t,onDelete:s,actionLoading:i}){const{state:{isUserAllowedToDelete:r}}=(0,a.useContext)(Ja),c=e.entity_type===t,l=e.entity_type===en.Pipeline?"board":e.entity_type;return i?(0,n.jsx)(Ys,{ovalSize:"24",className:"wpqt-ml-auto"}):(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-ml-auto",children:r&&(0,n.jsx)(oa,Object.assign({onClick:()=>{return e=this,t=void 0,n=function*(){c&&s()},new((a=void 0)||(a=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}c((n=n.apply(e,t||[])).next())}));var e,t,a,n},className:c?"":"!wpqt-cursor-not-allowed",icon:(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-4"})},!c&&{tooltipId:`custom-field-${e.id}-delete`,tooltipText:(0,o.sprintf)((0,o.__)("This custom field is inherited from %s settings and can't be deleted here","quicktasker"),l)}))})}function Cn({name:e,description:t=""}){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-mb-1 wpqt-text-base wpqt-font-semibold",children:e}),t&&(0,n.jsx)("div",{className:"wpqt-mb-2 wpqt-italic",children:t})]})}function In({data:e,initialValue:t,onChange:s,disabled:i=!1}){const[o,r]=(0,a.useState)(t);return(0,a.useEffect)((()=>{r(t)}),[t]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(Cn,{name:e.name,description:e.description}),(0,n.jsx)("input",{type:"checkbox",checked:"true"===o,className:"!wpqt-block",onChange:e=>{r(e.target.checked?"true":"false"),s(e.target.checked?"true":"false")},disabled:i})]})}function Dn({data:e,initialValue:t,onChange:s,disabled:i=!1}){const[o,r]=(0,a.useState)(t),[c,l]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{r(t),l(!1)}),[t]),(0,a.useEffect)((()=>{if(!c)return;const e=setTimeout((()=>{s(o),l(!1)}),700);return()=>clearTimeout(e)}),[o,c,s]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center",children:[(0,n.jsx)(Cn,{name:e.name,description:e.description}),(0,n.jsx)(Aa,{value:o,onChange:e=>{r(e),l(!0)},disabled:i,wrapperClassName:"!wpqt-mb-0","data-testid":"text-custom-field"})]})}var Pn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Rn({data:e}){var t,s;const{state:{entityType:i,entityId:o},customFieldsDispatch:r}=(0,a.useContext)(dn),{updateCustomFieldValue:c,markCustomFieldAsDeleted:l,updateCustomFieldDefaultValue:d}=mn(),[u,p]=(0,a.useState)(!1),h=i===en.QUICKTASKER||i===en.Task,m=i===en.Users||i===en.Pipeline,w=t=>Pn(this,void 0,void 0,(function*(){h?(p(!0),yield c(e.id,t,o,i),p(!1)):m?(p(!0),yield d(e.id,t),p(!1)):console.error("Invalid entity type for saving custom field value")}));let f;const k=null!==(s=null!==(t=e.value)&&void 0!==t?t:e.default_value)&&void 0!==s?s:"",q=h||m;switch(e.type){case Za.Text:f=(0,n.jsx)(Dn,{data:e,initialValue:k,onChange:w,disabled:u||!q});break;case Za.Checkbox:f=(0,n.jsx)(In,{data:e,initialValue:k,onChange:w,disabled:u||!h})}return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-py-4 wpqt-items-center wpqt-border-0 wpqt-border-b wpqt-border-solid wpqt-border-gray-200",children:[f,(0,n.jsx)(Nn,{data:e,locationOfCustomFields:i,onDelete:()=>Pn(this,void 0,void 0,(function*(){p(!0),yield l(e.id,(()=>{r({type:at,payload:e.id})})),p(!1)})),actionLoading:u})]})}function Ln(){const{state:{loading:e,customFields:t}}=(0,a.useContext)(dn);return e?(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Ws,{width:"36",height:"36"})}):t&&0===t.length?(0,n.jsx)("div",{className:"wpqt-text-center wpqt-font-semibold",children:(0,o.__)("No related custom fields created","quicktasker")}):(0,n.jsx)("div",{className:"wpqt-my-4 wpqt-flex wpqt-flex-col wpqt-gap-3",children:t.map((e=>(0,n.jsx)(Rn,{data:e},e.id)))})}function Mn({className:e=""}){const{modalDispatch:t}=(0,a.useContext)(Ls);return(0,n.jsxs)("div",{className:`wpqt-flex wpqt-gap-2 ${e}`,children:[(0,n.jsx)(oa,{onClick:()=>{t({type:pe,payload:!0})},icon:(0,n.jsx)(kn.HCd,{className:"wpqt-icon-blue wpqt-size-4"}),tooltipId:"custom-field-restore",tooltipText:(0,o.__)("Restore deleted custom fields","quicktasker")}),(0,n.jsx)(oa,{onClick:()=>{t({type:ue,payload:!0})},icon:(0,n.jsx)(pn.A,{className:"wpqt-icon-green wpqt-size-4"}),tooltipId:"custom-field-create",tooltipText:(0,o.__)("Add custom field","quicktasker")})]})}const Un={[en.QUICKTASKER]:(0,o.__)("Add user-specific custom fields. If you want to add custom fields to all users, please go to users settings.","quicktasker"),[en.WP_USER]:(0,o.__)("Add user-specific custom fields. If you want to add custom fields to all users, please go to users settings.","quicktasker"),[en.Users]:(0,o.__)("Add custom fields to all users. If you want to add custom fields to a specific user only, please go to that user settings.","quicktasker"),[en.Pipeline]:(0,o.__)("Add board level custom fields.","quicktasker"),[en.Task]:(0,o.__)("Add task-specific custom fields. If you want to add custom fields to all tasks in this board, please go to board settings.","quicktasker")},Fn={[en.QUICKTASKER]:(0,o.__)("Custom fields applied to this user, including both user-specific and global users fields.","quicktasker"),[en.WP_USER]:(0,o.__)("Custom fields applied to this user, including both user-specific and global users fields.","quicktasker"),[en.Users]:(0,o.__)("Global user custom field are applied to all users.","quicktasker"),[en.Pipeline]:(0,o.__)("Board level fields are applied to all tasks in this board.","quicktasker"),[en.Task]:(0,o.__)("Custom fields applied to this task, including both task-specific and board-level fields.","quicktasker")},Kn={[en.QUICKTASKER]:(0,o.__)("User custom fields","quicktasker"),[en.WP_USER]:(0,o.__)("User custom fields","quicktasker"),[en.Users]:(0,o.__)("Global users custom fields","quicktasker"),[en.Pipeline]:(0,o.__)("Board custom fields","quicktasker"),[en.Task]:(0,o.__)("Custom fields","quicktasker")};function $n({entityId:e,entityType:t}){const s=Un[t],a=Kn[t],i=Fn[t];return(0,n.jsx)("div",{className:"wpqt-relative",children:(0,n.jsxs)(un,{entityId:e,entityType:t,children:[(0,n.jsx)(Mn,{className:"wpqt-absolute wpqt--top-2 wpqt-right-0"}),(0,n.jsx)("h2",{className:"wpqt-text-center",children:a}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:i}),(0,n.jsx)(Ln,{}),(0,n.jsx)(fn,{description:s}),(0,n.jsx)(On,{})]})})}function zn({onConfirm:e,confirmMessage:t=(0,o.__)("Are you sure?","quicktasker"),confirmButtonText:s=(0,o.__)("Yes","quicktasker"),cancelButtonText:i=(0,o.__)("No","quicktasker"),children:r,position:c="bottom",containerClassName:l=""}){const[d,u]=(0,a.useState)(!1),[p,h]=(0,a.useState)(null),m=(0,a.useRef)(null),w=(0,a.useRef)(null),f=d&&null!==p;(0,a.useEffect)((()=>{if(d&&m.current){const e=m.current.getBoundingClientRect(),t=8;let s=100;w.current&&(s=w.current.offsetHeight);let a=0,n=0;switch(c){case"top":a=e.top-s-t,n=e.left+e.width/2-112;break;case"right":a=e.top,n=e.right+t;break;case"bottom":a=e.bottom+t,n=e.left+e.width/2-112;break;case"left":a=e.top,n=e.left-224-t}a<0?a=t:a+s>window.innerHeight&&(a=window.innerHeight-s-t),n<0?n=t:n+224>window.innerWidth&&(n=window.innerWidth-224-t),h({top:a,left:n})}}),[d,c,f]);const k=e=>{null==e||e.stopPropagation(),u(!1)};return(0,a.useEffect)((()=>{if(!f)return;const e=e=>{m.current&&!m.current.contains(e.target)&&w.current&&!w.current.contains(e.target)&&k()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[f]),(0,n.jsxs)("div",{className:`wpqt-relative ${l}`,ref:m,children:[r({onClick:e=>{e.stopPropagation(),e.preventDefault(),u(!0)}}),f&&(0,n.jsx)("div",{ref:w,className:"wpqt-fixed wpqt-z-50",style:{top:`${p.top}px`,left:`${p.left}px`},onClick:e=>e.stopPropagation(),children:(0,n.jsx)("div",{className:"wpqt-origin-top-right wpqt-main-border wpqt-bg-white wpqt-transition",style:{width:"224px"},children:(0,n.jsxs)("div",{className:"wpqt-p-3",children:[(0,n.jsx)("div",{className:"wpqt-text-sm wpqt-mb-2",children:t}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-space-x-2",children:[(0,n.jsx)(Js,{btnText:i,onClick:k,buttonStyleType:Fs.SECONDARY}),(0,n.jsx)(Js,{btnText:s,onClick:t=>{null==t||t.stopPropagation(),e(),u(!1)},buttonStyleType:Fs.DANGER})]})]})})})]})}var Gn=s(5785);function Vn({children:e,inlineStyle:t,className:s=""}){return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-py-1 wpqt-px-2 wpqt-font-semibold wpqt-text-xs wpqt-leading-none wpqt-shopping-tag ${s}`,style:t,children:e})}var Bn=s(2185);function Hn({children:e,menuBtn:t,menuBtnClasses:s="",anchor:a="bottom end"}){return(0,n.jsxs)(Bn.W1,{children:[(0,n.jsx)(Bn.IU,{as:"div",className:`wpqt-cursor-pointer ${s}`,onClick:e=>e.stopPropagation(),children:({active:e})=>(0,n.jsx)(n.Fragment,{children:t({active:e})})}),(0,n.jsx)(Bn.c,{anchor:a,transition:!0,className:"wpqt-z-20 wpqt-origin-top wpqt-rounded-xl wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-bg-white wpqt-p-4 wpqt-transition wpqt-duration-200 wpqt-ease-out data-[closed]:wpqt-scale-95 data-[closed]:wpqt-opacity-0",children:e})]})}function Wn({isActive:e,IconComponent:t}){return(0,n.jsx)(t,{className:"wpqt-size-6 wpqt-text-gray-400 hover:wpqt-text-qtBlueHover "+(e?"wpqt-text-qtBlueHover":"")})}function Qn({text:e,onClick:t,icon:s,className:a,disabled:i=!1,id:o="",tooltipText:r="",loading:c=!1}){const l=""!==r&&""!==o?{"data-tooltip-id":o,"data-tooltip-content":r,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info"}:{};return(0,n.jsx)(Bn.Dr,{children:(0,n.jsxs)("div",Object.assign({},l,{className:`wpqt-mb-3 wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-relative ${i?"wpqt-cursor-not-allowed wpqt-line-through":"wpqt-cursor-pointer hover:wpqt-underline"} ${a}`,onClick:e=>{!i&&t&&t(e)},children:[s,(0,n.jsx)("span",{className:c?"wpqt-invisible":"",children:e}),c&&(0,n.jsx)(Ws,{width:"16",height:"16",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"}),(0,n.jsx)(ea,{id:o})]}))})}var Yn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};var Jn=s(3858);function Xn({labelCreated:e,loading:t=!1}){const{labelDispatch:s}=(0,a.useContext)(va),[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)("#FF9800"),[d,u]=(0,a.useState)({});return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Create new label","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-max-w-sm",children:(0,o.__)("Label will be added to the board","quicktasker")})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(wa,{labelFor:"new-label-name",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(Aa,{value:i,onChange:r,inputId:"new-label-name",errorText:d.nameError,className:"wpqt-w-full"})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-mb-2",children:[(0,n.jsx)(wa,{children:(0,o.__)("Color","quicktasker")}),(0,n.jsx)(Jn.A,{color:c,disableAlpha:!0,onChange:e=>{l(e.hex)},style:{width:"100%"}}),d.nameError&&(0,n.jsx)(Ta,{errorText:d.colorError})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-justify-end",children:[(0,n.jsx)(Js,{btnText:(0,o.__)("Cancel","quicktasker"),buttonStyleType:Fs.SECONDARY,onClick:()=>{s({type:dt})}}),(0,n.jsx)(Js,{btnText:(0,o.__)("Create","quicktasker"),onClick:()=>{const t={};i.trim()||(t.nameError=(0,o.__)("Name is required","quicktasker")),c||(t.colorError=(0,o.__)("Color is required","quicktasker")),u(t),Object.keys(t).length>0||e(i,c)},loading:t})]})]})}function Zn({labelToEdit:e,editLabel:t,closeEdit:s=()=>{}}){if(!e)return null;const[i,r]=(0,a.useState)(Object.assign({},e)),[c,l]=(0,a.useState)(!1),[d,u]=(0,a.useState)({});return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Edit label","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-max-w-sm",children:(0,o.__)("Make changes to this label","quicktasker")})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(wa,{labelFor:"edit-label-name",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(Aa,{value:i.name,onChange:e=>{r(Object.assign(Object.assign({},i),{name:e}))},inputId:"edit-label-name",className:"wpqt-w-full",errorText:d.nameError})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-mb-2",children:[(0,n.jsx)(wa,{children:(0,o.__)("Color","quicktasker")}),(0,n.jsx)(Jn.A,{color:i.color,disableAlpha:!0,onChange:e=>{r(Object.assign(Object.assign({},i),{color:e.hex}))},style:{width:"100%"}}),d.nameError&&(0,n.jsx)(Ta,{errorText:d.colorError})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-justify-end",children:[(0,n.jsx)(Js,{btnText:(0,o.__)("Cancel","quicktasker"),buttonStyleType:Fs.SECONDARY,onClick:s}),(0,n.jsx)(Js,{btnText:(0,o.__)("Update","quicktasker"),onClick:()=>{return e=this,s=void 0,n=function*(){const e={};i.name.trim()||(e.nameError=(0,o.__)("Name is required","quicktasker")),i.color||(e.colorError=(0,o.__)("Color is required","quicktasker")),u(e),Object.keys(e).length>0||(l(!0),yield t(i),l(!1))},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n},loading:c})]})]})}var ei=s(2601),ti=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function si({labels:e,title:t,description:s,labelSelected:i,labelDeSelection:r,deleteLabe:c,loading:l=!1}){const{labelDispatch:d}=(0,a.useContext)(va);return e?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:t}),(0,n.jsx)("div",{className:"wpqt-max-w-sm",children:s})]}),l?(0,n.jsx)(Ys,{ovalSize:"24"}):0===e.length?(0,n.jsx)("div",{className:"wpqt-text-gray-500",children:(0,o.__)("There are no labels created for this board","quicktasker")}):e.map((e=>(0,n.jsx)(ai,{label:e,labelSelected:i,labelDeSelection:r,deleteLabe:c},e.id))),(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-justify-end",children:(0,n.jsx)(oa,{onClick:()=>{d({type:pt})},className:"wpqt-mt-3",icon:(0,n.jsx)(Gn.A,{className:"wpqt-text-blue-400 wpqt-size-5"}),text:(0,o.__)("Create new label","quicktasker")})})]}):null}function ai({label:e,labelSelected:t,labelDeSelection:s,deleteLabe:i}){const{labelDispatch:r}=(0,a.useContext)(va),[c,l]=(0,a.useState)(e.selected),[d,u]=(0,a.useState)(!1),[p,h]=(0,a.useState)(!1);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-between wpqt-gap-2 wpqt-w-full",children:[p?(0,n.jsx)(Ws,{width:"20",height:"20"}):(0,n.jsx)("input",{type:"checkbox",checked:c,onChange:a=>ti(this,void 0,void 0,(function*(){const n=a.target.checked;h(!0);const{success:i}=n?yield t(e.id):yield s(e.id);h(!1),i&&l(n)}))}),(0,n.jsx)(Vn,{inlineStyle:{backgroundColor:e.color},className:"wpqt-py-2",children:e.name}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(oa,{icon:(0,n.jsx)(ei.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:()=>{r({type:ut,payload:e})}}),(0,n.jsx)(zn,{confirmMessage:(0,o.__)("Are you sure you want to delete the label from this board?","quicktasker"),onConfirm:()=>ti(this,void 0,void 0,(function*(){u(!0),yield i(e.id),u(!1)})),containerClassName:"wpqt-flex",children:({onClick:e})=>(0,n.jsx)(Tn,{icon:(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-4"}),className:"wpqt-p-2",onClick:e,loading:d})})]})]})}var ni=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const ii=(0,a.memo)((({task:e,labelSelected:t,labelDeselected:s,labelDeleted:r})=>{const{state:{labels:c,labelActionState:l,labelToEdit:d},labelDispatch:u}=(0,a.useContext)(va),{archiveDispatch:p}=(0,a.useContext)(Ns),{dispatch:h}=(0,a.useContext)(ws),[m,w]=(0,a.useState)(!0),[f,k]=(0,a.useState)(!1),{getPipelineLabels:q,createPipelineLabel:g,assignLabelToTask:x,usassignLabelFromTask:_,editLabel:v,deleteLabel:j}=function(){return{deleteLabel:(e,t,s)=>Yn(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return Ft()({path:`/wpqt/v1/pipelines/${e}/labels/${t}`,method:"DELETE",headers:Kt()})}(e,t);i.oR.success((0,o.__)("Label deleted from the board","quicktasker")),s&&s(!0,a.data.deletedLabel)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete label","quicktasker")),s&&s(!1)}})),getPipelineLabels:(e,t)=>Yn(this,void 0,void 0,(function*(){try{const a=yield(s=e,Ft()({path:`/wpqt/v1/pipelines/${s}/labels`,method:"GET",headers:Kt()}));t&&t(!0,a.data.labels)}catch(e){console.error(e),t&&t(!1)}var s})),createPipelineLabel:(e,t,s,a)=>Yn(this,void 0,void 0,(function*(){try{const n=yield function(e,t,s){return Ft()({path:`/wpqt/v1/pipelines/${e}/labels`,method:"POST",headers:Kt(),data:{name:t,color:s}})}(e,t,s);i.oR.success((0,o.__)("Label created successfully","quicktasker")),a&&a(!0,n.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create label","quicktasker")),a&&a(!1)}})),editLabel:(e,t,s)=>Yn(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return Ft()({path:`/wpqt/v1/pipelines/${e}/labels/${t.id}`,method:"PATCH",headers:Kt(),data:{name:t.name,color:t.color}})}(e,t);i.oR.success((0,o.__)("Label updated successfully","quicktasker")),s&&s(!0,a.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to update label","quicktasker")),s&&s(!1)}})),assignLabelToTask:(e,t,s)=>Yn(this,void 0,void 0,(function*(){try{const a=yield function(e,t,s){return Ft()({path:`/wpqt/v1/pipelines/${e}/tasks/${t}/labels`,method:"POST",headers:Kt(),data:{labelId:s}})}(e,t,s);return i.oR.success((0,o.__)("Label added to task","quicktasker")),{success:!0,label:a.data.label}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to add label to task","quicktasker")),{success:!1}}})),usassignLabelFromTask:(e,t,s)=>Yn(this,void 0,void 0,(function*(){try{return yield function(e,t,s){return Ft()({path:`/wpqt/v1/pipelines/${e}/tasks/${t}/labels/${s}`,method:"DELETE",headers:Kt()})}(e,t,s),i.oR.success((0,o.__)("Label removed from task","quicktasker")),{success:!0}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to remove label from task","quicktasker")),{success:!1}}}))}}();(0,a.useEffect)((()=>(ni(void 0,void 0,void 0,(function*(){w(!0),yield q(e.pipeline_id,((e,t)=>{e&&t&&u({type:ot,payload:t})})),w(!1)})),()=>{u({type:ht})})),[]);const b=()=>{const t=e.assigned_labels||[];return(c||[]).map((e=>Object.assign(Object.assign({},e),{selected:t.some((t=>t.id===e.id))})))},y=s=>ni(void 0,void 0,void 0,(function*(){const{success:a,label:n}=yield x(e.pipeline_id,e.id,s);return a&&n&&(h({type:N,payload:{taskId:e.id,label:n}}),p({type:Te,payload:{taskId:e.id,label:n}}),t(n)),{success:a,label:n}})),E=t=>ni(void 0,void 0,void 0,(function*(){const{success:a}=yield _(e.pipeline_id,e.id,t);return a&&(h({type:C,payload:{taskId:e.id,labelId:t}}),p({type:Se,payload:{taskId:e.id,labelId:t}}),s(t)),{success:a}})),T=(t,s)=>ni(void 0,void 0,void 0,(function*(){k(!0),yield g(e.pipeline_id,t,s,((e,t)=>{e&&t&&u({type:rt,payload:t})})),k(!1)})),S=t=>ni(void 0,void 0,void 0,(function*(){yield v(e.pipeline_id,t,((e,t)=>{e&&t&&(u({type:lt,payload:t}),h({type:I,payload:{label:t}}))}))})),A=t=>ni(void 0,void 0,void 0,(function*(){yield j(e.pipeline_id,t,((e,s)=>{e&&s&&(u({type:dt}),u({type:ct,payload:s}),h({type:D,payload:t}),r(t))}))}));return(0,n.jsx)("div",{className:"wpqt-min-w-56 wpqt-flex wpqt-flex-col wpqt-gap-4",onClick:e=>e.stopPropagation(),children:(()=>{switch(l){case qa.SELECTION:return(0,n.jsx)(si,{title:(0,o.__)("Board labels","quicktasker"),description:(0,o.__)("Add, edit, or remove board labels. Created labels can be applied or removed from this task.","quicktasker"),labels:b(),loading:m,labelSelected:y,labelDeSelection:E,deleteLabe:A});case qa.CREATION:return(0,n.jsx)(Xn,{labelCreated:T,loading:f});case qa.EDIT:return(0,n.jsx)(Zn,{labelToEdit:d,editLabel:S,closeEdit:()=>{u({type:dt})}});default:return null}})()})}));function oi({task:e,labelSelected:t=()=>{},labelDeselected:s=()=>{},labelDeleted:a=()=>{}}){const i=e.assigned_labels||[],o=Array.isArray(i)&&i.length>0;return(0,n.jsx)(Hn,{menuBtnClasses:"wpqt-inline-flex",anchor:"bottom start",menuBtn:()=>(0,n.jsxs)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1.5",children:[(0,n.jsx)(Gn.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`}),o&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-flex-wrap",children:i.map((e=>(0,n.jsx)(Vn,{inlineStyle:{backgroundColor:e.color},children:e.name},e.id)))})]}),children:e&&(0,n.jsx)(ii,{task:e,labelSelected:t,labelDeselected:s,labelDeleted:a})})}var ri=s(2792),ci=s(6797),li=s(4403);function di({sectionTitle:e,onItemSelect:t=()=>{},users:s=[],ActionIcon:a=li.A,actionIconClasses:i,noUsersText:o}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2 wpqt-text-lg",children:e}),s.map(((e,s)=>{var o;return(0,n.jsxs)("div",{onClick:s=>{s.stopPropagation(),t(e)},className:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-px-2 wpqt-py-1 hover:wpqt-bg-gray-100",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("div",{children:e.name}),(0,n.jsx)("div",{className:"wpqt-italic",children:e.description}),Yt(e)&&(0,n.jsx)("div",{children:null===(o=e.roles)||void 0===o?void 0:o.join(",")})]}),(0,n.jsx)(a,{className:`wpqt-ml-auto wpqt-size-5 ${i}`})]},s)})),0===s.length&&(0,n.jsx)("div",{children:o})]})}var ui=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function pi({task:e,onUserAdd:t,onUserDelete:s}){const{state:{users:r,wpUsers:c}}=(0,a.useContext)(La),{handleExecutedAutomations:l}=gs(),{dispatch:d}=(0,a.useContext)(ws),[u,p]=(0,a.useState)(!1),h=r.filter((t=>{var s;return!(null!==(s=e.assigned_users)&&void 0!==s?s:[]).some((e=>e.id===t.id))})),m=c.filter((t=>{var s;return!(null!==(s=e.assigned_wp_users)&&void 0!==s?s:[]).some((e=>e.id===t.id))})),w=s=>ui(this,void 0,void 0,(function*(){try{p(!0);const a=s.user_type,n=yield function(e,t,s){return Ft()({path:`/wpqt/v1/users/${e}/tasks/${t}`,method:"POST",data:{user_type:s},headers:Kt()})}(s.id,e.id,a);d({type:b,payload:{taskId:e.id,user:s}}),t(s),l(n.data.executedAutomations,e.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to assign user","quicktasker"))}finally{p(!1)}})),f=t=>ui(this,void 0,void 0,(function*(){try{p(!0);const a=t.user_type,n=yield Ht(t.id,e.id,a);d({type:y,payload:{taskId:e.id,userId:t.id,userType:a}}),s(t),l(n.data.executedAutomations,e.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to remove user","quicktasker"))}finally{p(!1)}}));return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-w-[320px] wpqt-flex-col",children:[(0,n.jsx)(di,{sectionTitle:(0,o.__)("Assigned quicktaskers","quicktasker"),users:e.assigned_users,onItemSelect:f,ActionIcon:ci.A,actionIconClasses:"wpqt-icon-red",noUsersText:(0,o.__)("No quicktaskers assigned","quicktasker")}),(0,n.jsx)(di,{sectionTitle:(0,o.__)("Assigned WordPress users","quicktasker"),users:e.assigned_wp_users,onItemSelect:f,ActionIcon:ci.A,actionIconClasses:"wpqt-icon-red",noUsersText:(0,o.__)("No WordPress users assigned","quicktasker")}),(0,n.jsx)(di,{sectionTitle:(0,o.__)("Assign a quicktasker","quicktasker"),users:h,onItemSelect:w,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No quicktaskers available to assign","quicktasker")}),(0,n.jsx)(di,{sectionTitle:(0,o.__)("Assign a WordPress user","quicktasker"),users:m,onItemSelect:w,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No WordPress users with required permissions available to assign","quicktasker")}),u&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Ws,{width:"30",height:"30"})})]})}function hi({task:e,onUserAdd:t=()=>{},onUserDelete:s=()=>{},menuBtnClasses:a=""}){const i=[...e.assigned_users||[],...e.assigned_wp_users||[]],o=i.length>0;return(0,n.jsx)(Hn,{menuBtnClasses:`wpqt-inline-flex ${a}`,anchor:"bottom start",menuBtn:()=>(0,n.jsxs)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1",children:[(0,n.jsx)(ri.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`}),o&&(0,n.jsx)("div",{children:i.map(((e,t)=>(0,n.jsxs)("span",{children:[e.name,t<i.length-1&&", "]},t)))})]}),children:(0,n.jsx)(pi,{task:e,onUserAdd:t,onUserDelete:s})})}var mi=s(1848);function wi({tabs:e,tabsContent:t,tabClassName:s="",tabListClassName:a=""}){return(0,n.jsxs)(mi.fu,{children:[(0,n.jsx)(mi.wb,{className:`wpqt-mb-6 wpqt-flex wpqt-border-0 wpqt-border-b wpqt-border-solid wpqt-border-b-gray-300 ${a}`,children:e.map((e=>(0,n.jsx)(fi,{className:s,children:e},e)))}),(0,n.jsx)(mi.T2,{children:t.map(((e,t)=>(0,n.jsx)(ki,{children:e},t)))})]})}function fi({children:e,className:t}){return(0,n.jsx)(mi.oz,{as:"div",className:`wpqt-flex-1 wpqt-cursor-pointer wpqt-p-1 wpqt-pb-[10px] wpqt-text-center wpqt-text-lg data-[selected]:wpqt-border-b-2 data-[selected]:wpqt-border-l-0 data-[selected]:wpqt-border-r-0 data-[selected]:wpqt-border-t-0 data-[selected]:wpqt-border-solid data-[selected]:wpqt-border-b-blue-500 ${t}`,children:e})}function ki({children:e}){return(0,n.jsx)(mi.Kp,{children:e})}const qi={[bs.Admin]:(0,o.__)("Admin","quicktasker"),[bs.Automation]:(0,o.__)("Automation","quicktasker"),[bs.System]:(0,o.__)("System","quicktasker"),[bs.WPQTUser]:"Quicktasker",[bs.Import]:(0,o.__)("Import","quicktasker"),[bs.Webhook]:(0,o.__)("Webhook","quicktasker")};function gi({log:e,children:t}){const{convertToWPTimezone:s}=yn(),a=qi[e.created_by];return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-main-border wpqt-p-3",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-1",children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:e.author_name}),(0,n.jsxs)("span",{children:["(",a,")"]}),"",(0,n.jsx)("span",{children:s(e.created_at)})]}),(0,n.jsx)("div",{children:t})]})}var xi=s(3338),_i=s(3211);const vi={success:"wpqt-bg-green-100 wpqt-border-green-400 wpqt-text-green-700",error:"wpqt-bg-red-100 wpqt-border-red-400 wpqt-text-red-700",warning:"wpqt-bg-yellow-100 wpqt-border-yellow-400 wpqt-text-yellow-700",info:"wpqt-bg-blue-100 wpqt-border-blue-400 wpqt-text-blue-700",primary:"wpqt-bg-gray-100 wpqt-border-gray-400 wpqt-text-gray-700"};function ji({type:e="primary",className:t="",children:s}){const a=vi[e];return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-p-2 wpqt-border wpqt-border-solid wpqt-rounded-md ${a} ${t}`,children:s})}var bi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function yi({typeId:e,fetchData:t,renderItem:s,noDataMessage:i,explanation:o,onAdd:r=()=>bi(this,void 0,void 0,(function*(){})),enableAdd:c=!1}){const[l,d]=(0,a.useState)(null),[u,p]=(0,a.useState)(""),[h,m]=(0,a.useState)(!0),[w,f]=(0,a.useState)(!1);(0,a.useEffect)((()=>{k()}),[e]);const k=()=>bi(this,void 0,void 0,(function*(){m(!0);const e=yield t();e&&d(e),m(!1)}));return null===l?(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Ws,{width:"30",height:"30"})}):(0,n.jsxs)("div",{children:[o&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(ji,{type:"info",className:"wpqt-mb-3 wpqt-text-center",children:o})}),0===l.length&&(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-text-center",children:i}),(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-mt-3 wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Ei,{isLoading:h,refreshComemnts:k})}),c&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-mb-6",children:[(0,n.jsx)(on,{rowsCount:3,value:u,onChange:e=>p(e),className:"wpqt-w-full !wpqt-mb-0",wrapperClassName:"!wpqt-mb-0"}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(oa,{text:"Add comment",loading:w,onClick:()=>bi(this,void 0,void 0,(function*(){if(!u)return;f(!0);const e=yield r(u);e&&(d((t=>t?[e,...t]:[e])),p("")),f(!1)})),icon:(0,n.jsx)(xi.A,{className:"wpqt-icon-blue wpqt-size-5"})})})]}),l.length>0&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-4 wpqt-items-start",children:l.map((e=>s(e)))})]})}function Ei({isLoading:e,refreshComemnts:t}){return(0,n.jsx)(n.Fragment,{children:e?(0,n.jsx)(Ws,{width:"32",height:"32"}):(0,n.jsx)(_i.A,{className:"wpqt-icon-blue wpqt-size-8 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:t})})}function Ti({taskId:e}){return(0,n.jsx)(yi,{typeId:e,fetchData:()=>{return t=this,s=void 0,n=function*(){try{return(yield Vt(e,js.Task)).data}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to get logs","quicktasker"))}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n},renderItem:e=>(0,n.jsx)(gi,{log:e,children:e.text}),noDataMessage:(0,o.__)("No logs available","quicktasker")})}function Si(){return{addComment:(e,t,s,a)=>{return n=this,r=void 0,l=function*(){try{const n=yield Gt(e,t,s,a);return i.oR.success((0,o.__)("Comment added","quicktasker")),n.data.newComment}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add comment","quicktasker"))}},new((c=void 0)||(c=Promise))((function(e,t){function s(e){try{i(l.next(e))}catch(e){t(e)}}function a(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){var n;t.done?e(t.value):(n=t.value,n instanceof c?n:new c((function(e){e(n)}))).then(s,a)}i((l=l.apply(n,r||[])).next())}));var n,r,c,l}}}function Ai({authorName:e,authorType:t,commentDate:s,children:a}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-main-border wpqt-p-3",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-1",children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:e}),(0,n.jsxs)("span",{children:["(","quicktasker"===t?"QuickTasker":"WP User",")"]}),"",(0,n.jsx)("span",{children:s})]}),(0,n.jsx)("div",{children:a})]})}var Oi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ni({taskId:e}){const{addComment:t}=Si();return(0,n.jsx)(yi,{typeId:e,fetchData:()=>Oi(this,void 0,void 0,(function*(){try{return(yield zt(e,js.Task,!0)).data}catch(e){console.error(e),i.oR.error("Failed to load comments")}})),onAdd:s=>Oi(this,void 0,void 0,(function*(){const a=yield t(e,js.Task,!0,s);if(a)return a})),renderItem:e=>{var t;return(0,n.jsx)(Ai,{authorName:null!==(t=e.author_name)&&void 0!==t?t:"",authorType:e.author_type,commentDate:e.created_at,children:e.text},e.id)},noDataMessage:"No comments available",enableAdd:!0})}var Ci=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ii({taskId:e}){const{addComment:t}=Si();return(0,n.jsx)(yi,{typeId:e,fetchData:()=>Ci(this,void 0,void 0,(function*(){try{return(yield zt(e,js.Task,!1)).data}catch(e){console.error(e),i.oR.error("Failed to load comments")}})),onAdd:s=>Ci(this,void 0,void 0,(function*(){const a=yield t(e,js.Task,!1,s);if(a)return a})),renderItem:e=>{var t;return(0,n.jsx)(Ai,{authorName:null!==(t=e.author_name)&&void 0!==t?t:"",authorType:e.author_type,commentDate:e.created_at,children:e.text},e.id)},noDataMessage:"No comments available",enableAdd:!0})}function Di({task:e}){const t=[(0,o.__)("Logs","quicktasker"),(0,o.__)("Private comments","quicktasker"),(0,o.__)("Public comments","quicktasker")];return(0,n.jsx)(wi,{tabs:t,tabsContent:[(0,n.jsx)(Ti,{taskId:e.id},3),(0,n.jsx)(Ni,{taskId:e.id},1),(0,n.jsx)(Ii,{taskId:e.id},2)]})}var Pi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ri(){return{getUplaods:(e,t)=>Pi(this,void 0,void 0,(function*(){try{const s=yield function(e,t){const s=new URLSearchParams({entity_id:e,entity_type:t});return Ft()({path:`/wpqt/v1/uploads?${s.toString()}`,method:"GET"})}(e,t);return{data:s.data,error:null}}catch(e){return console.error(e),{data:null,error:e}}})),uploadFile:e=>Pi(this,void 0,void 0,(function*(){try{const t=yield function(e){return Ft()({path:"/wpqt/v1/uploads",method:"POST",body:e})}(e);return i.oR.success((0,o.__)("File uploaded successfully","quicktasker")),{data:t.data,error:null}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to upload a file","quicktasker")),{data:null,error:e}}})),deleteUpload:e=>Pi(this,void 0,void 0,(function*(){try{const t=yield function(e){return Ft()({path:`/wpqt/v1/uploads/${e}`,method:"DELETE"})}(e);return i.oR.success((0,o.__)("File deleted successfully","quicktasker")),{data:t.data,error:null}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to delete a file","quicktasker")),{data:null,error:e}}})),checkFileExists:e=>Pi(this,void 0,void 0,(function*(){try{return(yield fetch(e,{method:"HEAD"})).ok}catch(e){return!1}}))}}var Li=s(2944),Mi=s(4015);function Ui({upload:e,menuBtnClasses:t=""}){const{state:{taskUploadsURL:s}}=(0,a.useContext)(Ja),i=`${s}/${e.upload_uuid}/${e.file_name}`;return(0,n.jsx)(Hn,{menuBtnClasses:`wpqt-inline-flex ${t}`,anchor:"top",menuBtn:()=>(0,n.jsx)(Mi.A,{className:"wpqt-size-5 wpqt-icon-blue"}),children:(0,n.jsxs)("div",{children:[(0,n.jsx)(Fi,{title:(0,o.__)("File name","quicktasker"),children:e.file_name}),(0,n.jsx)(Fi,{title:(0,o.__)("File link","quicktasker"),children:(0,n.jsx)("a",{href:i,target:"_blank",rel:"noreferrer",children:i})}),(0,n.jsx)(Fi,{title:(0,o.__)("Created at","quicktasker"),children:e.created_at}),(0,n.jsx)(Fi,{title:(0,o.__)("Created by","quicktasker"),children:e.uploader_name})]})})}function Fi({title:e,children:t}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-uppercase",children:e}),(0,n.jsx)("div",{children:t})]})}var Ki=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function $i({upload:e}){const{state:{isUserAllowedToDelete:t,taskUploadsURL:s}}=(0,a.useContext)(Ja),{uploadDispatch:r}=(0,a.useContext)(za),[c,l]=(0,a.useState)(!1),{checkFileExists:d,deleteUpload:u}=Ri(),p=`${s}/${e.upload_uuid}/${e.file_name}`,h=(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-4 wpqt-justify-end wpqt-items-center",children:[(0,n.jsx)("a",{href:p,download:!0,onClick:()=>Ki(this,void 0,void 0,(function*(){(yield d(p))||i.oR.error((0,o.__)("File was not found","quicktasker"))})),className:"focus:wpqt-shadow-none",children:(0,n.jsx)(Li.A,{className:"wpqt-icon-blue wpqt-size-5 :hover:wpqt-text-blue-800 wpqt-cursor-pointer"})}),(0,n.jsx)(Ui,{upload:e}),t&&(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-5 :hover:wpqt-text-red-800 wpqt-cursor-pointer",onClick:()=>Ki(this,void 0,void 0,(function*(){l(!0);const{data:t}=yield u(e.id);t&&r({type:Nt,payload:e.id}),l(!1)}))})]});return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-main-border wpqt-p-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:e.file_name}),c?(0,n.jsx)(Ys,{ovalSize:"22",className:"!wpqt-items-end"}):h]})}function zi({entityId:e,entityType:t}){const{uploadDispatch:s}=(0,a.useContext)(za),[r,c]=(0,a.useState)(null),[l,d]=(0,a.useState)(!1),{uploadFile:u}=Ri(),p=(0,a.useRef)(null);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsxs)("div",{className:"wpqt-max-w-[300px]",children:[(0,o.sprintf)((0,o.__)("Select file to upload (Max size: %d MB)","quicktasker"),25),(0,n.jsx)("br",{}),(0,o.__)("Allowed characters in file name: Latin letters, numbers, underscores, hyphens, and dots.","quicktasker")]}),(0,n.jsx)("input",{type:"file",onChange:e=>{if(e.target.files){const t=e.target.files[0];if(t.size>Rt)return void i.oR.error((0,o.sprintf)((0,o.__)("File size exceeds the maximum limit of %d MB","quicktasker"),Rt));if(!Lt.test(t.name))return void i.oR.error((0,o.__)("Invalid file name","quicktasker"));if(0===t.size)return void i.oR.error((0,o.__)("The selected file is empty","quicktasker"));c(t)}},ref:p,accept:Pt.join(",")}),r&&(0,n.jsx)(Js,{btnText:(0,o.__)("Upload","quicktasker"),loading:l,onClick:()=>{return a=this,n=void 0,o=function*(){const a=(()=>{if(!r)return null;const s=new FormData;return s.append("file_to_upload",r),s.append("entity_id",e),s.append("entity_type",t),s})();if(a){d(!0);const{data:e}=yield u(a);e&&(s({type:Ot,payload:e.upload}),c(null),p.current&&(p.current.value="")),d(!1)}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{c(o.next(e))}catch(e){t(e)}}function r(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var a;t.done?e(t.value):(a=t.value,a instanceof i?a:new i((function(e){e(a)}))).then(s,r)}c((o=o.apply(a,n||[])).next())}));var a,n,i,o}})]})}function Gi({entityId:e,entityType:t}){const{state:{uploads:s},uploadDispatch:r}=(0,a.useContext)(za),[c,l]=(0,a.useState)(!0),{getUplaods:d}=Ri(),u=()=>{return s=this,a=void 0,c=function*(){l(!0);const{data:s,error:a}=yield d(e,t);l(!1),s&&s.uploads&&r({type:At,payload:s.uploads}),a&&i.oR.error((0,o.__)("Failed to fetch uploads","quicktasker"))},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}r((c=c.apply(s,a||[])).next())}));var s,a,n,c};return(0,a.useEffect)((()=>{u()}),[]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(zi,{entityId:e,entityType:t}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-flex-wrap wpqt-items-start",children:c?(0,n.jsx)(Ys,{ovalSize:"24"}):s.map((e=>(0,n.jsx)($i,{upload:e},e.id)))})]})}var Vi=s(303);function Bi({checked:e,handleChange:t,id:s,dataTestId:a}){return(0,n.jsx)(Vi.A,{onChange:t,checked:e,uncheckedIcon:!1,checkedIcon:!1,height:20,width:44,id:s,"data-testid":a})}function Hi({initialValue:e,task:t,onEditTaskCompleted:s}){const[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(e),{editTask:u}=_s();return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)(Bi,{checked:l,handleChange:e=>{return a=this,n=void 0,l=function*(){d(e),c(!0);const{success:a,task:n}=yield u(t.id,{free_for_all:e});c(!1),a&&n?(s(n),i.oR.success((0,o.__)("Free for all updated","quicktasker"))):d(!e)},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{o(l.next(e))}catch(e){t(e)}}function i(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var a;t.done?e(t.value):(a=t.value,a instanceof r?a:new r((function(e){e(a)}))).then(s,i)}o((l=l.apply(a,n||[])).next())}));var a,n,r,l}}),r&&(0,n.jsx)(Ys,{ovalSize:"20"})]})}var Wi=s(4461);function Qi({initialValue:e,task:t,onEditTaskCompleted:s}){const[r,c]=(0,a.useState)(null),[l,d]=(0,a.useState)(!1),{editTask:u}=_s(),{convertUTCDateTimeToWPTimezone:p}=yn();(0,a.useEffect)((()=>{const t=e?p(e):null;c(t)}),[e]);const h=e=>{return a=this,n=void 0,p=function*(){const a=r,n=e?gn()(e).utc().format("YYYY-MM-DD HH:mm:ss"):"";c(e),d(!0);const{success:l,task:p}=yield u(t.id,{due_date:n});d(!1),l&&p?(s(p),i.oR.success((0,o.__)("Due date updated","quicktasker"))):c(a)},new((l=void 0)||(l=Promise))((function(e,t){function s(e){try{o(p.next(e))}catch(e){t(e)}}function i(e){try{o(p.throw(e))}catch(e){t(e)}}function o(t){var a;t.done?e(t.value):(a=t.value,a instanceof l?a:new l((function(e){e(a)}))).then(s,i)}o((p=p.apply(a,n||[])).next())}));var a,n,l,p};return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)(Wi.A,{onChange:e=>{h(e)},value:r,format:"y-MM-dd HH:mm"}),l&&(0,n.jsx)(Ys,{ovalSize:"20"})]})}var Yi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Ji=({deleteTask:e,onEditTaskCompleted:t})=>{const{state:{taskToEdit:s,taskModalSettings:r},modalDispatch:c}=(0,a.useContext)(Ls),{state:{isUserAllowedToDelete:l}}=(0,a.useContext)(Ja),{state:{activePipeline:d},fetchAndSetPipelineData:u}=(0,a.useContext)(ws),[p]=(0,a.useState)(!1),[h,m]=(0,a.useState)([]),{archiveTask:w,editTask:f}=_s(),{loading1:k,setLoading1:q,loading2:g,setLoading2:x}=Wa(),_=null==s?void 0:s.is_archived;return(0,a.useEffect)((()=>{s&&m(s.assigned_labels)}),[s]),s?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsxs)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-6",children:[(0,n.jsxs)("div",{className:"wpqt-mb-2 wpqt-grid wpqt-grid-cols-1 wpqt-gap-10 md:wpqt-grid-cols-[1fr_0.7fr]",children:[(0,n.jsxs)(aa,{children:[(0,n.jsx)(na,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(sn,{value:s.name,wrapperClassName:"wpqt-w-full",className:"wpqt-w-full",onChange:e=>Yi(void 0,void 0,void 0,(function*(){const{success:a,task:n}=yield f(s.id,{name:e});a&&n&&(t(n),i.oR.success((0,o.__)("Task name updated","quicktasker")))}))})}),(0,n.jsx)(na,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(rn,{value:s.description,className:"wpqt-w-full",onChange:e=>Yi(void 0,void 0,void 0,(function*(){const{success:a,task:n}=yield f(s.id,{description:e});a&&n&&(t(n),i.oR.success((0,o.__)("Task description updated","quicktasker")))}))})}),(0,n.jsx)(na,{label:(0,o.__)("Assigned users","quicktasker"),children:(0,n.jsx)(hi,{task:s,onUserAdd:e=>{c({type:Y,payload:e})},onUserDelete:e=>{c({type:J,payload:e})}})}),(0,n.jsx)(na,{label:(0,o.__)("Labels","quicktasker"),children:(0,n.jsx)(oi,{task:Object.assign(Object.assign({},s),{assigned_labels:h}),labelSelected:e=>{m((t=>[...t,e]))},labelDeselected:e=>{m((t=>t.filter((t=>t.id!==e))))},labelDeleted:e=>{m((t=>t.filter((t=>t.id!==e))))}})}),(0,n.jsx)(na,{label:(0,o.__)("Free for all task","quicktasker"),description:(0,o.__)("When enabled, users have the ability to self-assign or unassign this task.","quicktasker"),children:(0,n.jsx)(Hi,{task:s,initialValue:s.free_for_all,onEditTaskCompleted:t})}),(0,n.jsx)(na,{label:(0,o.__)("Due date","quicktasker"),children:(0,n.jsx)(Qi,{initialValue:s.due_date||"",task:s,onEditTaskCompleted:t})}),r.allowToMarkTaskAsDone&&(0,n.jsx)(Xi,{taskId:s.id,isCompleted:s.is_done})]}),(0,n.jsx)("div",{children:(0,n.jsx)($n,{entityId:s.id,entityType:en.Task})})]}),(0,n.jsx)(na,{label:(0,o.__)("File attachment","quicktasker"),children:(0,n.jsx)(Gi,{entityId:s.id,entityType:tn.TASK})}),(0,n.jsx)("div",{className:"wpqt-mt-7 md:wpqt-pr-3",children:(0,n.jsx)(Di,{task:s})})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[_&&(0,n.jsx)(oa,{icon:(0,n.jsx)(la.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Restore task","quicktasker"),loading:p,onClick:()=>Yi(void 0,void 0,void 0,(function*(){c({type:K}),c({type:le,payload:{taskToRestore:s}})}))}),!_&&(0,n.jsx)(zn,{confirmMessage:(0,o.__)("Are you sure you want to archive this task?","quicktasker"),onConfirm:()=>{x(!0),w(s.id,(()=>{c({type:K}),u(d.id),x(!1)}))},children:({onClick:e})=>(0,n.jsx)(oa,{icon:(0,n.jsx)(Va.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("Archive task","quicktasker"),loading:g,onClick:e})}),l&&(0,n.jsx)(zn,{onConfirm:()=>Yi(void 0,void 0,void 0,(function*(){q(!0),yield e(s),c({type:K}),q(!1)})),children:({onClick:e})=>(0,n.jsx)(oa,{icon:(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Delete task","quicktasker"),loading:k,onClick:e})})]})]})}):null};function Xi({isCompleted:e,taskId:t}){const{modalDispatch:s}=(0,a.useContext)(Ls),{dispatch:i}=(0,a.useContext)(ws),[r,c]=(0,a.useState)(!1),{changeTaskDoneStatus:l}=_s();return(0,n.jsx)(na,{label:e?(0,o.__)("Task completed","quicktasker"):(0,o.__)("Task not completed","quicktasker"),children:r?(0,n.jsx)(Ws,{width:"24",height:"24"}):(0,n.jsx)(Ha.A,{onClick:()=>Yi(this,void 0,void 0,(function*(){c(!0),yield l(t,!e,(e=>{s({type:E,payload:{done:e}}),i({type:E,payload:{taskId:t,done:e}})})),c(!1)})),className:`wpqt-size-6 ${e?"wpqt-icon-green":"wpqt-text-gray-300"} wpqt-cursor-pointer`})})}function Zi({deleteTaskCallback:e}){const{state:{taskModalOpen:t}}=(0,a.useContext)(Ls),{deleteTask:s}=_s(),{closeModal:i,handleSuccess:o}=Fa(K);return(0,n.jsx)(ta,{modalOpen:t,closeModal:i,size:"xl",children:(0,n.jsx)(Ga,{children:(0,n.jsx)(Ji,{deleteTask:t=>{return a=this,n=void 0,o=function*(){s(t.id,(()=>{e&&e(t)}))},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{c(o.next(e))}catch(e){t(e)}}function r(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var a;t.done?e(t.value):(a=t.value,a instanceof i?a:new i((function(e){e(a)}))).then(s,r)}c((o=o.apply(a,n||[])).next())}));var a,n,i,o},onEditTaskCompleted:e=>{o(q,e,Ua.ACTIVE_PIPELINE)}})})})}function eo({text:e=(0,o.__)("No results found","quicktasker")}){return(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-center wpqt-text-xl",children:e})}var to=s(3033),so=s(587);function ao({className:e,onClick:t,title:s,description:a,children:i,dropdown:o,titleClassName:r="",style:c={}}){const l=void 0!==o;return(0,n.jsxs)("div",{className:(0,nn.$)("wpqt-relative wpqt-flex wpqt-flex-col wpqt-rounded wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-p-4",l&&"wpqt-pr-[24px]",e),style:c,onClick:t,children:[(0,n.jsxs)("div",{className:"wpqt-mb-3",children:[(0,n.jsx)("div",{className:`wpqt-text-lg ${r}`,children:s}),a&&(0,n.jsx)("div",{className:"wpqt-italic wpqt-text-gray-500",children:a})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-h-full",children:i}),l&&(0,n.jsx)("div",{className:"wpqt-absolute wpqt-right-2 wpqt-top-1 wpqt-z-10",children:o})]})}function no({task:e,onDoneStatusChange:t,className:s=""}){const{changeTaskDoneStatus:i}=_s(),[o,r]=(0,a.useState)(!1),c=e.is_done,l=s=>{return a=this,n=void 0,c=function*(){r(!0),yield i(e.id,s,(s=>{t(e.id,s)})),r(!1)},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{r(c.next(e))}catch(e){t(e)}}function i(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var a;t.done?e(t.value):(a=t.value,a instanceof o?a:new o((function(e){e(a)}))).then(s,i)}r((c=c.apply(a,n||[])).next())}));var a,n,o,c};return o?(0,n.jsx)(Ys,{ovalSize:"24",className:"wpqt-mt-auto"}):(0,n.jsx)("div",{className:`wpqt-flex wpqt-justify-center wpqt-mt-auto ${s}`,children:c?(0,n.jsx)(Ha.A,{className:"wpqt-size-6 wpqt-icon-green",onClick:e=>{e.stopPropagation(),l(!1)},"data-testid":"check-icon"}):(0,n.jsx)(Ha.A,{className:"wpqt-size-6 wpqt-text-gray-300",onClick:e=>{e.stopPropagation(),l(!0)},"data-testid":"check-icon"})})}function io({label:e,value:t,valueClassName:s="",valueLink:a,icon:i,onClick:o=()=>{},className:r="",labelClassName:c=""}){return(0,n.jsxs)("div",{className:`wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center ${r}`,onClick:o,children:[i&&i,(0,n.jsx)("div",{className:c,children:t?`${e}:`:e}),(0,n.jsx)("div",{className:`${s}`,children:a?(0,n.jsx)("a",{href:a,target:"_blank",className:"wpqt-text-qtTextBlue wpqt-no-underline",rel:"noreferrer",onClick:e=>e.stopPropagation(),children:t}):t})]})}var oo=s(6436),ro=s(72),co=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function lo({task:e}){const{state:{isUserAllowedToDelete:t}}=(0,a.useContext)(Ja),{archiveDispatch:s}=(0,a.useContext)(Ns),{deleteTask:i}=_s(),{modalDispatch:r}=(0,a.useContext)(Ls),[c,l]=(0,a.useState)(!1);return(0,n.jsxs)(Hn,{menuBtn:({active:e})=>(0,n.jsx)(Wn,{isActive:e,IconComponent:oo.A}),children:[(0,n.jsx)(Qn,{text:(0,o.__)("View task","quicktasker"),icon:(0,n.jsx)(ro.A,{className:"wpqt-icon-blue wpqt-size-4"})}),(0,n.jsx)(Qn,{text:(0,o.__)("Restore task","quicktasker"),icon:(0,n.jsx)(la.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:t=>co(this,void 0,void 0,(function*(){t.stopPropagation(),r({type:le,payload:{taskToRestore:e}})}))}),t&&(0,n.jsx)(Qn,{text:(0,o.__)("Delete","quicktasker"),loading:c,icon:(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>co(this,void 0,void 0,(function*(){t.stopPropagation(),l(!0),yield i(e.id,(()=>{s({type:xe,payload:e.id})})),l(!1)})),className:"!wpqt-mb-0"})]})}function uo({task:e}){const{modalDispatch:t}=(0,a.useContext)(Ls),{archiveDispatch:s}=(0,a.useContext)(Ns),{convertToWPTimezone:i}=yn(),r=e.due_date?i(e.due_date):null;return(0,n.jsxs)(ao,{title:e.name,description:e.description,dropdown:(0,n.jsx)(lo,{task:e}),className:"wpqt-cursor-pointer",onClick:()=>{t({type:F,payload:{taskToEdit:e}})},children:[(0,n.jsx)(io,{label:(0,o.__)("Board","quicktasker"),value:e.pipeline_name?e.pipeline_name:(0,o.__)("Board is deleted!","quicktasker"),icon:(0,n.jsx)(to.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(hi,{menuBtnClasses:"wpqt-self-start",task:e,onUserAdd:t=>{s({type:ve,payload:{taskId:e.id,user:t}})},onUserDelete:t=>{s({type:je,payload:{taskId:e.id,user:t}})}}),(0,n.jsx)(oi,{task:e})]}),r&&(0,n.jsx)(io,{label:(0,o.__)("Due date","quicktasker"),value:r,icon:(0,n.jsx)(so.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(no,{task:e,onDoneStatusChange:(e,t)=>{s({type:be,payload:{taskId:e,done:t}})}})]})}function po(){const{state:{archivedTasks:e,archiveLoading:t}}=(0,a.useContext)(Ns);return t?(0,n.jsx)(Ys,{className:"wpqt-h-[200px]"}):e&&0===e.length?(0,n.jsx)(eo,{text:(0,o.__)("No match","quicktasker")}):e?(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"wpqt-card-grid",children:e.map((e=>(0,n.jsx)(uo,{task:e},e.id)))})}):null}function ho(){const{archiveDispatch:e}=(0,a.useContext)(Ns);return(0,n.jsxs)("div",{children:[(0,n.jsx)(Ia,{}),(0,n.jsx)(po,{}),(0,n.jsx)(Zi,{editTaskCallback:t=>{e({type:ye,payload:t})},deleteTaskCallback:t=>{e({type:xe,payload:t.id})}})]})}function mo(){const{modalDispatch:e}=(0,a.useContext)(Ls);return(0,n.jsx)(Cs,{children:(0,n.jsx)(ja,{children:(0,n.jsxs)(ba,{children:[(0,n.jsx)(d,{description:(0,o.__)("Archived tasks management page.","quicktasker"),icon:(0,n.jsx)(l.A,{className:"wpqt-icon-gray wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{e({type:ce,payload:!0})}}),children:(0,o.__)("Archive","quicktasker")}),(0,n.jsx)(ho,{}),(0,n.jsx)(ca,{}),(0,n.jsx)(ga,{})]})})})}const wo=({filterSettings:e,setFilterSettings:t})=>{const{state:{pipelines:s}}=(0,a.useContext)(pa),[i,r]=(0,a.useState)(e),c=(0,n.jsx)(Ca,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"log-search",children:(0,n.jsx)(Aa,{inputId:"log-search",value:i.search,onChange:e=>{r(Object.assign(Object.assign({},i),{search:e}))}})}),l=(0,n.jsx)(oa,{text:(0,o.__)("Apply filter","quicktasker"),icon:(0,n.jsx)(ya.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:()=>t(i)});return(0,n.jsxs)(Na,{title:(0,o.__)("Logs filtering","quicktasker"),searchChildren:c,applyFilterChildren:l,children:[(0,n.jsx)(Ca,{title:(0,o.__)("Type","quicktasker"),children:(0,n.jsx)(ka,{allSelector:!1,selectedOptionValue:i.type,options:[{label:(0,o.__)("All types","quicktasker"),value:fo.All},{label:(0,o.__)("Board","quicktasker"),value:fo.Pipeline},{label:(0,o.__)("Task","quicktasker"),value:fo.Task}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{type:e,typeId:""}))}})}),i.type===fo.Pipeline&&(0,n.jsx)(Ca,{title:(0,o.__)("Board","quicktasker"),children:(0,n.jsx)(ka,{allSelector:!0,selectedOptionValue:i.typeId,options:s.map((e=>({label:e.name,value:e.id}))),onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{typeId:e}))}})}),(0,n.jsx)(Ca,{title:(0,o.__)("Created by","quicktasker"),children:(0,n.jsx)(ka,{allSelector:!1,selectedOptionValue:i.createdBy,options:[{label:(0,o.__)("Everyone","quicktasker"),value:qo.All},{label:(0,o.__)("Admin","quicktasker"),value:qo.Admin},{label:"QuickTasker",value:qo.Quicktasker},{label:(0,o.__)("Automation","quicktasker"),value:qo.Automation},{label:(0,o.__)("Import","quicktasker"),value:qo.Import},{label:(0,o.__)("System","quicktasker"),value:qo.System}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{createdBy:e}))}})}),(0,n.jsx)(Ca,{title:(0,o.__)("Number of logs","quicktasker"),children:(0,n.jsx)(ka,{allSelector:!1,selectedOptionValue:i.numberOfLogs,options:[{label:(0,o.__)("Show 100","quicktasker"),value:xo.Hundred},{label:(0,o.__)("Show 200","quicktasker"),value:xo.TwoHundred},{label:"Show 500",value:xo.FiveHundred},{label:"Show all",value:xo.All}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{numberOfLogs:e}))}})}),(0,n.jsx)(Ca,{title:(0,o.__)("Order","quicktasker"),children:(0,n.jsx)(ka,{allSelector:!1,selectedOptionValue:i.order,options:[{label:(0,o.__)("Ascending","quicktasker"),value:go.Asc},{label:(0,o.__)("Descending","quicktasker"),value:go.Desc}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{order:e}))}})}),(0,n.jsx)(Ca,{title:(0,o.__)("Status","quicktasker"),children:(0,n.jsx)(ka,{allSelector:!1,selectedOptionValue:i.status,options:[{label:(0,o.__)("All","quicktasker"),value:_o.All},{label:(0,o.__)("Success","quicktasker"),value:_o.Success},{label:(0,o.__)("Error","quicktasker"),value:_o.Error}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{status:e}))}})})]})};var fo,ko,qo;!function(e){e.Pipeline="pipeline",e.Stage="stage",e.Task="task",e.Webhook="webhook",e.All="all"}(fo||(fo={})),function(e){e.Success="success",e.Error="error"}(ko||(ko={})),function(e){e.Admin="admin",e.Quicktasker="quicktasker_user",e.Automation="automation",e.Import="import",e.System="system",e.All="all"}(qo||(qo={}));var go,xo,_o,vo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};!function(e){e.Asc="ASC",e.Desc="DESC"}(go||(go={})),function(e){e.Hundred="100",e.TwoHundred="200",e.FiveHundred="500",e.All="all"}(xo||(xo={})),function(e){e.All="all",e.Success="success",e.Error="error"}(_o||(_o={}));const jo=()=>{const[e,t]=(0,a.useState)([]),[s,r]=(0,a.useState)({numberOfLogs:xo.Hundred,type:fo.All,typeId:"",createdBy:qo.All,order:go.Desc,search:"",status:_o.All}),[c,l]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!0);(0,a.useEffect)((()=>{d&&(p(),u(!1))}),[s,d]);const p=()=>vo(void 0,void 0,void 0,(function*(){try{l(!0);const e=Object.assign({},s);e.numberOfLogs===xo.All&&delete e.numberOfLogs,e.type===fo.All&&delete e.type,""===e.typeId&&delete e.typeId,e.createdBy===qo.All&&delete e.createdBy,e.status===_o.All&&delete e.status;const a=yield Bt(e);t(a.data)}catch(e){console.error(e),i.oR.error("Failed to fetch logs")}finally{l(!1)}}));return(0,n.jsxs)("div",{className:"wpqt-max-w-[1000px] wpqt-mx-auto",children:[(0,n.jsx)(wo,{filterSettings:s,setFilterSettings:e=>vo(void 0,void 0,void 0,(function*(){r(e),u(!0)}))}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3",children:c?(0,n.jsx)(Ys,{ovalSize:"32"}):0===e.length?(0,n.jsx)(eo,{text:(0,o.__)("No logs found","quicktasker")}):e.map((e=>(0,n.jsx)(gi,{log:e,children:e.text},e.id)))})]})};function bo(){const{state:{automationLogsModalOpen:e,automationLogsModalSettings:t},modalDispatch:s}=(0,a.useContext)(Ls);return(0,n.jsx)(ta,{modalOpen:e,closeModal:()=>s({type:fe}),size:"lg",children:e&&(0,n.jsx)(yo,{settings:t})})}function yo({settings:e}){const[t,s]=(0,a.useState)(!1),[i,r]=(0,a.useState)([]),[c,l]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{e.automationId&&(()=>{return t=this,a=void 0,i=function*(){if(e.automationId){s(!0),l(!1);try{const t=yield Bt({createdById:e.automationId,createdBy:qo.Automation,order:go.Desc});r(t.data)}catch(e){console.error("Error fetching automation logs:",e),l(!0)}finally{s(!1)}}},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i})()}),[e.automationId]),c?(0,n.jsx)("div",{children:(0,o.__)("Error fetching logs","quicktasker")}):t?(0,n.jsx)(Ys,{ovalSize:"32"}):0===i.length?(0,n.jsx)(eo,{text:(0,o.__)("No logs found","quicktasker")}):(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-4 wpqt-items-start",children:i.map((e=>(0,n.jsx)(gi,{log:e,children:e.text},e.id)))})}const Eo=(e,t)=>{var s,a;switch(t.type){case mt:{const s=t.payload.automations;return Object.assign(Object.assign({},e),{automations:s})}case wt:{const s=t.payload;return Object.assign(Object.assign({},e),{loading:s})}case ft:{const n=t.payload,i=null!==(a=null===(s=e.automations)||void 0===s?void 0:s.filter((e=>e.id!==n)))&&void 0!==a?a:null;return Object.assign(Object.assign({},e),{automations:i})}case qt:{const s=e.automations?e.automations.map((e=>e.id===t.payload.id?Object.assign(Object.assign({},e),{active:t.payload.active}):e)):null;return Object.assign(Object.assign({},e),{automations:s})}case kt:{const s=t.payload,a=e.automations?[...e.automations,s]:[s];return Object.assign(Object.assign({},e),{automations:a})}default:return e}},To={[as.ARCHIVE_TASK]:(0,o.__)("Archive task","quicktasker"),[as.ASSIGN_USER]:(0,o.__)("Assign user","quickkasker"),[as.NEW_ENTITY_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[as.DELETED_ENTITY_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[as.TASK_ASSIGNED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[as.TASK_UNASSIGNED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[as.TASK_PUBLIC_COMMENT_ADDED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[as.TASK_PRIVATE_COMMENT_ADDED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[as.TASK_FILE_UPLOADED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[as.TASK_FILE_DELETED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[as.CREATE_TASK]:(0,o.__)("Create task","quicktasker"),[as.SEND_SLACK_MESSAGE]:(0,o.__)("Send Slack message","quicktasker")},So={[ts.Task]:(0,o.__)("Task","quicktasker"),[ts.Stage]:(0,o.__)("Stage","quicktasker"),[ts.PIPELINE]:(0,o.__)("Board","quicktasker"),[ts.quicktasker]:"Quicktasker",[ts.WOOCOMMERCE_ORDER]:(0,o.__)("WooCommerce Order","quicktasker"),[ts.SEATREG_BOOKING]:(0,o.__)("SeatReg Booking","quicktasker")},Ao={[Xt.TASK_DONE]:(0,o.__)("Task marked as done","quicktasker"),[Xt.Task_NOT_DONE]:(0,o.__)("Task marked as not done","quicktasker"),[Xt.TASK_CREATED]:(0,o.__)("Task created","quicktasker"),[Xt.TASK_DELETED]:(0,o.__)("Task deleted","quicktasker"),[Xt.TASK_ASSIGNED]:(0,o.__)("Task assigned","quicktasker"),[Xt.TASK_UNASSIGNED]:(0,o.__)("Task unassigned","quicktasker"),[Xt.TASK_PUBLIC_COMMENT_ADDED]:(0,o.__)("Public comment added","quicktasker"),[Xt.TASK_PRIVATE_COMMENT_ADDED]:(0,o.__)("Private comment added","quicktasker"),[Xt.TASK_FILE_UPLOADED]:(0,o.__)("File attached","quicktasker"),[Xt.TASK_FILE_DELETED]:(0,o.__)("Attached file deleted","quicktasker"),[Zt.WOOCOMMERCE_ORDER_ADDED]:(0,o.__)("Order added","quicktasker"),[es.SEATREG_BOOKING_CREATED]:(0,o.__)("Booking created","quicktasker"),[es.SEATREG_BOOKING_APPROVED]:(0,o.__)("Booking gets approved state","quicktasker"),[es.SEATREG_BOOKING_PENDING]:(0,o.__)("Booking gets pending state","quicktasker"),[es.SEATREG_BOOKING_APPROVED_VIA_MANAGER]:(0,o.__)("Booking gets approved state manually with booking manager","quicktasker"),[es.SEATREG_BOOKING_PENDING_VIA_MANAGER]:(0,o.__)("Booking gets pending state manually with booking manager","quicktasker")},Oo=(Zt.WOOCOMMERCE_ORDER_ADDED,(0,o.__)("Order added","quicktasker"),{[Xt.TASK_DONE]:[{id:as.ARCHIVE_TASK},{id:as.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Xt.Task_NOT_DONE]:[{id:as.ARCHIVE_TASK}],[Xt.TASK_CREATED]:[{id:as.ASSIGN_USER,requireAutomationTarget:!0,requireAutomationTargetType:!0},{id:as.NEW_ENTITY_EMAIL,requireMetaData:!0},{id:as.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Xt.TASK_DELETED]:[{id:as.DELETED_ENTITY_EMAIL,requireMetaData:!0},{id:as.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Xt.TASK_ASSIGNED]:[{id:as.TASK_ASSIGNED_EMAIL,requireMetaData:!0},{id:as.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Xt.TASK_UNASSIGNED]:[{id:as.TASK_UNASSIGNED_EMAIL,requireMetaData:!0},{id:as.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Xt.TASK_PUBLIC_COMMENT_ADDED]:[{id:as.TASK_PUBLIC_COMMENT_ADDED_EMAIL,requireMetaData:!0},{id:as.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Xt.TASK_PRIVATE_COMMENT_ADDED]:[{id:as.TASK_PRIVATE_COMMENT_ADDED_EMAIL,requireMetaData:!0},{id:as.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Xt.TASK_FILE_UPLOADED]:[{id:as.TASK_FILE_UPLOADED_EMAIL,requireMetaData:!0}],[Xt.TASK_FILE_DELETED]:[{id:as.TASK_FILE_DELETED_EMAIL,requireMetaData:!0}]}),No={[Zt.WOOCOMMERCE_ORDER_ADDED]:[{id:as.CREATE_TASK}]},Co={[es.SEATREG_BOOKING_CREATED]:[{id:as.CREATE_TASK}],[es.SEATREG_BOOKING_APPROVED]:[{id:as.CREATE_TASK}],[es.SEATREG_BOOKING_PENDING]:[{id:as.CREATE_TASK}],[es.SEATREG_BOOKING_APPROVED_VIA_MANAGER]:[{id:as.CREATE_TASK}],[es.SEATREG_BOOKING_PENDING_VIA_MANAGER]:[{id:as.CREATE_TASK}]},Io={[ts.Task]:Oo,[ts.WOOCOMMERCE_ORDER]:No,[ts.SEATREG_BOOKING]:Co};const Do={automations:null,loading:!0},Po=(0,a.createContext)({state:Do,pipelineAutomationsDispatch:()=>{}}),Ro=({children:e,pipelineId:t})=>{const[s,r]=(0,a.useReducer)(Eo,Do),c=()=>{return e=void 0,s=void 0,n=function*(){try{r({type:wt,payload:!0});const s=yield function(e){return Ft()({path:`/wpqt/v1/pipelines/${e}/automations`,method:"GET",headers:Kt()})}(t);r({type:mt,payload:{automations:(e=s.data.automations,e.map((e=>Object.assign(Object.assign({},e),{active:"1"===e.active,verify_success:"1"===e.verify_success}))))}})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load board automations","quicktasker"))}finally{r({type:wt,payload:!1})}var e},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n};return(0,a.useEffect)((()=>{c()}),[]),(0,n.jsx)(Po.Provider,{value:{state:s,pipelineAutomationsDispatch:r},children:e})};function Lo(){const{state:{automations:e,loading:t}}=(0,a.useContext)(Po);return{automations:e,loading:t}}var Mo=s(8046),Uo=s(1226);const Fo={automationTarget:null,automationTrigger:null,automationAction:null,automationActionTargetId:null,automationActionTargetType:null,metaData:null};function Ko(e,t){switch(t.type){case"SET_TARGET":return Object.assign(Object.assign({},e),{automationTarget:t.payload,automationTrigger:null,automationAction:null});case"SET_TRIGGER":return Object.assign(Object.assign({},e),{automationTrigger:t.payload,automationAction:null});case"SET_ACTION":return Object.assign(Object.assign({},e),{automationAction:t.payload});case"RESET":return Fo;case xt:return Object.assign(Object.assign({},e),{automationActionTargetId:t.payload.automationActionTargetId,automationActionTargetType:t.payload.automationActionTargetType});case gt:return Object.assign(Object.assign({},e),{metaData:t.payload});case _t:return Fo;case vt:return Object.assign(Object.assign({},Fo),{automationTarget:e.automationTarget});case jt:return Object.assign(Object.assign({},Fo),{automationTarget:e.automationTarget,automationTrigger:e.automationTrigger});default:return e}}const $o=()=>{const{state:{users:e,wpUsers:t}}=(0,a.useContext)(La);return{getUser:(s,a)=>a===Ut.QUICKTASKER?e.find((e=>e.id===s)):a===Ut.WP_USER?t.find((e=>e.id===s)):void 0,combinedUsers:(0,a.useMemo)((()=>[...e,...t]),[e,t])}};function zo({actionTargetId:e,actionTargetType:t}){if(null===e||null===t)return null;const{getUser:s}=$o();if(t===ss.QUICKTASKER||t===ss.WP_USER||null!==e){const a=(e=>{switch(e){case ss.QUICKTASKER:return Ut.QUICKTASKER;case ss.WP_USER:return Ut.WP_USER;default:return null}})(t);if(a){const t=s(e,a);return(0,n.jsx)("div",{className:"wpqt-text-center",children:(null==t?void 0:t.name)||(0,o.__)("User not found","quicktasker")})}}return null}var Go=s(712);function Vo({value:e,label:t,onClick:s=()=>{},className:a=""}){return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-text-center wpqt-font-semibold wpqt-rounded-xl wpqt-px-4 wpqt-py-2 wpqt-border wpqt-border-solid wpqt-cursor-pointer wpqt-border-qtBorder ${a}`,onClick:()=>{s(e)},children:t})}function Bo({children:e,title:t}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-base wpqt-mb-4 wpqt-text-center",children:t}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center wpqt-gap-3 wpqt-flex-wrap",children:e})]})}function Ho({automationDispatch:e,automation:t}){if(!t.automationTarget||!t.automationTrigger)return null;const s=t.automationTarget,a=t.automationTrigger,i=Io[s],r=i&&a in i?i[a]:[];return(0,n.jsx)(Bo,{title:(0,o.__)("Step 3. Select action","quicktasker"),children:r.map((t=>(0,n.jsx)(Vo,{value:t.id,label:To[t.id],onClick:()=>{e({type:"SET_ACTION",payload:t})}},t.id)))})}function Wo({quickTaskerUsers:e,wpUsers:t,assignUser:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-w-[320px] wpqt-flex-col",children:[(0,n.jsx)(di,{sectionTitle:(0,o.__)("Assign a quicktasker","quicktasker"),users:e,onItemSelect:s,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No quicktaskers available to assign","quicktasker")}),(0,n.jsx)(di,{sectionTitle:(0,o.__)("Assign a WordPress user","quicktasker"),users:t,onItemSelect:s,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No WordPress users with required permissions available to assign","quicktasker")})]})}function Qo({automationAction:e,onUserAdd:t=()=>{},quickTaskerUserTargets:s=[],wpUserTargets:a=[],menuBtnClasses:i=""}){const o=[...s,...a].length>0;return(0,n.jsx)(Hn,{menuBtnClasses:`wpqt-inline-flex ${i}`,anchor:"bottom start",menuBtn:()=>(0,n.jsx)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1",children:(0,n.jsx)(ri.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`})}),children:e===as.ASSIGN_USER&&(0,n.jsx)(Wo,{quickTaskerUsers:s,wpUsers:a,assignUser:t})})}const Yo=[as.ASSIGN_USER];function Jo({automationDispatch:e,automation:t}){var s;const{state:{users:i,wpUsers:r}}=(0,a.useContext)(La),c=null===(s=t.automationAction)||void 0===s?void 0:s.id,l=void 0!==c&&Yo.includes(c);return(0,n.jsx)(Bo,{title:(0,o.__)("Step 4. Select action target","quicktasker"),children:l&&(0,n.jsx)(Qo,{automationAction:c,quickTaskerUserTargets:i,wpUserTargets:r,onUserAdd:t=>{e({type:xt,payload:{automationActionTargetId:t.id,automationActionTargetType:t.user_type}})}})})}var Xo=s(4476);const Zo=Xo.z.string().email({message:"Invalid email address"});function er({setAutomationMeta:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(e=>{try{Zo.parse(e),r(!0)}catch(e){r(!1)}})(t)}),[t]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-justify-center wpqt-items-center",children:[(0,n.jsx)(ji,{type:"info",children:(0,o.__)("Make sure your website is configured to send out emails","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("label",{htmlFor:"automation-meta-email-input",children:(0,o.__)("Email will be sent to","quicktasker")}),(0,n.jsx)(Aa,{inputId:"automation-meta-email-input",value:t,onChange:s,wrapperClassName:"!wpqt-mb-0"}),!i&&(0,n.jsx)("div",{className:"wpqt-text-red-500",children:(0,o.__)("Invalid email address","quicktasker")})]}),(0,n.jsx)(Js,{btnText:(0,o.__)("Set email","quicktasker"),onClick:()=>{i&&e(t)}})]})}const tr=Xo.z.string().url({message:"Invalid URL"}).refine((e=>e.startsWith("https://hooks.slack.com/services/")),{message:"Invalid Slack webhook URL"}),sr=function({setAutomationMeta:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(e=>{try{tr.parse(e),r(!0)}catch(e){r(!1)}})(t)}),[t]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-justify-center wpqt-items-center",children:[(0,n.jsxs)(ji,{type:"info",children:[(0,o.__)("Make sure your have configured your Slack webhook URL.","quicktasker"),(0,n.jsx)("a",{href:"https://api.slack.com/messaging/webhooks",target:"_blank",rel:"noopener noreferrer",className:"wpqt-text-blue-500 hover:underline wpqt-ml-1",children:(0,o.__)("Read more about Slack webhooks.","quicktasker")})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("label",{htmlFor:"automation-meta-slack-webhook-input",children:(0,o.__)("Slack webhook URL","quicktasker")}),(0,n.jsx)(Aa,{inputId:"automation-meta-slack-webhook-input",value:t,onChange:s,wrapperClassName:"!wpqt-mb-0"}),!i&&(0,n.jsx)("div",{className:"wpqt-text-red-500",children:(0,o.__)("Invalid Slack webhook","quicktasker")})]}),(0,n.jsx)(Js,{btnText:(0,o.__)("Set webhook URL","quicktasker"),onClick:()=>{i&&e(t)}})]})};function ar({automationCreationState:e,automationDispatch:t}){var s;const a=null===(s=null==e?void 0:e.automationAction)||void 0===s?void 0:s.id,i=a===as.NEW_ENTITY_EMAIL||a===as.DELETED_ENTITY_EMAIL||a===as.TASK_ASSIGNED_EMAIL||a===as.TASK_UNASSIGNED_EMAIL||a===as.TASK_PUBLIC_COMMENT_ADDED_EMAIL||a===as.TASK_PRIVATE_COMMENT_ADDED_EMAIL||a===as.TASK_FILE_UPLOADED_EMAIL||a===as.TASK_FILE_DELETED_EMAIL,o=a===as.SEND_SLACK_MESSAGE,r=e=>{t({type:gt,payload:e})};return i?(0,n.jsx)(er,{setAutomationMeta:r}):o?(0,n.jsx)(sr,{setAutomationMeta:r}):null}function nr({automationDispatch:e}){const t=Object.keys(Io).map((e=>({value:e,label:So[e]||e})));return(0,n.jsx)(Bo,{title:(0,o.__)("Step 1. Select a target","quicktasker"),children:t.map((({value:t,label:s})=>(0,n.jsx)(Vo,{value:t,label:s,onClick:()=>{e({type:"SET_TARGET",payload:t})}},t)))})}function ir({automationDispatch:e,automation:t}){if(!t.automationTarget)return null;const s=t.automationTarget,a=Object.keys(Io[s]).map((e=>({value:e,label:Ao[e]||e})));return(0,n.jsx)(Bo,{title:(0,o.__)("Step 2. Select a trigger","quicktasker"),children:a.map((({value:t,label:s})=>(0,n.jsx)(Vo,{value:t,label:s,onClick:()=>{e({type:"SET_TRIGGER",payload:t})}},t)))})}function or(e){return!(!e.automationTarget||!e.automationTrigger||!e.automationAction||e.automationAction.requireAutomationTarget&&e.automationAction.requireAutomationTargetType&&(null===e.automationActionTargetType||null===e.automationActionTargetId)||e.automationAction.requireMetaData&&!e.metaData)}function rr({automation:e,automationDispatch:t,createAutomation:s}){const[i,r]=(0,a.useState)(!1);let c=null;return null===e.automationTarget?c=(0,n.jsx)(nr,{automationDispatch:t}):null===e.automationTrigger?c=(0,n.jsx)(ir,{automationDispatch:t,automation:e}):null===e.automationAction?c=(0,n.jsx)(Ho,{automationDispatch:t,automation:e}):e.automationAction&&e.automationAction.requireAutomationTarget&&e.automationAction.requireAutomationTargetType&&(null===e.automationActionTargetType||null===e.automationActionTargetId)?c=(0,n.jsx)(Jo,{automationDispatch:t,automation:e}):e.automationAction.requireMetaData&&!e.metaData&&(c=(0,n.jsx)(ar,{automationCreationState:e,automationDispatch:t})),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-4",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-row wpqt-gap-4",children:c}),(0,n.jsx)(oa,{text:(0,o.__)("Create automation","quicktasker"),icon:(0,n.jsx)(Go.z7b,{className:"wpqt-size-6 wpqt-text-blue-400"}),onClick:()=>{return e=this,t=void 0,n=function*(){r(!0),yield s(),r(!1)},new((a=void 0)||(a=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}c((n=n.apply(e,t||[])).next())}));var e,t,a,n},loading:i,disabled:!or(e)})]})}function cr({pipelineId:e}){const{pipelineAutomationsDispatch:t,state:{loading:s}}=(0,a.useContext)(Po),[i,r]=(0,a.useReducer)(Ko,Fo),{createAutomation:c}=gs(),l=null!==i.automationActionTargetId&&null!==i.automationActionTargetType,d=null!==i.metaData,u="wpqt-px-3 wpqt-min-w-[60px] wpqt-cursor-pointer",p="wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1";return s?null:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3 wpqt-mb-8",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-3 wpqt-p-4 wpqt-justify-center wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-start"}),(0,n.jsx)(ao,{title:(0,o.__)("Target","quicktasker"),className:u,titleClassName:p,onClick:()=>{r({type:_t})},children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:i.automationTarget?So[i.automationTarget]:(0,n.jsx)(lr,{})})}),(0,n.jsx)(Mo.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(ao,{title:(0,o.__)("Trigger","quicktasker"),className:u,titleClassName:p,onClick:()=>{r({type:vt})},children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:i.automationTrigger?Ao[i.automationTrigger]:(0,n.jsx)(lr,{})})}),(0,n.jsx)(Mo.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(ao,{title:(0,o.__)("Action","quicktasker"),className:u,titleClassName:p,onClick:()=>{r({type:jt})},children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center wpqt-items-center",children:[i.automationAction?To[i.automationAction.id]:(0,n.jsx)(lr,{}),l&&(0,n.jsx)(zo,{actionTargetId:i.automationActionTargetId,actionTargetType:i.automationActionTargetType}),d&&(0,n.jsx)("div",{children:i.metaData})]})})]}),(0,n.jsx)(rr,{automation:i,automationDispatch:r,createAutomation:()=>{return s=this,a=void 0,o=function*(){yield c(e,i,((e,s)=>{e&&s&&(r({type:"RESET"}),t({type:kt,payload:s}))}))},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{c(o.next(e))}catch(e){t(e)}}function r(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,r)}c((o=o.apply(s,a||[])).next())}));var s,a,n,o}})]})}function lr(){return(0,n.jsx)(Uo.A,{className:"wpqt-size-7 wpqt-text-gray-300"})}function dr({title:e,className:t,activateLoading:s,active:a,deleteLoading:i,deleteConfirmMessage:r,onDelete:c,onActiveChange:l,openLogs:d=()=>{}}){return(0,n.jsx)(ao,{title:e,className:`${t} wpqt-ml-6`,titleClassName:"wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1",children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3 wpqt-justify-center",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-1 wpqt-justify-center wpqt-items-center wpqt-h-[40px]",children:s?(0,n.jsx)(Ys,{ovalSize:"32"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Active","quicktasker")}),(0,n.jsx)(Bi,{checked:a,handleChange:l})]})}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(oa,{icon:(0,n.jsx)(kn.aio,{className:"wpqt-icon-blue wpqt-size-5"}),onClick:d,text:(0,o.__)("Logs","quicktasker")}),(0,n.jsx)(zn,{confirmMessage:(0,o.__)(r,"quicktasker"),onConfirm:()=>{return e=this,t=void 0,a=function*(){c()},new((s=void 0)||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}));var e,t,s,a},children:({onClick:e})=>(0,n.jsx)(oa,{loading:i,icon:(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-5"}),onClick:e,text:(0,o.__)("Delete","quicktasker")})})]})]})})}var ur=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function pr({automation:e}){const{deleteAutomation:t,updateAutomationActiveStatus:s}=gs(),{pipelineAutomationsDispatch:i}=(0,a.useContext)(Po),{modalDispatch:r}=(0,a.useContext)(Ls),[c,l]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!1);return(0,n.jsx)(dr,{title:(0,o.__)("Controls","quicktasker"),activateLoading:d,active:e.active,deleteLoading:c,onDelete:()=>ur(this,void 0,void 0,(function*(){l(!0),yield t(e.pipeline_id,e.id,(t=>{t&&i({type:ft,payload:e.id})})),l(!1)})),onActiveChange:t=>ur(this,void 0,void 0,(function*(){u(!0);const a=yield s(e.pipeline_id,e.id,t);u(!1),a.success&&i({type:qt,payload:{id:e.id,active:t}})})),deleteConfirmMessage:(0,o.__)("Are you sure you want to delete this automation?","quicktasker"),openLogs:()=>{r({type:we,payload:{automationId:e.id}})}})}function hr({automation:e}){const t="wpqt-px-3 wpqt-pt-1 wpqt-min-w-[60px] wpqt-cursor-default",s="wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1",a=null!==e.automation_action_target_id&&null!==e.automation_action_target_type,i=null!==e.metadata;return(0,n.jsxs)("div",{className:"wpqt-flex",children:[(0,n.jsxs)("div",{className:"wpqt-flex-1 wpqt-flex wpqt-p-4 wpqt-items-center wpqt-justify-center wpqt-gap-3",children:[(0,n.jsx)(ao,{title:(0,o.__)("Target","quicktasker"),className:t,titleClassName:s,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:So[e.target_type]})}),(0,n.jsx)(Mo.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(ao,{title:(0,o.__)("Trigger","quicktasker"),className:t,titleClassName:s,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:Ao[e.automation_trigger]})}),(0,n.jsx)(Mo.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(ao,{title:(0,o.__)("Action","quicktasker"),className:t,titleClassName:s,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center wpqt-items-center",children:[To[e.automation_action],a&&(0,n.jsx)(zo,{actionTargetId:e.automation_action_target_id,actionTargetType:e.automation_action_target_type}),i&&(0,n.jsx)("div",{children:e.metadata})]})})]}),(0,n.jsx)(pr,{automation:e,className:`${t}`,titleClassName:s})]})}function mr(){const{state:{automations:e}}=(0,a.useContext)(Po);return e&&0!==e.length?(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-6 wpqt-mx-auto wpqt-max-w-7xl",children:e.map((e=>(0,n.jsx)(hr,{automation:e},e.id)))}):null}function wr(){const{automations:e}=Lo(),t=(null==e?void 0:e.length)||0;return 0===t?(0,n.jsx)("p",{children:(0,o.__)("There are no automations created for this board.","quicktasker")}):(0,n.jsx)("p",{children:(0,o.sprintf)((0,o.__)("There are %d automations created for this board.","quicktasker"),t)})}function fr({pipelineId:e}){const{loading:t}=Lo();return t?(0,n.jsx)(Ys,{ovalSize:"24"}):(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:(0,o.__)("Created automations","quicktasker")}),(0,n.jsx)(wr,{}),(0,n.jsx)(mr,{}),(0,n.jsx)("h2",{children:(0,o.__)("Create a new automation","quicktasker")}),(0,n.jsx)("p",{children:(0,o.__)("Follow the steps to create a new automation.","quicktasker")}),(0,n.jsx)(cr,{pipelineId:e}),(0,n.jsx)(bo,{})]})}function kr({pipelineId:e}){return(0,n.jsx)(Ro,{pipelineId:e,children:(0,n.jsxs)(ba,{children:[(0,n.jsx)(d,{description:(0,o.__)("Set up automated processes to help manage your board.","quicktasker"),children:(0,o.__)("Board automations","quicktasker")}),(0,n.jsx)(fr,{pipelineId:e})]})})}const qr=()=>{const{state:{pluginURL:e}}=(0,a.useContext)(Ja);return(0,n.jsxs)(ba,{children:[(0,n.jsx)(d,{description:(0,o.__)("Info about the plugin.","quicktasker"),children:(0,o.__)("About","quicktasker")}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:["Thank you for your interest in the QuickTasker project. For any suggestions or concerns, please write to"," ",(0,n.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://wordpress.org/support/plugin/quicktasker/",children:"support forum."})]}),(0,n.jsxs)("p",{children:["For some reading material about the plugin, you can check out the"," ",(0,n.jsx)("a",{target:"_blank",rel:"noreferrer",href:e+"help/index.html",children:"plugin guide."})]}),(0,n.jsxs)("p",{children:["Source code is available on"," ",(0,n.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://github.com/SiimKirjanen/quicktasker",children:"GitHub"})]}),(0,n.jsx)("div",{children:(0,n.jsx)("img",{src:e+"img/old-banner-icon.jpg",alt:"QuickTasker",className:"wpqt-max-w-[600px] wpqt-w-full"})})]})]})},gr=()=>(0,n.jsxs)(ba,{children:[(0,n.jsx)(d,{description:(0,o.__)("The logs page where you can see all logs and filter them.","quicktasker"),children:(0,o.__)("Logs","quicktasker")}),(0,n.jsx)(jo,{})]});function xr({infoTitle:e,infoDescription:t,infoTitleClick:s,children:a}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-h-screen-minus-top-bar wpqt-items-center wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-1",children:[e&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2 "+(s?"wpqt-cursor-pointer":""),onClick:s||void 0,children:(0,n.jsx)("p",{className:"wpqt-m-0 wpqt-font-semibold wpqt-text-lg",children:e})}),(0,n.jsx)("p",{children:t}),a]})})}function _r({overviewFilter:e,onCreationDateChange:t,onDoneDateChange:s}){const a=e=>e instanceof Date?gn()(e).format("YYYY-MM-DD"):"";return(0,n.jsx)("div",{children:(0,n.jsxs)(Na,{title:(0,o.__)("Statistics filtering","quicktasker"),titleClassName:"wpqt-text-center",childrenClassName:"wpqt-gap-6 wpqt-justify-center",searchChildren:null,children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:(0,o.__)("Task creation date","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("(Filter tasks that have creation date equal or bigger than)","quicktasker")})]}),(0,n.jsx)(Wi.A,{onChange:e=>{const s=a(e);t(s)},value:e.taskCreationDate,format:"y-MM-dd",id:"taskCreationDate"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:(0,o.__)("Task done date","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("(Filter tasks that have done date equal or smaller than)","quicktasker")})]}),(0,n.jsx)(Wi.A,{onChange:e=>{const t=a(e);s(t)},value:e.taskDoneDate,format:"y-MM-dd",id:"taskCreationDate"})]})]})})}var vr=s(2298);function jr(e){const t=e.slice(1).some((e=>e[1]>0));return e.length>1&&t}function br({text:e}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center wpqt-items-center wpqt-h-[400px] wpqt-w-[500px] wpqt-font-semibold",children:e})}function yr({pipelineOverviewData:e,options:t,width:s}){var a,i;const r=[["Archived tasks","Task Count"],["Archived tasks",parseInt(null!==(a=null==e?void 0:e.archivedTasksCount)&&void 0!==a?a:"0")||0],["Not archived tasks",parseInt(null!==(i=null==e?void 0:e.notArchivedTasksCount)&&void 0!==i?i:"0")||0]];return jr(r)?(0,n.jsx)(vr.t1,{chartType:"PieChart",data:r,options:Object.assign(Object.assign({},t),{title:"Archived tasks"}),width:s,height:"400px"}):(0,n.jsx)(br,{text:(0,o.__)("Not enough data to display archived tasks chart","quicktasker")})}function Er({pipelineOverviewData:e,options:t,width:s}){var a;const i=[["Stage","Task Count"],...null!==(a=null==e?void 0:e.stages.map((e=>[e.name,parseInt(e.tasksCount)||0])))&&void 0!==a?a:[]];return jr(i)?(0,n.jsx)(vr.t1,{chartType:"PieChart",data:i,options:Object.assign(Object.assign({},t),{title:"Task distribution by stages"}),width:s,height:"400px"}):(0,n.jsx)(br,{text:(0,o.__)("Not enough data to display task distribution by stages chart","quicktasker")})}function Tr({pipelineOverviewData:e,options:t,width:s}){var a,i;const r=[["Task status","Task Count"],["Done",parseInt(null!==(a=null==e?void 0:e.doneTasksCount)&&void 0!==a?a:"0")||0],["Not Done",parseInt(null!==(i=null==e?void 0:e.notDoneTasksCount)&&void 0!==i?i:"0")||0]];return jr(r)?(0,n.jsx)(vr.t1,{chartType:"PieChart",data:r,options:Object.assign(Object.assign({},t),{title:"Task status"}),width:s,height:"400px"}):(0,n.jsx)(br,{text:(0,o.__)("Not enough data to display task status chart","quicktasker")})}const Sr={legend:{position:"left",alignment:"center",textStyle:{color:"#233238",fontSize:14}}};function Ar({pipeline:e,overviewFilter:t}){const[s,i]=(0,a.useState)(null),[o,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(()=>{var s,a,n,o;s=this,a=void 0,o=function*(){try{r(!0);const s=yield function(e,t){const s=new URLSearchParams({taskStartDate:t.taskCreationDate||"",taskDoneDate:t.taskDoneDate||"",taskAssignees:t.taskAssignees.join(",")});return Ft()({path:`/wpqt/v1/pipelines/${e}/overview?${s.toString()}`,method:"GET",headers:Kt()})}(e.id,t);i(s.data)}catch(e){console.error(e)}finally{r(!1)}},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{c(o.next(e))}catch(e){t(e)}}function r(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,r)}c((o=o.apply(s,a||[])).next())}))})()}),[e.id,t]),o||!s?(0,n.jsx)(Ys,{ovalSize:"48"}):(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-wrap wpqt-justify-center xl:wpqt-justify-start",children:[(0,n.jsx)(Er,{pipelineOverviewData:s,options:Sr,width:"500px"}),(0,n.jsx)(Tr,{pipelineOverviewData:s,options:Sr,width:"500px"}),(0,n.jsx)(yr,{pipelineOverviewData:s,options:Sr,width:"500px"})]})}function Or({pipeline:e}){const[t,s]=(0,a.useState)({taskCreationDate:null,taskDoneDate:null,taskAssignees:[]});return(0,n.jsxs)("div",{children:[(0,n.jsx)(_r,{overviewFilter:t,onCreationDateChange:e=>{s(Object.assign(Object.assign({},t),{taskCreationDate:e}))},onDoneDateChange:e=>{s(Object.assign(Object.assign({},t),{taskDoneDate:e}))}}),(0,n.jsx)(Ar,{pipeline:e,overviewFilter:t})]})}function Nr(){const{state:{pipelines:e}}=(0,a.useContext)(pa),t=e.map((e=>e.name)),s=e.map((e=>(0,n.jsx)(Or,{pipeline:e},e.id)));return(0,n.jsx)(ba,{children:s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d,{description:(0,o.__)("Get overview of the tasks.","quicktasker"),children:(0,o.__)("Overview","quicktasker")}),(0,n.jsx)(wi,{tabs:t,tabsContent:s,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})]}):(0,n.jsx)(xr,{infoTitle:(0,o.__)("No overview to display","quicktasker"),infoDescription:(0,o.__)("You need to first create a board to see the overview.","quicktasker")})})}function Cr(){const{state:{activePipeline:e}}=(0,a.useContext)(ws),t=null==e?void 0:e.id,s=()=>(null==e?void 0:e.stages)||[],n=e=>{const t=s();let a=null;return t?(t.forEach((t=>{t.tasks&&!a&&t.tasks.find((t=>t.id===e))&&(a=t)})),a):null},i=(0,a.useMemo)((()=>{const e=s();return e?e.map((e=>({label:e.name,value:e.id}))):[]}),[e]),o=(0,a.useMemo)((()=>{const e=s(),t=[];return e?(e.forEach((e=>{e.tasks&&t.push(...e.tasks)})),t):t}),[e]),r=null==e?void 0:e.settings;return{getActivePipelineStages:s,getActivePipelinStageTasksLength:e=>{const t=s();if(!t)return 0;const a=t.find((t=>t.id===e));return a&&a.tasks?a.tasks.length:0},getTaskStage:n,getTaskOrderInStage:e=>{const t=n(e);if(!t||!t.tasks)return null;const s=t.tasks.findIndex((t=>t.id===e));return-1!==s?s:null},activePipelineTasks:o,activePipelineSettings:r,isTaskOnLastStage:e=>{const t=s();if(!t)return!1;const a=n(e);if(!a)return!1;const i=t[t.length-1];return a.id===i.id},stageOptions:i,activePipelineId:t}}const Ir=(e,t)=>{switch(t.type){case M:{const{id:s,type:a}=t.payload;return Object.assign(Object.assign({},e),{userFilter:{id:s,type:a}})}case L:return Object.assign(Object.assign({},e),{stageIdFilter:t.payload});case U:return Object.assign(Object.assign({},e),{searchText:t.payload});default:return e}},Dr={stageIdFilter:"",userFilter:{id:null,type:null},searchText:""},Pr=(0,a.createContext)({state:Dr,taskViewDispatch:()=>{}}),Rr=({children:e})=>{const[t,s]=(0,a.useReducer)(Ir,Dr);return(0,n.jsx)(Pr.Provider,{value:{state:t,taskViewDispatch:s},children:e})};function Lr(){const{state:{stageIdFilter:e,userFilter:t,searchText:s},taskViewDispatch:i}=(0,a.useContext)(Pr),{stageOptions:r}=Cr(),{combinedUsers:c}=$o(),l=c.map((e=>({value:`${e.id}:${e.user_type}`,label:`${e.name} (${is[e.user_type]})`}))),d=t.id&&t.type?`${t.id}:${t.type}`:"";return(0,n.jsxs)(Na,{title:(0,o.__)("Filter tasks","quicktasker"),searchChildren:(0,n.jsx)(Ca,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"task-view-search",children:(0,n.jsx)(Aa,{inputId:"task-view-search",value:s,onChange:e=>{i({type:U,payload:e})}})}),children:[(0,n.jsx)(Ca,{title:(0,o.__)("Stage","quicktasker"),children:(0,n.jsx)(ka,{id:"task-view-stage-filter",allSelectorLabel:(0,o.__)("All stages","quicktasker"),selectedOptionValue:e,options:r,onSelectionChange:e=>{i({type:L,payload:e})}})}),(0,n.jsx)(Ca,{title:(0,o.__)("Assigned user","quicktasker"),children:(0,n.jsx)(ka,{id:"task-view-assigned-user-filter",allSelectorLabel:(0,o.__)("All users","quicktasker"),selectedOptionValue:d,options:l,onSelectionChange:e=>{const[t,s]=e.split(":");i({type:M,payload:{id:t,type:s}})}})})]})}var Mr,Ur,Fr=s(9879);function Kr(){return{importPipeline:(e,t)=>{return s=this,a=void 0,r=function*(){try{const s=yield function(e,t){return Ft()({path:"/wpqt/v1/import",method:"POST",data:{source:e,data:t},headers:Kt()})}(e,t);return{success:!0,data:s.data}}catch(e){return console.error(e),i.oR.error((0,o.__)("Import failed","quicktasker")),{success:!1,error:e}}},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{c(r.next(e))}catch(e){t(e)}}function o(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}c((r=r.apply(s,a||[])).next())}));var s,a,n,r}}}function $r(e){return e.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"")}function zr(e){const t=[];let s="",a=!1;for(let n=0;n<e.length;n++){const i=e[n];'"'===i?a&&n+1<e.length&&'"'===e[n+1]?(s+='"',n++):a=!a:","!==i||a?s+=i:(t.push(s.trim()),s="")}return t.push(s.trim()),t}function Gr(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}!function(e){e.ADD_CARD="addCard",e.UPDATE_CARD="updateCard",e.Comment_CARD="commentCard"}(Mr||(Mr={})),function(e){e.TRELLO="TRELLO-IMPORT",e.ASANA="ASANA-IMPORT",e.PIPEDRIVE="PIPEDRIVE-IMPORT",e.QUICKTASKER="QUICKTASKER-IMPORT"}(Ur||(Ur={}));const Vr={pipelineName:"",pipelineDescription:"",stages:[],tasks:[],labels:[],sourcePipelines:[],taskComments:[]},Br=e=>{switch(e){case Ur.TRELLO:return(0,o.__)("Import from Trello.","quicktasker");case Ur.ASANA:return(0,o.__)("Import from Asana.","quicktasker");case Ur.PIPEDRIVE:return(0,o.__)("Import from Pipedrive.","quicktasker");case Ur.QUICKTASKER:return(0,o.__)("Import from QuickTasker.","quicktasker");default:return(0,o.__)("Select import source","quicktasker")}},Hr=e=>{switch(e){case Ur.TRELLO:return(0,o.__)("Export your Trello board as JSON format and use it for import.","quicktasker");case Ur.ASANA:return(0,o.__)("Export your Asana project as JSON format and use it for import","quicktasker");case Ur.PIPEDRIVE:return(0,o.__)("Export your Pipedrive deals as CSV format and use it for import. Please note that generated CSV file column headers should be in English.","quicktasker");case Ur.QUICKTASKER:return(0,o.__)("Import your QuickTasker board from JSON format.","quicktasker");default:return(0,o.__)("Select an import source to get started","quicktasker")}};function Wr({importData:e,importDataFilter:t,selectedImportSource:s,onNameChange:a,onDescriptionChange:i,onImportDataFilterChange:r,validation:c}){const l=function(e){const t={supportsArchiveTaskToggle:!1,supportTaskCustomFieldsToggle:!1,supportTaskCommentsToggle:!1,allowSourceSelection:!1};switch(e){case Ur.PIPEDRIVE:return Object.assign(Object.assign({},t),{supportsArchiveTaskToggle:!0,allowSourceSelection:!0});case Ur.TRELLO:return Object.assign(Object.assign({},t),{supportsArchiveTaskToggle:!0,supportTaskCommentsToggle:!0});case Ur.ASANA:return Object.assign(Object.assign({},t),{supportsArchiveTaskToggle:!0});case Ur.QUICKTASKER:return Object.assign(Object.assign({},t),{supportsArchiveTaskToggle:!0,supportTaskCustomFieldsToggle:!0,supportTaskCommentsToggle:!0});default:return t}}(s);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3 wpqt-mb-3",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-1",children:[(0,n.jsx)(Qr,{title:(0,o.__)("Board name","quicktasker")}),(0,n.jsx)(Aa,{value:e.pipelineName,onChange:a,wrapperClassName:"wpqt-w-[200px] !wpqt-mb-0",className:"wpqt-w-full wpqt-mb-0"}),c.pipelineNameExists&&(0,n.jsx)("div",{className:"wpqt-text-red-500 wpqt-text-sm",children:(0,o.__)("This board name already exists.","quicktasker")})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-1",children:[(0,n.jsx)(Qr,{title:(0,o.__)("Board description","quicktasker")}),(0,n.jsx)(on,{value:e.pipelineDescription,onChange:i,rowsCount:2,className:"!wpqt-w-[200px] !wpqt-mb-0"})]}),l.supportsArchiveTaskToggle&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-2 wpqt-w-[200px]",children:[(0,n.jsx)(Qr,{title:(0,o.__)("Import archived tasks?","quicktasker")}),(0,n.jsx)(Bi,{checked:t.includeArchivedTasks,handleChange:()=>{r(Object.assign(Object.assign({},t),{includeArchivedTasks:!t.includeArchivedTasks}))},dataTestId:"import-archived-tasks-toggle"})]}),l.supportTaskCustomFieldsToggle&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-2 wpqt-w-[200px]",children:[(0,n.jsx)(Qr,{title:(0,o.__)("Import task custom fields?","quicktasker")}),(0,n.jsx)(Bi,{checked:t.includeTaskCustomFields,handleChange:()=>{r(Object.assign(Object.assign({},t),{includeTaskCustomFields:!t.includeTaskCustomFields}))},dataTestId:"import-task-custom-fields-toggle"})]}),l.supportTaskCommentsToggle&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-2 wpqt-w-[200px]",children:[(0,n.jsx)(Qr,{title:(0,o.__)("Import task comments?","quicktasker")}),(0,n.jsx)(Bi,{checked:t.includeTaskComments,handleChange:()=>{r(Object.assign(Object.assign({},t),{includeTaskComments:!t.includeTaskComments}))},dataTestId:"import-task-comments-toggle"})]}),l.allowSourceSelection&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-2 wpqt-w-[200px]",children:[(0,n.jsx)(Qr,{title:(0,o.__)("Filter by source","quicktasker")}),e.sourcePipelines.map((e=>{const s=t.sourcePipelinesFilter.some((t=>t.id===e.id)),a=`source-${e.id}`;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)("label",{htmlFor:a,children:e.name}),(0,n.jsx)("input",{type:"checkbox",value:e.name,id:a,checked:s,onChange:()=>{let a;a=s?t.sourcePipelinesFilter.filter((t=>t.id!==e.id)):[...t.sourcePipelinesFilter,e],r(Object.assign(Object.assign({},t),{sourcePipelinesFilter:a}))}})]},e.id)}))]})]})}function Qr({title:e}){return(0,n.jsx)("div",{className:"wpqt-font-semibold",children:e})}function Yr({importData:e}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-2",children:[(0,n.jsxs)("div",{children:[(0,o.__)("Number of tasks","quicktasker"),":"," ",(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[e.tasks.length," (",(0,o.__)("archived","quicktasker")," ",e.tasks.filter((e=>e.archived)).length,")"]})]}),(0,n.jsxs)("div",{children:[(0,o.__)("Number of task comments","quicktasker"),":"," ",(0,n.jsx)("span",{className:"wpqt-font-semibold",children:e.taskComments.length})]}),(0,n.jsxs)("div",{children:[(0,o.__)("Number of stages","quicktasker"),":"," ",(0,n.jsx)("span",{className:"wpqt-font-semibold",children:e.stages.length})]}),(0,n.jsxs)("div",{children:[(0,o.__)("Number of labels","quicktasker"),":"," ",(0,n.jsx)("span",{className:"wpqt-font-semibold"}),e.labels.length]})]})}var Jr=s(9197),Xr=s(7613);const Zr=s.p+"images/icon-80x80.78f40056.png";function ec({selectedImportSource:e,handleImportSourceChange:t}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)("div",{"data-testid":"trello-container",className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(e===Ur.TRELLO?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>t(Ur.TRELLO),children:(0,n.jsx)(Jr.IK4,{className:"wpqt-size-6 wpqt-trello-blue","data-testid":"trello-icon"})}),(0,n.jsx)("div",{"data-testid":"asana-container",className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(e===Ur.ASANA?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>t(Ur.ASANA),children:(0,n.jsx)(kn.OpO,{className:"wpqt-size-6 wpqt-asana-pink","data-testid":"asana-icon"})}),(0,n.jsx)("div",{"data-testid":"pipedrive-container",className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(e===Ur.PIPEDRIVE?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>t(Ur.PIPEDRIVE),children:(0,n.jsx)(Xr.nad,{className:"wpqt-size-6 wpqt-pipedrive-green","data-testid":"pipedrive-icon"})}),(0,n.jsx)("div",{"data-testid":"quicktasker-container",className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(e===Ur.QUICKTASKER?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>t(Ur.QUICKTASKER),children:(0,n.jsx)("img",{src:Zr,className:"wpqt-size-6","data-testid":"quicktasker-icon"})})]})}const tc={includeArchivedTasks:!0,includeTaskComments:!1,includeTaskCustomFields:!0,sourcePipelinesFilter:[]};function sc(){const{state:{pipelineImportModalOpen:e},modalDispatch:t}=(0,a.useContext)(Ls),{pipelinesDispatch:s,checkIfPipelineNameExists:r}=ma(),{fetchAndSetPipelineData:c}=(0,a.useContext)(ws),[l,d]=(0,a.useState)(Ur.TRELLO),[u,p]=(0,a.useState)(null),[h,m]=(0,a.useState)(Object.assign({},tc)),[w,f]=(0,a.useState)(null),[k,q]=(0,a.useState)(!1),g=(0,a.useRef)(null),{importPipeline:_}=Kr(),v=(0,a.useMemo)((()=>!!(null==u?void 0:u.pipelineName)&&r(u.pipelineName)),[null==u?void 0:u.pipelineName]),j=w&&!v,b=()=>{p(null),f(null),m(Object.assign({},tc))};return(0,a.useEffect)((()=>{if(u){const e=u.tasks.filter((e=>h.includeArchivedTasks||!e.archived)),t=new Set(e.map((e=>e.taskId))),s=h.includeTaskComments?u.taskComments.filter((e=>t.has(e.taskId))):[];h.includeTaskCustomFields||e.forEach((e=>{e.customFields=[]}));const a=Object.assign(Object.assign({},u),{tasks:e,taskComments:s});h.sourcePipelinesFilter.length>0&&(a.tasks=a.tasks.filter((e=>h.sourcePipelinesFilter.some((t=>e.sourcePipeline&&t.id===e.sourcePipeline.id)))),a.stages=a.stages.filter((e=>h.sourcePipelinesFilter.some((t=>e.sourcePipeline.id===t.id))))),f(a)}}),[u,h]),(0,n.jsx)(ta,{modalOpen:e,closeModal:()=>{t({type:re}),b()},children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-4",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Import board","quicktasker")}),(0,n.jsx)(ec,{selectedImportSource:l,handleImportSourceChange:e=>{d(e),b()}}),(0,n.jsxs)("div",{className:"wpqt-text-center wp-mb-4",children:[(0,n.jsx)("p",{className:"wpqt-my-0",children:Br(l)}),(0,n.jsx)("p",{className:"wpqt-my-0",children:Hr(l)})]}),!u&&(0,n.jsx)(oa,{text:(0,o.__)("Select import file","quicktasker"),onClick:()=>{g.current&&g.current.click()},icon:(0,n.jsx)(Fr.t76,{className:"wpqt-size-5 wpqt-text-blue-500"})}),u&&(0,n.jsx)(Wr,{importData:u,importDataFilter:h,validation:{pipelineNameExists:v},selectedImportSource:l,onNameChange:e=>{p((t=>t?Object.assign(Object.assign({},t),{pipelineName:e}):t))},onDescriptionChange:e=>{p((t=>t?Object.assign(Object.assign({},t),{pipelineDescription:e}):t))},onImportDataFilterChange:m}),w&&(0,n.jsx)(Yr,{importData:w}),j&&(0,n.jsx)(oa,{text:(0,o.__)("Start import","quicktasker"),onClick:()=>{return e=this,a=void 0,r=function*(){if(!w||v)return;q(!0);const{data:e}=yield _(l,w);e&&(s({type:x,payload:e.pipeline}),yield c(e.pipeline.id),b(),t({type:re}),i.oR.success((0,o.__)("Board imported","quicktasker"))),q(!1)},new((n=void 0)||(n=Promise))((function(t,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}c((r=r.apply(e,a||[])).next())}));var e,a,n,r},loading:k}),(0,n.jsx)("input",{type:"file",ref:g,id:"import-upload",className:"wpqt-hidden",accept:(()=>{switch(l){case Ur.PIPEDRIVE:return".csv";case Ur.TRELLO:case Ur.ASANA:case Ur.QUICKTASKER:default:return".json"}})(),onChange:e=>{var t,s;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){const e=new FileReader,t=null===(s=a.name.split(".").pop())||void 0===s?void 0:s.toLowerCase();e.onload=e=>{var s,a;try{let n,r;switch(n="csv"===t?function(e){if(!e||"string"!=typeof e)return[];const t=e.split("\n").filter((e=>""!==e.trim()));if(0===t.length)return[];const s=zr(t[0]).map($r),a=[];for(let e=1;e<t.length;e++){const n=zr(t[e]);if(0===n.length)continue;const i={};for(let e=0;e<s.length;e++)i[s[e]]=e<n.length?n[e]:"";a.push(i)}return a}(null===(s=e.target)||void 0===s?void 0:s.result):JSON.parse(null===(a=e.target)||void 0===a?void 0:a.result),l){case Ur.TRELLO:{const e=function(e){if(!e||"object"!=typeof e)return"Import data is missing or not an object";const t=e;if(!t.name)return"Missing board name";if(!t.cards)return"Missing cards array";if(!t.lists)return"Missing lists array";if(!t.labels)return"Missing labels array";if(!Array.isArray(t.cards))return"Cards property is not an array";if(!Array.isArray(t.lists))return"Lists property is not an array";if(!Array.isArray(t.labels))return"Labels property is not an array";if(t.lists.length>0&&!t.lists.some((e=>!e.closed)))return"All lists are closed, at least one open list is required";for(const e of t.cards){if(!e.id)return`Card missing ID: ${JSON.stringify(e).substring(0,100)}...`;if(!e.name)return`Card missing name: ${e.id}`;if(!e.idList)return`Card missing list ID: ${e.id}`;if(!Array.isArray(e.labels))return`Card labels is not an array: ${e.id}`}for(const e of t.lists){if(!e.id)return`List missing ID: ${JSON.stringify(e).substring(0,100)}...`;if(!e.name)return`List missing name: ${e.id}`;if("boolean"!=typeof e.closed)return`List closed status is not boolean: ${e.id}`}for(const e of t.labels){if(!e.id)return`Label missing ID: ${JSON.stringify(e).substring(0,100)}...`;if(!e.name&&""!==e.name)return`Label missing name: ${e.id}`;if(!e.color)return`Label missing color: ${e.id}`}return!0}(n);if(!0!==e)return void i.oR.error(`${(0,o.__)("Invalid Trello import","quicktasker")}: ${e}`);r=function(e){const t=[{name:e.name,id:e.id}],s=e.actions.filter((e=>e.type===Mr.Comment_CARD));return{pipelineName:e.name,pipelineDescription:e.desc,stages:e.lists.filter((e=>!e.closed)).map((t=>({stageName:t.name,stageDescription:"",stageId:t.id,sourcePipeline:{name:e.name,id:e.id}}))),tasks:e.cards.map((t=>{var s,a;return{taskId:t.id,taskName:t.name,taskDescription:"",stageId:t.idList,archived:t.closed,assignedLabels:t.labels.map((e=>({labelName:e.name,labelId:e.id,color:e.color}))),dueDate:t.due?t.due:null,taskCompletedAt:t.dateCompleted?t.dateCompleted:null,taskFocusColor:null!==(a=null===(s=t.cover)||void 0===s?void 0:s.color)&&void 0!==a?a:null,sourcePipeline:{name:e.name,id:e.id},customFields:[]}})),labels:e.labels.map((e=>({labelName:e.name,labelId:e.id,color:e.color}))),sourcePipelines:t,taskComments:s.map((e=>{var t,s,a;return{commentId:e.id,taskId:null!==(s=null===(t=e.data.card)||void 0===t?void 0:t.id)&&void 0!==s?s:"",createdAt:e.date,commentText:null!==(a=e.data.text)&&void 0!==a?a:"",authorId:e.idMemberCreator,isAuthorAdmin:!1,isPrivate:!0}}))}}(n);break}case Ur.ASANA:{const e=function(e){if(!e||"object"!=typeof e)return"Import data is missing or not an object";const t=e;if(!t.data)return"Missing data array";if(!Array.isArray(t.data))return"Data property is not an array";if(0===t.data.length)return"Data array is empty";for(const e of t.data){if(!e.gid)return`Task missing GID: ${JSON.stringify(e).substring(0,100)}...`;if(!e.name)return`Task missing name: ${e.gid}`;if("boolean"!=typeof e.completed)return`Task completed status is not boolean: ${e.gid}`;if(!Array.isArray(e.projects))return`Task projects is not an array: ${e.gid}`;if(0===e.projects.length)return`Task has no projects: ${e.gid}`;if(!Array.isArray(e.memberships))return`Task memberships is not an array: ${e.gid}`;if(!Array.isArray(e.tags))return`Task tags is not an array: ${e.gid}`;for(const t of e.projects){if(!t.gid)return`Project missing GID in task ${e.gid}`;if(!t.name)return`Project missing name in task ${e.gid}`}for(const t of e.memberships){if(!t.project)return`Membership missing project in task ${e.gid}`;if(!t.section)return`Membership missing section in task ${e.gid}`;const s=t.project,a=t.section;if(!s.gid)return`Membership project missing GID in task ${e.gid}`;if(!s.name)return`Membership project missing name in task ${e.gid}`;if(!a.gid)return`Membership section missing GID in task ${e.gid}`;if(!a.name)return`Membership section missing name in task ${e.gid}`}for(const t of e.tags){if(!t.gid)return`Tag missing GID in task ${e.gid}`;if(!t.name)return`Tag missing name in task ${e.gid}`}}return!0}(n);if(!0!==e)return void i.oR.error(`${(0,o.__)("Invalid Asana import","quicktasker")}: ${e}`);r=function(e){if(!e.data||0===e.data.length)return Object.assign({},Vr);const t=e.data[0].projects[0].gid,s=e.data[0].projects[0].name,a=new Map,n=new Map,i=[{name:s,id:t}];e.data.forEach((e=>{e.memberships.forEach((e=>{if(e.project.gid===t){const t=e.section;a.has(t.gid)||a.set(t.gid,t)}})),e.tags.forEach((e=>{n.has(e.gid)||n.set(e.gid,e)}))}));const o=Array.from(a.values()).map((e=>({stageId:e.gid,stageName:e.name,stageDescription:"",sourcePipeline:{name:s,id:t}}))),r=Array.from(n.values()).map((e=>({labelId:e.gid,labelName:e.name||"",color:Dt}))),c=e.data.map((e=>{var a;const n=e.memberships.find((e=>e.project.gid===t)),i=(null==n?void 0:n.section.gid)||(null===(a=o[0])||void 0===a?void 0:a.stageId)||"";return{taskId:e.gid,taskName:e.name,taskDescription:"",stageId:i,archived:e.completed,dueDate:e.due_at||e.due_on||null,taskCompletedAt:e.completed_at||null,assignedLabels:e.tags.map((e=>({labelName:e.name,labelId:e.gid,color:Dt}))),taskFocusColor:null,sourcePipeline:{name:s,id:t},customFields:[]}}));return{pipelineName:s,pipelineDescription:"",stages:o,tasks:c,labels:r,sourcePipelines:i,taskComments:[]}}(n);break}case Ur.PIPEDRIVE:{const e=function(e){if(!e||!Array.isArray(e))return"Import data is missing or not an array";if(0===e.length)return"Deals array is empty";for(const t of e){if(!t.title)return`Deal missing title: ${JSON.stringify(t).substring(0,100)}...`;if(!t.stage)return`Deal missing stage: ${t.title||"Unknown"}`;if(!t.status)return`Deal missing status: ${t.title||"Unknown"}`;const e=String(t.status).toLowerCase();if(!["open","won","lost","deleted"].includes(e))return`Invalid deal status: ${e} for deal: ${t.title||"Unknown"}`;if(void 0!==t.label&&null!==t.label&&"string"!=typeof t.label)return`Deal label must be a string: ${t.title||"Unknown"}`;if(void 0!==t.expected_close_date&&null!==t.expected_close_date&&"string"!=typeof t.expected_close_date)return`Deal expected_close_date must be a string or null: ${t.title||"Unknown"}`;if(void 0!==t.deal_closed_on&&null!==t.deal_closed_on&&"string"!=typeof t.deal_closed_on)return`Deal deal_closed_on must be a string or null: ${t.title||"Unknown"}`}const t=new Set;for(const s of e)s.stage&&"string"==typeof s.stage&&t.add(s.stage);return 0!==t.size||"No valid stages found in deals"}(n);if(!0!==e)return void i.oR.error(`${(0,o.__)("Invalid Pipedrive import","quicktasker")}: ${e}`);r=function(e){if(!e)return Object.assign({},Vr);const t=new Map,s=new Map,a=new Map;e.forEach((e=>{e.pipeline&&!a.has(e.pipeline)&&a.set(e.pipeline,{name:e.pipeline,id:Gr()})})),e.forEach((e=>{e.stage&&!t.has(e.stage)&&t.set(e.stage,{stageId:Gr(),stageName:e.stage,stageDescription:"",sourcePipeline:a.get(e.pipeline)||{name:"",id:Gr()}}),e.label&&e.label.split(",").map((e=>e.trim())).filter(Boolean).forEach((e=>{e&&!s.has(e)&&s.set(e,{labelId:Gr(),labelName:e,color:Dt})}))}));const n=Array.from(t.values()).map((e=>({stageId:e.stageId,stageName:e.stageName,stageDescription:"",sourcePipeline:{name:e.sourcePipeline.name,id:e.sourcePipeline.id}}))),i=Array.from(s.values()).map((e=>({labelId:e.labelId,labelName:e.labelName,color:e.color}))),o=Array.from(a.values()).map((e=>({name:e.name,id:e.id}))),r=e.map((e=>{var i;const o=t.get(e.stage),r=e.status.toLocaleLowerCase(),c=[];let l=null;if(e.label&&e.label.split(",").map((e=>e.trim())).filter(Boolean).forEach((e=>{const t=s.get(e);t&&c.push({labelId:t.labelId,labelName:t.labelName,color:t.color})})),e.pipeline){const t=a.get(e.pipeline);t&&(l={name:t.name,id:t.id})}return{taskId:e.id,taskName:e.title,taskDescription:"",stageId:o?o.stageId:(null===(i=n[0])||void 0===i?void 0:i.stageId)||"",archived:"lost"===r||"deleted"===r,assignedLabels:c,dueDate:e.expected_close_date||null,taskFocusColor:null,taskCompletedAt:"won"===r&&e.deal_closed_on||null,sourcePipeline:l,customFields:[]}}));return{pipelineName:"",pipelineDescription:"",stages:n,tasks:r,labels:i,sourcePipelines:o,taskComments:[]}}(n);break}case Ur.QUICKTASKER:{const e=function(e){if(!e||"object"!=typeof e)return"Invalid import data: Not a valid object";const t=e;if(!t.pipelineName)return"Pipeline name is required";if(!Array.isArray(t.stages))return"Stages must be an array";for(let e=0;e<t.stages.length;e++){const s=t.stages[e];if(!s.stageName||"string"!=typeof s.stageName||!s.stageName.trim())return`Stage #${e+1} is missing a name`;if(void 0===s.stageId||null===s.stageId)return`Stage #${e+1} is missing an ID`}if(t.tasks&&Array.isArray(t.tasks))for(let e=0;e<t.tasks.length;e++){const s=t.tasks[e];if(!s.taskName||"string"!=typeof s.taskName||!s.taskName.trim())return`Task #${e+1} is missing a name`;if(void 0===s.stageId||null===s.stageId)return`Task #${e+1} is missing a stage ID`;if(!t.stages.some((e=>e.stageId==s.stageId)))return`Task "${s.taskName}" references a stage ID that does not exist in the import data`;if(s.assignedLabels&&Array.isArray(s.assignedLabels))for(let e=0;e<s.assignedLabels.length;e++){const t=s.assignedLabels[e];if(void 0===t.labelId||null===t.labelId||!t.labelName)return`Task "${s.taskName}" has an invalid label at position ${e+1}`}if(s.customFields&&Array.isArray(s.customFields))for(let e=0;e<s.customFields.length;e++)if(!s.customFields[e].task_id)return`Task "${s.taskName}" has a custom field without task_id`}if(t.labels&&Array.isArray(t.labels))for(let e=0;e<t.labels.length;e++){const s=t.labels[e];if(!s.labelName||"string"!=typeof s.labelName||!s.labelName.trim())return`Label #${e+1} is missing a name`;if(void 0===s.labelId||null===s.labelId)return`Label #${e+1} is missing an ID`;if(!s.color||"string"!=typeof s.color||!s.color.trim())return`Label "${s.labelName||e+1}" is missing a color`}return!0}(n);if(!0!==e)return void i.oR.error(`${(0,o.__)("Invalid Quicktasker import","quicktasker")}: ${e}`);r=n;break}default:throw new Error("Unsupported import source")}p(r)}catch(e){console.error("Error parsing import file:",e),i.oR.error((0,o.__)("Failed to parse import file","quicktasker"))}},e.readAsText(a)}}})]})})}function ac(){const{state:{moveTaskModalOpen:e,taskToEdit:t},modalDispatch:s}=(0,a.useContext)(Ls),{dispatch:i}=(0,a.useContext)(ws),{getActivePipelineStages:r,getActivePipelinStageTasksLength:c,getTaskStage:l,getTaskOrderInStage:d}=Cr(),{moveTask:u}=_s(),[p,h]=(0,a.useState)(0),[w,f]=(0,a.useState)(""),[k,q]=(0,a.useState)(!1),g=c(w),x=Array.from({length:g+1},((e,t)=>({value:t.toString(),label:(t+1).toString()}))),_=r().map((e=>({value:e.id,label:e.name}))),v=()=>{s({type:ee})};return(0,a.useEffect)((()=>{if(t){const e=l(t.id),s=d(t.id);e&&null!==s&&(f(e.id),h(s))}}),[t]),(0,n.jsx)(ta,{modalOpen:e,closeModal:v,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)("h2",{children:(0,o.__)("Change task location on board","quicktasker")}),(0,n.jsx)("label",{htmlFor:"move-task-stage-selection",children:(0,o.__)("Select stage","quicktasker")}),(0,n.jsx)(ka,{id:"move-task-stage-selection",allSelector:!1,selectedOptionValue:w,options:_,onSelectionChange:e=>{f(e),h(0)}}),(0,n.jsx)("label",{htmlFor:"move-task-order-selection",children:(0,o.__)("Select order","quicktasker")}),(0,n.jsx)(ka,{id:"move-task-order-selection",allSelector:!1,selectedOptionValue:String(p),options:x,onSelectionChange:e=>h(Number(e))}),(0,n.jsx)(Js,{btnText:(0,o.__)("Apply","quicktasker"),loading:k,onClick:()=>{return e=this,s=void 0,n=function*(){if(!t)return;const e=l(t.id),s=d(t.id);e&&null!==s&&(q(!0),yield u(t.id,w,p,(t=>{t&&(i({type:m,payload:{source:{droppableId:e.id,index:s},destination:{droppableId:w,index:p}}}),v())})),q(!1))},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n}})]})})}const nc=(0,a.forwardRef)((({addPipeline:e,modalSaving:t},s)=>{const[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(""),d=()=>{r(""),l("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:d}))),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(aa,{children:[(0,n.jsx)(na,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(Aa,{isAutoFocus:!0,value:i,onChange:e=>r(e),className:"wpqt-w-full",wrapperClassName:"wpqt-w-full"})}),(0,n.jsx)(na,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(on,{rowsCount:3,value:c,onChange:e=>l(e),className:"wpqt-w-full"})})]}),(0,n.jsx)(ia,{onSave:()=>{e(i,c)},loading:t,saveBtnText:(0,o.__)("Add board","quicktasker")})]})}));var ic=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function oc(){return{deletePipeline:(e,t)=>ic(this,void 0,void 0,(function*(){try{const s=yield function(e){return Ft()({path:`/wpqt/v1/pipelines/${e}`,method:"DELETE",headers:Kt()})}(e);t&&t(s.data.deletedPipelineId,s.data.pipelineIdToLoad)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete board","quicktasker"))}})),addPipeline:(e,t,s,a)=>ic(this,void 0,void 0,(function*(){try{const a=yield(n=e,r=t,Ft()({path:"/wpqt/v1/pipelines",method:"POST",data:{name:n,description:r},headers:Kt()}));i.oR.success((0,o.__)("Board created successfully","quicktasker")),s&&s(a.data)}catch(e){i.oR.error((0,o.__)("Failed to create a board","quicktasker")),a&&a(e)}var n,r})),editPipeline:(e,t)=>ic(this,void 0,void 0,(function*(){try{const s=yield function(e,t){return Ft()({path:`/wpqt/v1/pipelines/${e}`,method:"PATCH",data:t,headers:Kt()})}(e,t);return i.oR.success((0,o.__)("Board updated successfully","quicktasker")),{success:!0,pipeline:s.data}}catch(e){return i.oR.error((0,o.__)("Failed to update board","quicktasker")),{success:!1,error:e}}}))}}function rc(){const{state:{newPipelineModalOpen:e}}=(0,a.useContext)(Ls),{fetchAndSetPipelineData:t}=(0,a.useContext)(ws),{modalSaving:s,setModalSaving:i,modalContentRef:o,closeModal:r,handleSuccess:c,handleError:l}=Fa(H),{addPipeline:d}=oc();return(0,n.jsx)(ta,{modalOpen:e,closeModal:r,size:"sm",children:(0,n.jsx)(nc,{ref:o,addPipeline:(e,s)=>{return a=this,n=void 0,u=function*(){i(!0),yield d(e,s,(e=>{c(x,e,Ua.PIPELINES),t(e.id),r()}),(e=>{l(e)}))},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{r(u.next(e))}catch(e){t(e)}}function i(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){var a;t.done?e(t.value):(a=t.value,a instanceof o?a:new o((function(e){e(a)}))).then(s,i)}r((u=u.apply(a,n||[])).next())}));var a,n,o,u},modalSaving:s,setModalSaving:i})})}function cc(){const e=(0,a.useContext)(Ja);return Object.assign({},e)}var lc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function dc(){return{saveCustomUserPageStyles:e=>lc(this,void 0,void 0,(function*(){try{const s=yield(t=e,Ft()({path:"/wpqt/v1/settings/user-page-custom-styles",method:"PATCH",data:{styles:t},headers:Kt()}));return i.oR.success((0,o.__)("Custom tasks app styles saved successfully","quicktasker")),{success:!0,styles:s.data}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to save custom tasks app styles","quicktasker")),{success:!1}}var t})),saveTaskCompletionDoneSetting:(e,t)=>lc(this,void 0,void 0,(function*(){try{return yield function(e,t){return Ft()({path:`/wpqt/v1/pipelines/${e}/settings/task-completion-done-restriction`,method:"PATCH",data:{allow_task_completion_only_on_last_stage:t},headers:Kt()})}(e,t),i.oR.success((0,o.__)("Task completion restriction saved successfully","quicktasker")),{success:!0,checked:t}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to save task completion restriction","quicktasker")),{success:!1}}}))}}const uc=({children:e,title:t,description:s})=>(0,n.jsxs)("div",{className:"wpqt-mb-5",children:[(0,n.jsx)("h4",{className:"wpqt-m-0 wpqt-mb-1",children:t}),(0,n.jsx)("p",{className:"wpqt-mt-0",children:s}),e]});function pc({allow_only_last_stage_task_done:e,pipelineId:t}){const[s,i]=(0,a.useState)(e),[r,c]=(0,a.useState)(!1),{saveTaskCompletionDoneSetting:l}=dc(),{dispatch:d}=(0,a.useContext)(ws);return(0,n.jsx)(uc,{title:(0,o.__)("Restrict Task Completion","quicktasker"),description:(0,o.__)("Allow to mark task as done only on board last stage. By default, task can be marked as done on any stage. Will apply also to QuickTasker page.","quicktasker"),children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(Bi,{checked:s,handleChange:e=>{return s=this,a=void 0,o=function*(){i(e),c(!0);const{success:s}=yield l(t,e);c(!1),s?d({type:R,payload:{allow_only_last_stage_task_done:e}}):i(!e)},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{c(o.next(e))}catch(e){t(e)}}function r(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,r)}c((o=o.apply(s,a||[])).next())}));var s,a,n,o}}),r&&(0,n.jsx)(Ws,{width:"20",height:"20"})]})})}function hc({pipeline:e}){const[t,s]=(0,a.useState)(!0),[i,o]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(()=>{var t,a,n,i;t=this,a=void 0,i=function*(){try{s(!0);const a=yield(t=e.id,Ft()({path:`/wpqt/v1/pipelines/${t}/settings`,method:"GET",headers:Kt()}));o(Jt(a.data.settings))}catch(e){console.error(e)}finally{s(!1)}var t},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}))})()}),[]),t?(0,n.jsx)(Ys,{ovalSize:"36"}):i?(0,n.jsx)("div",{children:(0,n.jsx)(pc,{pipelineId:e.id,allow_only_last_stage_task_done:i.allow_only_last_stage_task_done})}):null}var mc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const wc=({onPipelineEditSuccess:e})=>{const{state:{pipelineToEdit:t},modalDispatch:s}=(0,a.useContext)(Ls),{fetchAndSetPipelineData:r,dispatch:c}=(0,a.useContext)(ws),{pipelinesDispatch:l}=(0,a.useContext)(pa),{editPipeline:d}=oc(),{deletePipeline:u}=oc(),{loading1:p,setLoading1:h}=Wa(),{state:{isUserAllowedToDelete:m}}=cc();return t?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsx)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:(0,n.jsxs)("div",{className:"wpqt-mb-5 wpqt-grid wpqt-grid-cols-1 wpqt-gap-6 md:wpqt-grid-cols-[1fr_0.7fr]",children:[(0,n.jsxs)(aa,{children:[(0,n.jsx)(na,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(sn,{isAutoFocus:!0,value:t.name,wrapperClassName:"wpqt-w-full !wpqt-mb-0",className:"wpqt-w-full",onChange:s=>mc(void 0,void 0,void 0,(function*(){const{success:a,pipeline:n}=yield d(t.id,{name:s});a&&n&&e(n)}))})}),(0,n.jsx)(na,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(rn,{value:t.description||"",className:"wpqt-w-full",onChange:s=>mc(void 0,void 0,void 0,(function*(){const{success:a,pipeline:n}=yield d(t.id,{description:s});a&&n&&e(n)}))})}),(0,n.jsx)(hc,{pipeline:t})]}),(0,n.jsx)($n,{entityId:t.id,entityType:en.Pipeline})]})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:(0,n.jsx)(zn,{onConfirm:()=>{t&&(h(!0),u(t.id,((e,t)=>{s({type:H}),h(!1),i.oR.success((0,o.__)("Board deleted","quicktasker")),l({type:T,payload:e}),null!==t?(l({type:v,payload:t}),r(t)):c({type:S})})))},confirmMessage:(0,o.__)("Are you sure you want to delete this board?","quicktasker"),children:({onClick:e})=>(0,n.jsx)(oa,{icon:(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:p,text:(0,o.__)("Delete board","quicktasker"),onClick:e,disabled:!m})})})]})}):null};function fc(){const{state:{pipelineModalOpen:e}}=(0,a.useContext)(Ls),{closeModal:t,handleSuccess:s}=Fa(H);return(0,n.jsx)(ta,{modalOpen:e,closeModal:t,size:"xl",children:(0,n.jsx)(wc,{onPipelineEditSuccess:e=>{s(_,e,Ua.ACTIVE_PIPELINE),s(_,e,Ua.PIPELINES)}})})}function kc(e){switch(e){case Ps.PDF:return(0,o.__)("Export as PDF","quicktasker");case Ps.JSON:return(0,o.__)("Export as JSON","quicktasker");default:return(0,o.__)("Export","quicktasker")}}var qc=s(6973);function gc(){const{modalDispatch:e,state:{taskExportModalSettings:t}}=(0,a.useContext)(Ls);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(t.selectedMethod===Ps.PDF?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>e({type:ie,payload:{selectedMethod:Ps.PDF}}),"data-testid":"task-export-pdf-icon",children:(0,n.jsx)(Jr.uNb,{className:"wpqt-size-5 wpqt-pdf-red"})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(t.selectedMethod===Ps.JSON?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>e({type:ie,payload:{selectedMethod:Ps.JSON}}),"data-testid":"task-export-json-icon",children:(0,n.jsx)(qc.Qio,{className:"wpqt-size-5"})})]})}function xc({pipelineId:e}){const{state:{taskExportModalOpen:t,taskExportModalSettings:s},modalDispatch:i}=(0,a.useContext)(Ls),{state:{siteURL:r}}=(0,a.useContext)(Ja),[c,l]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1),[p,h]=(0,a.useState)(!0);return(0,n.jsx)(ta,{modalOpen:t,closeModal:()=>{i({type:ne})},size:"md",children:(0,n.jsxs)("form",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",action:r,target:"_blank",method:"GET",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Tasks export","quicktasker")}),(0,n.jsx)(gc,{}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(wa,{labelFor:"export-search-filter",children:(0,o.__)("Filter by task name and desription","quicktasker")}),(0,n.jsx)(Aa,{value:c,onChange:l,inputId:"export-search-filter",name:"task_search",wrapperClassName:"wpqt-mb-0"})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(wa,{labelFor:"export-include-archive-filter",children:(0,o.__)("Include board archived tasks","quicktasker")}),(0,n.jsx)(Bi,{checked:d,handleChange:u,id:"export-include-archive-filter"})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(wa,{labelFor:"export-include-archive-filter",children:(0,o.__)("Include board custom fields","quicktasker")}),(0,n.jsx)(Bi,{checked:p,handleChange:h,id:"export-include-task-custom-fields-filter"})]}),(0,n.jsx)(Js,{btnText:kc(s.selectedMethod),type:Us.SUBMIT}),e&&(0,n.jsx)("input",{type:"hidden",name:"pipeline_id",value:e}),(0,n.jsx)("input",{type:"hidden",name:"wpqt-page",value:`${s.selectedMethod}-export`}),(0,n.jsx)("input",{type:"hidden",name:"include_archive",value:d?"1":"0"}),(0,n.jsx)("input",{type:"hidden",name:"include_custom_fields",value:p?"1":"0"})]})})}var _c=s(9919),vc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const jc=(0,a.forwardRef)((({editStage:e,addStage:t,stageModalSaving:s},i)=>{const{state:{stageToEdit:r}}=(0,a.useContext)(Ls),[c,l]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),p=!!r;(0,a.useEffect)((()=>{r&&(l(r.name),u(r.description))}),[r]);const h=()=>{l(""),u("")};return(0,a.useImperativeHandle)(i,(()=>({clearContent:h}))),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(sa,{children:p?(0,o.__)("Edit Stage","quicktasker"):(0,o.__)("Add Stage","quicktasker")}),(0,n.jsxs)(aa,{children:[(0,n.jsx)(na,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(Aa,{isAutoFocus:!0,value:c,onChange:e=>l(e),className:"wpqt-w-full",wrapperClassName:"wpqt-w-full"})}),(0,n.jsx)(na,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(on,{rowsCount:3,value:d,onChange:e=>u(e),className:"!wpqt-w-full"})})]}),(0,n.jsx)(ia,{onSave:()=>{p?e(Object.assign(Object.assign({},r),{name:c,description:d})):t(c,d)},loading:s,saveBtnText:p?(0,o.__)("Save","quicktasker"):(0,o.__)("Add stage","quicktasker")})]})}));var bc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function yc(){const{state:{stageModalOpen:e,targetPipelineId:t}}=(0,a.useContext)(Ls),{modalSaving:s,setModalSaving:r,modalContentRef:c,closeModal:l,handleSuccess:d,handleError:u}=Fa(z),{editStage:p,addStage:h}=function(){return{editStage:(e,t,s)=>vc(this,void 0,void 0,(function*(){try{const s=yield function(e){return Ft()({path:`/wpqt/v1/stages/${e.id}`,method:"PATCH",data:{name:e.name,description:e.description},headers:Kt()})}(e);i.oR.success((0,o.__)("Stage updated successfully","quicktasker")),t&&t(s.data)}catch(e){i.oR.error((0,o.__)("Failed to update stage","quicktasker")),s&&s(e)}})),addStage:(e,t,s,a,n)=>vc(this,void 0,void 0,(function*(){try{const n=yield(r=e,c=t,l=s,Ft()({path:"/wpqt/v1/stages",method:"POST",data:{pipelineId:r,name:c,description:l},headers:Kt()}));i.oR.success((0,o.__)("Stage created successfully","quicktasker")),a&&a(n.data)}catch(e){i.oR.error((0,o.__)("Failed to create stage","quicktasker")),n&&n(e)}var r,c,l}))}}();return(0,n.jsx)(ta,{modalOpen:e,closeModal:l,children:(0,n.jsx)(jc,{ref:c,editStage:e=>bc(this,void 0,void 0,(function*(){r(!0),yield p(e,(e=>{d(g,e,Ua.ACTIVE_PIPELINE),l()}),(e=>{u(e)}))})),addStage:(e,s)=>bc(this,void 0,void 0,(function*(){try{r(!0),yield h(t,e,s,(e=>{d(f,{stage:Object.assign(Object.assign({},e),{tasks:[]})},Ua.ACTIVE_PIPELINE),l()}))}catch(e){u(e)}})),stageModalSaving:s,stageTaskModalSaving:r})})}function Ec(){const{state:{taskColorModalOpen:e,taskToEdit:t},modalDispatch:s}=(0,a.useContext)(Ls),{dispatch:i}=(0,a.useContext)(ws),{updateTaskFocusColor:r}=_s(),[c,l]=(0,a.useState)(Ct),[d,u]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{t&&t.task_focus_color&&l(t.task_focus_color)}),[t]),(0,n.jsx)(ta,{modalOpen:e,closeModal:()=>{s({type:se})},size:"sm",children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-4 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Task focus color","quicktasker")}),(0,n.jsx)(Jn.A,{color:c||void 0,disableAlpha:!0,onChange:e=>{l(e.hex)}}),(0,n.jsx)(Js,{btnText:(0,o.__)("Apply changes","quicktasker"),onClick:()=>{return e=this,s=void 0,n=function*(){if(!t)return;u(!0);const{success:e}=yield r(t.id,c);u(!1),e&&i({type:P,payload:{taskId:t.id,color:c}})},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n},loading:d}),(0,n.jsx)(Js,{buttonStyleType:Fs.DANGER,btnText:(0,o.__)("Reset color","quicktasker"),onClick:()=>{l(Ct)}})]})})}var Tc=s(1609);function Sc({pipelineId:e,stagesLength:t=0}){const{modalDispatch:s}=(0,a.useContext)(Ls),i=()=>{return t=this,a=void 0,i=function*(){s({type:$,payload:{targetPipelineId:e}})},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i};return 0===t?(0,n.jsx)("div",{className:"wpqt-pipeline-height wpqt-flex wpqt-w-full wpqt-items-center wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-main-border wpqt-flex wpqt-cursor-pointer wpqt-flex-col wpqt-items-center wpqt-justify-start wpqt-gap-y-1 wpqt-p-3 hover:wpqt-bg-gray-100",onClick:i,children:[(0,n.jsx)(pn.A,{className:"wpqt-size-6 wpqt-text-green-600"}),(0,n.jsx)("div",{className:"wpqt-whitespace-nowrap",children:(0,o.__)("Add first stage","quicktasker")})]})}):(0,n.jsxs)("div",{className:"wpqt-main-border wpqt-mb-3 wpqt-flex wpqt-cursor-pointer wpqt-flex-col wpqt-items-center wpqt-justify-start wpqt-self-start wpqt-p-3 hover:wpqt-bg-gray-100",onClick:i,children:[(0,n.jsx)(pn.A,{className:"wpqt-size-6 wpqt-text-green-600"}),(0,n.jsx)("div",{className:"wpqt-whitespace-nowrap",children:(0,o.__)("Add stage","quicktasker")})]})}var Ac=s(5575),Oc=s(6304),Nc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Cc({stage:e}){var t,s,r,c;const{dispatch:d,state:{activePipeline:u},fetchAndSetPipelineData:p}=(0,a.useContext)(ws),{modalDispatch:h}=(0,a.useContext)(Ls),{state:{isUserAllowedToDelete:m}}=(0,a.useContext)(Ja),[w,f]=(0,a.useState)(null),[q,g]=(0,a.useState)(!1),[x,_]=(0,a.useState)(!1),v=null!==(s=null===(t=null==u?void 0:u.stages)||void 0===t?void 0:t.length)&&void 0!==s?s:0,j=null!==(c=null===(r=e.tasks)||void 0===r?void 0:r.length)&&void 0!==c?c:0,b=+e.stage_order,y=b>0&&b<v,E=b!==v-1,T=t=>Nc(this,void 0,void 0,(function*(){try{f(t),yield function(e,t){return Ft()({path:`/wpqt/v1/stages/${e}/move`,method:"PATCH",data:{direction:t},headers:Kt()})}(e.id,t),yield p(u.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to move the stage","quicktasker"))}finally{f(null)}}));return(0,n.jsxs)(Hn,{menuBtn:({active:e})=>(0,n.jsx)(Wn,{isActive:e,IconComponent:l.A}),children:[y&&(0,n.jsx)(Qn,{text:(0,o.__)("Move left","quicktasker"),loading:"left"===w,icon:(0,n.jsx)(Ac.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:e=>{e.preventDefault(),T("left")}}),E&&(0,n.jsx)(Qn,{text:(0,o.__)("Move right","quicktasker"),loading:"right"===w,icon:(0,n.jsx)(Oc.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:e=>{e.preventDefault(),T("right")}}),(0,n.jsx)(Qn,{text:(0,o.__)("Edit stage","quicktasker"),icon:(0,n.jsx)(ei.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:()=>{h({type:G,payload:{stageToEdit:e}})}}),(0,n.jsx)(zn,{onConfirm:()=>Nc(this,void 0,void 0,(function*(){try{g(!0),yield(t=e.id,Ft()({path:`/wpqt/v1/stages/${t}/archive-tasks`,method:"PATCH",headers:Kt()})),yield p(u.id),i.oR.success((0,o.sprintf)((0,o.__)("Archived all %s tasks","quicktasker"),e.name))}catch(t){console.error(t),i.oR.error((0,o.sprintf)((0,o.__)("Failed to archive stage %s tasks","quicktasker"),e.name))}finally{g(!1)}var t})),confirmMessage:(0,o.__)("Are you sure you want to archive all tasks on the stage?","quicktasker"),children:({onClick:t})=>(0,n.jsx)(Qn,{text:(0,o.__)("Archive all stage tasks","quicktasker"),icon:(0,n.jsx)(Va.A,{className:"wpqt-icon-blue wpqt-size-4"}),loading:q,onClick:t,disabled:0===j,id:`item-dropdown-${e.id}-archive`,tooltipText:0===j?(0,o.__)("No tasks to archive on the stage","quicktasker"):void 0})}),m&&(0,n.jsx)(Qn,{text:(0,o.__)("Delete stage","quicktasker"),icon:(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-4"}),loading:x,onClick:()=>Nc(this,void 0,void 0,(function*(){try{_(!0),yield(t=e.id,Ft()({path:`/wpqt/v1/stages/${t}`,method:"DELETE",data:{stageId:t},headers:Kt()})),d({type:k,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete a stage","quicktasker"))}finally{_(!1)}var t})),disabled:j>0,className:"!wpqt-mb-0",id:`item-dropdown-${e.id}`,tooltipText:j>0?(0,o.__)("Stage can be deleted when there are no tasks on it","quicktasker"):void 0})]})}var Ic=s(1578);function Dc({stageId:e}){const[t,s]=(0,a.useState)(""),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),u=(0,a.useRef)(null),p=(0,a.useRef)(null),{state:{activePipeline:h},dispatch:m}=(0,a.useContext)(ws),{handleExecutedAutomations:f}=gs();(0,a.useEffect)((()=>{const e=e=>{"Enter"===e.key&&document.activeElement===p.current&&k()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[t]),(0,a.useEffect)((()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&q()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),(0,a.useEffect)((()=>{var e;r&&(null===(e=p.current)||void 0===e||e.focus())}),[r]);const k=()=>{return s=this,a=void 0,r=function*(){if(t)try{d(!0);const s=yield function(e,t,s){return Ft()({path:"/wpqt/v1/tasks",method:"POST",data:{stageId:e,name:s,pipelineId:t},headers:Kt()})}(e,h.id,t);m({type:w,payload:s.data.newTask}),i.oR.success((0,o.__)("Task created","quicktasker")),q(),f(s.data.executedAutomations,s.data.newTask.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create task","quicktasker"))}finally{d(!1)}else i.oR.error((0,o.__)("Task name is required","quicktasker"))},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{c(r.next(e))}catch(e){t(e)}}function o(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}c((r=r.apply(s,a||[])).next())}));var s,a,n,r},q=()=>{c(!1),s("")};return(0,n.jsx)("div",{ref:u,className:"wpqt-sticky wpqt-bottom-0 wpqt-z-10 wpqt-order-1 wpqt-mt-2 wpqt-flex wpqt-justify-center wpqt-bg-gray-100 wpqt-py-2",children:r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-3",children:[(0,n.jsx)(Aa,{ref:p,value:t,onChange:e=>s(e),wrapperClassName:"!wpqt-mb-0",className:"!wpqt-mb-0"}),l?(0,n.jsx)(Ws,{width:"24",height:"24"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Ic.A,{className:"wpqt-icon-red wpqt-size-6 wpqt-cursor-pointer",onClick:q}),(0,n.jsx)(pn.A,{className:"wpqt-icon-green wpqt-size-6 wpqt-cursor-pointer",onClick:k})]})]}):(0,n.jsxs)("div",{onClick:()=>c(!0),className:"wpqt-main-border wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-p-2 hover:wpqt-bg-white",children:[(0,o.__)("Add task","quicktasker"),(0,n.jsx)(pn.A,{className:"wpqt-size-6 wpqt-text-green-600"})]})})}var Pc=s(7959),Rc=s(1735),Lc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Mc({task:e}){const{modalDispatch:t}=(0,a.useContext)(Ls),{dispatch:s}=(0,a.useContext)(ws),{state:{isUserAllowedToDelete:i}}=(0,a.useContext)(Ja),{deleteTask:r,archiveTask:c}=_s(),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1);return(0,n.jsxs)(Hn,{menuBtn:({active:e})=>(0,n.jsx)(Wn,{isActive:e,IconComponent:oo.A}),children:[(0,n.jsx)(zn,{confirmMessage:(0,o.__)("Are you sure you want to archive this task?","quicktasker"),onConfirm:()=>Lc(this,void 0,void 0,(function*(){p(!0),c(e.id,(({success:t})=>{t&&s({type:A,payload:e.id}),p(!1)}))})),children:({onClick:e})=>(0,n.jsx)(Qn,{text:(0,o.__)("Archive task","quicktasker"),icon:(0,n.jsx)(Va.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:e,loading:u})}),(0,n.jsx)(Qn,{text:(0,o.__)("Edit task","quicktasker"),icon:(0,n.jsx)(ei.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:F,payload:{taskToEdit:e}})}}),(0,n.jsx)(Qn,{text:(0,o.__)("Color","quicktasker"),icon:(0,n.jsx)(Pc.A,{className:"wpqt-icon-orange wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:te,payload:{task:e}})}}),(0,n.jsx)(Qn,{text:(0,o.__)("Move task","quicktasker"),icon:(0,n.jsx)(Rc.zhn,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:Z,payload:{task:e}})}}),i&&(0,n.jsx)(zn,{onConfirm:()=>Lc(this,void 0,void 0,(function*(){d(!0),yield r(e.id,(({success:t})=>{t&&s({type:A,payload:e.id}),d(!1)}))})),confirmMessage:(0,o.__)("Are you sure you want to delete this task?","quicktasker"),confirmButtonText:(0,o.__)("Delete","quicktasker"),children:({onClick:e})=>(0,n.jsx)(Qn,{text:(0,o.__)("Delete task","quicktasker"),icon:(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-4"}),loading:l,onClick:e,className:"!wpqt-mb-0"})})]})}function Uc({task:e}){const{convertToWPTimezone:t}=yn();return e.due_date?(0,n.jsxs)("div",{className:"wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(so.A,{className:`wpqt-size-5 ${function(e){const t=function(e,t){const s=new Date(e),a=new Date(t).getTime()-s.getTime(),n=Math.floor(a/1e3),i=Math.floor(n/60),o=Math.floor(i/60);return{milliseconds:a,seconds:n,minutes:i,hours:o,days:Math.floor(o/24)}}(gn()().utc().format("YYYY-MM-DD HH:mm:ss"),e);return t.milliseconds<0?"wpqt-text-red-600":t.hours<24?"wpqt-text-amber-500":t.hours<72?"wpqt-text-yellow-500":"wpqt-icon-blue"}(e.due_date)}`}),(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[(0,o.__)("Due date","quicktasker"),":"]}),t(e.due_date)]}):null}function Fc({task:e,allowToMarkTaskAsDone:t}){const{dispatch:s}=(0,a.useContext)(ws),{changeTaskDoneStatus:i}=_s(),[o,r]=(0,a.useState)(!1),c=e.is_done,l=t=>{return a=this,n=void 0,c=function*(){r(!0),yield i(e.id,t,(t=>{s({type:E,payload:{taskId:e.id,done:t}})})),r(!1)},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{r(c.next(e))}catch(e){t(e)}}function i(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var a;t.done?e(t.value):(a=t.value,a instanceof o?a:new o((function(e){e(a)}))).then(s,i)}r((c=c.apply(a,n||[])).next())}));var a,n,o,c};return t?o?(0,n.jsx)(Ys,{ovalSize:"24"}):(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:c?(0,n.jsx)(Ha.A,{className:"wpqt-size-6 wpqt-icon-green hover:wpqt-icon-gray",onClick:e=>{e.stopPropagation(),l(!1)}}):(0,n.jsx)(Ha.A,{className:"wpqt-size-6 wpqt-icon-gray hover:wpqt-icon-green",onClick:e=>{e.stopPropagation(),l(!0)}})}):null}function Kc({task:e,index:t,onLastStage:s}){const{modalDispatch:i}=(0,a.useContext)(Ls),{state:{activePipeline:o}}=(0,a.useContext)(ws),r=!(null==o?void 0:o.settings).allow_only_last_stage_task_done||s,c=()=>{i({type:F,payload:{taskToEdit:e,taskModalSettings:{allowToMarkTaskAsDone:r}}})},l=e.task_focus_color?{borderTopColor:e.task_focus_color,borderTopWidth:"6px",borderTopStyle:It}:{};return(0,n.jsx)(_c.sx,{draggableId:e.id,index:t,children:t=>(0,n.jsx)("div",Object.assign({ref:t.innerRef},t.draggableProps,t.dragHandleProps,{children:(0,n.jsxs)("div",{className:"wpqt-relative wpqt-mx-4 wpqt-mb-2 wpqt-flex !wpqt-cursor-pointer wpqt-flex-col wpqt-gap-1 wpqt-rounded wpqt-border wpqt-border-gray-200 wpqt-bg-white wpqt-p-3 wpqt-shadow hover:wpqt-shadow-md",style:l,onClick:c,children:[(0,n.jsx)("div",{className:"wpqt-absolute wpqt-right-[12px] wpqt-top-[12px]",children:(0,n.jsx)(Mc,{task:e})}),(0,n.jsx)("div",{className:"wpqt-text-base",children:e.name}),e.description&&(0,n.jsx)("div",{className:"wpqt-text-sm wpqt-italic",children:e.description}),(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(hi,{task:e}),(0,n.jsx)(oi,{task:e})]}),(0,n.jsx)(Uc,{task:e}),(0,n.jsx)(Fc,{task:e,allowToMarkTaskAsDone:r})]})}))},e.id)}function $c({tasks:e}){const t=e.length;return(0,n.jsx)("span",{className:"wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-1 wpqt-text-xs",children:t})}function zc({stage:e,isLastStage:t}){const{state:{isUserAllowedToManageSettings:s}}=cc();return(0,n.jsxs)("div",{"data-stage-id":e.id,className:"wpqt-relative wpqt-mb-3 wpqt-flex wpqt-max-h-full wpqt-w-[360px] wpqt-flex-none wpqt-flex-col wpqt-overflow-hidden wpqt-rounded-md wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-bg-gray-100",children:[(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-flex wpqt-flex-wrap wpqt-items-center wpqt-gap-1 wpqt-px-4 wpqt-pt-3",children:[(0,n.jsxs)("div",{className:"wpqt-mr-auto wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-text-base wpqt-leading-none",children:[e.name," ",(0,n.jsx)($c,{tasks:e.tasks})]}),s&&(0,n.jsx)(Cc,{stage:e}),e.description&&(0,n.jsx)("div",{className:"wpqt-w-full wpqt-flex-shrink-0 wpqt-flex-grow-0 wpqt-text-sm",children:e.description})]}),(0,n.jsx)(_c.gL,{droppableId:e.id,children:s=>{var a;return(0,n.jsxs)("div",{ref:s.innerRef,className:"wpqt-flex wpqt-h-full wpqt-flex-col wpqt-overflow-y-auto wpqt-overflow-x-hidden",children:[null===(a=e.tasks)||void 0===a?void 0:a.map(((e,s)=>(0,n.jsx)(Kc,{task:e,index:s,onLastStage:t},e.id))),s.placeholder,(0,n.jsx)(Dc,{stageId:e.id})]})}})]})}const Gc=()=>{var e,t;const{state:{activePipeline:s},dispatch:r,fetchAndSetPipelineData:c}=(0,a.useContext)(ws),{isTabVisible:l}=(()=>{const[e,t]=(0,Tc.useState)(!document.hidden);return(0,Tc.useEffect)((()=>{const e=()=>{t(!document.hidden)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),{isTabVisible:e}})(),{modalDispatch:d}=(0,a.useContext)(Ls),{state:{isUserAllowedToManageSettings:u}}=cc();(0,a.useEffect)((()=>{const e=setInterval((()=>{s&&l&&c(s.id)}),3e4);return()=>clearInterval(e)}),[s,l]);const p=(e,t)=>{e.droppableId===t.droppableId?r({type:"REORDER_TASK",payload:{source:e,destination:t}}):r({type:m,payload:{source:e,destination:t}})},h=(0,a.useCallback)((e=>{return t=void 0,s=void 0,n=function*(){const{source:t,destination:s,draggableId:a}=e;if(s){p(t,s);try{yield $t(a,s.droppableId,s.index)}catch(e){console.error(e),p(s,t),i.oR.error((0,o.__)("Failed to move a task","quicktasker"))}}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n}),[s]);return s?(0,n.jsxs)("div",{className:"wpqt-pipeline-height wpqt-flex wpqt-gap-[24px] wpqt-overflow-x-auto wpqt-overflow-y-hidden",children:[(0,n.jsx)(_c.JY,{onDragEnd:h,children:null===(e=s.stages)||void 0===e?void 0:e.map(((e,t)=>{const a=t===s.stages.length-1;return(0,n.jsx)(zc,{stage:e,isLastStage:a},e.id)}))}),u&&(0,n.jsx)(Sc,{pipelineId:s.id,stagesLength:null===(t=s.stages)||void 0===t?void 0:t.length}),(0,n.jsx)(Zi,{deleteTaskCallback:()=>{s&&c(s.id)}}),(0,n.jsx)(Ec,{}),(0,n.jsx)(yc,{})]}):(0,n.jsx)(xr,{infoDescription:(0,o.__)("No boards found. Start by creating a board to organize and manage your tasks effectively.","quicktasker"),children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(oa,{text:(0,o.__)("Create a new board","quicktasker"),icon:(0,n.jsx)(pn.A,{className:"wpqt-size-6 wpqt-icon-green"}),onClick:()=>{d({type:V})}}),(0,n.jsx)("span",{children:(0,o.__)("or","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-blue-text wpqt-blue-text-hover wpqt-cursor-pointer",onClick:()=>{d({type:oe})},children:(0,o.__)("Import an existing board","quicktasker")})]})})};var Vc=s(8932),Bc=s(247),Hc=s(1203),Wc=s(2496),Qc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Yc(){const{state:{activePipeline:e},fetchAndSetPipelineData:t}=(0,a.useContext)(ws),{state:{pipelines:s},pipelinesDispatch:r}=(0,a.useContext)(pa),{modalDispatch:c}=(0,a.useContext)(Ls),{state:{isUserAllowedToManageSettings:l}}=cc(),d=e=>Qc(this,void 0,void 0,(function*(){try{yield(t=e.id,Ft()({path:`/wpqt/v1/pipelines/${t}/set-primary`,method:"PATCH",headers:Kt()})),r({type:v,payload:e.id}),i.oR.success((0,o.__)("Primary board has been set successfully.","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to set primary board","quicktasker"))}var t}));return(0,n.jsxs)(Hn,{menuBtnClasses:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1 wpqt-rounded-xl wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-p-3",menuBtn:({active:t})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-leading-none",children:null==e?void 0:e.name}),(0,n.jsx)(Hc.A,{className:"wpqt-size-4 "+(t?"wpqt-text-qtBlueHover":"")})]}),children:[(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center wpqt-font-bold",children:(0,o.__)("Change board","quicktasker")}),s.map((s=>{const a=s.is_primary,i=(null==e?void 0:e.id)===s.id;return(0,n.jsx)(Bn.Dr,{children:(0,n.jsxs)("div",{className:"wpqt-mb-3 wpqt-flex wpqt-gap-2",children:[(0,n.jsx)("div",{className:(0,nn.$)("wpqt-cursor-pointer wpqt-text-center",{"wpqt-font-bold":i}),onClick:()=>t(s.id),children:s.name}),(0,n.jsx)("div",{className:"wpqt-ml-auto",children:a?(0,n.jsx)(Wc.A,{className:"wpqt-size-4 wpqt-cursor-pointer wpqt-text-blue-500"}):(0,n.jsx)(Bc.A,{className:"wpqt-size-4 wpqt-cursor-pointer wpqt-text-gray-400",onClick:e=>{e.stopPropagation(),d(s)}})})]})},s.id)})),l&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Bn.Dr,{children:(0,n.jsx)("div",{className:"wpqt-my-4 wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-2",children:(0,n.jsx)(oa,{text:(0,o.__)("Add new board","quicktasker"),onClick:()=>Qc(this,void 0,void 0,(function*(){c({type:V})})),icon:(0,n.jsx)(pn.A,{className:"wpqt-size-6 wpqt-icon-green"}),className:"wpqt-bg-white hover:!wpqt-bg-gray-100"})})},"new-pipeline"),(0,n.jsx)(Bn.Dr,{children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-justify-center wpqt-cursor-pointer wpqt-blue-text wpqt-blue-text-hover",onClick:()=>{c({type:oe})},children:(0,o.__)("Import existing","quicktasker")})},"export-pipeline")]})]})}function Jc(){return{navigatePage:function(e){window.location.hash=e}}}function Xc(){const{navigatePage:e}=Jc(),{activePipelineId:t}=Cr();return(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-rows-2 wpqt-auto-cols-fr wpqt-mr-2 wpqt-pr-4 wpqt-gap-2 wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-qtBorder",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-cursor-pointer wpqt-gap-2 wpqt-group",onClick:()=>{e(`#/board/${t}/automations`)},children:[(0,n.jsx)(Go.z7b,{className:"wpqt-size-5 wpqt-text-blue-400 group-hover:wpqt-text-blue-600"}),(0,n.jsx)("span",{className:"wpqt-text-sm wpqt-blue-text group-hover:wpqt-text-blue-600",children:(0,o.__)("Automations","quicktasker")})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-cursor-pointer wpqt-gap-2 wpqt-group",onClick:()=>{e(`#/board/${t}/webhooks`)},children:[(0,n.jsx)(Xr.R$,{className:"wpqt-size-5 wpqt-text-blue-400 group-hover:wpqt-text-blue-600"}),(0,n.jsx)("span",{className:"wpqt-text-sm wpqt-blue-text group-hover:wpqt-text-blue-600",children:(0,o.__)("Webhooks","quicktasker")})]})]})}function Zc(){const{modalDispatch:e}=(0,a.useContext)(Ls),t=t=>{e({type:ae,payload:{selectedMethod:t}})};return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-mr-5 wpqt-gap-1",children:[(0,n.jsx)("span",{className:"wpqt-text-sm",children:(0,o.__)("Export","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(Jr.uNb,{className:"wpqt-size-5 wpqt-pdf-red wpqt-cursor-pointer","data-testid":"task-export-pdf-icon",onClick:()=>{t(Ps.PDF)}}),(0,n.jsx)(qc.Qio,{className:"wpqt-size-5 wpqt-cursor-pointer","data-testid":"task-export-pdf-json-icon",onClick:()=>{t(Ps.JSON)}})]})]})}function el(){const{state:{activePipeline:e,loading:t},fetchAndSetPipelineData:s}=(0,a.useContext)(ws),{modalDispatch:i}=(0,a.useContext)(Ls),{state:{isUserAllowedToManageSettings:r}}=cc();return e?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-py-5",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)("div",{className:"wpqt-text-lg wpqt-font-semibold",children:e.name}),r&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-items-center wpqt-cursor-pointer wpqt-group",onClick:()=>{e&&i({type:B,payload:{pipelineToEdit:e}})},children:[(0,n.jsx)(l.A,{className:"wpqt-text-blue-400 wpqt-size-6 group-hover:wpqt-text-blue-600"}),(0,n.jsx)("span",{className:"wpqt-text-sm wpqt-blue-text group-hover:wpqt-text-blue-600",children:(0,o.__)("Settings","quicktasker")})]})]}),e.description&&(0,n.jsx)("div",{className:"wpqt-italic",children:e.description})]}),(0,n.jsxs)("div",{className:"wpqt-ml-auto wpqt-flex wpqt-items-center wpqt-gap-3",children:[r&&(0,n.jsx)(Xc,{}),(0,n.jsx)(Zc,{}),(0,n.jsx)(tl,{}),t?(0,n.jsx)(Ws,{width:"24",height:"24"}):(0,n.jsx)(_i.A,{className:"wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover","data-testid":"refresh-icon",onClick:()=>s(e.id)}),(0,n.jsx)(Yc,{})]})]}):null}function tl(){const{state:{view:e},dispatch:t}=(0,a.useContext)(ws);return(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-items-center wpqt-cursor-pointer wpqt-text-blue-400 wpqt-text-base :hover:wpqt-text-blue-600 wpqt-group",onClick:()=>{t({type:O,payload:e===ls.PIPELINE?ls.TASK:ls.PIPELINE})},children:e===ls.PIPELINE?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Vc.A,{className:"wpqt-size-5 wpqt-text-blue-400 group-hover:wpqt-text-blue-600"}),(0,n.jsx)("span",{className:"group-hover:wpqt-text-blue-600",children:(0,o.__)("Switch to Task view","quicktasker")})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(to.A,{className:"wpqt-size-5 wpqt-text-blue-400 group-hover:wpqt-text-blue-600"}),(0,n.jsx)("span",{className:"group-hover:wpqt-text-blue-600",children:(0,o.__)("Switch to Board view","quicktasker")})]})})}function sl(){const{modalDispatch:e}=(0,a.useContext)(Ls),{activePipelineTasks:t,activePipelineSettings:s,isTaskOnLastStage:i}=Cr(),{taskViewFilter:r}=(()=>{const{state:{stageIdFilter:e,userFilter:t,searchText:s}}=(0,a.useContext)(Pr);return{taskViewFilter:a=>{var n,i,o,r;const c=!e||a.stage_id===e,l=!t.id||!t.type||t.type===Ut.QUICKTASKER&&(null===(n=a.assigned_users)||void 0===n?void 0:n.some((e=>e.id===t.id)))||t.type===Ut.WP_USER&&(null===(i=a.assigned_wp_users)||void 0===i?void 0:i.some((e=>e.id===t.id))),d=!s||a.name.toLowerCase().includes(s.toLowerCase())||null!==(r=null===(o=a.description)||void 0===o?void 0:o.toLowerCase().includes(s.toLowerCase()))&&void 0!==r&&r;return c&&l&&d}}})(),c=t.filter(r);return 0===c.length?(0,n.jsx)(eo,{text:(0,o.__)("No tasks","quictasker")}):(0,n.jsxs)("div",{className:"wpqt-card-grid",children:[c.map((t=>{const a=i(t.id),o=!s.allow_only_last_stage_task_done||a,r=t.task_focus_color?{borderTopColor:t.task_focus_color,borderTopWidth:"6px",borderTopStyle:It}:{};return(0,n.jsxs)(ao,{className:"wpqt-cursor-pointer",style:r,title:t.name,description:t.description,dropdown:(0,n.jsx)(Mc,{task:t}),onClick:()=>{e({type:F,payload:{taskToEdit:t,taskModalSettings:{allowToMarkTaskAsDone:o}}})},children:[(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(hi,{task:t}),(0,n.jsx)(oi,{task:t})]}),(0,n.jsx)(Uc,{task:t}),(0,n.jsx)(Fc,{task:t,allowToMarkTaskAsDone:o})]},t.id)})),(0,n.jsx)(Zi,{}),(0,n.jsx)(Ec,{})]})}const al=()=>(0,n.jsx)(fs,{children:(0,n.jsx)(ja,{children:(0,n.jsx)(nl,{})})}),nl=()=>{const{state:{view:e,activePipeline:t}}=(0,a.useContext)(ws),s=e===ls.PIPELINE;return(0,n.jsxs)(ba,{children:[(0,n.jsx)(el,{}),s?(0,n.jsx)(Gc,{}):(0,n.jsxs)(Rr,{children:[(0,n.jsx)(Lr,{}),(0,n.jsx)(sl,{})]}),(0,n.jsx)(rc,{}),(0,n.jsx)(fc,{}),(0,n.jsx)(ac,{}),(0,n.jsx)(xc,{pipelineId:(null==t?void 0:t.id)||null}),(0,n.jsx)(sc,{})]})};var il=s(6197);function ol(){const{state:{siteURL:e,publicUserPageId:t}}=(0,a.useContext)(Ja);return{userPage:e+`/wpqt?page=${t}&page_id=wpqt`}}function rl(){const{state:{userPageCustomStyles:e,isUserAllowedToManageSettings:t},appDispatch:s}=(0,a.useContext)(Ja),{userPage:i}=ol(),[r,c]=(0,a.useState)(""),[l,u]=(0,a.useState)(!1),{saveCustomUserPageStyles:p}=dc();return(0,a.useEffect)((()=>{c(e)}),[e]),(0,n.jsxs)(ba,{children:[(0,n.jsx)(d,{description:(0,o.__)("Lets you manage assigned tasks on a separate page.","quicktasker"),children:(0,o.__)("Tasks app","quicktasker")}),(0,n.jsxs)("div",{children:[(0,n.jsx)("a",{onClick:e=>{e.preventDefault(),window.open(i,"_blank")},href:"",children:(0,o.__)("Open your tasks app","quicktasker")}),t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom styles","quicktasker")}),(0,n.jsx)("p",{children:(0,o.__)("Add custom CSS rules for user tasks page.","quicktasker")}),(0,n.jsx)(on,{value:r,onChange:c,colsCount:40}),(0,n.jsx)(oa,{text:(0,o.__)("Save","quicktasker"),loading:l,onClick:()=>{return e=this,t=void 0,n=function*(){u(!0);const{success:e,styles:t}=yield p(r);u(!1),e&&t&&s({type:Ke,payload:t})},new((a=void 0)||(a=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}c((n=n.apply(e,t||[])).next())}));var e,t,a,n},icon:(0,n.jsx)(il.RZ0,{className:"wpqt-icon-blue wpqt-size-4"})})]})]})]})}var cl=s(1548),ll=s(1266),dl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ul(){return{createUser:(e,t,s)=>dl(this,void 0,void 0,(function*(){try{const r=yield(a=e,n=t,Ft()({path:"/wpqt/v1/users",method:"POST",data:{name:a,description:n},headers:Kt()}));s&&s(r.data),i.oR.success((0,o.__)("User created successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("User creation failed. Please try again","quicktasker"))}var a,n})),editUser:(e,t)=>dl(this,void 0,void 0,(function*(){try{const s=yield function(e,t){return Ft()({path:`/wpqt/v1/users/${e}`,method:"PATCH",data:t,headers:Kt()})}(e,t);return{success:!0,user:s.data}}catch(e){return console.error(e),i.oR.error((0,o.__)("User edit failed. Please try again","quicktasker")),{success:!1}}})),changeUserStatus:(e,t,s)=>dl(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return Ft()({path:`/wpqt/v1/users/${e}/status`,method:"PATCH",data:{status:t},headers:Kt()})}(e,t);s&&s(a.data),i.oR.success((0,o.__)("User status changed successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change user status. Please try again","quicktasker"))}})),deleteUser:(e,t)=>dl(this,void 0,void 0,(function*(){try{yield function(e){return Ft()({path:`/wpqt/v1/users/${e}`,method:"DELETE",headers:Kt()})}(e),t&&t(e),i.oR.success((0,o.__)("User deleted successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete user. Please try again","quicktasker"))}})),resetUserPassword:(e,t)=>dl(this,void 0,void 0,(function*(){try{yield function(e){return Ft()({path:`/wpqt/v1/users/${e}/password-reset`,method:"PATCH",headers:Kt()})}(e),t&&t(e),i.oR.success((0,o.__)("User password reset successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to reset user password. Please try again","quicktasker"))}}))}}var pl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function hl({data:e,changeStatus:t,changeSetUpStatus:s,changePasswordStatus:i}){const{changeUserStatus:r,deleteUser:c,resetUserPassword:l}=ul(),{userDispatch:d}=(0,a.useContext)(La),{loading1:u,setLoading1:p,loading2:h,setLoading2:m,loading3:w,setLoading3:f}=Wa(),k=e.is_active,q=e.has_password;return(0,n.jsxs)("div",{className:"wpqt-mt-5 wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(oa,{icon:(0,n.jsx)(Vc.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("User tasks","quicktasker"),onClick:()=>{window.location.hash=`#/users/${e.id}/tasks`}}),!k&&(0,n.jsx)(oa,{icon:(0,n.jsx)(cl.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Activate user","quicktasker"),loading:h,onClick:()=>pl(this,void 0,void 0,(function*(){m(!0),yield r(e.id,!0,(e=>{d({type:Re,payload:Object.assign({},e)}),t(!0)})),m(!1)}))}),k&&(0,n.jsx)(oa,{icon:(0,n.jsx)(cl.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Disable user","quicktasker"),loading:h,onClick:()=>pl(this,void 0,void 0,(function*(){m(!0),yield r(e.id,!1,(e=>{d({type:Re,payload:Object.assign({},e)}),t(!1)})),m(!1)}))}),q&&(0,n.jsx)(oa,{icon:(0,n.jsx)(ll.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:u,text:(0,o.__)("Reset password","quicktasker"),onClick:()=>pl(this,void 0,void 0,(function*(){p(!0),yield l(e.id,(()=>{s(!1),i(!1)})),p(!1)}))}),(0,n.jsx)(oa,{icon:(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:w,text:(0,o.__)("Delete user","quicktasker"),onClick:()=>pl(this,void 0,void 0,(function*(){f(!0),yield c(e.id,(e=>{d({type:Le,payload:e}),window.location.hash="#/users"})),f(!1)}))})]})}var ml=s(8624),wl=s(3997),fl=s(5028);function kl({data:e}){const{userPage:t}=ol(),{convertToWPTimezone:s}=yn(),a=e.is_active,i=t+"&code="+e.page_hash;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)(ql,{label:(0,o.__)("Name","quicktasker"),value:e.name,icon:(0,n.jsx)(ml.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(ql,{label:(0,o.__)("Created at","quicktasker"),value:s(e.created_at),icon:(0,n.jsx)(wl.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(ql,{label:(0,o.__)("Assigned tasks count","quicktasker"),value:e.assigned_tasks_count,icon:(0,n.jsx)(Vc.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(ql,{label:(0,o.__)("Setup completed","quicktasker"),value:e.setup_completed?(0,o.__)("Yes","quicktasker"):(0,o.__)("No","quicktasker"),icon:(0,n.jsx)(fl.A,{className:"wpqt-size-5 wpqt-text-yellow-600"})}),(0,n.jsx)(ql,{label:(0,o.__)("Is active","quicktasker"),value:a?(0,o.__)("Yes","quicktasker"):(0,o.__)("No","quicktasker"),icon:(0,n.jsx)(cl.A,{className:"wpqt-size-5 "+(a?"wpqt-icon-green":"wpqt-icon-red")})}),(0,n.jsx)(ql,{label:(0,o.__)("User Page","quicktasker"),value:(0,n.jsx)("a",{href:i,rel:"noreferrer",target:"_blank",children:i}),icon:(0,n.jsx)(ro.A,{className:"wpqt-size-5 wpqt-icon-blue"})})]})}function ql({label:e,value:t,icon:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[s,(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[e,": "]}),(0,n.jsx)("span",{children:t})]})}var gl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function xl({userId:e}){const{loadingDispatch:t}=(0,a.useContext)(ps),[s,r]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(()=>{gl(this,void 0,void 0,(function*(){try{t({type:$e,payload:!0});const a=yield function(e){return Ft()({path:`/wpqt/v1/users/${e}/extended`,method:"GET",headers:Kt()})}(e);r((s=a.data,Object.assign(Object.assign({},s),{is_active:"1"===s.is_active})))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to get user data. Please try again","quicktasker"))}finally{t({type:$e,payload:!1})}var s}))})()}),[]),(0,n.jsx)(ba,{children:s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d,{description:(0,o.__)("User details","quicktasker"),children:s.name}),(0,n.jsx)(kl,{data:s}),(0,n.jsx)(hl,{data:s,changeStatus:e=>gl(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{is_active:e}):t))})),changeSetUpStatus:e=>gl(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{setup_completed:e}):t))})),changePasswordStatus:e=>gl(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{has_password:e}):t))}))})]})})}s(8987);const _l=e=>Object.assign(Object.assign({},e),{is_active:"1"===e.is_active||!0===e.is_active}),vl=(e,t)=>{var s;switch(t.type){case ze:return Object.assign(Object.assign({},e),{sessionsSearchValue:null!==(s=t.payload)&&void 0!==s?s:""});case Ge:{const s=t.payload.map(_l);return Object.assign(Object.assign({},e),{userSessions:s})}case Ve:{const{sessionId:s,status:a}=t.payload;return Object.assign(Object.assign({},e),{userSessions:e.userSessions.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_active:a}):e))})}case Be:{const s=t.payload;return Object.assign(Object.assign({},e),{userSessions:e.userSessions.filter((e=>e.id!==s))})}default:return e}};var jl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const bl={loading:!0,sessionsSearchValue:"",userSessions:[]},yl=(0,a.createContext)({state:bl,usersSessionDispatch:()=>{},loadUserSessions:()=>jl(void 0,void 0,void 0,(function*(){}))}),El=({children:e})=>{const[t,s]=(0,a.useReducer)(vl,bl),{loadingDispatch:r}=(0,a.useContext)(ps);(0,a.useEffect)((()=>{c()}),[]);const c=()=>jl(void 0,void 0,void 0,(function*(){try{r({type:$e,payload:!0});const e=yield Ft()({path:"/wpqt/v1/users/sessions",method:"GET",headers:Kt()});s({type:Ge,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch user sessions","quicktasker"))}finally{r({type:$e,payload:!1})}}));return(0,n.jsx)(yl.Provider,{value:{state:t,usersSessionDispatch:s,loadUserSessions:c},children:e})};function Tl(){const{state:{sessionsSearchValue:e},usersSessionDispatch:t}=(0,a.useContext)(yl);return(0,n.jsx)(Na,{title:(0,o.__)("Session filtering","quicktasker"),searchChildren:(0,n.jsx)(Ca,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"session-search",children:(0,n.jsx)(Aa,{inputId:"session-search",value:e,onChange:e=>{t({type:ze,payload:e})}})})})}var Sl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Al({session:e}){const{usersSessionDispatch:t}=(0,a.useContext)(yl),{state:{isUserAllowedToDelete:s}}=(0,a.useContext)(Ja),{convertToWPTimezone:r}=yn(),c=e.is_active,l=s=>Sl(this,void 0,void 0,(function*(){try{yield function(e,t){return Ft()({path:`/wpqt/v1/users/sessions/${e}/status`,method:"PATCH",data:{status:t},headers:Kt()})}(e.id,s),t({type:Ve,payload:{sessionId:e.id,status:s}})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change session status","quicktasker"))}}));return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:e.user_name}),(0,n.jsx)("div",{className:"wpqt-italic",children:e.user_description})]}),(0,n.jsx)("div",{children:r(e.created_at_utc)}),(0,n.jsx)("div",{children:r(e.expires_at_utc)}),(0,n.jsx)("div",{className:c?"wpqt-text-qtTextGreen":"wpqt-text-qtTextRed",children:c?(0,o.__)("On","quicktasker"):(0,o.__)("Off","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-4",children:[c?(0,n.jsx)(Tn,{icon:(0,n.jsx)(cl.A,{className:"wpqt-icon-red wpqt-size-5 wpqt-cursor-pointer",title:(0,o.__)("Turn session off","quicktasker")}),onClick:()=>l(!1)}):(0,n.jsx)(Tn,{icon:(0,n.jsx)(cl.A,{className:"wpqt-icon-green wpqt-size-5 wpqt-cursor-pointer",title:(0,o.__)("Turn session on","quicktasker")}),onClick:()=>l(!0)}),s&&(0,n.jsx)(zn,{onConfirm:()=>Sl(this,void 0,void 0,(function*(){try{yield(s=e.id,Ft()({path:`/wpqt/v1/users/sessions/${s}`,method:"DELETE",headers:Kt()})),t({type:Be,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete session","quicktasker"))}var s})),children:({onClick:e})=>(0,n.jsx)(Tn,{icon:(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-5 wpqt-cursor-pointer",title:(0,o.__)("Delete session","quicktasker")}),onClick:e})})]})]})}function Ol(){const{state:{userSessions:e}}=(0,a.useContext)(yl),{filterSessions:t}=(()=>{const{state:{sessionsSearchValue:e}}=(0,a.useContext)(yl);return{filterSessions:t=>t.user_name.toLowerCase().includes(e.toLowerCase())||t.user_description&&t.user_description.toLowerCase().includes(e.toLowerCase())}})(),s=e.filter(t);return 0===s.length?(0,n.jsx)(eo,{text:(0,o.__)("No sessions found","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-grid wpqt-grid-cols-5 wpqt-font-bold",children:[(0,n.jsx)("div",{children:(0,o.__)("Session owner","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Created at","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Expires at","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Status","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Actions","quicktasker")})]}),(0,n.jsx)("div",{className:"wpqt-grid wpqt-grid-cols-5 wpqt-items-center wpqt-gap-y-4",children:s.map((e=>(0,n.jsx)(Al,{session:e},e.id)))})]})}function Nl(){return(0,n.jsx)(El,{children:(0,n.jsx)(ba,{children:(0,n.jsx)(Cl,{})})})}function Cl(){const{state:{userSessions:e}}=(0,a.useContext)(yl);return e.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d,{children:(0,o.__)("Quicktasker sessions","quicktasker")}),(0,n.jsx)(Tl,{}),(0,n.jsx)(Ol,{})]}):(0,n.jsx)(xr,{infoTitle:(0,o.__)("No sessions","quicktasker"),infoDescription:(0,o.__)("No QuickTasker sessions found","quicktasker")})}function Il(){const{state:{usersSearchValue:e},userDispatch:t}=(0,a.useContext)(La);return(0,n.jsx)(Na,{title:(0,o.__)("User filtering","quicktasker"),searchChildren:(0,n.jsx)(Ca,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"user-search",children:(0,n.jsx)(Aa,{inputId:"user-search",value:e,onChange:e=>{t({type:Pe,payload:e})}})})})}function Dl({userId:e}){return(0,n.jsx)(yi,{typeId:e,fetchData:()=>{return t=this,s=void 0,n=function*(){try{return(yield Vt(e,js.User)).data}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load log","quicktasker"))}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n},renderItem:e=>(0,n.jsx)(gi,{log:e,children:e.text}),noDataMessage:(0,o.__)("No logs available","quicktasker")})}var Pl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Rl({userId:e}){return(0,n.jsx)(yi,{typeId:e,fetchData:()=>Pl(this,void 0,void 0,(function*(){try{return(yield zt(e,Ut.QUICKTASKER,!0)).data}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load private comments","quicktasker"))}})),onAdd:t=>Pl(this,void 0,void 0,(function*(){try{return(yield Gt(e,Ut.QUICKTASKER,!0,t)).data.newComment}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add private comment","quicktasker"))}})),renderItem:e=>{var t;return(0,n.jsx)(Ai,{authorName:null!==(t=e.author_name)&&void 0!==t?t:"",authorType:e.author_type,commentDate:e.created_at,children:e.text},e.id)},noDataMessage:(0,o.__)("No comments available","quicktasker"),enableAdd:!0})}var Ll=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ml({userId:e}){const{addComment:t}=Si();return(0,n.jsx)(yi,{typeId:e,fetchData:()=>Ll(this,void 0,void 0,(function*(){try{return(yield zt(e,Ut.QUICKTASKER,!1)).data}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load comments","quicktasker"))}})),onAdd:s=>Ll(this,void 0,void 0,(function*(){const a=yield t(e,Ut.QUICKTASKER,!1,s);if(a)return a})),renderItem:e=>{var t;return(0,n.jsx)(Ai,{authorName:null!==(t=e.author_name)&&void 0!==t?t:"",authorType:e.author_type,commentDate:e.created_at,children:e.text},e.id)},noDataMessage:(0,o.__)("No comments available","quicktasker"),enableAdd:!0})}function Ul({user:e}){const t=[(0,o.__)("Logs","quicktasker"),(0,o.__)("Private comments","quicktasker"),(0,o.__)("Public comments","quicktasker")];return(0,n.jsx)(wi,{tabs:t,tabsContent:[(0,n.jsx)(Dl,{userId:e.id},3),(0,n.jsx)(Rl,{userId:e.id},1),(0,n.jsx)(Ml,{userId:e.id},2)]})}var Fl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Kl=({onEditUserCompleted:e})=>{const{state:{userToEdit:t},modalDispatch:s}=(0,a.useContext)(Ls),{state:{isUserAllowedToDelete:i}}=(0,a.useContext)(Ja),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),{changeUserStatus:u,deleteUser:p,resetUserPassword:h,editUser:m}=ul(),{userDispatch:w}=(0,a.useContext)(La),{loading1:f,setLoading1:k,loading2:q,setLoading2:g,loading3:x,setLoading3:_}=Wa(),{navigatePage:v}=Jc();return(0,a.useEffect)((()=>{t&&(c(t.is_active),d(t.has_password))}),[t]),t?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsxs)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-6",children:[(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-10 md:wpqt-grid-cols-[1fr_0.7fr]",children:[(0,n.jsx)("div",{children:(0,n.jsxs)(aa,{children:[(0,n.jsx)(na,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(sn,{isAutoFocus:!0,value:t.name,wrapperClassName:"wpqt-w-full",className:"wpqt-w-full",onChange:s=>Fl(void 0,void 0,void 0,(function*(){const{success:a,user:n}=yield m(t.id,{name:s});a&&n&&e(n)}))})}),(0,n.jsx)(na,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(rn,{value:t.description,className:"wpqt-w-full",onChange:s=>Fl(void 0,void 0,void 0,(function*(){const{success:a,user:n}=yield m(t.id,{description:s});a&&n&&e(n)}))})})]})}),(0,n.jsx)($n,{entityId:t.id,entityType:en.QUICKTASKER})]}),(0,n.jsx)("div",{className:"wpqt-mt-7",children:(0,n.jsx)(Ul,{user:t})})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)(oa,{icon:(0,n.jsx)(ml.A,{className:"wpqt-icon-blue wpqt-size-4"}),text:(0,o.__)("User details","quicktasker"),onClick:()=>{v(`#/users/${t.id}`),s({type:W})}}),(0,n.jsx)(oa,{icon:(0,n.jsx)(Vc.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("User tasks","quicktasker"),onClick:()=>{v(`#/users/${t.id}/tasks`),s({type:W})}}),l&&(0,n.jsx)(oa,{icon:(0,n.jsx)(ll.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Reset password","quicktasker"),loading:f,onClick:()=>Fl(void 0,void 0,void 0,(function*(){k(!0),yield h(t.id,(()=>{w({type:Ue,payload:t.id}),d(!1)})),k(!1)}))}),!r&&(0,n.jsx)(oa,{icon:(0,n.jsx)(cl.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Activate user","quicktasker"),loading:q,onClick:()=>Fl(void 0,void 0,void 0,(function*(){g(!0),yield u(t.id,!0,(e=>{w({type:Re,payload:Object.assign({},e)}),c(!0)})),g(!1)}))}),r&&(0,n.jsx)(oa,{icon:(0,n.jsx)(cl.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Disable user","quicktasker"),loading:q,onClick:()=>Fl(void 0,void 0,void 0,(function*(){g(!0),yield u(t.id,!1,(e=>{w({type:Re,payload:Object.assign({},e)}),c(!1)})),g(!1)}))}),i&&(0,n.jsx)(zn,{confirmMessage:(0,o.__)("Are you sure you want to delete this user?","quicktasker"),onConfirm:()=>Fl(void 0,void 0,void 0,(function*(){_(!0),yield p(t.id,(e=>{w({type:Le,payload:e}),s({type:W})})),_(!1)})),containerClassName:"wpqt-flex",children:({onClick:e})=>(0,n.jsx)(oa,{icon:(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Delete user","quicktasker"),loading:x,onClick:e,className:"wpqt-w-full"})})]})]})}):null};function $l(){const{state:{userModalOpen:e}}=(0,a.useContext)(Ls),{closeModal:t,handleSuccess:s}=Fa(W);return(0,n.jsx)(ta,{modalOpen:e,closeModal:t,size:"xl",children:(0,n.jsx)(Kl,{onEditUserCompleted:e=>{s(Re,e,Ua.USER)}})})}function zl(){const{state:{userSettingsModalOpen:e},modalDispatch:t}=(0,a.useContext)(Ls);return(0,n.jsx)(ta,{modalOpen:e,closeModal:()=>t({type:X,payload:!1}),size:"md",children:(0,n.jsx)("div",{children:(0,n.jsx)($n,{entityId:"null",entityType:en.Users})})})}var Gl=s(8316);function Vl(){const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(""),{userDispatch:d}=(0,a.useContext)(La),{createUser:u}=ul(),p=()=>{r(""),l(""),t(!1)};return(0,n.jsx)("div",{className:"wpqt-mb-6",children:e?(0,n.jsxs)("div",{className:"wpqt-w-1/4",children:[(0,n.jsx)("label",{className:"wpqt-mb-2 wpqt-block wpqt-font-semibold",children:(0,o.__)("User name","quicktasker")}),(0,n.jsx)(Aa,{value:s,onChange:r,className:"wpqt-w-full"}),(0,n.jsx)("label",{className:"wpqt-mb-2 wpqt-block wpqt-font-semibold",children:(0,o.__)("User description","quicktasker")}),(0,n.jsx)(on,{value:c,onChange:l,className:"wpqt-w-full"}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:[(0,n.jsx)(oa,{text:(0,o.__)("Cancel","quicktasker"),onClick:p,icon:(0,n.jsx)(Vs.A,{className:"wpqt-icon-red wpqt-size-5"})}),(0,n.jsx)(oa,{text:(0,o.__)("Add","quicktasker"),onClick:()=>{return e=this,t=void 0,n=function*(){s?yield u(s,c,(e=>{d({type:De,payload:e}),p()})):i.oR.error("User name is required")},new((a=void 0)||(a=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}c((n=n.apply(e,t||[])).next())}));var e,t,a,n},icon:(0,n.jsx)(Gl.A,{className:"wpqt-icon-green wpqt-size-5"})})]})]}):(0,n.jsx)(oa,{text:(0,o.__)("Add QuickTasker","quicktasker"),onClick:()=>t(!0),icon:(0,n.jsx)(Gl.A,{className:"wpqt-icon-green wpqt-size-5"})})})}var Bl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Hl({user:e}){const{modalDispatch:t}=(0,a.useContext)(Ls),{userDispatch:s}=(0,a.useContext)(La),{changeUserStatus:i,deleteUser:r,resetUserPassword:c}=ul(),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1),[h,m]=(0,a.useState)(!1),w=e.is_active,f=t=>Bl(this,void 0,void 0,(function*(){m(!0),yield i(e.id,t,(()=>{s({type:Me,payload:{userId:e.id,isActive:t}})})),m(!1)}));return(0,n.jsxs)(Hn,{menuBtn:({active:e})=>(0,n.jsx)(Wn,{isActive:e,IconComponent:oo.A}),children:[(0,n.jsx)(Qn,{text:(0,o.__)("User details","quicktasker"),icon:(0,n.jsx)(ml.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}`}}),(0,n.jsx)(Qn,{text:(0,o.__)("User tasks","quicktasker"),icon:(0,n.jsx)(Vc.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}/tasks`}}),(0,n.jsx)(Qn,{text:(0,o.__)("Edit user","quicktasker"),icon:(0,n.jsx)(ei.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:Q,payload:e})}}),e.has_password&&(0,n.jsx)(Qn,{text:(0,o.__)("Reset password","quicktasker"),loading:l,icon:(0,n.jsx)(ll.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>Bl(this,void 0,void 0,(function*(){t.stopPropagation(),d(!0),yield c(e.id,(()=>{s({type:Ue,payload:e.id})})),d(!1)}))}),w&&(0,n.jsx)(Qn,{text:(0,o.__)("Disable user","quicktasker"),loading:h,icon:(0,n.jsx)(cl.A,{className:"wpqt-icon-red wpqt-size-4"}),className:"!wpqt-mb-0",onClick:e=>{e.stopPropagation(),f(!1)}}),!w&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Qn,{text:(0,o.__)("Activate user","quicktasker"),loading:h,icon:(0,n.jsx)(cl.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:e=>{e.stopPropagation(),f(!0)}}),(0,n.jsx)(Qn,{text:(0,o.__)("Delete user","quicktasker"),loading:u,icon:(0,n.jsx)(Ba.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>Bl(this,void 0,void 0,(function*(){t.stopPropagation(),p(!0),yield r(e.id,(e=>{s({type:Le,payload:e})})),p(!1)}))})]})]})}function Wl({user:e}){const{userPage:t}=ol(),{navigatePage:s}=Jc(),{modalDispatch:i}=(0,a.useContext)(Ls),r=e.is_active,c=t+"&code="+e.page_hash;return(0,n.jsxs)(ao,{title:e.name,description:e.description,dropdown:(0,n.jsx)(Hl,{user:e}),onClick:()=>{i({type:Q,payload:e})},className:"wpqt-cursor-pointer",children:[(0,n.jsx)(io,{className:"hover:wpqt-underline wpqt-self-start",label:(0,o.__)("Open user page","quicktasker"),icon:(0,n.jsx)(ro.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:e=>{e.stopPropagation(),window.open(c,"_blank")}}),(0,n.jsx)(io,{className:"hover:wpqt-underline wpqt-self-start",label:(0,o.__)("View user details","quicktasker"),icon:(0,n.jsx)(ro.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:t=>{t.stopPropagation(),s(`#/users/${e.id}`)}}),(0,n.jsx)(io,{label:(0,o.__)("Status","quicktasker"),value:r?(0,o.__)("Active","quicktasker"):(0,o.__)("Disabled","quicktasker"),valueClassName:r?"wpqt-text-qtTextGreen wpqt-font-bold":"wpqt-text-qtTextRed wpqt-font-bold",icon:(0,n.jsx)(cl.A,{className:"wpqt-size-5 "+(r?"wpqt-icon-green":"wpqt-icon-red")})})]})}function Ql(){const{state:{users:e}}=(0,a.useContext)(La),{filterUsers:t}=(()=>{const{state:{usersSearchValue:e}}=(0,a.useContext)(La);return{filterUsers:t=>t.name.toLowerCase().includes(e.toLowerCase())||t.description&&t.description.toLowerCase().includes(e.toLowerCase())}})(),s=e.filter(t);return e&&0===e.length?(0,n.jsx)(eo,{text:(0,o.__)("No users found","quicktasker")}):s&&0===s.length?(0,n.jsx)(eo,{}):(0,n.jsx)("div",{className:"wpqt-card-grid",children:s.map((e=>(0,n.jsx)(Wl,{user:e},e.id)))})}function Yl(){return(0,n.jsxs)("div",{children:[(0,n.jsx)(Vl,{}),(0,n.jsx)(Il,{}),(0,n.jsx)(Ql,{}),(0,n.jsx)(zl,{}),(0,n.jsx)($l,{})]})}function Jl(){return{updateWPUserCapabilities:(e,t,s,a)=>{return n=this,i=void 0,r=function*(){try{yield function(e,t){return Ft()({path:`/wpqt/v1/wp-users/${e}/capabilities`,method:"PATCH",data:{quicktasker_admin_role:t.quicktasker_admin_role,quicktasker_admin_role_allow_delete:t.quicktasker_admin_role_allow_delete,quicktasker_admin_role_manage_users:t.quicktasker_admin_role_manage_users,quicktasker_admin_role_manage_settings:t.quicktasker_admin_role_manage_settings,quicktasker_admin_role_manage_archive:t.quicktasker_admin_role_manage_archive,quicktasker_access_user_page_app:t.quicktasker_access_user_page_app},headers:Kt()})}(e,t),s&&s()}catch(e){a&&a(e)}},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{c(r.next(e))}catch(e){t(e)}}function a(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,a)}c((r=r.apply(n,i||[])).next())}));var n,i,o,r}}}function Xl({user:e}){const[t,s]=(0,a.useState)({quicktasker_admin_role:"quicktasker_admin_role"in e.allcaps,quicktasker_admin_role_allow_delete:"quicktasker_admin_role_allow_delete"in e.allcaps,quicktasker_admin_role_manage_users:"quicktasker_admin_role_manage_users"in e.allcaps,quicktasker_admin_role_manage_settings:"quicktasker_admin_role_manage_settings"in e.allcaps,quicktasker_admin_role_manage_archive:"quicktasker_admin_role_manage_archive"in e.allcaps,quicktasker_access_user_page_app:"quicktasker_access_user_page_app"in e.allcaps}),[i,r]=(0,a.useState)(!1),{updateWPUserCapabilities:c}=Jl(),l=(a,n)=>{return o=this,l=void 0,u=function*(){if(i)return;r(!0);const o=Object.assign({},t),l=Object.assign(Object.assign({},t),{[n]:a});s(l),yield c(e.id,l,(()=>{}),(()=>{s(o)})),r(!1)},new((d=void 0)||(d=Promise))((function(e,t){function s(e){try{n(u.next(e))}catch(e){t(e)}}function a(e){try{n(u.throw(e))}catch(e){t(e)}}function n(t){var n;t.done?e(t.value):(n=t.value,n instanceof d?n:new d((function(e){e(n)}))).then(s,a)}n((u=u.apply(o,l||[])).next())}));var o,l,d,u};return(0,n.jsxs)(ao,{title:e.name,description:e.description,children:[(0,n.jsx)(io,{label:(0,o.__)("Role","quicktasker"),value:Array.isArray(e.roles)?e.roles.join(", "):""}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to plugin admin area","quicktasker")}),(0,n.jsx)(Bi,{checked:t.quicktasker_admin_role,handleChange:e=>{l(e,"quicktasker_admin_role")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to user management","quicktasker")}),(0,n.jsx)(Bi,{checked:t.quicktasker_admin_role_manage_users,handleChange:e=>{l(e,"quicktasker_admin_role_manage_users")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to manage settings (boards, stages, automations, webhooks)","quicktasker")}),(0,n.jsx)(Bi,{checked:t.quicktasker_admin_role_manage_settings,handleChange:e=>{l(e,"quicktasker_admin_role_manage_settings")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to archive page","quicktasker")}),(0,n.jsx)(Bi,{checked:t.quicktasker_admin_role_manage_archive,handleChange:e=>{l(e,"quicktasker_admin_role_manage_archive")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Allow to delete resources","quicktasker")}),(0,n.jsx)(Bi,{checked:t.quicktasker_admin_role_allow_delete,handleChange:e=>{l(e,"quicktasker_admin_role_allow_delete")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Allow access to user tasks app","quicktasker")}),(0,n.jsx)(Bi,{checked:t.quicktasker_access_user_page_app,handleChange:e=>{l(e,"quicktasker_access_user_page_app")}})]}),i&&(0,n.jsx)(Ys,{ovalSize:"24"})]})}function Zl(){const[e,t]=(0,a.useState)(null),[s,i]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(()=>{var e,s,a,n;e=this,s=void 0,n=function*(){try{i(!0);const s=yield(e=Es.Other,Ft()({path:`/wpqt/v1/wp-users?type=${encodeURIComponent(e)}`,method:"GET",headers:Kt()}));t(s.data)}catch(e){console.error(e)}finally{i(!1)}var e},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}))})()}),[]),s||null===e?(0,n.jsx)(Ys,{ovalSize:"48"}):0===e.length?(0,n.jsx)(eo,{text:(0,o.__)("No non-admin WordPress users found","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Displaying non-admin WordPress users.","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-card-grid",children:e.map((e=>(0,n.jsx)(Xl,{user:e},e.id)))})]})}function ed(){const{updateUsers:e}=(0,a.useContext)(La),{loadingDispatch:t}=(0,a.useContext)(ps),{modalDispatch:s}=(0,a.useContext)(Ls),i=[(0,n.jsx)(Yl,{},0),(0,n.jsx)(Zl,{},1)];return(0,a.useEffect)((()=>{(()=>{var s,a,n,i;s=this,a=void 0,i=function*(){t({type:$e,payload:!0}),yield e(),t({type:$e,payload:!1})},new((n=void 0)||(n=Promise))((function(e,t){function o(e){try{c(i.next(e))}catch(e){t(e)}}function r(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(s,a||[])).next())}))})()}),[]),(0,n.jsxs)(ba,{children:[(0,n.jsx)(d,{description:(0,o.__)("Manage QuickTasker and WordPress type users. This plugin supports three types of users: WordPress admins, other WordPress users, and QuickTaskers. WordPress admins have full access to all admin areas. Other WordPress users do not have any access by default but can be granted if needed. QuickTaskers are different type of users who do not have admin access but can manage tasks through a tasks app provided by this plugin.","quicktasker"),icon:(0,n.jsx)(l.A,{className:"wpqt-icon-gray wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{s({type:X,payload:!0})}}),children:(0,o.__)("Users","quicktasker")}),(0,n.jsx)(wi,{tabs:["QuickTaskers","WordPress users"],tabsContent:i,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})]})}const td=(e,t)=>{switch(t.type){case He:{const s=t.payload.map(os);return Object.assign(Object.assign({},e),{tasks:s})}case Qe:{const s=t.payload;return Object.assign(Object.assign({},e),{tasks:e.tasks.filter((e=>e.id!==s))})}case Ye:{const s=t.payload,a=e.tasks.map((e=>e.id===s.id?os(s):e));return Object.assign(Object.assign({},e),{tasks:a})}case We:{const s=t.payload;return Object.assign(Object.assign({},e),{searchValue:s})}case Je:{const s=t.payload;return Object.assign(Object.assign({},e),{filteredPipelineId:s})}case Xe:{const{taskId:s,user:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:Qt(a)?[a,...e.assigned_users]:e.assigned_users,assigned_wp_users:Yt(a)?[a,...e.assigned_wp_users]:e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{tasks:n})}case Ze:{const{taskId:s,user:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:Qt(a)?e.assigned_users.filter((e=>e.id!==a.id)):e.assigned_users,assigned_wp_users:Yt(a)?e.assigned_wp_users.filter((e=>e.id!==a.id)):e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{tasks:n})}case et:{const{taskId:s,done:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}default:return e}};var sd=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const ad={tasks:[],searchValue:"",filteredPipelineId:""},nd=(0,a.createContext)({state:ad,userTasksDispatch:()=>{},fetchAndSetUserTasks:()=>sd(void 0,void 0,void 0,(function*(){}))}),id=({children:e,userId:t})=>{const[s,r]=(0,a.useReducer)(td,ad),{loadingDispatch:c}=(0,a.useContext)(ps);(0,a.useEffect)((()=>{l()}),[]);const l=()=>sd(void 0,void 0,void 0,(function*(){try{c({type:$e,payload:!0});const e=yield function(e){return Ft()({path:`/wpqt/v1/users/${e}/tasks`,method:"GET",headers:Kt()})}(t);r({type:He,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch user tasks","quicktasker"))}finally{c({type:$e,payload:!1})}}));return(0,n.jsx)(nd.Provider,{value:{state:s,userTasksDispatch:r,fetchAndSetUserTasks:l},children:e})};function od(){const{state:{searchValue:e,filteredPipelineId:t},userTasksDispatch:s}=(0,a.useContext)(nd);return(0,n.jsx)(Na,{title:(0,o.__)("Filter tasks","quicktasker"),searchChildren:(0,n.jsx)(Ca,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"user-tasks-search",children:(0,n.jsx)(Aa,{inputId:"user-tasks-search",value:e,onChange:e=>{s({type:We,payload:e})},className:"!wpqt-mb-0"})}),children:(0,n.jsx)(Ca,{title:(0,o.__)("Board","quicktasker"),children:(0,n.jsx)(Oa,{selectedOptionValue:t,selectionChange:e=>{s({type:Je,payload:e})}})})})}var rd=s(7028);function cd({taskId:e,onUnAssignTask:t}){const[s,i]=(0,a.useState)(!1);return(0,n.jsx)(Hn,{menuBtn:({active:e})=>(0,n.jsx)(Wn,{isActive:e,IconComponent:oo.A}),children:(0,n.jsx)(Qn,{text:(0,o.__)("Unassign from task","quicktasker"),loading:s,icon:(0,n.jsx)(rd.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:s=>{return a=this,n=void 0,r=function*(){s.stopPropagation(),i(!0),yield t(e),i(!1)},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{c(r.next(e))}catch(e){t(e)}}function i(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var a;t.done?e(t.value):(a=t.value,a instanceof o?a:new o((function(e){e(a)}))).then(s,i)}c((r=r.apply(a,n||[])).next())}));var a,n,o,r},className:"!wpqt-mb-0"})})}function ld({userId:e}){var t;const{filterTasks:s}=(()=>{const{state:{searchValue:e,filteredPipelineId:t}}=(0,a.useContext)(nd);return{filterTasks:s=>{const a=s.name&&s.name.toLowerCase().includes(e.toLowerCase())||s.description&&s.description.toLowerCase().includes(e.toLowerCase()),n=!t||s.pipeline_id===t;return a&&n}}})(),{modalDispatch:i}=(0,a.useContext)(Ls),{state:{tasks:r},userTasksDispatch:c}=(0,a.useContext)(nd),{removeTaskFromUser:l}=_s(),d=null!==(t=null==r?void 0:r.filter(s))&&void 0!==t?t:[],u=t=>{return s=this,a=void 0,i=function*(){yield l(e,t,(()=>{c({type:Qe,payload:t})}))},new((n=void 0)||(n=Promise))((function(e,t){function o(e){try{c(i.next(e))}catch(e){t(e)}}function r(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(s,a||[])).next())}));var s,a,n,i};return r&&0===r.length?(0,n.jsx)(eo,{text:(0,o.__)("User has no tasks","quicktasker")}):d&&0===d.length?(0,n.jsx)(eo,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-card-grid",children:d.map((e=>(0,n.jsxs)(ao,{className:"wpqt-cursor-pointer",title:e.name,description:e.description,dropdown:(0,n.jsx)(cd,{taskId:e.id,onUnAssignTask:u}),onClick:()=>{i({type:F,payload:{taskToEdit:e}})},children:[(0,n.jsx)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:(0,n.jsx)(hi,{task:e,onUserAdd:t=>{c({type:Xe,payload:{taskId:e.id,user:t}})},onUserDelete:t=>{c({type:Ze,payload:{taskId:e.id,user:t}})}})}),(0,n.jsx)(no,{task:e,onDoneStatusChange:(e,t)=>{c({type:et,payload:{taskId:e,done:t}})}})]},e.id)))}),(0,n.jsx)(Zi,{editTaskCallback:e=>{c({type:Ye,payload:e})}})]})}function dd({userId:e}){return(0,n.jsx)(id,{userId:e,children:(0,n.jsxs)(ba,{children:[(0,n.jsx)(d,{description:(0,o.__)("Tasks assigned to user","quicktasker"),children:(0,o.__)("User tasks","quicktasker")}),(0,n.jsx)(od,{}),(0,n.jsx)(ld,{userId:e})]})})}function ud(){const{state:{webhooksLogsModalOpen:e,webhooksLogsModalSettings:t},modalDispatch:s}=(0,a.useContext)(Ls);return(0,n.jsx)(ta,{modalOpen:e,closeModal:()=>s({type:me}),size:"lg",children:e&&(0,n.jsx)(pd,{settings:t})})}function pd({settings:e}){const[t,s]=(0,a.useState)(!1),[i,r]=(0,a.useState)([]),[c,l]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{e.webhookId&&(()=>{return t=this,a=void 0,i=function*(){if(e.webhookId){s(!0),l(!1);try{const t=yield Bt({type:fo.Webhook,typeId:e.webhookId,order:go.Desc});r(t.data)}catch(e){console.error("Error fetching webhook logs:",e),l(!0)}finally{s(!1)}}},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i})()}),[e.webhookId]),c?(0,n.jsx)("div",{children:(0,o.__)("Error fetching logs","quicktasker")}):t?(0,n.jsx)(Ys,{ovalSize:"32"}):0===i.length?(0,n.jsx)(eo,{text:(0,o.__)("No logs found","quicktasker")}):(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-4 wpqt-items-start",children:i.map((e=>(0,n.jsx)(gi,{log:e,children:e.text},e.id)))})}const hd=(e,t)=>{switch(t.type){case bt:return Object.assign(Object.assign({},e),{webhooks:t.payload.webhooks});case yt:return Object.assign(Object.assign({},e),{loading:t.payload});case Tt:return Object.assign(Object.assign({},e),{webhooks:[...e.webhooks,t.payload.webhook]});case Et:return Object.assign(Object.assign({},e),{webhooks:e.webhooks.filter((e=>e.id!==t.payload.webhookId))});case St:{const{webhookId:s,webhookData:a}=t.payload;return Object.assign(Object.assign({},e),{webhooks:e.webhooks.map((e=>e.id===s?Object.assign(Object.assign({},e),a):e))})}default:return e}};var md,wd;!function(e){e.TASK="task"}(md||(md={})),function(e){e.CREATE="created",e.UPDATE="updated",e.DELETE="deleted",e.STAGE_CHANGED="stage-changed",e.ARCHIVED="archived",e.RESTORED_ARCHIVED="restored-archived",e.COMPLETED="completed",e.NOT_COMPLETED="not-completed",e.ASSIGNED="assigned",e.UNASSIGNED="unassigned",e.COMMENT_ADDED="comment-added",e.LABEL_ADDED="label-added",e.LABEL_REMOVED="label-removed",e.FILE_ADDED="file-added",e.FILE_REMOVED="file-removed"}(wd||(wd={}));const fd=e=>Object.assign(Object.assign({},e),{webhook_confirm:"1"===e.webhook_confirm,active:"1"===e.active}),kd={[md.TASK]:[wd.CREATE,wd.UPDATE,wd.DELETE,wd.STAGE_CHANGED,wd.COMPLETED,wd.NOT_COMPLETED,wd.RESTORED_ARCHIVED,wd.COMMENT_ADDED,wd.FILE_ADDED,wd.FILE_REMOVED,wd.LABEL_ADDED,wd.LABEL_REMOVED,wd.ASSIGNED,wd.UNASSIGNED]};const qd={webhooks:[],loading:!0},gd=(0,a.createContext)({state:qd,pipelineWebhooksDispatch:()=>{}}),xd=({children:e,pipelineId:t})=>{const[s,r]=(0,a.useReducer)(hd,qd),c=()=>{return e=void 0,s=void 0,n=function*(){try{r({type:yt,payload:!0});const s=yield function(e){return Ft()({path:`/wpqt/v1/pipelines/${e}/webhooks`,method:"GET",headers:Kt()})}(t);r({type:bt,payload:{webhooks:(e=s.data.webhooks,e.map(fd))}})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load board webhooks","quicktasker"))}finally{r({type:yt,payload:!1})}var e},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n};return(0,a.useEffect)((()=>{c()}),[]),(0,n.jsx)(gd.Provider,{value:{state:s,pipelineWebhooksDispatch:r},children:e})};function _d(){const{state:{webhooks:e,loading:t},pipelineWebhooksDispatch:s}=(0,a.useContext)(gd);return{webhooks:e,loading:t,pipelineWebhooksDispatch:s}}var vd=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function jd(){return{createWebhook:function(e,t,s,a,n){return vd(this,void 0,void 0,(function*(){try{const i=yield function(e,t,s,a,n){return Ft()({path:`/wpqt/v1/pipelines/${e}/webhooks`,method:"POST",data:{target_type:t,target_action:s,webhook_url:a,webhook_confirm:n},headers:Kt()})}(e,t,s,a,n);return{success:!0,webhook:i.data.webhook}}catch(e){return console.error("Error creating webhook:",e),i.oR.error((0,o.__)("Failed to create webhook","quicktasker")),{success:!1,webhook:null}}}))},editWebhook:function(e,t){return vd(this,void 0,void 0,(function*(){try{const s=yield function(e,t){return Ft()({path:`/wpqt/v1/webhooks/${e}`,method:"PATCH",data:t,headers:Kt()})}(e,t);return{success:!0,webhook:s.data.webhook}}catch(e){return console.error("Error editing webhook:",e),i.oR.error((0,o.__)("Failed to edit webhook","quicktasker")),{success:!1,webhook:null}}}))},deleteWebhook:function(e){return vd(this,void 0,void 0,(function*(){try{return yield function(e){return Ft()({path:`/wpqt/v1/webhooks/${e}`,method:"DELETE",headers:Kt()})}(e),i.oR.success((0,o.__)("Webhook deleted successfully","quicktasker")),{success:!0}}catch(e){return console.error("Error deleting webhook:",e),i.oR.error((0,o.__)("Failed to delete webhook","quicktasker")),{success:!1}}}))}}}var bd=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function yd({webhook:e}){const[t,s]=(0,a.useState)(!1),[i,r]=(0,a.useState)(!1),{deleteWebhook:c,editWebhook:l}=jd(),{pipelineWebhooksDispatch:d}=_d(),{modalDispatch:u}=(0,a.useContext)(Ls);return(0,n.jsx)(dr,{title:(0,o.__)("Controls","quicktasker"),deleteConfirmMessage:(0,o.__)("Are you sure you want to delete this webhook?","quicktasker"),onDelete:function(){return bd(this,void 0,void 0,(function*(){s(!0);const{success:t}=yield c(e.id);s(!1),t&&d({type:Et,payload:{webhookId:e.id}})}))},openLogs:()=>{u({type:he,payload:{webhookId:e.id}})},deleteLoading:t,active:e.active,activateLoading:i,onActiveChange:function(t){return bd(this,void 0,void 0,(function*(){r(!0);const{success:s}=yield l(e.id,{active:t});r(!1),s&&d({type:St,payload:{webhookId:e.id,webhookData:{active:t}}})}))}})}function Ed({webhook:e}){const{state:{timezone:t}}=(0,a.useContext)(Ja);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-6 wpqt-mb-4 wpqt-mt-8 wpqt-justify-center",children:[(0,n.jsx)(Td,{name:(0,o.__)("Target","quicktasker"),value:e.target_type}),(0,n.jsx)(Td,{name:(0,o.__)("Action","quicktasker"),value:e.target_action}),(0,n.jsx)(Sd,{webhook:e,name:(0,o.__)("Wait for response","quicktasker"),value:e.webhook_confirm}),(0,n.jsx)(Td,{name:(0,o.__)("URL","quicktasker"),value:e.webhook_url}),(0,n.jsx)(Td,{name:(0,o.__)("Created","quicktasker"),value:bn(e.created_at,t)}),(0,n.jsx)(yd,{webhook:e})]})}function Td({name:e,value:t,className:s=""}){return(0,n.jsxs)("div",{className:`wpqt-flex wpqt-flex-col ${s}`,children:[(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-font-semibold",children:e}),(0,n.jsx)("div",{children:t})]})}function Sd({webhook:e,name:t,value:s}){const[r,c]=(0,a.useState)(s),[l,d]=(0,a.useState)(!1),{editWebhook:u}=jd(),{pipelineWebhooksDispatch:p}=_d();return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-font-semibold",children:t}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(Bi,{checked:r,handleChange:t=>{return s=this,a=void 0,r=function*(){c(t),d(!0);const{success:s}=yield u(e.id,{webhook_confirm:t});d(!1),s?(i.oR.success((0,o.__)("Webhook updated","quicktasker")),p({type:St,payload:{webhookId:e.id,webhookData:{webhook_confirm:t}}})):c(!t)},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{c(r.next(e))}catch(e){t(e)}}function o(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}c((r=r.apply(s,a||[])).next())}));var s,a,n,r}}),l&&(0,n.jsx)(Ys,{ovalSize:"16"})]})]})}function Ad(){const{webhooks:e}=_d();return(0,n.jsx)("div",{children:e.map((e=>(0,n.jsx)(Ed,{webhook:e},e.id)))})}function Od(){const{webhooks:e}=_d(),t=(null==e?void 0:e.length)||0;return 0===t?(0,n.jsx)("p",{children:(0,o.__)("There are no webhooks configured for this board.","quicktasker")}):(0,n.jsx)("p",{children:(0,o.sprintf)((0,o.__)("There are %d webhooks configured for this board.","quicktasker"),t)})}const Nd=Xo.z.string().url({message:"Invalid URL"});function Cd({pipelineId:e}){var t;const[s,r]=(0,a.useState)(md.TASK),[c,l]=(0,a.useState)(wd.CREATE),[d,u]=(0,a.useState)(!1),[p,h]=(0,a.useState)(""),[m,w]=(0,a.useState)(!1),[f,k]=(0,a.useState)({urlValid:!1,urlDirty:!1}),{createWebhook:q}=jd(),{pipelineWebhooksDispatch:g}=_d(),x=null!==(t=kd[s])&&void 0!==t?t:[];return(0,a.useEffect)((()=>{k((e=>Object.assign(Object.assign({},e),{urlValid:Nd.safeParse(p).success})))}),[p]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-4 wpqt-mb-5 wpqt-justify-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(wa,{labelFor:"webhook-target-type",className:"wpqt-block wpqt-mb-3",children:(0,o.__)("Select a target type","quicktasker")}),(0,n.jsx)(ka,{id:"webhook-target-type",selectedOptionValue:s,options:Object.values(md).map((e=>({value:e,label:e}))),allSelector:!1,onSelectionChange:e=>r(e)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(wa,{labelFor:"webhook-target-action",className:"wpqt-block wpqt-mb-3",children:(0,o.__)("Select a target action","quicktasker")}),(0,n.jsx)(ka,{id:"webhook-target-action",selectedOptionValue:c,options:Object.values(x).map((e=>({value:e,label:e}))),allSelector:!1,onSelectionChange:e=>l(e)})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)(wa,{labelFor:"webhook-confirm",className:"wpqt-flex wpqt-mb-3 wpqt-gap-1","data-tooltip-id":"webhook-confirm-tooltip","data-tooltip-content":(0,o.__)("If enabled, the webhook will wait for the HTTP response. Much slower performance but better for debugging.","quicktasker"),"data-tooltip-variant":"info",children:[(0,o.__)("Wait for response","quicktasker"),(0,n.jsx)(Uo.A,{className:"wpqt-size-5"})]}),(0,n.jsx)(Bi,{checked:d,handleChange:u,id:"webhook-confirm"}),(0,n.jsx)(ea,{id:"webhook-confirm-tooltip"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(wa,{labelFor:"webhook-url",className:"wpqt-block wpqt-mb-3",children:(0,o.__)("Enter the webhook URL","quicktasker")}),(0,n.jsx)(Aa,{inputId:"webhook-url",value:p,wrapperClassName:"!wpqt-mb-0",onChange:e=>{h(e),k((e=>Object.assign(Object.assign({},e),{urlDirty:!0})))}}),!f.urlValid&&f.urlDirty&&(0,n.jsx)(Ta,{errorText:(0,o.__)("Please enter a valid URL","quicktasker")})]})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(oa,{text:(0,o.__)("Create Webhook","quicktasker"),icon:(0,n.jsx)(Xr.R$,{className:"wpqt-size-6 wpqt-text-blue-400"}),onClick:function(){return t=this,a=void 0,x=function*(){if(m||!f.urlValid)return;w(!0);const{success:t,webhook:a}=yield q(e,s,c,p,d);w(!1),t&&a&&(i.oR.success((0,o.__)("Webhook created successfully","quicktasker")),g({type:Tt,payload:{webhook:fd(a)}}),r(md.TASK),l(wd.CREATE),h(""),u(!1),k({urlValid:!1,urlDirty:!1}))},new((n=void 0)||(n=Promise))((function(e,s){function i(e){try{r(x.next(e))}catch(e){s(e)}}function o(e){try{r(x.throw(e))}catch(e){s(e)}}function r(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}r((x=x.apply(t,a||[])).next())}));var t,a,n,x},loading:m,disabled:!f.urlValid})})]})}function Id({pipelineId:e}){const{loading:t}=_d();return t?(0,n.jsx)(Ys,{ovalSize:"24"}):(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:(0,o.__)("Created webhooks","quicktasker")}),(0,n.jsx)(Od,{}),(0,n.jsx)(Ad,{}),(0,n.jsx)("h2",{children:(0,o.__)("Create a new webhook","quicktasker")}),(0,n.jsx)(Cd,{pipelineId:e}),(0,n.jsx)(ud,{})]})}function Dd({pipelineId:e}){return(0,n.jsx)(xd,{pipelineId:e,children:(0,n.jsxs)(ba,{children:[(0,n.jsx)(d,{description:(0,o.__)("Send real-time board event data to external services using webhooks.","quicktasker"),children:(0,o.__)("Board webhooks","quicktasker")}),(0,n.jsx)(Id,{pipelineId:e})]})})}const Pd=()=>{const{page:e,hash:t}=Rd();if("wp-quick-tasks"===e){const e=t.match(/^#\/users\/(\d+)\/tasks$/);if(e){const t=e[1];return(0,n.jsx)(dd,{userId:t})}const s=t.match(/^#\/users\/(\d+)$/);if(s){const e=s[1];return(0,n.jsx)(xl,{userId:e})}const a=t.match(/^#\/board\/(\d+)\/automations$/);if(a){const e=a[1];return(0,n.jsx)(kr,{pipelineId:e})}const i=t.match(/^#\/board\/(\d+)\/webhooks$/);if(i){const e=i[1];return(0,n.jsx)(Dd,{pipelineId:e})}switch(t){case"#/users":return(0,n.jsx)(ed,{});case"#/overview":return(0,n.jsx)(Nr,{});case"#/archive":return(0,n.jsx)(mo,{});case"#/user-sessions":return(0,n.jsx)(Nl,{});case"#/logs":return(0,n.jsx)(gr,{});case"#/guide":return(0,n.jsx)(qr,{});case"#/user-page-link":return(0,n.jsx)(rl,{});default:return(0,n.jsx)(al,{})}}},Rd=()=>({page:new URLSearchParams(window.location.search).get("page"),hash:window.location.hash}),Ld=function(){const e=(()=>{const[e,t]=(0,a.useState)(Pd());return(0,a.useEffect)((()=>{const e=()=>{t(Pd()),(()=>{const{page:e,hash:t}=Rd();if("wp-quick-tasks"!==e)return;const s=document.querySelectorAll("#toplevel_page_wp-quick-tasks .wp-submenu li");s.forEach((e=>e.classList.remove("wpqt-current")));const a={"#/users":"#/users","#/overview":"#/overview","#/archive":"#/archive","#/user-sessions":"#/user-sessions","#/user-page-link":"#/user-page-link","#/logs":"#/logs","#/settings":"#/settings","#/guide":"#/guide",default:""};let n=a.default;void 0!==a[t]?n=a[t]:/^#\/users(\/\d+)?(\/tasks)?$/.test(t)&&(n="#/users"),s.forEach((e=>{const t=e.querySelector("a");t&&t.getAttribute("href")&&t.getAttribute("href")===`admin.php?page=wp-quick-tasks${n}`&&e.classList.add("wpqt-current")}))})()};return e(),window.addEventListener("popstate",e),window.addEventListener("hashchange",e),()=>{window.removeEventListener("popstate",e),window.removeEventListener("hashchange",e)}}),[]),e})();return(0,n.jsx)(c,{children:(0,n.jsx)(Xa,{children:(0,n.jsx)(Ma,{children:(0,n.jsx)(Ms,{children:(0,n.jsx)(ha,{children:(0,n.jsxs)(hs,{children:[e,(0,n.jsx)(i.N9,{position:"bottom-right",className:"wpqt-z-[999999]"})]})})})})})})};(0,a.render)((0,n.jsx)(Ld,{}),document.getElementById("wpqt-app"))},1609(e){e.exports=window.React},5795(e){e.exports=window.ReactDOM},790(e){e.exports=window.ReactJSXRuntime}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return a[e].call(s.exports,s,s.exports,i),s.exports}i.m=a,e=[],i.O=(t,s,a,n)=>{if(!s){var o=1/0;for(d=0;d<e.length;d++){for(var[s,a,n]=e[d],r=!0,c=0;c<s.length;c++)(!1&n||o>=n)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(r=!1,n<o&&(o=n));if(r){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,a,n]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},s=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var n=Object.create(null);i.r(n);var o={};t=t||[null,s({}),s([]),s(s)];for(var r=2&a&&e;("object"==typeof r||"function"==typeof r)&&!~t.indexOf(r);r=s(r))Object.getOwnPropertyNames(r).forEach((t=>o[t]=()=>e[t]));return o.default=()=>e,i.d(n,o),n},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=524,(()=>{var e;globalThis.importScripts&&(e=globalThis.location+"");var t=globalThis.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var a=s.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=s[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={524:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[o,r,c]=s,l=0;if(o.some((t=>0!==e[t]))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(c)var d=c(i)}for(t&&t(s);l<o.length;l++)n=o[l],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},s=globalThis.webpackChunkquicktasker=globalThis.webpackChunkquicktasker||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.nc=void 0;var o=i.O(void 0,[96],(()=>i(4720)));o=i.O(o)})();