(()=>{"use strict";var e,t,s,a={6247:(e,t,s)=>{const a=window.wp.element;var n=s(790),i=s(9571);const o=window.wp.i18n;class r extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){var e;return this.state.hasError?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-h-screen wpqt-items-center wpqt-justify-center wpqt-text-center wpqt-text-lg",children:[(0,o.__)("Something went wrong. Please refresh the page.","quicktasker"),(0,n.jsx)("br",{}),null===(e=this.state.error)||void 0===e?void 0:e.message]}):this.props.children}}const c=r;var l=s(12);function d({children:e,description:t=null,icon:s=null}){return(0,n.jsx)("div",{className:"wpqt-mb-6 wpqt-inline-grid wpqt-grid-cols-[auto_auto] wpqt-items-center wpqt-gap-2",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("h1",{children:[e,s&&(0,n.jsx)("span",{className:"wpqt-ml-1 wpqt-align-middle",children:s})]}),t&&(0,n.jsx)("div",{children:t})]})})}var u=s(7908);const p="SET_LOADING",m="SET_PIPELINE",h="MOVE_TASK",w="ADD_TASK",f="ADD_STAGE",q="DELETE_STAGE",_="EDIT_TASK",x="EDIT_STAGE",k="ADD_PIPELINE",g="EDIT_PIPELINE",v="SET_PRIMARY",j="SET_PIPELINES",y="ADD_USER_TO_TASK",b="REMOVE_USER_FROM_TASK",E="CHANGE_TASK_DONE_STATUS",T="REMOVE_PIPELINE",A="REMOVE_ACTIVE_PIPELINE",S="REMOVE_TASK",N="TOGGLE_VIEW",O="ADD_LABEL_TO_TASK",C="REMOVE_LABEL_FROM_TASK",I="EDIT_PIPELINE_LABEL",D="REMOVE_PIPELINE_LABEL",P="SET_TASK_FOCUS_COLOR",R="SET_STAGE_FILTER",L="SET_USER_FILTER",M="OPEN_EDIT_TASK_MODAL",U="CLOSE_TASK_MODAL",F="OPEN_NEW_STAGE_MODAL",$="CLOSE_STAGE_MODAL",K="OPEN_STAGE_EDIT_MODAL",z="OPEN_NEW_PIPELINE_MODAL",G="OPEN_EDIT_PIPELINE_MODAL",V="CLOSE_PIPELINE_EDIT_MODAL",B="CLOSE_USER_MODAL",H="OPEN_EDIT_USER_MODAL",W="ADD_ASSIGNED_USER_TO_EDITING_TASK",Q="REMOVE_ASSIGNED_USER_FROM_EDITING_TASK",Y="CHANGE_USER_SETTINGS_MODAL_OPEN",J="OPEN_MOVE_TASK_MODAL",X="CLOSE_MOVE_TASK_MODAL",Z="OPEN_TASK_COLOR_MODAL",ee="CLOSE_TASK_COLOR_MODAL",te="OPEN_TASK_EXPORT_MODAL",se="CLOSE_TASK_EXPORT_MODAL",ae="CHANGE_TASK_EXPORT_MODAL_METHOD",ne="OPEN_PIPELINE_IMPORT_MODAL",ie="CLOSE_PIPELINE_IMPORT_MODAL",oe="OPEN_AUTOMATION_CREATOR_MODAL",re="CLOSE_AUTOMATION_CREATOR_MODAL",ce="OPEN_AUTOMATIONS_MODAL",le="CLOSE_AUTOMATIONS_MODAL",de="ARCHIVE_SETTINGS_MODAL_OPEN",ue="SET_ARCHIVE_TASKS",pe="SET_ARCHIVE_SEARCH_VALUE",me="SET_ARCHIVE_FILTERED_PIPELINE",he="REMOVE_ARCHIVED_TASK",we="REMOVE_ARCHIVED_TASKS",fe="ADD_ASSIGNED_USER_TO_ARCHIVED_TASK",qe="REMOVE_ASSINGED_USER_FROM_ARCHIVED_TASK",_e="CHANGE_ARCHIVED_TASK_DONE_STATUS",xe="EDIT_ARCHIVED_TASK",ke="CHANGE_ARCHIVE_TASK_DONE_FILTER",ge="ADD_LABEL_ARCHIVED_TASK",ve="REMOVE_LABEL_ARCHIVED_TASK",je="CHANGE_ARCHIVED_TASKS_LIMIT_FILTER",ye="SET_ARCHIVE_LOADING",be="SET_ARCHIVE_FILTER_ORDER",Ee="SET_USERS",Te="SET_WP_USERS",Ae="ADD_USER",Se="SET_USERS_SEARCH_VALUE",Ne="EDIT_USER",Oe="DELETE_USER",Ce="CHANGE_USER_STATUS",Ie="RESET_PASSWORD",De="INIT_APP_STATE",Pe="SET_CUSTOM_USER_PAGE_STYLES",Re="SET_FULL_PAGE_LOADING",Le="SET_USER_SESSIONS_SEARCH_VALUE",Me="SET_USER_SESSIONS",Ue="CHANGE_USER_SESSION_STATUS",Fe="DELETE_USER_SESSION",$e="SET_USER_TASKS",Ke="SET_USER_TASKS_SEARCH_VALUE",ze="REMOVE_USER_TASK",Ge="EDIT_USER_TASK",Ve="SET_USER_TASKS_FILTERED_PIPELINE",Be="ADD_ASSIGNED_USER_TO_USER_TASK",He="REMOVE_ASSIGNED_USER_FROM_USER_TASK",We="CHANGE_USER_TASK_DONE_STATUS",Qe="SET_CUSTOM_FIELDS",Ye="ADD_CUSTOM_FIELD",Je="DELETE_CUSTOM_FIELD",Xe="SET_CUSTOM_FIELD_LOADING",Ze="SET_CUSTOM_FIELD_INITIAL_DATA",et="SET_LABELS",tt="ADD_LABEL",st="REMOVE_LABEL",at="EDIT_LABEL",nt="SET_LABEL_ACTION_STATE_SELECTION",it="SET_LABEL_ACTION_STATE_EDITING",ot="SET_LABEL_ACTION_STATE_CREATION",rt="RESET_LABEL_CONTEXT",ct="SET_PIPELINE_AUTOMATIONS",lt="SET_PIPELINE_AUTOMATIONS_LOADING",dt="REMOVE_PIPELINE_AUTOMATION",ut="ADD_PIPELINE_AUTOMATION",pt="UPDATE_PIPELINE_AUTOMATION_ACTIVE_STATUS",mt="SET_META",ht="SET_ACTION_TARGET",wt="RESET_AUTOMATION_TO_TARGET",ft="RESET_AUTOMATION_TO_TRIGGER",qt="RESET_AUTOMATION_TO_ACTION",_t="SET_UPLOADS",xt="ADD_UPLOAD",kt="REMOVE_UPLOAD",gt=!1,vt="#ffffff",jt="6px",yt="solid",bt="#16a34a",Et=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","text/plain","image/jpeg","image/png","image/gif","image/bmp","image/svg+xml","audio/mpeg","audio/wav","audio/ogg","video/mp4","video/webm","video/ogg","application/zip","application/x-rar-compressed","application/x-tar","application/gzip"],Tt=26214400,At=/^[a-zA-Z0-9_\-.]+$/,St=window.wp.apiFetch;var Nt,Ot=s.n(St);function Ct(){return{"Content-Type":"application/json","X-WPQT-API-Nonce":window.wpqt.apiNonce}}function It(e,t,s){return Ot()({path:`/wpqt/v1/tasks/${e}/move`,method:"PATCH",data:{stageId:t,order:s},headers:Ct()})}function Dt(e,t,s){const a=new URLSearchParams({typeId:e,type:t,isPrivate:s.toString()}).toString();return Ot()({path:`/wpqt/v1/comments?${a}`,method:"GET",headers:Ct()})}function Pt(e,t,s,a){return Ot()({path:"/wpqt/v1/comments",data:{comment:a,typeId:e,type:t,isPrivate:s},method:"POST",headers:Ct()})}function Rt(e,t){const s=new URLSearchParams({typeId:e,type:t});return Ot()({path:`/wpqt/v1/logs?${s.toString()}`,method:"GET",headers:Ct()})}function Lt(e,t,s){return Ot()({path:`/wpqt/v1/users/${e}/tasks/${t}`,method:"DELETE",data:{user_type:s},headers:Ct()})}function Mt(e,t,s){const a=new URLSearchParams({entityId:e,entityType:t,active:String(s)});return Ot()({path:`/wpqt/v1/custom-fields?${a.toString()}`,method:"GET",headers:Ct()})}!function(e){e.QUICKTASKER="quicktasker",e.WP_USER="wp-user"}(Nt||(Nt={}));function Ut(e){return!e.user_type||e.user_type===Nt.QUICKTASKER}function Ft(e){return e.user_type===Nt.WP_USER}const $t=e=>Object.assign(Object.assign({},e),{allow_only_last_stage_task_done:"1"===e.allow_only_last_stage_task_done});var Kt,zt,Gt,Vt,Bt,Ht;!function(e){e.TASK_DONE="task-done",e.Task_NOT_DONE="task-not-done",e.TASK_CREATED="task-created",e.TASK_DELETED="task-deleted",e.TASK_ASSIGNED="task-assigned",e.TASK_UNASSIGNED="task-unassigned",e.TASK_PUBLIC_COMMENT_ADDED="task-public-comment-added",e.TASK_PRIVATE_COMMENT_ADDED="task-private-comment-added",e.TASK_FILE_UPLOADED="task-attachment-added",e.TASK_FILE_DELETED="task-attachment-deleted"}(Kt||(Kt={})),function(e){e.WOOCOMMERCE_ORDER_ADDED="woocommerce-order-added"}(zt||(zt={})),function(e){e.SEATREG_BOOKING_CREATED="seatreg-booking-created",e.SEATREG_BOOKING_APPROVED="seatreg-booking-approved",e.SEATREG_BOOKING_APPROVED_VIA_MANAGER="seatreg-booking-approved-via-manager",e.SEATREG_BOOKING_PENDING="seatreg-booking-pending",e.SEATREG_BOOKING_PENDING_VIA_MANAGER="seatreg-booking-pending-via-manager"}(Gt||(Gt={})),function(e){e.PIPELINE="pipeline",e.Stage="stage",e.Task="task",e.quicktasker="quicktasker",e.WOOCOMMERCE_ORDER="woocommerce-order",e.SEATREG_BOOKING="seatreg-booking"}(Vt||(Vt={})),function(e){e.PIPELINE="pipeline",e.STAGE="stage",e.TASK="task",e.QUICKTASKER="quicktasker",e.WP_USER="wp-user"}(Bt||(Bt={})),function(e){e.ARCHIVE_TASK="archive-task",e.ASSIGN_USER="assign-user",e.NEW_ENTITY_EMAIL="new-entity-email",e.DELETED_ENTITY_EMAIL="deleted-entity-email",e.TASK_ASSIGNED_EMAIL="task-assigned-email",e.TASK_UNASSIGNED_EMAIL="task-unassigned-email",e.TASK_PUBLIC_COMMENT_ADDED_EMAIL="task-public-comment-added-email",e.TASK_PRIVATE_COMMENT_ADDED_EMAIL="task-private-comment-added-email",e.TASK_FILE_UPLOADED_EMAIL="task-attachment-added-email",e.TASK_FILE_DELETED_EMAIL="task-attachment-deleted-email",e.CREATE_TASK="create-task",e.SEND_SLACK_MESSAGE="send-slack-message"}(Ht||(Ht={}));const Wt=e=>Object.assign(Object.assign({},e),{is_active:"1"===e.is_active,has_password:"1"===e.has_password}),Qt=e=>{switch(e){case Bt.QUICKTASKER:return Nt.QUICKTASKER;case Bt.WP_USER:return Nt.WP_USER;default:return null}},Yt={[Nt.QUICKTASKER]:"Quicktasker",[Nt.WP_USER]:"WordPress User"},Jt=e=>Object.assign(Object.assign({},e),{task_order:Number(e.task_order),free_for_all:"1"===e.free_for_all,is_archived:"1"===e.is_archived,is_done:"1"===e.is_done,assigned_users:e.assigned_users?e.assigned_users.map((e=>Object.assign({},Wt(e)))):[]}),Xt=e=>Object.assign(Object.assign({},e),{stage_order:Number(e.stage_order),tasks:(e.tasks||[]).map((e=>Object.assign({},Jt(e))))}),Zt=(e,t)=>{var s,a,n,i,o,r,c,l,d,u,k,v,j,T,R;switch(t.type){case p:return Object.assign(Object.assign({},e),{loading:t.payload});case m:{const s=t.payload,a=(s.stages||[]).map((e=>Object.assign({},Xt(e)))),n=s.settings?$t(s.settings):void 0;return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},s),{stages:a,settings:n,is_primary:"1"===s.is_primary})})}case h:{if(!e.activePipeline||!e.activePipeline.stages)return e;const s=((e,t,s)=>{const a=[...e],n=a.find((e=>e.id===t.droppableId)),i=a.find((e=>e.id===s.droppableId));if((null==n?void 0:n.tasks)&&(null==i?void 0:i.tasks)){const[e]=n.tasks.splice(t.index,1);i.tasks.splice(s.index,0,e)}return a})(e.activePipeline.stages,t.payload.source,t.payload.destination);return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:s})})}case"REORDER_TASK":{const{source:n,destination:i}=t.payload,o=i.droppableId,r=i.index;if(!e.activePipeline)return e;const c=null===(s=e.activePipeline.stages)||void 0===s?void 0:s.find((e=>e.id===o));if(!c||!c.tasks)return e;const l=((e,t,s)=>{const a=[...e],[n]=a.splice(t,1);return a.splice(s,0,n),a})(c.tasks,n.index,r),d=null===(a=e.activePipeline.stages)||void 0===a?void 0:a.map((e=>e.id===o?Object.assign(Object.assign({},e),{tasks:l}):e));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:d})})}case w:{const s=Jt(t.payload);return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:null===(n=e.activePipeline.stages)||void 0===n?void 0:n.map((e=>e.id===s.stage_id?Object.assign(Object.assign({},e),{tasks:[...e.tasks||[],s]}):e))})}):e}case _:{const s=Jt(t.payload);if(!e.activePipeline)return e;const a=null===(i=e.activePipeline.stages)||void 0===i?void 0:i.map((e=>{var t;return e.id===s.stage_id?Object.assign(Object.assign({},e),{tasks:null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s.id?s:e))}):e}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case f:{const{stage:s}=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:[...e.activePipeline.stages||[],s]})}):e}case x:{const s=t.payload;if(!e.activePipeline)return e;const a=e=>e.id===s.id?Object.assign(Object.assign({},e),{name:s.name,description:s.description}):e,n=null===(o=e.activePipeline.stages)||void 0===o?void 0:o.map(a);return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case q:{const s=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:null===(r=e.activePipeline.stages)||void 0===r?void 0:r.filter((e=>e.id!==s))})}):e}case y:{const{taskId:s,user:a}=t.payload;if(!e.activePipeline)return e;const n=null===(c=e.activePipeline.stages)||void 0===c?void 0:c.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>{if(e.id===s){const t=Ut(a)?[a,...e.assigned_users||[]]:e.assigned_users||[],s=Ft(a)?[a,...e.assigned_wp_users||[]]:e.assigned_wp_users||[];return Object.assign(Object.assign({},e),{assigned_users:t,assigned_wp_users:s})}return e}));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case b:{const{taskId:s,userId:a,userType:n}=t.payload;if(!e.activePipeline)return e;const i=null===(l=e.activePipeline.stages)||void 0===l?void 0:l.map((e=>{var t;const i=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>{var t,i;return e.id===s?Object.assign(Object.assign({},e),{assigned_users:n===Nt.QUICKTASKER?null===(t=e.assigned_users)||void 0===t?void 0:t.filter((e=>e.id!==a)):e.assigned_users,assigned_wp_users:n===Nt.WP_USER?null===(i=e.assigned_wp_users)||void 0===i?void 0:i.filter((e=>e.id!==a)):e.assigned_wp_users}):e}));return Object.assign(Object.assign({},e),{tasks:i})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:i})})}case g:{const s=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{name:s.name,description:s.description,is_primary:"1"===s.is_primary})}):e}case E:{const{taskId:s,done:a}=t.payload;if(!e.activePipeline)return e;const n=null===(d=e.activePipeline.stages)||void 0===d?void 0:d.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case A:return Object.assign(Object.assign({},e),{activePipeline:null});case S:{const s=t.payload;if(!e.activePipeline)return e;const a=null===(u=e.activePipeline.stages)||void 0===u?void 0:u.map((e=>{var t;return Object.assign(Object.assign({},e),{tasks:null===(t=e.tasks)||void 0===t?void 0:t.filter((e=>e.id!==s))})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case N:return Object.assign(Object.assign({},e),{view:t.payload});case O:{const{taskId:s,label:a}=t.payload;if(!e.activePipeline)return e;const n=null===(k=e.activePipeline.stages)||void 0===k?void 0:k.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:[...e.assigned_labels||[],a]}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case C:{const{taskId:s,labelId:a}=t.payload;if(!e.activePipeline)return e;const n=null===(v=e.activePipeline.stages)||void 0===v?void 0:v.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).filter((e=>e.id!==a))}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case I:{const{label:s}=t.payload;if(!e.activePipeline)return e;const a=null===(j=e.activePipeline.stages)||void 0===j?void 0:j.map((e=>{var t;const a=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).map((e=>e.id===s.id?s:e))})));return Object.assign(Object.assign({},e),{tasks:a})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case D:{const s=t.payload;if(!e.activePipeline)return e;const a=null===(T=e.activePipeline.stages)||void 0===T?void 0:T.map((e=>{var t;const a=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).filter((e=>e.id!==s))})));return Object.assign(Object.assign({},e),{tasks:a})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case P:{const{taskId:s,color:a}=t.payload;if(!e.activePipeline)return e;const n=null===(R=e.activePipeline.stages)||void 0===R?void 0:R.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{task_focus_color:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}default:return e}};var es;!function(e){e.PIPELINE="PIPELINE-VIEW",e.TASK="TASK-VIEW"}(es||(es={}));const ts=(e,t)=>{if(t.type===Re){const s=t.payload;return Object.assign(Object.assign({},e),{fullPageLoading:s})}return e},ss={fullPageLoading:!1},as=(0,a.createContext)({state:ss,loadingDispatch:()=>{}}),ns=({children:e})=>{const[t,s]=(0,a.useReducer)(ts,ss);return(0,n.jsx)(as.Provider,{value:{state:t,loadingDispatch:s},children:e})};const is={loading:!1,view:es.PIPELINE,activePipeline:null},os=(0,a.createContext)({state:is,dispatch:()=>{},fetchAndSetPipelineData:()=>Promise.resolve()}),rs=({children:e})=>{const[t,s]=(0,a.useReducer)(Zt,is),{loadingDispatch:r}=(0,a.useContext)(as);(0,a.useEffect)((()=>{const e=window.wpqt.initialActivePipelineId;e&&l(e,!0)}),[]);const c=(e,t)=>{t?r({type:Re,payload:e}):s({type:p,payload:e})},l=(e,...t)=>{return a=void 0,n=[e,...t],l=function*(e,t=!1){try{c(!0,t);const{data:{pipeline:a}}=yield function(e){return Ot()({path:`/wpqt/v1/pipelines/${e}`,headers:Ct()})}(e);s({type:m,payload:a})}catch(e){console.error(e),i.oR.error((0,o.__)("Unable to load the board. Please try again later.","quicktasker"))}finally{c(!1,t)}},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{o(l.next(e))}catch(e){t(e)}}function i(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var a;t.done?e(t.value):(a=t.value,a instanceof r?a:new r((function(e){e(a)}))).then(s,i)}o((l=l.apply(a,n||[])).next())}));var a,n,r,l};return(0,n.jsx)(os.Provider,{value:{state:t,dispatch:s,fetchAndSetPipelineData:l},children:e})};var cs=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const ls={[Ht.ARCHIVE_TASK]:(0,o.__)("Task archived by automation","quicktasker"),[Ht.ASSIGN_USER]:(0,o.__)("User assigned by automation","quicktasker"),[Ht.NEW_ENTITY_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Ht.DELETED_ENTITY_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Ht.TASK_ASSIGNED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Ht.TASK_UNASSIGNED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Ht.TASK_PUBLIC_COMMENT_ADDED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Ht.TASK_PRIVATE_COMMENT_ADDED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Ht.TASK_FILE_UPLOADED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Ht.TASK_FILE_DELETED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[Ht.CREATE_TASK]:(0,o.__)("Task created by automation","quicktasker"),[Ht.SEND_SLACK_MESSAGE]:(0,o.__)("Slack message sent by automation","quicktasker")};function ds(){const{dispatch:e}=(0,a.useContext)(os),t=e=>{e&&e.forEach((e=>{if(e.automation_action.includes("email"))return;const t=ls[e.automation_action]||`Automation executed: ${e.automation_action}`;i.oR.info(t)}))},s=(t,s)=>{t&&s&&t.forEach((t=>{if(t.automation_action===Ht.ARCHIVE_TASK&&e({type:S,payload:s}),t.automation_action===Ht.ASSIGN_USER){const n=t.executionResult;!n||!(a=n)||"object"!=typeof a||a.user_type&&a.user_type!==Nt.QUICKTASKER&&a.user_type!==Nt.WP_USER||e({type:y,payload:{taskId:s,user:n}})}var a}))};return{displayAutomationMessages:t,handleExecutedAnimationsResults:s,handleExecutedAutomations:(e,a)=>{0!==e.length&&(s(e,a),t(e))},createAutomation:(e,t,s)=>cs(this,void 0,void 0,(function*(){try{const a=yield function(e,t){var s;return Ot()({path:`/wpqt/v1/pipelines/${e}/automations`,method:"POST",data:{automationTargetId:null,automationTarget:t.automationTarget,automationTrigger:t.automationTrigger,automationAction:null===(s=t.automationAction)||void 0===s?void 0:s.id,automationActionTargetId:t.automationActionTargetId,automationActionTargetType:t.automationActionTargetType,automationMetadata:t.metaData},headers:Ct()})}(e,t);i.oR.success((0,o.__)("Automation created","quicktasker")),s&&s(!0,a.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create automation","quicktasker")),s&&s(!1,null)}})),updateAutomationActiveStatus:(e,t,s)=>cs(this,void 0,void 0,(function*(){try{const a=yield function(e,t,s){return Ot()({path:`/wpqt/v1/pipelines/${e}/automations/${t}/active`,method:"PATCH",data:{active:s},headers:Ct()})}(e,t,s);return i.oR.success(s?(0,o.__)("Automation activated","quicktasker"):(0,o.__)("Automation deactivated","quicktasker")),{success:!0,data:a.data}}catch(e){return console.error(e),i.oR.error(s?(0,o.__)("Failed to activate automation","quicktasker"):(0,o.__)("Failed to deactivate automation","quicktasker")),{success:!1,data:null}}})),deleteAutomation:(e,t,s)=>cs(this,void 0,void 0,(function*(){try{yield function(e,t){return Ot()({path:`/wpqt/v1/pipelines/${e}/automations/${t}`,method:"DELETE",headers:Ct()})}(e,t),i.oR.success((0,o.__)("Automation deleted","quicktasker")),s&&s(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete automation","quicktasker")),s&&s(!1)}}))}}var us=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const ps=()=>{const{handleExecutedAutomations:e}=ds(),{displayErrorMessages:t}=function(){return{displayErrorMessages:e=>{return t=this,s=void 0,n=function*(){if(e.messages&&Array.isArray(e.messages)&&e.messages.length>0){const t=e.messages.join(", ");i.oR.error(t)}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n}}}();return{deleteTask:(t,s)=>us(void 0,void 0,void 0,(function*(){try{const a=yield function(e){return Ot()({path:`/wpqt/v1/tasks/${e}`,method:"DELETE",headers:Ct()})}(t);s&&s({success:!0,taskId:t}),i.oR.success((0,o.__)("Task deleted","quicktasker")),e(a.data.executedAutomations,t)}catch(e){s&&s({success:!1,taskId:t}),console.error(e),i.oR.error((0,o.__)("Failed to delete a task","quicktasker"))}})),archiveTask:(e,t)=>us(void 0,void 0,void 0,(function*(){try{yield function(e){return Ot()({path:`/wpqt/v1/tasks/${e}/archive`,method:"PATCH",headers:Ct()})}(e),t&&t({success:!0,taskId:e}),i.oR.success((0,o.__)("Task archived","quicktasker"))}catch(s){t&&t({success:!1,taskId:e}),console.error(s),i.oR.error((0,o.__)("Failed to archive a task","quicktasker"))}})),restoreArchivedTask:(e,t)=>us(void 0,void 0,void 0,(function*(){try{yield function(e){return Ot()({path:`/wpqt/v1/tasks/${e}/archive-restore`,method:"PATCH",headers:Ct()})}(e),t&&t(),i.oR.success((0,o.__)("Task restored","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to restore a task","quicktasker"))}})),removeTaskFromUser:(t,s,a)=>us(void 0,void 0,void 0,(function*(){try{const n=yield Lt(t,s,Nt.QUICKTASKER);i.oR.success((0,o.__)("Task has been unassigned","quicktasker")),e(n.data.executedAutomations,s),a&&a()}catch(e){console.error(e),i.oR.error((0,o.__)("Task unassignment failed. Try again","quicktasker"))}})),changeTaskDoneStatus:(s,a,n)=>us(void 0,void 0,void 0,(function*(){try{const t=a?(0,o.__)("Task marked as completed","quicktasker"):(0,o.__)("Task marked as incomplete","quicktasker"),r=yield function(e,t){return Ot()({path:`/wpqt/v1/tasks/${e}/done`,method:"PATCH",data:{done:t},headers:Ct()})}(s,a);n&&n(a),i.oR.success(t),e(r.data.executedAutomations,s)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change task status","quicktasker")),t(e)}})),moveTask:(e,t,s,a)=>us(void 0,void 0,void 0,(function*(){try{yield It(e,t,s),i.oR.success((0,o.__)("Task moved","quicktasaker")),a&&a(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to move a task","quicktasker")),a&&a(!1)}})),updateTaskFocusColor:(e,t)=>us(void 0,void 0,void 0,(function*(){const s={taskId:e,color:t};try{return yield function(e,t){return Ot()({path:`/wpqt/v1/tasks/${e}/focus-color`,method:"PATCH",data:{color:t},headers:Ct()})}(e,t),i.oR.success((0,o.__)("Task focus color changed","quicktasker")),Object.assign({success:!0},s)}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to change task focus color","quicktasker")),Object.assign({success:!1},s)}})),cleanupTaskArchive:()=>us(void 0,void 0,void 0,(function*(){try{const e=(yield Ot()({path:"/wpqt/v1/archive/settings/task-cleanup",method:"PATCH",headers:Ct()})).data.deletedTaskIds;return i.oR.success((0,o.sprintf)((0,o.__)("Removed %d orphaned tasks from archive","quicktasker"),e.length)),{success:!0,deletedTaskIds:e}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to clean up task archive","quicktasker")),{success:!1,deletedTaskIds:[]}}}))}},ms=(e,t)=>{var s,a,n,i,o,r,c,l;switch(t.type){case ue:{const s=t.payload;return Object.assign(Object.assign({},e),{archivedTasks:s.map(Jt)})}case pe:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveSearchValue:s})}case me:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveFilteredPipelineId:s})}case he:{const a=(null!==(s=e.archivedTasks)&&void 0!==s?s:[]).filter((e=>e.id!==t.payload));return Object.assign(Object.assign({},e),{archivedTasks:a})}case we:{const s=t.payload,n=(null!==(a=e.archivedTasks)&&void 0!==a?a:[]).filter((e=>!s.includes(e.id)));return Object.assign(Object.assign({},e),{archivedTasks:n})}case fe:{const{taskId:s,user:a}=t.payload,i=(null!==(n=e.archivedTasks)&&void 0!==n?n:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:Ut(a)?[a,...e.assigned_users]:e.assigned_users,assigned_wp_users:Ft(a)?[a,...e.assigned_wp_users]:e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{archivedTasks:i})}case qe:{const{taskId:s,user:a}=t.payload,n=(null!==(i=e.archivedTasks)&&void 0!==i?i:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:Ut(a)?e.assigned_users.filter((e=>e.id!==a.id)):e.assigned_users,assigned_wp_users:Ft(a)?e.assigned_wp_users.filter((e=>e.id!==a.id)):e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case _e:{const{taskId:s,done:a}=t.payload,n=(null!==(o=e.archivedTasks)&&void 0!==o?o:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case xe:{const s=t.payload,a=(null!==(r=e.archivedTasks)&&void 0!==r?r:[]).map((e=>e.id===s.id?Jt(s):e));return Object.assign(Object.assign({},e),{archivedTasks:a})}case ke:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveTaskDoneFilter:s})}case ge:{const{taskId:s,label:a}=t.payload,n=(null!==(c=e.archivedTasks)&&void 0!==c?c:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:[...e.assigned_labels,a]}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case ve:{const{taskId:s,labelId:a}=t.payload,n=(null!==(l=e.archivedTasks)&&void 0!==l?l:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:e.assigned_labels.filter((e=>e.id!==a))}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case je:{const s=t.payload;return Object.assign(Object.assign({},e),{archivedTaskLimit:s})}case ye:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveLoading:s})}case be:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveFilterOrder:s})}default:return e}};var hs,ws,fs,qs,_s,xs;!function(e){e.Task="task",e.User="user"}(hs||(hs={})),function(e){e.System="system",e.Admin="admin",e.WPQTUser="quicktasker_user",e.Automation="automation",e.Import="import"}(ws||(ws={})),function(e){e.All="",e.Completed="1",e.NotCompleted="0"}(fs||(fs={})),function(e){e.Admin="administrator",e.Other="other"}(qs||(qs={})),function(e){e.ALL="",e.ONE_HUNDRED="100",e.TWO_HUNDRED="200",e.FIVE_HUNDRED="500"}(_s||(_s={})),function(e){e.ASC="ASC",e.DESC="DESC"}(xs||(xs={}));var ks=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const gs={archivedTasks:null,archiveLoading:!1,archiveSearchValue:"",archiveFilteredPipelineId:"",archiveTaskDoneFilter:fs.All,archivedTaskLimit:_s.ONE_HUNDRED,archiveFilterOrder:xs.DESC},vs=(0,a.createContext)({state:gs,archiveDispatch:()=>{},fetchAndSetArchivedTasks:()=>ks(void 0,void 0,void 0,(function*(){}))}),js=({children:e})=>{const[t,s]=(0,a.useReducer)(ms,gs);(0,a.useEffect)((()=>{r()}),[]);const r=()=>ks(void 0,void 0,void 0,(function*(){try{s({type:ye,payload:!0});const{data:e}=yield function(e){const t=new URLSearchParams;return e.search&&t.set("search",e.search),e.pipelineId&&t.set("pipelineId",e.pipelineId),e.doneFilter&&t.set("status",e.doneFilter),null!==e.limit&&t.set("limit",String(e.limit)),e.order&&t.set("order",e.order),Ot()({path:`/wpqt/v1/tasks/archived?${t}`,method:"GET",headers:Ct()})}({search:t.archiveSearchValue,pipelineId:t.archiveFilteredPipelineId,doneFilter:t.archiveTaskDoneFilter,limit:t.archivedTaskLimit,order:t.archiveFilterOrder});s({type:ue,payload:e})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch archived tasks","quicktasker"))}finally{s({type:ye,payload:!1})}}));return(0,n.jsx)(vs.Provider,{value:{state:t,archiveDispatch:s,fetchAndSetArchivedTasks:r},children:e})},ys=()=>Object.assign({},Ts),bs=(e,t)=>{var s,a,n,i,o,r,c,l,d,u,p,m,h,w,f,q;switch(t.type){case M:{const{taskToEdit:s,taskModalSettings:a}=t.payload;return Object.assign(Object.assign({},e),{taskModalOpen:!0,taskToEdit:s,targetStageId:s.stage_id,taskModalSettings:Object.assign(Object.assign({},e.taskModalSettings),a)})}case U:return ys();case W:{const d=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{assigned_users:Ut(d)?[d,...null!==(a=null===(s=e.taskToEdit)||void 0===s?void 0:s.assigned_users)&&void 0!==a?a:[]]:null!==(i=null===(n=e.taskToEdit)||void 0===n?void 0:n.assigned_users)&&void 0!==i?i:[],assigned_wp_users:Ft(d)?[d,...null!==(r=null===(o=e.taskToEdit)||void 0===o?void 0:o.assigned_wp_users)&&void 0!==r?r:[]]:null!==(l=null===(c=e.taskToEdit)||void 0===c?void 0:c.assigned_wp_users)&&void 0!==l?l:[]})})}case Q:{const s=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{assigned_users:Ut(s)?(null!==(u=null===(d=e.taskToEdit)||void 0===d?void 0:d.assigned_users)&&void 0!==u?u:[]).filter((e=>e.id!==s.id)):null!==(m=null===(p=e.taskToEdit)||void 0===p?void 0:p.assigned_users)&&void 0!==m?m:[],assigned_wp_users:Ft(s)?(null!==(w=null===(h=e.taskToEdit)||void 0===h?void 0:h.assigned_wp_users)&&void 0!==w?w:[]).filter((e=>e.id!==s.id)):null!==(q=null===(f=e.taskToEdit)||void 0===f?void 0:f.assigned_wp_users)&&void 0!==q?q:[]})})}case F:{const{targetPipelineId:s}=t.payload;return Object.assign(Object.assign({},e),{stageModalOpen:!0,targetPipelineId:s})}case K:{const{stageToEdit:s}=t.payload;return Object.assign(Object.assign({},e),{stageModalOpen:!0,stageToEdit:s})}case $:return ys();case z:return Object.assign(Object.assign({},e),{newPipelineModalOpen:!0});case G:{const{pipelineToEdit:s}=t.payload;return Object.assign(Object.assign({},e),{pipelineModalOpen:!0,pipelineToEdit:s})}case V:return ys();case"OPEN_ARCHIVE_TASK_MODAL":{const s=t.payload;return Object.assign(Object.assign({},e),{archiveTaskModalOpen:!0,archiveModalTask:s})}case"CLOSE_ARCHIVE_TASK_MODAL":return ys();case"OPEN_NEW_USER_MODAL":return Object.assign(Object.assign({},e),{userModalOpen:!0});case H:{const s=t.payload;return Object.assign(Object.assign({},e),{userModalOpen:!0,userToEdit:s})}case B:return ys();case Y:return t.payload?Object.assign(Object.assign({},e),{userSettingsModalOpen:!0}):ys();case"CHANGE_TASK_DONE_STATUS":{const{done:s}=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{is_done:s})})}case J:{const{task:s}=t.payload;return Object.assign(Object.assign({},e),{moveTaskModalOpen:!0,taskToEdit:s})}case X:return ys();case Z:{const{task:s}=t.payload;return Object.assign(Object.assign({},e),{taskColorModalOpen:!0,taskToEdit:s})}case ee:return ys();case te:{const{selectedMethod:s}=t.payload;return Object.assign(Object.assign({},e),{taskExportModalOpen:!0,taskExportModalSettings:Object.assign(Object.assign({},e.taskExportModalSettings),{selectedMethod:s})})}case se:return ys();case ae:{const{selectedMethod:s}=t.payload;return Object.assign(Object.assign({},e),{taskExportModalSettings:Object.assign(Object.assign({},e.taskExportModalSettings),{selectedMethod:s})})}case ne:return Object.assign(Object.assign({},e),{pipelineImportModalOpen:!0});case ie:return ys();case oe:return Object.assign(Object.assign({},e),{automationCreatorModalOpen:!0});case re:return ys();case ce:return Object.assign(Object.assign({},e),{automationsModalOpen:!0});case le:return ys();case de:return t.payload?Object.assign(Object.assign({},e),{archiveSettingsModalOpen:!0}):ys();default:return e}};var Es;!function(e){e.PDF="pdf",e.CSV="csv",e.JSON="json"}(Es||(Es={}));const Ts={taskModalOpen:!1,targetStageId:"",taskToEdit:null,taskModalSettings:{allowToMarkTaskAsDone:!0},moveTaskModalOpen:!1,stageModalOpen:!1,stageToEdit:null,targetPipelineId:"",pipelineModalOpen:!1,newPipelineModalOpen:!1,pipelineToEdit:null,archiveTaskModalOpen:!1,archiveModalTask:null,userModalOpen:!1,userToEdit:null,userSettingsModalOpen:!1,taskColorModalOpen:!1,taskExportModalOpen:!1,taskExportModalSettings:{selectedMethod:Es.PDF},pipelineImportModalOpen:!1,automationCreatorModalOpen:!1,automationsModalOpen:!1,archiveSettingsModalOpen:!1},As=(0,a.createContext)({state:Ts,modalDispatch:()=>{}}),Ss=({children:e})=>{const[t,s]=(0,a.useReducer)(bs,Ts);return(0,n.jsx)(As.Provider,{value:{state:t,modalDispatch:s},children:e})};var Ns=s(2922),Os=s(6053),Cs=s(9828),Is=s(540),Ds=s(4576),Ps=s(5138),Rs=s(6061);function Ls({width:e="80",height:t="80",className:s="",color:a="#1d4ed8",secondaryColor:i="#2563eb"}){return(0,n.jsx)(Rs.BM,{visible:!0,height:t,width:e,color:a,secondaryColor:i,ariaLabel:"oval-loading",wrapperStyle:{},wrapperClass:s})}function Ms(){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-h-screen-minus-top-bar wpqt-flex-col wpqt-items-center wpqt-justify-center",children:(0,n.jsx)(Ls,{})})}function Us({className:e="",ovalSize:t}){const s=t?{width:t,height:t}:{};return(0,n.jsx)("div",{className:`wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center ${e}`,children:(0,n.jsx)(Ls,Object.assign({},s))})}var Fs,$s,Ks=s(7008);function zs({id:e}){return(0,n.jsx)(Ks.m_,{id:e,className:"wpqt-bg-red-600",children:(0,n.jsx)("span",{children:"Tooltip content"})})}function Gs({onClick:e=()=>{},btnText:t,className:s,type:a=Fs.BUTTON,disabled:i=!1,loading:o=!1,buttonStyleType:r=$s.PRIMARY}){const c=r===$s.PRIMARY?"wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-transparent wpqt-bg-blue-500 wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-text-white wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 focus:wpqt-ring-blue-800 enabled:hover:wpqt-bg-blue-600":r===$s.SECONDARY?"wpqt-inline-flex wpqt-cursor-pointer wpqt-bg-gray-100 wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 enabled:hover:wpqt-bg-gray-200":"wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-transparent wpqt-bg-red-500 wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-text-white wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 focus:wpqt-ring-red-800 enabled:hover:wpqt-bg-red-600";return(0,n.jsx)(Ps.$,{disabled:i||o,className:`${c} ${s}`,onClick:e,type:a,children:o?(0,n.jsx)(Ls,{width:"24",height:"24",color:"#ffffff",secondaryColor:"#ffffff"}):t})}function Vs({icon:e,text:t,onClick:s=()=>{},className:a,tooltipId:i,tooltipText:o,loading:r=!1}){const c=o&&i,l=c?{"data-tooltip-id":i,"data-tooltip-content":o,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info"}:{};return(0,n.jsxs)("div",Object.assign({},l,{className:`wpqt-main-border wpqt-relative wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-bg-gray-100 wpqt-p-2 hover:wpqt-bg-white ${a}`,onClick:s,children:[e,t||r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center wpqt-relative",children:[t&&(0,n.jsx)("span",{className:"wpqt-whitespace-nowrap "+(r?"wpqt-invisible":""),children:t}),r&&(0,n.jsx)(Ls,{width:"20",height:"20",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"})]}):null,c&&(0,n.jsx)(zs,{id:i})]}))}function Bs({icon:e,onClick:t=()=>{},className:s,loading:a=!1}){return(0,n.jsxs)("div",{className:`wpqt-main-border wpqt-p-1 wpqt-relative wpqt-inline-flex wpqt-cursor-pointer wpqt-bg-gray-100 hover:wpqt-bg-white ${s}`,onClick:t,children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center "+(a?"wpqt-invisible":""),children:e}),a&&(0,n.jsx)(Ls,{width:"20",height:"20",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"})]})}function Hs({modalOpen:e,closeModal:t,children:s,size:a="sm"}){return(0,n.jsxs)(Ns.lG,{open:e,as:"div",className:"wpqt-relative wpqt-z-9999 focus:wpqt-outline-none",onClose:t,children:[(0,n.jsx)(Ns.Xi,{className:"wpqt-fixed wpqt-inset-0 wpqt-bg-black/40"}),(0,n.jsx)("div",{className:"wpqt-fixed wpqt-inset-0 wpqt-z-10 wpqt-w-screen wpqt-overflow-y-auto",children:(0,n.jsx)("div",{className:"wpqt-mt-[8vh] wpqt-flex wpqt-justify-center",children:(0,n.jsxs)(Ns.Lj,{transition:!0,className:`data-[closed]:wpqt-transform-[wpqt-scale(95%)] wpqt-relative wpqt-mt-[20px] wpqt-w-4/5 ${{sm:"wpqt-max-w-sm",md:"wpqt-max-w-lg",lg:"wpqt-max-w-4xl",xl:"wpqt-max-w-6xl"}[a]} wpqt-rounded-xl wpqt-bg-white wpqt-p-8 wpqt-backdrop-blur-2xl wpqt-duration-300 wpqt-ease-out data-[closed]:wpqt-opacity-0`,children:[(0,n.jsx)("div",{className:"wpqt-group wpqt-absolute wpqt-right-[-20px] wpqt-top-[-20px] wpqt-flex wpqt-h-[40px] wpqt-w-[40px] wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-rounded-full wpqt-border wpqt-border-solid wpqt-bg-white wpqt-text-qtBorder",onClick:t,"data-testid":"wpqt-modal-close-button",children:(0,n.jsx)(Ds.A,{className:"wpqt-icon-blue group-hover:wpqt-icon-red wpqt-size-5"})}),s]})})})]})}function Ws({children:e,className:t=""}){return(0,n.jsx)(Ns.L3,{as:"div",className:`wpqt-text-base wpqt-font-semibold wpqt-text-black wpqt-mb-2 ${t}`,children:e})}function Qs({children:e}){return(0,n.jsx)(Os.L,{children:e})}function Ys({label:e,children:t,tooltipId:s,tooltipText:a}){const i=s&&a,o=i?{"data-tooltip-id":s,"data-tooltip-content":a,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info","data-tooltip-place":"top-end"}:{};return(0,n.jsxs)(Cs.D,{className:"wpqt-mb-3",children:[(0,n.jsx)(Is.JU,Object.assign({className:"wpqt-mb-2 wpqt-block wpqt-text-sm/6 wpqt-font-medium"},o,{children:e})),t,i&&(0,n.jsx)(zs,{id:s})]})}function Js({onSave:e,saveBtnText:t,loading:s=!1}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-px-2",children:(0,n.jsx)(Gs,{btnText:t,loading:s,onClick:e})})}!function(e){e.BUTTON="button",e.SUBMIT="submit",e.RESET="reset"}(Fs||(Fs={})),function(e){e.PRIMARY="primary",e.SECONDARY="secondary",e.DANGER="danger"}($s||($s={}));var Xs=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Zs({title:e,description:t,onSave:s,icon:i,saveBtnText:r=(0,o.__)("Clean","quicktask")}){const[c,l]=(0,a.useState)(!1);return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-lg",children:e}),(0,n.jsx)("p",{className:"wpqt-mt-0",children:t}),(0,n.jsx)(Vs,{onClick:()=>Xs(this,void 0,void 0,(function*(){c||(l(!0),yield s(),l(!1))})),icon:i,loading:c,text:r})]})}var ea,ta=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function sa(){const{state:{archiveSettingsModalOpen:e},modalDispatch:t}=(0,a.useContext)(As),{cleanupTaskArchive:s}=ps(),{archiveDispatch:i}=function(){const{archiveDispatch:e}=(0,a.useContext)(vs);return{archiveDispatch:e}}();return(0,n.jsx)(Hs,{modalOpen:e,closeModal:()=>{t({type:de,payload:!1})},size:"md",children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:(0,n.jsx)(Zs,{title:(0,o.__)("Archive cleanup","quicktasker"),description:(0,o.__)("Remote tasks from archive that have no parent board.","quicktasker"),icon:(0,n.jsx)(u.xWQ,{className:"wpqt-size-6"}),onSave:()=>ta(this,void 0,void 0,(function*(){const{success:e,deletedTaskIds:t}=yield s();e&&t.length>0&&i({type:we,payload:t})}))})})})}!function(e){e.SELECTION="select",e.CREATION="create",e.EDIT="edit"}(ea||(ea={}));const aa=(e,t)=>{switch(t.type){case et:return Object.assign(Object.assign({},e),{labels:t.payload});case tt:return Object.assign(Object.assign({},e),{labels:e.labels?[...e.labels,t.payload]:[t.payload],labelActionState:ea.SELECTION});case at:return Object.assign(Object.assign({},e),{labels:e.labels?e.labels.map((e=>e.id===t.payload.id?t.payload:e)):[t.payload]});case st:return Object.assign(Object.assign({},e),{labels:e.labels?e.labels.filter((e=>e.id!==t.payload.id)):[]});case nt:return Object.assign(Object.assign({},e),{labelActionState:ea.SELECTION,labelToEdit:null});case it:return Object.assign(Object.assign({},e),{labelActionState:ea.EDIT,labelToEdit:t.payload});case ot:return Object.assign(Object.assign({},e),{labelActionState:ea.CREATION,labelToEdit:null});case rt:return na;default:return e}},na={labels:null,labelActionState:ea.SELECTION,labelToEdit:null},ia=(0,a.createContext)({state:na,labelDispatch:()=>{}}),oa=({children:e})=>{const[t,s]=(0,a.useReducer)(aa,na);return(0,n.jsx)(ia.Provider,{value:{state:t,labelDispatch:s},children:e})};function ra({children:e}){const{state:{fullPageLoading:t}}=(0,a.useContext)(as);return(0,n.jsx)("div",{className:"wpqt-pr-4",children:t?(0,n.jsx)(Ms,{}):e})}var ca,la=s(4175),da=s(2912);!function(e){e.TEXT="text",e.PASSWORD="password"}(ca||(ca={}));const ua=(0,a.forwardRef)((({value:e,onChange:t,isAutoFocus:s,className:a="",wrapperClassName:i="",disabled:o=!1,type:r=ca.TEXT,loading:c=!1,inputId:l,name:d},u)=>(0,n.jsxs)("div",{className:`wpqt-inline-block wpqt-relative wpqt-mb-3 ${i}`,children:[(0,n.jsx)(da.p,{ref:u,autoFocus:s,className:`wpqt-block wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-3 wpqt-py-1.5 wpqt-text-sm/6 focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${a}`,value:e,disabled:o,onChange:e=>t(e.target.value),type:r,id:l,name:d}),c&&(0,n.jsx)(Ls,{width:"24",height:"24",className:"wpqt-absolute wpqt-right-[-32px] wpqt-top-1/2 wpqt-transform-y-center"})]}))),pa=(e,t)=>{var s;switch(t.type){case j:{const s=t.payload,a=e=>Object.assign({},Xt(e)),n=e=>{var t;return Object.assign(Object.assign({},e),{stages:null===(t=e.stages)||void 0===t?void 0:t.map(a),settings:e.settings?$t(e.settings):void 0,is_primary:"1"===e.is_primary})};return Object.assign(Object.assign({},e),{pipelines:s.map(n)})}case k:{const a=t.payload,n=e=>Object.assign({},Xt(e)),i=Object.assign(Object.assign({},a),{stages:null===(s=a.stages)||void 0===s?void 0:s.map(n),settings:a.settings?$t(a.settings):void 0,is_primary:!1});return Object.assign(Object.assign({},e),{pipelines:[...e.pipelines,i]})}case v:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.map((e=>Object.assign(Object.assign({},e),{is_primary:e.id===s})))})}case g:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.map((e=>e.id===s.id?s:e))})}case T:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.filter((e=>e.id!==s))})}default:return e}},ma={pipelines:[]},ha=(0,a.createContext)({state:ma,pipelinesDispatch:()=>{}}),wa=({children:e})=>{const[t,s]=(0,a.useReducer)(pa,ma);return(0,a.useEffect)((()=>{const e=window.wpqt.initialPipelines;s({type:j,payload:e})}),[]),(0,n.jsx)(ha.Provider,{value:{state:t,pipelinesDispatch:s},children:e})};var fa=s(3482);function qa({options:e,selectedOptionValue:t,onSelectionChange:s,allSelector:a=!0,className:i="",allSelectorLabel:o="All boards",id:r}){return(0,n.jsxs)(fa.l,{id:r,value:t,onChange:e=>{const t=e.target.value;s(t)},className:`!wpqt-rounded-lg !wpqt-border !wpqt-border-solid !wpqt-border-qtBorder !wpqt-px-2 !wpqt-pr-6 !wpqt-py-1 focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${i}`,children:[a&&(0,n.jsx)("option",{value:"",children:o}),e.map((e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value)))]})}function _a({selectedOptionValue:e,selectionChange:t,extraOptions:s=[]}){const{state:{pipelines:i}}=(0,a.useContext)(ha),o=(0,a.useMemo)((()=>i.map((e=>({value:e.id,label:e.name})))),[i]);return(0,n.jsx)(qa,{options:[...o,...s],selectedOptionValue:e,onSelectionChange:t})}function xa({children:e,labelFor:t,className:s=""}){return(0,n.jsx)("label",{className:`wpqt-mb-1 ${s}`,htmlFor:t,children:e})}function ka({children:e,searchChildren:t,applyFilterChildren:s,title:a,childrenClassName:i="",titleClassName:o=""}){return(0,n.jsxs)("div",{className:"wpqt-mb-8",children:[(0,n.jsx)("div",{className:`wpqt-mb-3 wpqt-text-lg wpqt-text-center wpqt-font-semibold ${o}`,children:a}),(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-flex wpqt-items-center wpqt-justify-center wpqt-gap-2",children:t}),(0,n.jsx)("div",{className:`wpqt-flex wpqt-gap-5 wpqt-items-center wpqt-justify-center wpqt-mb-6 ${i}`,children:e}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:s})]})}function ga({children:e,title:t,className:s="",labelIdFor:a}){return(0,n.jsxs)("div",{className:`wpqt-flex wpqt-flex-col ${s}`,children:[(0,n.jsx)(xa,{labelFor:a,children:t}),e]})}function va(){const{state:{archiveSearchValue:e,archiveFilteredPipelineId:t,archiveTaskDoneFilter:s,archivedTaskLimit:i,archiveFilterOrder:r},archiveDispatch:c,fetchAndSetArchivedTasks:l}=(0,a.useContext)(vs),d=(0,n.jsx)(Vs,{text:(0,o.__)("Apply filter","quicktasker"),icon:(0,n.jsx)(la.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:l});return(0,n.jsxs)(ka,{title:(0,o.__)("Archive filtering","quicktasker"),applyFilterChildren:d,searchChildren:(0,n.jsx)(ga,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"archive-search",children:(0,n.jsx)(ua,{inputId:"archive-search",value:e,onChange:e=>{c({type:pe,payload:e})}})}),children:[(0,n.jsx)(ga,{title:(0,o.__)("Task board","quicktasker"),children:(0,n.jsx)(_a,{selectedOptionValue:t,selectionChange:e=>{c({type:me,payload:e})}})}),(0,n.jsx)(ga,{title:(0,o.__)("Task status","quicktasker"),children:(0,n.jsx)(qa,{allSelector:!1,selectedOptionValue:s,options:[{label:(0,o.__)("All","quicktasker"),value:fs.All},{label:(0,o.__)("Completed","quicktasker"),value:fs.Completed},{label:(0,o.__)("Not completed","quicktasker"),value:fs.NotCompleted}],onSelectionChange:e=>{const t=(e=>{switch(e){case fs.All:return fs.All;case fs.Completed:return fs.Completed;case fs.NotCompleted:return fs.NotCompleted;default:throw new Error(`Invalid selection: ${e}`)}})(e);c({type:ke,payload:t})}})}),(0,n.jsx)(ga,{title:(0,o.__)("Number of tasks","quicktasker"),children:(0,n.jsx)(qa,{allSelector:!1,selectedOptionValue:i,options:[{label:(0,o.__)("Show all","quicktasker"),value:_s.ALL},{label:(0,o.__)("Show 100","quicktasker"),value:_s.ONE_HUNDRED},{label:(0,o.__)("Show 200","quicktasker"),value:_s.TWO_HUNDRED},{label:(0,o.__)("Show 500","quicktasker"),value:_s.FIVE_HUNDRED}],onSelectionChange:e=>{c({type:je,payload:e})}})}),(0,n.jsx)(ga,{title:(0,o.__)("Task order","quicktasker"),children:(0,n.jsx)(qa,{allSelector:!1,selectedOptionValue:r,options:[{label:(0,o.__)("Desc","quicktasker"),value:xs.DESC},{label:(0,o.__)("Asc","quicktasker"),value:xs.ASC}],onSelectionChange:e=>{c({type:be,payload:e})}})})]})}const ja=(e,t)=>{switch(t.type){case Ee:{const s=t.payload.map(Wt);return Object.assign(Object.assign({},e),{users:s})}case Te:{const s=t.payload.map((e=>Object.assign(Object.assign({},e),{id:String(e.id)})));return Object.assign(Object.assign({},e),{wpUsers:s})}case Ae:{const s=t.payload,a=Wt(s);return Object.assign(Object.assign({},e),{users:[...e.users,a]})}case Ne:{const s=t.payload,a=Wt(s),n=e.users.map((e=>e.id===a.id?a:e));return Object.assign(Object.assign({},e),{users:n})}case Ce:{const{isActive:s,userId:a}=t.payload,n=e.users.map((e=>e.id===a?Object.assign(Object.assign({},e),{is_active:s}):e));return Object.assign(Object.assign({},e),{users:n})}case Ie:{const s=t.payload,a=e.users.map((e=>e.id===s?Object.assign(Object.assign({},e),{has_password:!1}):e));return Object.assign(Object.assign({},e),{users:a})}case Oe:{const s=t.payload,a=e.users.filter((e=>e.id!==s));return Object.assign(Object.assign({},e),{users:a})}case Se:{const s=t.payload;return Object.assign(Object.assign({},e),{usersSearchValue:s})}default:return e}};var ya=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const ba={users:[],wpUsers:[],usersSearchValue:""},Ea=(0,a.createContext)({state:ba,userDispatch:()=>{},updateUsers:()=>ya(void 0,void 0,void 0,(function*(){}))}),Ta=({children:e})=>{const[t,s]=(0,a.useReducer)(ja,ba);return(0,a.useEffect)((()=>{const e=window.wpqt.initialUsers,t=window.wpqt.initialWPUsers;s({type:Ee,payload:e}),s({type:Te,payload:t})}),[]),(0,n.jsx)(Ea.Provider,{value:{state:t,userDispatch:s,updateUsers:()=>ya(void 0,void 0,void 0,(function*(){try{const e=yield Ot()({path:"/wpqt/v1/users",method:"GET",headers:Ct()});s({type:Ee,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch users","quicktasker"))}}))},children:e})};var Aa;!function(e){e.ACTIVE_PIPELINE="ACTIVE_PIPELINE",e.PIPELINES="PIPELINES",e.USER="USER"}(Aa||(Aa={}));const Sa=e=>{const[t,s]=(0,a.useState)(!1),n=(0,a.useRef)(null),{modalDispatch:i}=(0,a.useContext)(As),{dispatch:o}=(0,a.useContext)(os),{pipelinesDispatch:r}=(0,a.useContext)(ha),{userDispatch:c}=(0,a.useContext)(Ea);return{modalSaving:t,setModalSaving:s,modalContentRef:n,closeModal:()=>{i({type:e}),n.current&&n.current.clearContent()},handleSuccess:(e,t,a)=>{let n;switch(a){case Aa.PIPELINES:n=r;break;case Aa.ACTIVE_PIPELINE:n=o;break;case Aa.USER:n=c;break;default:n=o}s(!1),n({type:e,payload:t})},handleError:e=>{s(!1),console.error(e)}}},Na=(e,t)=>{switch(t.type){case _t:return Object.assign(Object.assign({},e),{uploads:t.payload});case xt:return Object.assign(Object.assign({},e),{uploads:[...e.uploads,t.payload]});case kt:return Object.assign(Object.assign({},e),{uploads:e.uploads.filter((e=>e.id!==t.payload))});default:return e}},Oa={uploads:[]},Ca=(0,a.createContext)({state:Oa,uploadDispatch:()=>{}}),Ia=({children:e})=>{const[t,s]=(0,a.useReducer)(Na,Oa);return(0,n.jsx)(Ca.Provider,{value:{state:t,uploadDispatch:s},children:e})};var Da=s(1489),Pa=s(8448),Ra=s(8176),La=s(1052),Ma=s(4353),Ua=s.n(Ma),Fa=s(4461);function $a(){const[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1);return{loading1:e,loading2:s,setLoading1:t,setLoading2:n,loading3:i,setLoading3:o}}const Ka=(e,t)=>{switch(t.type){case"SET_SITE_URL":{const s=t.payload;return Object.assign(Object.assign({},e),{siteURL:s})}case De:{const{siteURL:s,publicUserPageId:a,timezone:n,isUserAllowedToDelete:i,userPageCustomStyles:o,pluginURL:r,taskUploadsURL:c}=t.payload;return Object.assign(Object.assign({},e),{siteURL:s,publicUserPageId:a,timezone:n,isUserAllowedToDelete:i,userPageCustomStyles:o,pluginURL:r,taskUploadsURL:c})}case Pe:{const s=t.payload;return Object.assign(Object.assign({},e),{userPageCustomStyles:s})}default:return e}},za={siteURL:"",pluginURL:"",publicUserPageId:"",is_customFields:!1,timezone:"",isUserAllowedToDelete:!1,userPageCustomStyles:"",taskUploadsURL:""},Ga=(0,a.createContext)({state:za,appDispatch:()=>{}}),Va=({children:e})=>{const[t,s]=(0,a.useReducer)(Ka,za);return(0,a.useEffect)((()=>{const e=window.wpqt.siteURL,t=window.wpqt.publicUserPageId,a=window.wpqt.timezone,n="1"===window.wpqt.isUserAllowedToDelete,i=window.wpqt.userPageCustomStyles,o=window.wpqt.pluginURL,r=window.wpqt.taskUploadsURL;s({type:De,payload:{siteURL:e,publicUserPageId:t,timezone:a,isUserAllowedToDelete:n,userPageCustomStyles:i,pluginURL:o,taskUploadsURL:r}})}),[]),(0,n.jsx)(Ga.Provider,{value:{state:t,appDispatch:s},children:e})};var Ba=s(8569),Ha=s.n(Ba),Wa=s(3826),Qa=s.n(Wa);Ua().extend(Qa()),Ua().extend(Ha());const Ya=()=>{const{state:{timezone:e}}=(0,a.useContext)(Ga);return{convertToWPTimezone:t=>((e,t)=>{try{return Ua().utc(e).tz(t).format("MMMM D, YYYY HH:mm")}catch(t){return console.error("Error: ",t),e+" (UTC)"}})(t,e),convertUTCDateTimeToWPTimezone:t=>((e,t)=>{try{return Ua().utc(e).tz(t).toDate()}catch(t){return console.error("Error: ",t),new Date(e)}})(t,e)}};var Ja,Xa,Za;!function(e){e.Text="text",e.Select="select",e.Checkbox="checkbox",e.Radio="radio",e.Datetime="datetime",e.File="file"}(Ja||(Ja={})),function(e){e.User="user",e.Pipeline="pipeline",e.Users="users",e.Task="task"}(Xa||(Xa={})),function(e){e.TASK="task"}(Za||(Za={}));var en=s(1062),tn=s(4164);function sn({value:e,onChange:t,rowsCount:s=3,colsCount:a,className:i=""}){return(0,n.jsx)(en.T,{className:(0,tn.$)("wpqt-border-1 wpqt-mb-3 wpqt-block wpqt-w-auto wpqt-resize-none wpqt-rounded-lg wpqt-border-qtBorder wpqt-px-3 wpqt-py-1.5 wpqt-text-sm/6",`focus:wpqt-shadow-none focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${i}`),rows:s,cols:a,value:e,onChange:e=>t(e.target.value)})}var an=s(303);function nn({checked:e,handleChange:t,id:s}){return(0,n.jsx)(an.A,{onChange:t,checked:e,uncheckedIcon:!1,checkedIcon:!1,height:20,width:44,id:s})}const on=(e,t)=>{switch(t.type){case Xe:{const s=t.payload;return Object.assign(Object.assign({},e),{loading:s})}case Ze:{const{entityId:s,entityType:a}=t.payload;return Object.assign(Object.assign({},e),{entityId:s,entityType:a})}case Qe:{const s=t.payload;return Object.assign(Object.assign({},e),{customFields:s})}case Ye:{const s=t.payload;return Object.assign(Object.assign({},e),{customFields:[...e.customFields,s]})}case Je:{const s=t.payload,a=e.customFields.filter((e=>e.id!==s));return Object.assign(Object.assign({},e),{customFields:a})}default:return e}};const rn={customFields:[],loading:!0,entityId:"",entityType:null},cn=(0,a.createContext)({state:rn,customFieldsDispatch:()=>{},fetchCustomFields:()=>{}}),ln=({children:e,entityId:t,entityType:s})=>{const[r,c]=(0,a.useReducer)(on,rn);(0,a.useEffect)((()=>{l()}),[]),(0,a.useEffect)((()=>{c({type:Ze,payload:{entityType:s,entityId:t}})}),[s,t]);const l=()=>{return e=void 0,a=void 0,r=function*(){try{c({type:Xe,payload:!0});const e=yield Mt(t,s,!0);c({type:Qe,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch custom fields","quicktasker"))}finally{c({type:Xe,payload:!1})}},new((n=void 0)||(n=Promise))((function(t,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}c((r=r.apply(e,a||[])).next())}));var e,a,n,r};return(0,n.jsx)(cn.Provider,{value:{state:r,customFieldsDispatch:c,fetchCustomFields:l},children:e})};var dn=s(9197),un=s(2767),pn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function mn(){return{addCustomField:(e,t,s,a,n,r)=>pn(this,void 0,void 0,(function*(){try{const i=yield function(e,t,s,a,n){return Ot()({path:"/wpqt/v1/custom-fields",method:"POST",data:{entityId:e,entityType:t,type:s,name:a,description:n},headers:Ct()})}(e,t,s,a,n);r&&r(i.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add a custom field","quicktasker"))}})),markCustomFieldAsDeleted:(e,t)=>pn(this,void 0,void 0,(function*(){try{yield function(e){return Ot()({path:`/wpqt/v1/custom-fields/${e}`,method:"DELETE",headers:Ct()})}(e),t&&t()}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to mark custom field as deleted","quicktasker"))}})),restoreCustomField:(e,t)=>pn(this,void 0,void 0,(function*(){try{const s=yield function(e){return Ot()({path:`/wpqt/v1/custom-fields/${e}/restore`,method:"PATCH",headers:Ct()})}(e);i.oR.success((0,o.__)("Custom field restored","quicktasker")),t&&t(s.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to restore custom field","quicktasker"))}})),updateCustomFieldValue:(e,t,s,a,n)=>pn(this,void 0,void 0,(function*(){try{yield function(e,t,s,a){return Ot()({path:`/wpqt/v1/custom-fields/${e}/value`,method:"PATCH",data:{value:t,entityId:String(s),entityType:a},headers:Ct()})}(e,t,s,a),i.oR.success((0,o.__)("Custom field value updated","quicktasker")),n&&n()}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to update custom field value","quicktasker"))}}))}}function hn({title:e,description:t,className:s=""}){return(0,n.jsxs)("div",{className:`wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center wpqt-h-full ${s}`,children:[e&&(0,n.jsx)("h2",{className:"wpqt-font-semibold",children:e}),t&&(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-4",children:t}),(0,n.jsx)("div",{className:"wpqt-text-blue-500 wpqt-font-semibold",children:(0,n.jsx)("a",{href:"https://payhip.com/b/84TLC",target:"_blank",rel:"noreferrer",children:(0,o.__)("Get the premium version","quicktasker")})})]})}var wn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function fn({description:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(!1),[d,u]=(0,a.useState)(Ja.Text),{addCustomField:p}=mn(),{state:{entityId:m,entityType:h,customFields:w,loading:f},customFieldsDispatch:q}=(0,a.useContext)(cn),{state:{is_customFields:_}}=(0,a.useContext)(Ga),[x,k]=(0,a.useState)(!1),g=[{value:Ja.Text,label:"Text"},{value:Ja.Checkbox,label:"Checkbox"}],v=w.length>=1&&!_;return f?null:(0,n.jsxs)("div",{className:"wpqt-mb-6 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom Fields","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-text-center",children:[e,!_&&(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[" ",(0,o.__)("Free version allows only one custom field. To add more, please upgrade to premium.","quicktasker")]})]}),c&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(ua,{value:t,onChange:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Description","quicktasker")}),(0,n.jsx)(sn,{value:i,onChange:r})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Type","quicktasker")}),(0,n.jsx)(qa,{selectedOptionValue:d,options:g,onSelectionChange:e=>{u(e)},allSelector:!1})]})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:[!v&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Vs,{text:c?(0,o.__)("Cancel","quicktasker"):(0,o.__)("Add new custom field","quicktasker"),onClick:()=>l(!c),icon:c?(0,n.jsx)(dn.A,{className:"wpqt-icon-red wpqt-size-5"}):(0,n.jsx)(un.A,{className:"wpqt-icon-green wpqt-size-5"})}),c&&(0,n.jsx)(Vs,{text:(0,o.__)("Add","quicktasker"),onClick:()=>wn(this,void 0,void 0,(function*(){m&&h?(k(!0),yield p(m,h,d,t,i,(e=>{q({type:Ye,payload:e}),s(""),r(""),u(Ja.Text),l(!1)})),k(!1)):console.error("Entity ID or Entity Type is missing")})),loading:x,icon:(0,n.jsx)(un.A,{className:"wpqt-icon-green wpqt-size-5"})})]}),v&&(0,n.jsx)(hn,{})]})]})}var qn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function _n({data:e,onSave:t,locationOfCustomFields:s,onDelete:i,actionLoading:r}){const{state:{isUserAllowedToDelete:c}}=(0,a.useContext)(Ga),l=e.entity_type===s,d=s===Xa.Task||s===Xa.User,u=e.entity_type===Xa.Pipeline?"board":e.entity_type;return r?(0,n.jsx)(Us,{ovalSize:"24"}):(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-gap-2",children:[d&&(0,n.jsx)(Gs,{onClick:t,btnText:(0,o.__)("Save","quicktasker")}),c&&(0,n.jsx)(Vs,Object.assign({onClick:()=>qn(this,void 0,void 0,(function*(){l&&i()})),className:l?"":"!wpqt-cursor-not-allowed",icon:(0,n.jsx)(Ra.A,{className:"wpqt-icon-red wpqt-size-4"})},!l&&{tooltipId:`custom-field-${e.id}-delete`,tooltipText:(0,o.sprintf)((0,o.__)("This custom field is inherited from %s settings and can't be deleted here","quicktasker"),u)}))]})}var xn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function kn({data:e}){const[t,s]=(0,a.useState)(""),{state:{entityType:i,entityId:o},customFieldsDispatch:r}=(0,a.useContext)(cn),{updateCustomFieldValue:c,markCustomFieldAsDeleted:l}=mn(),[d,u]=(0,a.useState)(!1);let p;switch((0,a.useEffect)((()=>{e.value&&s(e.value)}),[e.value]),e.type){case Ja.Text:p=(0,n.jsx)(gn,{data:e,value:t,onChange:s});break;case Ja.Checkbox:p=(0,n.jsx)(vn,{data:e,value:t,onChange:s})}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{}),p,(0,n.jsx)(_n,{data:e,locationOfCustomFields:i,onSave:()=>xn(this,void 0,void 0,(function*(){i===Xa.User||i===Xa.Task?(u(!0),yield c(e.id,t,o,i),u(!1)):console.error("Invalid entity type for saving custom field value")})),onDelete:()=>xn(this,void 0,void 0,(function*(){u(!0),yield l(e.id,(()=>{r({type:Je,payload:e.id})})),u(!1)})),actionLoading:d})]})}function gn({data:e,value:t,onChange:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center",children:[(0,n.jsx)(jn,{name:e.name,description:e.description}),(0,n.jsx)(ua,{value:t,onChange:s})]})}function vn({data:e,value:t,onChange:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(jn,{name:e.name,description:e.description}),(0,n.jsx)("input",{type:"checkbox",checked:"true"===t,className:"!wpqt-block",onChange:e=>s(e.target.checked?"true":"false")})]})}function jn({name:e,description:t=""}){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-mb-1 wpqt-text-base wpqt-font-semibold",children:e}),t&&(0,n.jsx)("div",{className:"wpqt-mb-2 wpqt-italic",children:t})]})}function yn(){const{state:{loading:e,customFields:t}}=(0,a.useContext)(cn);return e?(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Ls,{width:"36",height:"36"})}):t&&0===t.length?(0,n.jsx)("div",{className:"wpqt-text-center wpqt-font-semibold",children:(0,o.__)("No related custom fields created","quicktasker")}):(0,n.jsx)("div",{className:"wpqt-my-4 wpqt-grid wpqt-grid-cols-[100px_1fr_100px] wpqt-items-center wpqt-gap-3",children:t.map((e=>(0,n.jsx)(kn,{data:e},e.id)))})}var bn=s(5066);const En={[Xa.Pipeline]:(0,o.__)("Board","quicktasker"),[Xa.Task]:(0,o.__)("Task","quicktasker"),[Xa.User]:(0,o.__)("User","quicktasker"),[Xa.Users]:(0,o.__)("Global users","quicktasker")};var Tn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function An({customField:e,refreshDeletedFields:t}){const{customFieldsDispatch:s}=(0,a.useContext)(cn),[i,r]=(0,a.useState)(!1),{restoreCustomField:c}=mn(),{convertToWPTimezone:l}=Ya();return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Name:","quicktasker")})," ",e.name]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Description:","quicktasker")})," ",e.description]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Level:","quicktasker")})," ",En[e.entity_type]]}),e.deleted_at&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Deleted:","quicktasker")})," ",l(e.deleted_at)]}),(0,n.jsx)("div",{children:(0,n.jsx)(Bs,{onClick:()=>Tn(this,void 0,void 0,(function*(){r(!0),yield c(e.id,(e=>{s({type:Ye,payload:e}),t()})),r(!1)})),loading:i,icon:(0,n.jsx)(bn.HCd,{className:"wpqt-icon-green wpqt-size-5"})})})]})}var Sn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Nn(){const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(!0),[c,l]=(0,a.useState)(null),{state:{entityId:d,entityType:u}}=(0,a.useContext)(cn);(0,a.useEffect)((()=>{e&&p()}),[e]);const p=()=>Sn(this,void 0,void 0,(function*(){if(d&&u)try{r(!0);const e=yield Mt(d,u,!1);l(e.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load deleted custom fields","quicktasker"))}finally{r(!1)}else console.error("Entity ID or Entity Type is missing")}));return(0,n.jsxs)("div",{className:"wpqt-my-3 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom Field recovery","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:(0,o.__)("Deleted custom field by accident? No worries! You can recover it here.","quicktasker")}),e&&(0,n.jsx)("div",{className:"wpqt-mb-3",children:s?(0,n.jsx)(Us,{ovalSize:"36"}):c&&0===c.length?(0,n.jsx)("div",{className:"wpqt-text-center wpqt-font-semibold",children:(0,o.__)("No deleted custom fields","quicktasker")}):c&&c.length>0?(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:c.map((e=>(0,n.jsx)(An,{customField:e,refreshDeletedFields:p},e.id)))}):null}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:(0,n.jsx)(Vs,{text:e?(0,o.__)("Close recovery","quicktasker"):(0,o.__)("Open recovery","quicktasker"),onClick:()=>t(!e),icon:(0,n.jsx)(bn.HCd,{className:"wpqt-icon-green wpqt-size-5"})})})]})}const On={[Xa.User]:(0,o.__)("Add user-specific custom fields. If you want to add custom fields to all users, please go to users settings.","quicktasker"),[Xa.Users]:(0,o.__)("Add custom fields to all users. If you want to add custom fields to a specific user only, please go to that user settings.","quicktasker"),[Xa.Pipeline]:(0,o.__)("Add board level custom fields.","quicktasker"),[Xa.Task]:(0,o.__)("Add task-specific custom fields. If you want to add custom fields to all tasks in this board, please go to board settings.","quicktasker")},Cn={[Xa.User]:(0,o.__)("Custom fields applied to this user, including both user-specific and global users fields.","quicktasker"),[Xa.Users]:(0,o.__)("Global user custom field are applied to all users.","quicktasker"),[Xa.Pipeline]:(0,o.__)("Board level fields are applied to all tasks in this board.","quicktasker"),[Xa.Task]:(0,o.__)("Custom fields applied to this task, including both task-specific and board-level fields.","quicktasker")},In={[Xa.User]:(0,o.__)("User custom fields","quicktasker"),[Xa.Users]:(0,o.__)("Global users custom fields","quicktasker"),[Xa.Pipeline]:(0,o.__)("Board custom fields","quicktasker"),[Xa.Task]:(0,o.__)("Task custom fields","quicktasker")};function Dn({entityId:e,entityType:t}){const s=On[t],a=In[t],i=Cn[t];return(0,n.jsx)("div",{children:(0,n.jsxs)(ln,{entityId:e,entityType:t,children:[(0,n.jsx)("h2",{className:"wpqt-text-center",children:a}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:i}),(0,n.jsx)(yn,{}),(0,n.jsx)(fn,{description:s}),(0,n.jsx)(Nn,{})]})})}function Pn({onConfirm:e,confirmMessage:t=(0,o.__)("Are you sure?","quicktasker"),confirmButtonText:s=(0,o.__)("Yes","quicktasker"),cancelButtonText:i=(0,o.__)("No","quicktasker"),children:r,position:c="bottom",containerClassName:l=""}){const[d,u]=(0,a.useState)(!1),[p,m]=(0,a.useState)(null),h=(0,a.useRef)(null),w=(0,a.useRef)(null),f=d&&null!==p;(0,a.useEffect)((()=>{if(d&&h.current){const e=h.current.getBoundingClientRect(),t=100,s=8;let a=0,n=0;switch(c){case"top":a=e.top-t-s,n=e.left+e.width/2-112;break;case"right":a=e.top,n=e.right+s;break;case"bottom":a=e.bottom+s,n=e.left+e.width/2-112;break;case"left":a=e.top,n=e.left-224-s}a=Math.max(0,a),n=Math.max(0,n),n=Math.min(n,window.innerWidth-224-10),m({top:a,left:n})}}),[d,c]);const q=e=>{null==e||e.stopPropagation(),u(!1)};return(0,a.useEffect)((()=>{if(!f)return;const e=e=>{h.current&&!h.current.contains(e.target)&&w.current&&!w.current.contains(e.target)&&q()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[f]),(0,n.jsxs)("div",{className:`wpqt-relative ${l}`,ref:h,children:[r({onClick:e=>{e.stopPropagation(),e.preventDefault(),u(!0)}}),f&&(0,n.jsx)("div",{ref:w,className:"wpqt-fixed wpqt-z-50",style:{top:`${p.top}px`,left:`${p.left}px`},onClick:e=>e.stopPropagation(),children:(0,n.jsx)("div",{className:"wpqt-origin-top-right wpqt-main-border wpqt-bg-white wpqt-transition",style:{width:"224px"},children:(0,n.jsxs)("div",{className:"wpqt-p-3",children:[(0,n.jsx)("div",{className:"wpqt-text-sm wpqt-mb-2",children:t}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-space-x-2",children:[(0,n.jsx)(Gs,{btnText:i,onClick:q,buttonStyleType:$s.SECONDARY}),(0,n.jsx)(Gs,{btnText:s,onClick:t=>{null==t||t.stopPropagation(),e(),u(!1)},buttonStyleType:$s.DANGER})]})]})})})]})}var Rn=s(5785);function Ln({children:e,inlineStyle:t,className:s=""}){return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-py-1 wpqt-px-2 wpqt-font-semibold wpqt-text-xs wpqt-leading-none wpqt-shopping-tag ${s}`,style:t,children:e})}var Mn=s(2185);function Un({children:e,menuBtn:t,menuBtnClasses:s="",anchor:a="bottom end"}){return(0,n.jsxs)(Mn.W1,{children:[(0,n.jsx)(Mn.IU,{as:"div",className:`wpqt-cursor-pointer ${s}`,onClick:e=>e.stopPropagation(),children:({active:e})=>(0,n.jsx)(n.Fragment,{children:t({active:e})})}),(0,n.jsx)(Mn.c,{anchor:a,transition:!0,className:"wpqt-z-20 wpqt-origin-top wpqt-rounded-xl wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-bg-white wpqt-p-4 wpqt-transition wpqt-duration-200 wpqt-ease-out data-[closed]:wpqt-scale-95 data-[closed]:wpqt-opacity-0",children:e})]})}function Fn({isActive:e,IconComponent:t}){return(0,n.jsx)(t,{className:"wpqt-size-6 wpqt-text-gray-400 hover:wpqt-text-qtBlueHover "+(e?"wpqt-text-qtBlueHover":"")})}function $n({text:e,onClick:t,icon:s,className:a,disabled:i=!1,id:o="",tooltipText:r="",loading:c=!1}){const l=""!==r&&""!==o?{"data-tooltip-id":o,"data-tooltip-content":r,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info"}:{};return(0,n.jsx)(Mn.Dr,{children:(0,n.jsxs)("div",Object.assign({},l,{className:`wpqt-mb-3 wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-relative ${i?"wpqt-cursor-not-allowed wpqt-line-through":"wpqt-cursor-pointer hover:wpqt-underline"} ${a}`,onClick:e=>{!i&&t&&t(e)},children:[s,(0,n.jsx)("span",{className:c?"wpqt-invisible":"",children:e}),c&&(0,n.jsx)(Ls,{width:"16",height:"16",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"}),(0,n.jsx)(zs,{id:o})]}))})}var Kn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};var zn=s(3858);function Gn({labelCreated:e,loading:t=!1}){const{labelDispatch:s}=(0,a.useContext)(ia),[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)("");return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Create new label","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(xa,{labelFor:"new-label-name",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(ua,{value:i,onChange:r,inputId:"new-label-name"})]}),(0,n.jsx)(zn.A,{color:c,disableAlpha:!0,onChange:e=>{l(e.hex)}}),(0,n.jsx)(Gs,{btnText:(0,o.__)("Create","quicktasker"),onClick:()=>{i&&c&&e(i,c)},loading:t}),(0,n.jsx)(Gs,{btnText:(0,o.__)("Cancel","quicktasker"),buttonStyleType:$s.SECONDARY,onClick:()=>{s({type:nt})}})]})}var Vn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Bn({labelToEdit:e,editLabel:t,deleteLabe:s,closeEdit:i=()=>{}}){if(!e)return null;const[r,c]=(0,a.useState)(Object.assign({},e)),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Edit label","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(xa,{labelFor:"edit-label-name",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(ua,{value:r.name,onChange:e=>{c(Object.assign(Object.assign({},r),{name:e}))},inputId:"edit-label-name"})]}),(0,n.jsx)(zn.A,{color:r.color,disableAlpha:!0,onChange:e=>{c(Object.assign(Object.assign({},r),{color:e.hex}))}}),(0,n.jsx)(Gs,{btnText:(0,o.__)("Save","quicktasker"),onClick:()=>Vn(this,void 0,void 0,(function*(){r.name&&r.color&&(d(!0),yield t(r),d(!1))})),loading:l}),(0,n.jsx)(Gs,{btnText:(0,o.__)("Delete","quicktasker"),onClick:()=>Vn(this,void 0,void 0,(function*(){p(!0),yield s(r.id),p(!1)})),loading:u,buttonStyleType:$s.DANGER}),(0,n.jsx)(Gs,{btnText:(0,o.__)("Cancel","quicktasker"),buttonStyleType:$s.SECONDARY,onClick:i})]})}var Hn=s(2601),Wn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Qn({labels:e,title:t,labelSelected:s,labelDeSelection:i,loading:r=!1}){const{labelDispatch:c}=(0,a.useContext)(ia);return e?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-4",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:t}),r?(0,n.jsx)(Us,{ovalSize:"24"}):0===e.length?(0,n.jsx)("div",{className:"wpqt-text-gray-500",children:(0,o.__)("There are no labels created for this board","quicktasker")}):e.map((e=>(0,n.jsx)(Yn,{label:e,labelSelected:s,labelDeSelection:i},e.id))),(0,n.jsx)(Gs,{btnText:(0,o.__)("Create new label","quicktasker"),className:"wpqt-mt-3",buttonStyleType:$s.SECONDARY,onClick:()=>{c({type:ot})}})]}):null}function Yn({label:e,labelSelected:t,labelDeSelection:s}){const{labelDispatch:i}=(0,a.useContext)(ia),[o,r]=(0,a.useState)(e.selected);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-between wpqt-gap-2 wpqt-w-full",children:[(0,n.jsx)("input",{type:"checkbox",checked:o,onChange:a=>Wn(this,void 0,void 0,(function*(){const n=a.target.checked;r(n),n?t(e.id):s(e.id)}))}),(0,n.jsx)(Ln,{inlineStyle:{backgroundColor:e.color},className:"wpqt-py-2",children:e.name}),(0,n.jsx)(Hn.A,{className:"wpqt-size-5 wpqt-icon-green wpqt-cursor-pointer",onClick:()=>{i({type:it,payload:e})}})]})}var Jn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Xn=(0,a.memo)((({task:e,labelSelected:t,labelDeselected:s,labelDeleted:r})=>{const{state:{labels:c,labelActionState:l,labelToEdit:d},labelDispatch:u}=(0,a.useContext)(ia),{archiveDispatch:p}=(0,a.useContext)(vs),{dispatch:m}=(0,a.useContext)(os),[h,w]=(0,a.useState)(!0),[f,q]=(0,a.useState)(!1),{getPipelineLabels:_,createPipelineLabel:x,assignLabelToTask:k,usassignLabelFromTask:g,editLabel:v,deleteLabel:j}=function(){return{deleteLabel:(e,t,s)=>Kn(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return Ot()({path:`/wpqt/v1/pipelines/${e}/labels/${t}`,method:"DELETE",headers:Ct()})}(e,t);i.oR.success((0,o.__)("Label deleted from the board","quicktasker")),s&&s(!0,a.data.deletedLabel)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete label","quicktasker")),s&&s(!1)}})),getPipelineLabels:(e,t)=>Kn(this,void 0,void 0,(function*(){try{const a=yield(s=e,Ot()({path:`/wpqt/v1/pipelines/${s}/labels`,method:"GET",headers:Ct()}));t&&t(!0,a.data.labels)}catch(e){console.error(e),t&&t(!1)}var s})),createPipelineLabel:(e,t,s,a)=>Kn(this,void 0,void 0,(function*(){try{const n=yield function(e,t,s){return Ot()({path:`/wpqt/v1/pipelines/${e}/labels`,method:"POST",headers:Ct(),data:{name:t,color:s}})}(e,t,s);i.oR.success((0,o.__)("Label created successfully","quicktasker")),a&&a(!0,n.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create label","quicktasker")),a&&a(!1)}})),editLabel:(e,t,s)=>Kn(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return Ot()({path:`/wpqt/v1/pipelines/${e}/labels/${t.id}`,method:"PATCH",headers:Ct(),data:{name:t.name,color:t.color}})}(e,t);i.oR.success((0,o.__)("Label updated successfully","quicktasker")),s&&s(!0,a.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to update label","quicktasker")),s&&s(!1)}})),assignLabelToTask:(e,t,s,a)=>Kn(this,void 0,void 0,(function*(){try{const n=yield function(e,t,s){return Ot()({path:`/wpqt/v1/pipelines/${e}/tasks/${t}/labels`,method:"POST",headers:Ct(),data:{labelId:s}})}(e,t,s);i.oR.success((0,o.__)("Label added to task","quicktasker")),a&&a(!0,n.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add label to task","quicktasker")),a&&a(!1)}})),usassignLabelFromTask:(e,t,s,a)=>Kn(this,void 0,void 0,(function*(){try{yield function(e,t,s){return Ot()({path:`/wpqt/v1/pipelines/${e}/tasks/${t}/labels/${s}`,method:"DELETE",headers:Ct()})}(e,t,s),i.oR.success((0,o.__)("Label removed from task","quicktasker")),a&&a(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to remove label from task","quicktasker")),a&&a(!1)}}))}}();(0,a.useEffect)((()=>(Jn(void 0,void 0,void 0,(function*(){w(!0),yield _(e.pipeline_id,((e,t)=>{e&&t&&u({type:et,payload:t})})),w(!1)})),()=>{u({type:rt})})),[]);const y=()=>{const t=e.assigned_labels||[];return(c||[]).map((e=>Object.assign(Object.assign({},e),{selected:t.some((t=>t.id===e.id))})))},b=s=>Jn(void 0,void 0,void 0,(function*(){yield k(e.pipeline_id,e.id,s,((s,a)=>{s&&a&&(m({type:O,payload:{taskId:e.id,label:a}}),p({type:ge,payload:{taskId:e.id,label:a}}),t(a))}))})),E=t=>Jn(void 0,void 0,void 0,(function*(){yield g(e.pipeline_id,e.id,t,(a=>{a&&(m({type:C,payload:{taskId:e.id,labelId:t}}),p({type:ve,payload:{taskId:e.id,labelId:t}}),s(t))}))})),T=(t,s)=>Jn(void 0,void 0,void 0,(function*(){q(!0),yield x(e.pipeline_id,t,s,((e,t)=>{e&&t&&u({type:tt,payload:t})})),q(!1)})),A=t=>Jn(void 0,void 0,void 0,(function*(){yield v(e.pipeline_id,t,((e,t)=>{e&&t&&(u({type:at,payload:t}),m({type:I,payload:{label:t}}))}))})),S=t=>Jn(void 0,void 0,void 0,(function*(){yield j(e.pipeline_id,t,((e,s)=>{e&&s&&(u({type:nt}),u({type:st,payload:s}),m({type:D,payload:t}),r(t))}))}));return(0,n.jsx)("div",{className:"wpqt-min-w-56 wpqt-flex wpqt-flex-col wpqt-gap-4",onClick:e=>e.stopPropagation(),children:(()=>{switch(l){case ea.SELECTION:return(0,n.jsx)(Qn,{title:(0,o.__)("Task label selection","quicktasker"),labels:y(),loading:h,labelSelected:b,labelDeSelection:E});case ea.CREATION:return(0,n.jsx)(Gn,{labelCreated:T,loading:f});case ea.EDIT:return(0,n.jsx)(Bn,{labelToEdit:d,editLabel:A,deleteLabe:S,closeEdit:()=>{u({type:nt})}});default:return null}})()})}));function Zn({task:e,labelSelected:t=()=>{},labelDeselected:s=()=>{},labelDeleted:a=()=>{}}){const i=e.assigned_labels||[],o=Array.isArray(i)&&i.length>0;return(0,n.jsx)(Un,{menuBtnClasses:"wpqt-inline-flex",anchor:"bottom start",menuBtn:()=>(0,n.jsxs)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1.5",children:[(0,n.jsx)(Rn.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`}),o&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-flex-wrap",children:i.map((e=>(0,n.jsx)(Ln,{inlineStyle:{backgroundColor:e.color},children:e.name},e.id)))})]}),children:e&&(0,n.jsx)(Xn,{task:e,labelSelected:t,labelDeselected:s,labelDeleted:a})})}var ei=s(2792),ti=s(6797),si=s(4403);function ai({sectionTitle:e,onItemSelect:t=()=>{},users:s=[],ActionIcon:a=si.A,actionIconClasses:i,noUsersText:o}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2 wpqt-text-lg",children:e}),s.map(((e,s)=>{var o;return(0,n.jsxs)("div",{onClick:s=>{s.stopPropagation(),t(e)},className:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-px-2 wpqt-py-1 hover:wpqt-bg-gray-100",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("div",{children:e.name}),(0,n.jsx)("div",{className:"wpqt-italic",children:e.description}),Ft(e)&&(0,n.jsx)("div",{children:null===(o=e.roles)||void 0===o?void 0:o.join(",")})]}),(0,n.jsx)(a,{className:`wpqt-ml-auto wpqt-size-5 ${i}`})]},s)})),0===s.length&&(0,n.jsx)("div",{children:o})]})}var ni=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ii({task:e,onUserAdd:t,onUserDelete:s}){const{state:{users:r,wpUsers:c}}=(0,a.useContext)(Ea),{handleExecutedAutomations:l}=ds(),{dispatch:d}=(0,a.useContext)(os),[u,p]=(0,a.useState)(!1),m=r.filter((t=>{var s;return!(null!==(s=e.assigned_users)&&void 0!==s?s:[]).some((e=>e.id===t.id))})),h=c.filter((t=>{var s;return!(null!==(s=e.assigned_wp_users)&&void 0!==s?s:[]).some((e=>e.id===t.id))})),w=s=>ni(this,void 0,void 0,(function*(){try{p(!0);const a=s.user_type,n=yield function(e,t,s){return Ot()({path:`/wpqt/v1/users/${e}/tasks/${t}`,method:"POST",data:{user_type:s},headers:Ct()})}(s.id,e.id,a);d({type:y,payload:{taskId:e.id,user:s}}),t(s),l(n.data.executedAutomations,e.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to assign user","quicktasker"))}finally{p(!1)}})),f=t=>ni(this,void 0,void 0,(function*(){try{p(!0);const a=t.user_type,n=yield Lt(t.id,e.id,a);d({type:b,payload:{taskId:e.id,userId:t.id,userType:a}}),s(t),l(n.data.executedAutomations,e.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to remove user","quicktasker"))}finally{p(!1)}}));return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-w-[320px] wpqt-flex-col",children:[(0,n.jsx)(ai,{sectionTitle:(0,o.__)("Assigned quicktaskers","quicktasker"),users:e.assigned_users,onItemSelect:f,ActionIcon:ti.A,actionIconClasses:"wpqt-icon-red",noUsersText:(0,o.__)("No quicktaskers assigned","quicktasker")}),(0,n.jsx)(ai,{sectionTitle:(0,o.__)("Assigned WordPress users","quicktasker"),users:e.assigned_wp_users,onItemSelect:f,ActionIcon:ti.A,actionIconClasses:"wpqt-icon-red",noUsersText:(0,o.__)("No WordPress users assigned","quicktasker")}),(0,n.jsx)(ai,{sectionTitle:(0,o.__)("Assign a quicktasker","quicktasker"),users:m,onItemSelect:w,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No quicktaskers available to assign","quicktasker")}),(0,n.jsx)(ai,{sectionTitle:(0,o.__)("Assign a WordPress user","quicktasker"),users:h,onItemSelect:w,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No WordPress users with required permissions available to assign","quicktasker")}),u&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Ls,{width:"30",height:"30"})})]})}function oi({task:e,onUserAdd:t=()=>{},onUserDelete:s=()=>{},menuBtnClasses:a=""}){const i=[...e.assigned_users||[],...e.assigned_wp_users||[]],o=i.length>0;return(0,n.jsx)(Un,{menuBtnClasses:`wpqt-inline-flex ${a}`,anchor:"bottom start",menuBtn:()=>(0,n.jsxs)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1",children:[(0,n.jsx)(ei.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`}),o&&(0,n.jsx)("div",{children:i.map(((e,t)=>(0,n.jsxs)("span",{children:[e.name,t<i.length-1&&", "]},t)))})]}),children:(0,n.jsx)(ii,{task:e,onUserAdd:t,onUserDelete:s})})}var ri=s(1848);function ci({tabs:e,tabsContent:t,tabClassName:s="",tabListClassName:a=""}){return(0,n.jsxs)(ri.fu,{children:[(0,n.jsx)(ri.wb,{className:`wpqt-mb-6 wpqt-flex wpqt-border-0 wpqt-border-b wpqt-border-solid wpqt-border-b-gray-300 ${a}`,children:e.map((e=>(0,n.jsx)(li,{className:s,children:e},e)))}),(0,n.jsx)(ri.T2,{children:t.map(((e,t)=>(0,n.jsx)(di,{children:e},t)))})]})}function li({children:e,className:t}){return(0,n.jsx)(ri.oz,{as:"div",className:`wpqt-flex-1 wpqt-cursor-pointer wpqt-p-1 wpqt-pb-[10px] wpqt-text-center wpqt-text-lg data-[selected]:wpqt-border-b-2 data-[selected]:wpqt-border-l-0 data-[selected]:wpqt-border-r-0 data-[selected]:wpqt-border-t-0 data-[selected]:wpqt-border-solid data-[selected]:wpqt-border-b-blue-500 ${t}`,children:e})}function di({children:e}){return(0,n.jsx)(ri.Kp,{children:e})}const ui={[ws.Admin]:(0,o.__)("Admin","quicktasker"),[ws.Automation]:(0,o.__)("Automation","quicktasker"),[ws.System]:(0,o.__)("System","quicktasker"),[ws.WPQTUser]:"Quicktasker",[ws.Import]:(0,o.__)("Import","quicktasker")},pi=({log:e,showStatus:t=!1})=>{const{convertToWPTimezone:s}=Ya(),a=ui[e.created_by];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-1",children:e.author_name}),(0,n.jsx)("div",{className:"wpqt-text-center",children:a})]}),(0,n.jsx)("div",{children:s(e.created_at)}),t&&(0,n.jsx)("div",{children:e.log_status}),(0,n.jsx)("div",{children:e.text})]})};function mi({title:e}){return(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-lg wpqt-underline",children:e})}var hi=s(3338),wi=s(3211);const fi={success:"wpqt-bg-green-100 wpqt-border-green-400 wpqt-text-green-700",error:"wpqt-bg-red-100 wpqt-border-red-400 wpqt-text-red-700",warning:"wpqt-bg-yellow-100 wpqt-border-yellow-400 wpqt-text-yellow-700",info:"wpqt-bg-blue-100 wpqt-border-blue-400 wpqt-text-blue-700",primary:"wpqt-bg-gray-100 wpqt-border-gray-400 wpqt-text-gray-700"};function qi({type:e="primary",className:t="",children:s}){const a=fi[e];return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-p-2 wpqt-border wpqt-border-solid wpqt-rounded-md ${a} ${t}`,children:s})}var _i=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function xi({typeId:e,fetchData:t,renderItem:s,noDataMessage:i,explanation:r,onAdd:c=()=>_i(this,void 0,void 0,(function*(){})),enableAdd:l=!1}){const[d,u]=(0,a.useState)(null),[p,m]=(0,a.useState)(""),[h,w]=(0,a.useState)(!0),[f,q]=(0,a.useState)(!1);(0,a.useEffect)((()=>{_()}),[e]);const _=()=>_i(this,void 0,void 0,(function*(){w(!0);const e=yield t();e&&u(e),w(!1)}));return null===d?(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Ls,{width:"30",height:"30"})}):(0,n.jsxs)("div",{children:[r&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(qi,{type:"info",className:"wpqt-mb-3 wpqt-text-center",children:r})}),0===d.length&&(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-text-center",children:i}),(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-mt-3 wpqt-flex wpqt-justify-center",children:(0,n.jsx)(ki,{isLoading:h,refreshComemnts:_})}),l&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-w-2/3 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(sn,{rowsCount:3,value:p,onChange:e=>m(e),className:"wpqt-mb-4 wpqt-w-full"}),(0,n.jsx)(Vs,{text:"Add comment",loading:f,onClick:()=>_i(this,void 0,void 0,(function*(){if(!p)return;q(!0);const e=yield c(p);e&&(u((t=>t?[e,...t]:[e])),m("")),q(!1)})),icon:(0,n.jsx)(hi.A,{className:"wpqt-icon-blue wpqt-size-5"})})]})}),d.length>0&&(0,n.jsxs)("div",{className:"wpqt-mb-[28px] wpqt-mt-[56px] wpqt-logs-grid",children:[(0,n.jsx)(mi,{title:(0,o.__)("Author","quicktasker")}),(0,n.jsx)(mi,{title:(0,o.__)("Date","quicktasker")}),(0,n.jsx)(mi,{title:(0,o.__)("Text","quicktasker")}),d.map((e=>s(e)))]})]})}function ki({isLoading:e,refreshComemnts:t}){return(0,n.jsx)(n.Fragment,{children:e?(0,n.jsx)(Ls,{width:"32",height:"32"}):(0,n.jsx)(wi.A,{className:"wpqt-icon-blue wpqt-size-8 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:t})})}function gi({item:e}){const{convertToWPTimezone:t}=Ya(),s=null===e.author_name&&null===e.author_id;return(0,n.jsxs)(n.Fragment,{children:[!s&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-1",children:e.author_name}),(0,n.jsx)("div",{className:"wpqt-text-center",children:e.is_admin_comment?(0,o.__)("Admin","quicktasker"):(0,o.__)("QuickTasker","quicktasker")})]}),s&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-1",children:(0,o.__)("Unknown","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-text-center",children:(0,o.__)("Author not found","quicktasker")})]}),(0,n.jsx)("div",{children:t(e.created_at)}),(0,n.jsx)("div",{children:e.text})]})}var vi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ji({taskId:e}){return(0,n.jsx)(xi,{typeId:e,fetchData:()=>vi(this,void 0,void 0,(function*(){try{return(yield Rt(e,hs.Task)).data}catch(e){console.error(e),i.oR.error("Failed to get log")}})),renderItem:e=>(0,n.jsx)(pi,{log:e}),noDataMessage:"No logs available",explanation:"Logs can be seen only by WordPress users (with required permissions)"})}var yi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function bi(){return{addComment:(e,t,s,a)=>yi(this,void 0,void 0,(function*(){try{const n=yield Pt(e,t,s,a);return i.oR.success((0,o.__)("Comment added","quicktasker")),n.data.newComment}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add comment","quicktasker"))}}))}}const Ei=e=>Object.assign(Object.assign({},e),{is_admin_comment:"1"===e.is_admin_comment});var Ti=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ai({taskId:e}){const{addComment:t}=bi();return(0,n.jsx)(xi,{typeId:e,fetchData:()=>Ti(this,void 0,void 0,(function*(){try{return(yield Dt(e,hs.Task,!0)).data.map(Ei)}catch(e){console.error(e),i.oR.error("Failed to load comments")}})),onAdd:s=>Ti(this,void 0,void 0,(function*(){const a=yield t(e,hs.Task,!0,s);if(a)return Ei(a)})),renderItem:e=>(0,n.jsx)(gi,{item:e}),noDataMessage:"No comments available",explanation:"Comments that can be added and viewed only by WordPress users (with required permissions).",enableAdd:!0})}var Si=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ni({taskId:e}){const{addComment:t}=bi();return(0,n.jsx)(xi,{typeId:e,fetchData:()=>Si(this,void 0,void 0,(function*(){try{return(yield Dt(e,hs.Task,!1)).data.map(Ei)}catch(e){console.error(e),i.oR.error("Failed to load comments")}})),onAdd:s=>Si(this,void 0,void 0,(function*(){const a=yield t(e,hs.Task,!1,s);if(a)return Ei(a)})),renderItem:e=>(0,n.jsx)(gi,{item:e}),noDataMessage:"No comments available",explanation:"Comments that can be added and viewed by WordPress users (with required permissions) and quicktaskers (in quicktasker user page) who have been assigned to the task.",enableAdd:!0})}function Oi({task:e}){return(0,n.jsx)(ci,{tabs:["Private comments","Public comments","Logs"],tabsContent:[(0,n.jsx)(Ai,{taskId:e.id},1),(0,n.jsx)(Ni,{taskId:e.id},2),(0,n.jsx)(ji,{taskId:e.id},3)]})}var Ci=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ii(){return{getUplaods:(e,t)=>Ci(this,void 0,void 0,(function*(){try{const s=yield function(e,t){const s=new URLSearchParams({entity_id:e,entity_type:t});return Ot()({path:`/wpqt/v1/uploads?${s.toString()}`,method:"GET"})}(e,t);return{data:s.data,error:null}}catch(e){return console.error(e),{data:null,error:e}}})),uploadFile:e=>Ci(this,void 0,void 0,(function*(){try{const t=yield function(e){return Ot()({path:"/wpqt/v1/uploads",method:"POST",body:e})}(e);return i.oR.success((0,o.__)("File uploaded successfully","quicktasker")),{data:t.data,error:null}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to upload a file","quicktasker")),{data:null,error:e}}})),deleteUpload:e=>Ci(this,void 0,void 0,(function*(){try{const t=yield function(e){return Ot()({path:`/wpqt/v1/uploads/${e}`,method:"DELETE"})}(e);return i.oR.success((0,o.__)("File deleted successfully","quicktasker")),{data:t.data,error:null}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to delete a file","quicktasker")),{data:null,error:e}}})),checkFileExists:e=>Ci(this,void 0,void 0,(function*(){try{return(yield fetch(e,{method:"HEAD"})).ok}catch(e){return!1}}))}}var Di=s(2944),Pi=s(4015);function Ri({upload:e,menuBtnClasses:t=""}){const{state:{taskUploadsURL:s}}=(0,a.useContext)(Ga),i=`${s}/${e.upload_uuid}/${e.file_name}`;return(0,n.jsx)(Un,{menuBtnClasses:`wpqt-inline-flex ${t}`,anchor:"top",menuBtn:()=>(0,n.jsx)(Pi.A,{className:"wpqt-size-5 wpqt-icon-blue"}),children:(0,n.jsxs)("div",{children:[(0,n.jsx)(Li,{title:(0,o.__)("File name","quicktasker"),children:e.file_name}),(0,n.jsx)(Li,{title:(0,o.__)("File link","quicktasker"),children:(0,n.jsx)("a",{href:i,target:"_blank",rel:"noreferrer",children:i})}),(0,n.jsx)(Li,{title:(0,o.__)("Created at","quicktasker"),children:e.created_at}),(0,n.jsx)(Li,{title:(0,o.__)("Created by","quicktasker"),children:e.uploader_name})]})})}function Li({title:e,children:t}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-uppercase",children:e}),(0,n.jsx)("div",{children:t})]})}var Mi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ui({upload:e}){const{state:{isUserAllowedToDelete:t,taskUploadsURL:s}}=(0,a.useContext)(Ga),{uploadDispatch:r}=(0,a.useContext)(Ca),[c,l]=(0,a.useState)(!1),{checkFileExists:d,deleteUpload:u}=Ii(),p=`${s}/${e.upload_uuid}/${e.file_name}`,m=(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-4 wpqt-justify-end wpqt-items-center",children:[(0,n.jsx)("a",{href:p,download:!0,onClick:()=>Mi(this,void 0,void 0,(function*(){(yield d(p))||i.oR.error((0,o.__)("File was not found","quicktasker"))})),className:"focus:wpqt-shadow-none",children:(0,n.jsx)(Di.A,{className:"wpqt-icon-blue wpqt-size-5 :hover:wpqt-text-blue-800 wpqt-cursor-pointer"})}),(0,n.jsx)(Ri,{upload:e}),t&&(0,n.jsx)(Ra.A,{className:"wpqt-icon-red wpqt-size-5 :hover:wpqt-text-red-800 wpqt-cursor-pointer",onClick:()=>Mi(this,void 0,void 0,(function*(){l(!0);const{data:t}=yield u(e.id);t&&r({type:kt,payload:e.id}),l(!1)}))})]});return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-main-border wpqt-p-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:e.file_name}),c?(0,n.jsx)(Us,{ovalSize:"22",className:"!wpqt-items-end"}):m]})}var Fi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function $i({entityId:e,entityType:t}){const{uploadDispatch:s}=(0,a.useContext)(Ca),[r,c]=(0,a.useState)(null),[l,d]=(0,a.useState)(!1),{uploadFile:u}=Ii(),p=(0,a.useRef)(null);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsxs)("div",{className:"wpqt-max-w-[300px]",children:[(0,o.sprintf)((0,o.__)("Select file to upload (Max size: %d MB)","quicktasker"),Tt/1024/1024),(0,n.jsx)("br",{}),(0,o.__)("Allowed characters in file name: Latin letters, numbers, underscores, hyphens, and dots.","quicktasker")]}),(0,n.jsx)("input",{type:"file",onChange:e=>{if(e.target.files){const t=e.target.files[0];if(t.size>Tt)return void i.oR.error((0,o.sprintf)((0,o.__)("File size exceeds the maximum limit of %d MB","quicktasker"),Tt));if(!At.test(t.name))return void i.oR.error((0,o.__)("Invalid file name","quicktasker"));if(0===t.size)return void i.oR.error((0,o.__)("The selected file is empty","quicktasker"));c(t)}},ref:p,accept:Et.join(",")}),r&&(0,n.jsx)(Gs,{btnText:(0,o.__)("Upload","quicktasker"),loading:l,onClick:()=>Fi(this,void 0,void 0,(function*(){const a=(()=>{if(!r)return null;const s=new FormData;return s.append("file_to_upload",r),s.append("entity_id",e),s.append("entity_type",t),s})();if(a){d(!0);const{data:e}=yield u(a);e&&(s({type:xt,payload:e.upload}),c(null),p.current&&(p.current.value="")),d(!1)}}))})]})}function Ki({entityId:e,entityType:t}){const{state:{uploads:s},uploadDispatch:r}=(0,a.useContext)(Ca),[c,l]=(0,a.useState)(!0),{getUplaods:d}=Ii(),u=()=>{return s=this,a=void 0,c=function*(){l(!0);const{data:s,error:a}=yield d(e,t);l(!1),s&&s.uploads&&r({type:_t,payload:s.uploads}),a&&i.oR.error((0,o.__)("Failed to fetch uploads","quicktasker"))},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}r((c=c.apply(s,a||[])).next())}));var s,a,n,c};return(0,a.useEffect)((()=>{u()}),[]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)($i,{entityId:e,entityType:t}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-flex-wrap wpqt-items-start",children:c?(0,n.jsx)(Us,{ovalSize:"24"}):s.map((e=>(0,n.jsx)(Ui,{upload:e},e.id)))})]})}var zi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Gi=(0,a.forwardRef)((({taskModalSaving:e,editTask:t,deleteTask:s},i)=>{const{state:{taskToEdit:r,taskModalSettings:c},modalDispatch:l}=(0,a.useContext)(As),{state:{isUserAllowedToDelete:d}}=(0,a.useContext)(Ga),{state:{activePipeline:u},fetchAndSetPipelineData:p}=(0,a.useContext)(os),{archiveDispatch:m}=(0,a.useContext)(vs),[h,w]=(0,a.useState)(""),[f,q]=(0,a.useState)(""),[_,x]=(0,a.useState)(!1),[k,g]=(0,a.useState)(null),[v,j]=(0,a.useState)([]),{archiveTask:y,restoreArchivedTask:b}=ps(),{loading1:E,setLoading1:T,loading2:A,setLoading2:S}=$a(),{convertUTCDateTimeToWPTimezone:N}=Ya(),O=null==r?void 0:r.is_archived,C=null!==(null==r?void 0:r.pipeline_name);(0,a.useEffect)((()=>{if(r){const e=r.due_date?N(r.due_date):null;w(r.name),q(r.description),x(r.free_for_all),g(e),j(r.assigned_labels)}}),[r]);const I=()=>{w(""),q("")};return(0,a.useImperativeHandle)(i,(()=>({clearContent:I}))),r?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsxs)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:[(0,n.jsxs)("div",{className:"wpqt-mb-2 wpqt-grid wpqt-grid-cols-1 wpqt-gap-4 md:wpqt-grid-cols-[1fr_2fr]",children:[(0,n.jsxs)(Qs,{children:[(0,n.jsx)(Ys,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(ua,{isAutoFocus:!0,value:h,onChange:e=>w(e),wrapperClassName:"wpqt-w-full",className:"wpqt-w-full"})}),(0,n.jsx)(Ys,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(sn,{rowsCount:3,value:f,className:"wpqt-w-full",onChange:e=>q(e)})}),(0,n.jsx)(Ys,{label:(0,o.__)("Assigned users","quicktasker"),children:(0,n.jsx)(oi,{task:r,onUserAdd:e=>{l({type:W,payload:e})},onUserDelete:e=>{l({type:Q,payload:e})}})}),(0,n.jsx)(Ys,{label:(0,o.__)("Labels","quicktasker"),children:(0,n.jsx)(Zn,{task:Object.assign(Object.assign({},r),{assigned_labels:v}),labelSelected:e=>{j((t=>[...t,e]))},labelDeselected:e=>{j((t=>t.filter((t=>t.id!==e))))},labelDeleted:e=>{j((t=>t.filter((t=>t.id!==e))))}})}),(0,n.jsx)(Ys,{label:(0,o.__)("Free for all task","quicktasker"),tooltipId:`free-for-all-${r.id}-tooltip`,tooltipText:(0,o.__)("When enabled, all QuickTasker users have the ability to self-assign or unassign this task.","quicktasker"),children:(0,n.jsx)(nn,{checked:_,handleChange:x})}),(0,n.jsx)(Ys,{label:(0,o.__)("Due date","quicktasker"),children:(0,n.jsx)(Fa.A,{onChange:e=>{g(e)},value:k,format:"y-MM-dd HH:mm"})}),c.allowToMarkTaskAsDone&&(0,n.jsx)(Vi,{taskId:r.id,isCompleted:r.is_done})]}),(0,n.jsx)("div",{children:(0,n.jsx)(Dn,{entityId:r.id,entityType:Xa.Task})})]}),(0,n.jsx)("div",{className:"wpqt-mb-4",children:(0,n.jsx)(Js,{onSave:()=>{r&&t(Object.assign(Object.assign({},r),{name:h,description:f,free_for_all:_,due_date:k?Ua()(k).utc().format("YYYY-MM-DD HH:mm:ss"):null}))},saveBtnText:e?(0,o.__)("Saving...","quicktasker"):(0,o.__)("Save","quicktasker")})}),(0,n.jsx)(Ys,{label:(0,o.__)("File attachment","quicktasker"),children:(0,n.jsx)(Ki,{entityId:r.id,entityType:Za.TASK})}),(0,n.jsx)("div",{className:"wpqt-mt-7 md:wpqt-pr-3",children:(0,n.jsx)(Oi,{task:r})})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[O&&C&&(0,n.jsx)(Vs,{icon:(0,n.jsx)(Da.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Restore task","quicktasker"),onClick:()=>{b(r.id,(()=>{l({type:U}),m({type:he,payload:r.id})}))}}),!O&&(0,n.jsx)(Pn,{confirmMessage:(0,o.__)("Are you sure you want to archive this task?","quicktasker"),onConfirm:()=>{S(!0),y(r.id,(()=>{l({type:U}),p(u.id),S(!1)}))},children:({onClick:e})=>(0,n.jsx)(Vs,{icon:(0,n.jsx)(Pa.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("Archive task","quicktasker"),loading:A,onClick:e})}),d&&(0,n.jsx)(Pn,{onConfirm:()=>zi(void 0,void 0,void 0,(function*(){T(!0),yield s(r),l({type:U}),T(!1)})),children:({onClick:e})=>(0,n.jsx)(Vs,{icon:(0,n.jsx)(Ra.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Delete task","quicktasker"),loading:E,onClick:e})})]})]})}):null}));function Vi({isCompleted:e,taskId:t}){const{modalDispatch:s}=(0,a.useContext)(As),{dispatch:i}=(0,a.useContext)(os),[r,c]=(0,a.useState)(!1),{changeTaskDoneStatus:l}=ps();return(0,n.jsx)(Ys,{label:e?(0,o.__)("Task completed","quicktasker"):(0,o.__)("Task not completed","quicktasker"),children:r?(0,n.jsx)(Ls,{width:"24",height:"24"}):(0,n.jsx)(La.A,{onClick:()=>zi(this,void 0,void 0,(function*(){c(!0),yield l(t,!e,(e=>{s({type:E,payload:{done:e}}),i({type:E,payload:{taskId:t,done:e}})})),c(!1)})),className:`wpqt-size-6 ${e?"wpqt-icon-green":"wpqt-text-gray-300"} wpqt-cursor-pointer`})})}var Bi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Hi({editTaskCallback:e,deleteTaskCallback:t}){const{state:{taskModalOpen:s}}=(0,a.useContext)(As),{deleteTask:i}=ps(),{modalSaving:o,setModalSaving:r,modalContentRef:c,closeModal:l,handleSuccess:d,handleError:u}=Sa(U);return(0,n.jsx)(Hs,{modalOpen:s,closeModal:l,size:"xl",children:(0,n.jsx)(Ia,{children:(0,n.jsx)(Gi,{ref:c,editTask:t=>Bi(this,void 0,void 0,(function*(){try{r(!0);const s=yield function(e){return Ot()({path:`/wpqt/v1/tasks/${e.id}`,method:"PATCH",data:{id:e.id,name:e.name,description:e.description,freeForAll:e.free_for_all,dueDate:e.due_date},headers:Ct()})}(t);d(_,s.data,Aa.ACTIVE_PIPELINE),e&&e(s.data)}catch(e){u(e)}})),deleteTask:e=>Bi(this,void 0,void 0,(function*(){i(e.id,(()=>{t&&t(e)}))})),taskModalSaving:o})})})}function Wi({text:e=(0,o.__)("No results found","quicktasker")}){return(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-center wpqt-text-xl",children:e})}var Qi=s(3033),Yi=s(587);function Ji({className:e,onClick:t,title:s,description:a,children:i,dropdown:o,titleClassName:r="",style:c={}}){const l=void 0!==o;return(0,n.jsxs)("div",{className:(0,tn.$)("wpqt-relative wpqt-flex wpqt-flex-col wpqt-rounded wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-p-4",l&&"wpqt-pr-[24px]",e),style:c,onClick:t,children:[(0,n.jsxs)("div",{className:"wpqt-mb-3",children:[(0,n.jsx)("div",{className:`wpqt-text-lg ${r}`,children:s}),a&&(0,n.jsx)("div",{className:"wpqt-italic wpqt-text-gray-500",children:a})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-h-full",children:i}),l&&(0,n.jsx)("div",{className:"wpqt-absolute wpqt-right-2 wpqt-top-1 wpqt-z-10",children:o})]})}var Xi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Zi({task:e,onDoneStatusChange:t,className:s=""}){const{changeTaskDoneStatus:i}=ps(),[o,r]=(0,a.useState)(!1),c=e.is_done,l=s=>Xi(this,void 0,void 0,(function*(){r(!0),yield i(e.id,s,(s=>{t(e.id,s)})),r(!1)}));return o?(0,n.jsx)(Us,{ovalSize:"24",className:"wpqt-mt-auto"}):(0,n.jsx)("div",{className:`wpqt-flex wpqt-justify-center wpqt-mt-auto ${s}`,children:c?(0,n.jsx)(La.A,{className:"wpqt-size-6 wpqt-icon-green",onClick:e=>{e.stopPropagation(),l(!1)}}):(0,n.jsx)(La.A,{className:"wpqt-size-6 wpqt-text-gray-300",onClick:e=>{e.stopPropagation(),l(!0)}})})}function eo({label:e,value:t,valueClassName:s="",valueLink:a,icon:i,onClick:o=()=>{},className:r="",labelClassName:c=""}){return(0,n.jsxs)("div",{className:`wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center ${r}`,onClick:o,children:[i&&i,(0,n.jsx)("div",{className:c,children:t?`${e}:`:e}),(0,n.jsx)("div",{className:`${s}`,children:a?(0,n.jsx)("a",{href:a,target:"_blank",className:"wpqt-text-qtTextBlue wpqt-no-underline",rel:"noreferrer",onClick:e=>e.stopPropagation(),children:t}):t})]})}var to=s(6436),so=s(72),ao=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function no({task:e}){const{state:{isUserAllowedToDelete:t}}=(0,a.useContext)(Ga),{archiveDispatch:s}=(0,a.useContext)(vs),{deleteTask:i,restoreArchivedTask:o}=ps(),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),u=null!==e.pipeline_name;return(0,n.jsxs)(Un,{menuBtn:({active:e})=>(0,n.jsx)(Fn,{isActive:e,IconComponent:to.A}),children:[(0,n.jsx)($n,{text:"View task",icon:(0,n.jsx)(so.A,{className:"wpqt-icon-blue wpqt-size-4"})}),(0,n.jsx)($n,{text:"Restore task",loading:r,icon:(0,n.jsx)(Da.A,{className:"wpqt-icon-green wpqt-size-4"}),disabled:!u,id:`restore-task-${e.id}-dropdown-item`,tooltipText:"Task cannot be restored because the board has been deleted.",onClick:t=>ao(this,void 0,void 0,(function*(){t.stopPropagation(),c(!0),yield o(e.id,(()=>{s({type:he,payload:e.id})})),c(!1)}))}),t&&(0,n.jsx)($n,{text:"Delete",loading:l,icon:(0,n.jsx)(Ra.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>ao(this,void 0,void 0,(function*(){t.stopPropagation(),d(!0),yield i(e.id,(()=>{s({type:he,payload:e.id})})),d(!1)})),className:"!wpqt-mb-0"})]})}function io({task:e}){const{modalDispatch:t}=(0,a.useContext)(As),{archiveDispatch:s}=(0,a.useContext)(vs),{convertToWPTimezone:i}=Ya(),r=e.due_date?i(e.due_date):null;return(0,n.jsxs)(Ji,{title:e.name,description:e.description,dropdown:(0,n.jsx)(no,{task:e}),className:"wpqt-cursor-pointer",onClick:()=>{t({type:M,payload:{taskToEdit:e}})},children:[(0,n.jsx)(eo,{label:(0,o.__)("Board","quicktasker"),value:e.pipeline_name?e.pipeline_name:(0,o.__)("Board is deleted!","quicktasker"),icon:(0,n.jsx)(Qi.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(oi,{menuBtnClasses:"wpqt-self-start",task:e,onUserAdd:t=>{s({type:fe,payload:{taskId:e.id,user:t}})},onUserDelete:t=>{s({type:qe,payload:{taskId:e.id,user:t}})}}),(0,n.jsx)(Zn,{task:e})]}),r&&(0,n.jsx)(eo,{label:(0,o.__)("Due date","quicktasker"),value:r,icon:(0,n.jsx)(Yi.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(Zi,{task:e,onDoneStatusChange:(e,t)=>{s({type:_e,payload:{taskId:e,done:t}})}})]})}function oo(){const{state:{archivedTasks:e,archiveLoading:t}}=(0,a.useContext)(vs);return t?(0,n.jsx)(Us,{className:"wpqt-h-[200px]"}):e&&0===e.length?(0,n.jsx)(Wi,{text:(0,o.__)("No match","quicktasker")}):e?(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"wpqt-card-grid",children:e.map((e=>(0,n.jsx)(io,{task:e},e.id)))})}):null}function ro(){const{archiveDispatch:e}=(0,a.useContext)(vs);return(0,n.jsxs)("div",{children:[(0,n.jsx)(va,{}),(0,n.jsx)(oo,{}),(0,n.jsx)(Hi,{editTaskCallback:t=>{e({type:xe,payload:t})},deleteTaskCallback:t=>{e({type:he,payload:t.id})}})]})}function co(){const{modalDispatch:e}=(0,a.useContext)(As);return(0,n.jsx)(js,{children:(0,n.jsx)(oa,{children:(0,n.jsxs)(ra,{children:[(0,n.jsx)(d,{description:(0,o.__)("Archived tasks management page.","quicktasker"),icon:(0,n.jsx)(l.A,{className:"wpqt-icon-gray wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{e({type:de,payload:!0})}}),children:(0,o.__)("Archive","quicktasker")}),(0,n.jsx)(ro,{}),(0,n.jsx)(sa,{})]})})})}const lo=()=>{const{state:{pluginURL:e}}=(0,a.useContext)(Ga);return(0,n.jsxs)(ra,{children:[(0,n.jsx)(d,{description:(0,o.__)("Reading material about QuickTasker features and usage.","quicktasker"),children:(0,o.__)("Guide","quicktasker")}),(0,n.jsx)("div",{children:(0,n.jsx)("a",{target:"_blank",rel:"noreferrer",href:e+"help/index.html",children:(0,o.__)("View Guide","quicktasker")})})]})},uo=({filterSettings:e,setFilterSettings:t})=>{const{state:{pipelines:s}}=(0,a.useContext)(ha),[i,r]=(0,a.useState)(e),c=(0,n.jsx)(ga,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"log-search",children:(0,n.jsx)(ua,{inputId:"log-search",value:i.search,onChange:e=>{r(Object.assign(Object.assign({},i),{search:e}))}})}),l=(0,n.jsx)(Vs,{text:(0,o.__)("Apply filter","quicktasker"),icon:(0,n.jsx)(la.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:()=>t(i)});return(0,n.jsxs)(ka,{title:(0,o.__)("Logs filtering","quicktasker"),searchChildren:c,applyFilterChildren:l,children:[(0,n.jsx)(ga,{title:(0,o.__)("Type","quicktasker"),children:(0,n.jsx)(qa,{allSelector:!1,selectedOptionValue:i.type,options:[{label:(0,o.__)("All types","quicktasker"),value:po.All},{label:(0,o.__)("Board","quicktasker"),value:po.Pipeline},{label:(0,o.__)("Task","quicktasker"),value:po.Task}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{type:e,typeId:""}))}})}),i.type===po.Pipeline&&(0,n.jsx)(ga,{title:(0,o.__)("Board","quicktasker"),children:(0,n.jsx)(qa,{allSelector:!0,selectedOptionValue:i.typeId,options:s.map((e=>({label:e.name,value:e.id}))),onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{typeId:e}))}})}),(0,n.jsx)(ga,{title:(0,o.__)("Created by","quicktasker"),children:(0,n.jsx)(qa,{allSelector:!1,selectedOptionValue:i.createdBy,options:[{label:(0,o.__)("Everyone","quicktasker"),value:ho.All},{label:(0,o.__)("Admin","quicktasker"),value:ho.Admin},{label:"QuickTasker",value:ho.Quicktasker},{label:(0,o.__)("Automation","quicktasker"),value:ho.Automation},{label:(0,o.__)("Import","quicktasker"),value:ho.Import},{label:(0,o.__)("System","quicktasker"),value:ho.System}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{createdBy:e}))}})}),(0,n.jsx)(ga,{title:(0,o.__)("Number of logs","quicktasker"),children:(0,n.jsx)(qa,{allSelector:!1,selectedOptionValue:i.numberOfLogs,options:[{label:(0,o.__)("Show 100","quicktasker"),value:qo.Hundred},{label:(0,o.__)("Show 200","quicktasker"),value:qo.TwoHundred},{label:"Show 500",value:qo.FiveHundred},{label:"Show all",value:qo.All}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{numberOfLogs:e}))}})}),(0,n.jsx)(ga,{title:(0,o.__)("Order","quicktasker"),children:(0,n.jsx)(qa,{allSelector:!1,selectedOptionValue:i.order,options:[{label:(0,o.__)("Ascending","quicktasker"),value:fo.Asc},{label:(0,o.__)("Descending","quicktasker"),value:fo.Desc}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{order:e}))}})}),(0,n.jsx)(ga,{title:(0,o.__)("Status","quicktasker"),children:(0,n.jsx)(qa,{allSelector:!1,selectedOptionValue:i.status,options:[{label:(0,o.__)("All","quicktasker"),value:_o.All},{label:(0,o.__)("Success","quicktasker"),value:_o.Success},{label:(0,o.__)("Error","quicktasker"),value:_o.Error}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{status:e}))}})})]})};var po,mo,ho;!function(e){e.Pipeline="pipeline",e.Stage="stage",e.Task="task",e.All="all"}(po||(po={})),function(e){e.Success="success",e.Error="error"}(mo||(mo={})),function(e){e.Admin="admin",e.Quicktasker="quicktasker_user",e.Automation="automation",e.Import="import",e.System="system",e.All="all"}(ho||(ho={}));const wo=({logs:e,loading:t})=>t?(0,n.jsx)(Us,{ovalSize:"64",className:"wpqt-mt-12"}):0===e.length?(0,n.jsx)(Wi,{text:(0,o.__)("No logs found","quicktasker")}):(0,n.jsxs)("div",{className:"wpqt-logs-page-grid",children:[(0,n.jsx)(mi,{title:(0,o.__)("Author","quicktasker")}),(0,n.jsx)(mi,{title:(0,o.__)("Created at","quicktasker")}),(0,n.jsx)(mi,{title:(0,o.__)("Status","quicktasker")}),(0,n.jsx)(mi,{title:(0,o.__)("Text","quicktasker")}),e.map((e=>(0,n.jsx)(pi,{log:e,showStatus:!0},e.id)))]});var fo,qo,_o,xo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};!function(e){e.Asc="ASC",e.Desc="DESC"}(fo||(fo={})),function(e){e.Hundred="100",e.TwoHundred="200",e.FiveHundred="500",e.All="all"}(qo||(qo={})),function(e){e.All="all",e.Success="success",e.Error="error"}(_o||(_o={}));const ko=()=>{const[e,t]=(0,a.useState)([]),[s,o]=(0,a.useState)({numberOfLogs:qo.Hundred,type:po.All,typeId:"",createdBy:ho.All,order:fo.Desc,search:"",status:_o.All}),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!0);(0,a.useEffect)((()=>{l&&(u(),d(!1))}),[s,l]);const u=()=>xo(void 0,void 0,void 0,(function*(){try{c(!0);const e=Object.assign({},s);e.numberOfLogs===qo.All&&delete e.numberOfLogs,e.type===po.All&&delete e.type,""===e.typeId&&delete e.typeId,e.createdBy===ho.All&&delete e.createdBy,e.status===_o.All&&delete e.status;const a=yield function(e){const t=new URLSearchParams(Object.entries(e).reduce(((e,[t,s])=>(e[t]=String(s),e)),{}));return Ot()({path:`/wpqt/v1/global-logs?${t.toString()}`,method:"GET",headers:Ct()})}(e);t(a.data)}catch(e){console.error(e),i.oR.error("Failed to fetch logs")}finally{c(!1)}}));return(0,n.jsxs)("div",{children:[(0,n.jsx)(uo,{filterSettings:s,setFilterSettings:e=>xo(void 0,void 0,void 0,(function*(){o(e),d(!0)}))}),(0,n.jsx)(wo,{logs:e,loading:r})]})},go=()=>(0,n.jsxs)(ra,{children:[(0,n.jsx)(d,{description:(0,o.__)("The logs page where you can see all logs and filter them.","quicktasker"),children:(0,o.__)("Logs","quicktasker")}),(0,n.jsx)(ko,{})]});function vo({infoTitle:e,infoDescription:t,infoTitleClick:s,children:a}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-h-screen-minus-top-bar wpqt-items-center wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-1",children:[e&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2 "+(s?"wpqt-cursor-pointer":""),onClick:s||void 0,children:(0,n.jsx)("p",{className:"wpqt-m-0 wpqt-font-semibold wpqt-text-lg",children:e})}),(0,n.jsx)("p",{children:t}),a]})})}function jo({overviewFilter:e,onCreationDateChange:t,onDoneDateChange:s}){const a=e=>e instanceof Date?Ua()(e).format("YYYY-MM-DD"):"";return(0,n.jsx)("div",{children:(0,n.jsxs)(ka,{title:(0,o.__)("Statistics filtering","quicktasker"),titleClassName:"wpqt-text-center",childrenClassName:"wpqt-gap-6 wpqt-justify-center",searchChildren:null,children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:(0,o.__)("Task creation date","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("(Filter tasks that have creation date equal or bigger than)","quicktasker")})]}),(0,n.jsx)(Fa.A,{onChange:e=>{const s=a(e);t(s)},value:e.taskCreationDate,format:"y-MM-dd",id:"taskCreationDate"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:(0,o.__)("Task done date","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("(Filter tasks that have done date equal or smaller than)","quicktasker")})]}),(0,n.jsx)(Fa.A,{onChange:e=>{const t=a(e);s(t)},value:e.taskDoneDate,format:"y-MM-dd",id:"taskCreationDate"})]})]})})}var yo=s(2298);function bo(e){const t=e.slice(1).some((e=>e[1]>0));return e.length>1&&t}function Eo({text:e}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center wpqt-items-center wpqt-h-[400px] wpqt-w-[500px] wpqt-font-semibold",children:e})}function To({pipelineOverviewData:e,options:t,width:s}){var a,i;const r=[["Archived tasks","Task Count"],["Archived tasks",parseInt(null!==(a=null==e?void 0:e.archivedTasksCount)&&void 0!==a?a:"0")||0],["Not archived tasks",parseInt(null!==(i=null==e?void 0:e.notArchivedTasksCount)&&void 0!==i?i:"0")||0]];return bo(r)?(0,n.jsx)(yo.t1,{chartType:"PieChart",data:r,options:Object.assign(Object.assign({},t),{title:"Archived tasks"}),width:s,height:"400px"}):(0,n.jsx)(Eo,{text:(0,o.__)("Not enough data to display archived tasks chart","quicktasker")})}function Ao({pipelineOverviewData:e,options:t,width:s}){var a;const i=[["Stage","Task Count"],...null!==(a=null==e?void 0:e.stages.map((e=>[e.name,parseInt(e.tasksCount)||0])))&&void 0!==a?a:[]];return bo(i)?(0,n.jsx)(yo.t1,{chartType:"PieChart",data:i,options:Object.assign(Object.assign({},t),{title:"Task distribution by stages"}),width:s,height:"400px"}):(0,n.jsx)(Eo,{text:(0,o.__)("Not enough data to display task distribution by stages chart","quicktasker")})}function So({pipelineOverviewData:e,options:t,width:s}){var a,i;const r=[["Task status","Task Count"],["Done",parseInt(null!==(a=null==e?void 0:e.doneTasksCount)&&void 0!==a?a:"0")||0],["Not Done",parseInt(null!==(i=null==e?void 0:e.notDoneTasksCount)&&void 0!==i?i:"0")||0]];return bo(r)?(0,n.jsx)(yo.t1,{chartType:"PieChart",data:r,options:Object.assign(Object.assign({},t),{title:"Task status"}),width:s,height:"400px"}):(0,n.jsx)(Eo,{text:(0,o.__)("Not enough data to display task status chart","quicktasker")})}var No=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Oo={legend:{position:"left",alignment:"center",textStyle:{color:"#233238",fontSize:14}}};function Co({pipeline:e,overviewFilter:t}){const[s,i]=(0,a.useState)(null),[o,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(()=>{No(this,void 0,void 0,(function*(){try{r(!0);const s=yield function(e,t){const s=new URLSearchParams({taskStartDate:t.taskCreationDate||"",taskDoneDate:t.taskDoneDate||"",taskAssignees:t.taskAssignees.join(",")});return Ot()({path:`/wpqt/v1/pipelines/${e}/overview?${s.toString()}`,method:"GET",headers:Ct()})}(e.id,t);i(s.data)}catch(e){console.error(e)}finally{r(!1)}}))})()}),[e.id,t]),o||!s?(0,n.jsx)(Us,{ovalSize:"48"}):(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-wrap wpqt-justify-center xl:wpqt-justify-start",children:[(0,n.jsx)(Ao,{pipelineOverviewData:s,options:Oo,width:"500px"}),(0,n.jsx)(So,{pipelineOverviewData:s,options:Oo,width:"500px"}),(0,n.jsx)(To,{pipelineOverviewData:s,options:Oo,width:"500px"})]})}function Io({pipeline:e}){const[t,s]=(0,a.useState)({taskCreationDate:null,taskDoneDate:null,taskAssignees:[]});return(0,n.jsxs)("div",{children:[(0,n.jsx)(jo,{overviewFilter:t,onCreationDateChange:e=>{s(Object.assign(Object.assign({},t),{taskCreationDate:e}))},onDoneDateChange:e=>{s(Object.assign(Object.assign({},t),{taskDoneDate:e}))}}),(0,n.jsx)(Co,{pipeline:e,overviewFilter:t})]})}function Do(){const{state:{pipelines:e}}=(0,a.useContext)(ha),t=e.map((e=>e.name)),s=e.map((e=>(0,n.jsx)(Io,{pipeline:e},e.id)));return(0,n.jsx)(ra,{children:s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d,{description:(0,o.__)("Get overview of the tasks.","quicktasker"),children:(0,o.__)("Overview","quicktasker")}),(0,n.jsx)(ci,{tabs:t,tabsContent:s,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})]}):(0,n.jsx)(vo,{infoTitle:(0,o.__)("No overview to display","quicktasker"),infoDescription:(0,o.__)("You need to first create a board to see the overview.","quicktasker")})})}function Po(){const{state:{activePipeline:e}}=(0,a.useContext)(os),t=()=>(null==e?void 0:e.stages)||[],s=e=>{const s=t();let a=null;return s?(s.forEach((t=>{t.tasks&&!a&&t.tasks.find((t=>t.id===e))&&(a=t)})),a):null},n=(0,a.useMemo)((()=>{const e=t();return e?e.map((e=>({label:e.name,value:e.id}))):[]}),[e]),i=(0,a.useMemo)((()=>{const e=t(),s=[];return e?(e.forEach((e=>{e.tasks&&s.push(...e.tasks)})),s):s}),[e]),o=null==e?void 0:e.settings;return{getActivePipelineStages:t,getActivePipelinStageTasksLength:e=>{const s=t();if(!s)return 0;const a=s.find((t=>t.id===e));return a&&a.tasks?a.tasks.length:0},getTaskStage:s,getTaskOrderInStage:e=>{const t=s(e);if(!t||!t.tasks)return null;const a=t.tasks.findIndex((t=>t.id===e));return-1!==a?a:null},activePipelineTasks:i,activePipelineSettings:o,isTaskOnLastStage:e=>{const a=t();if(!a)return!1;const n=s(e);if(!n)return!1;const i=a[a.length-1];return n.id===i.id},stageOptions:n}}const Ro=()=>{const{state:{users:e,wpUsers:t}}=(0,a.useContext)(Ea);return{getUser:(s,a)=>a===Nt.QUICKTASKER?e.find((e=>e.id===s)):a===Nt.WP_USER?t.find((e=>e.id===s)):void 0,combinedUsers:(0,a.useMemo)((()=>[...e,...t]),[e,t])}},Lo=(e,t)=>{switch(t.type){case L:{const{id:s,type:a}=t.payload;return Object.assign(Object.assign({},e),{userFilter:{id:s,type:a}})}case R:return Object.assign(Object.assign({},e),{stageIdFilter:t.payload});default:return e}},Mo={stageIdFilter:"",userFilter:{id:null,type:null}},Uo=(0,a.createContext)({state:Mo,taskViewDispatch:()=>{}}),Fo=({children:e})=>{const[t,s]=(0,a.useReducer)(Lo,Mo);return(0,n.jsx)(Uo.Provider,{value:{state:t,taskViewDispatch:s},children:e})};function $o(){const{state:{stageIdFilter:e,userFilter:t},taskViewDispatch:s}=(0,a.useContext)(Uo),{stageOptions:i}=Po(),{combinedUsers:r}=Ro(),c=r.map((e=>({value:`${e.id}:${e.user_type}`,label:`${e.name} (${Yt[e.user_type]})`}))),l=t.id&&t.type?`${t.id}:${t.type}`:"";return(0,n.jsxs)(ka,{title:(0,o.__)("Filter tasks","quicktasker"),searchChildren:null,children:[(0,n.jsx)(ga,{title:(0,o.__)("Stage","quicktasker"),children:(0,n.jsx)(qa,{id:"task-view-stage-filter",allSelectorLabel:(0,o.__)("All stages","quicktasker"),selectedOptionValue:e,options:i,onSelectionChange:e=>{s({type:R,payload:e})}})}),(0,n.jsx)(ga,{title:(0,o.__)("Assigned user","quicktasker"),children:(0,n.jsx)(qa,{id:"task-view-assigned-user-filter",allSelectorLabel:(0,o.__)("All users","quicktasker"),selectedOptionValue:l,options:c,onSelectionChange:e=>{const[t,a]=e.split(":");s({type:L,payload:{id:t,type:a}})}})})]})}var Ko,zo,Go=s(9879),Vo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Bo(e){return e.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"")}function Ho(e){const t=[];let s="",a=!1;for(let n=0;n<e.length;n++){const i=e[n];'"'===i?a&&n+1<e.length&&'"'===e[n+1]?(s+='"',n++):a=!a:","!==i||a?s+=i:(t.push(s.trim()),s="")}return t.push(s.trim()),t}function Wo(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}!function(e){e.ADD_CARD="addCard",e.UPDATE_CARD="updateCard",e.Comment_CARD="commentCard"}(Ko||(Ko={})),function(e){e.TRELLO="TRELLO-IMPORT",e.ASANA="ASANA-IMPORT",e.PIPEDRIVE="PIPEDRIVE-IMPORT",e.QUICKTASKER="QUICKTASKER-IMPORT"}(zo||(zo={}));const Qo={pipelineName:"",pipelineDescription:"",stages:[],tasks:[],labels:[],sourcePipelines:[],taskComments:[]},Yo=e=>{switch(e){case zo.TRELLO:return(0,o.__)("Import from Trello.","quicktasker");case zo.ASANA:return(0,o.__)("Import from Asana.","quicktasker");case zo.PIPEDRIVE:return(0,o.__)("Import from Pipedrive.","quicktasker");case zo.QUICKTASKER:return(0,o.__)("Import from QuickTasker.","quicktasker");default:return(0,o.__)("Select import source","quicktasker")}},Jo=e=>{switch(e){case zo.TRELLO:return(0,o.__)("Export your Trello board as JSON format and use it for import.","quicktasker");case zo.ASANA:return(0,o.__)("Export your Asana project as JSON format and use it for import","quicktasker");case zo.PIPEDRIVE:return(0,o.__)("Export your Pipedrive deals as CSV format and use it for import. Please not that generated CSV file column headers should be in English.","quicktasker");case zo.QUICKTASKER:return(0,o.__)("Import your QuickTasker board from JSON format.","quicktasker");default:return(0,o.__)("Select an import source to get started","quicktasker")}};function Xo({importData:e,importDataFilter:t,selectedImportSource:s,onNameChange:a,onDescriptionChange:i,onImportDataFilterChange:r,validation:c}){const l=s===zo.PIPEDRIVE;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3 wpqt-mb-3",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-1",children:[(0,n.jsx)(Zo,{title:(0,o.__)("Board name","quicktasker")}),(0,n.jsx)(ua,{value:e.pipelineName,onChange:a,wrapperClassName:"wpqt-w-[200px] !wpqt-mb-0",className:"wpqt-w-full wpqt-mb-0"}),c.pipelineNameExists&&(0,n.jsx)("div",{className:"wpqt-text-red-500 wpqt-text-sm",children:(0,o.__)("This board name already exists.","quicktasker")})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-1",children:[(0,n.jsx)(Zo,{title:(0,o.__)("Board description","quicktasker")}),(0,n.jsx)(sn,{value:e.pipelineDescription,onChange:i,rowsCount:2,className:"!wpqt-w-[200px] !wpqt-mb-0"})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-2 wpqt-w-[200px]",children:[(0,n.jsx)(Zo,{title:(0,o.__)("Import archived tasks?","quicktasker")}),(0,n.jsx)(nn,{checked:t.includeArchivedTasks,handleChange:()=>{r(Object.assign(Object.assign({},t),{includeArchivedTasks:!t.includeArchivedTasks}))}})]}),l&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-start wpqt-gap-2 wpqt-w-[200px]",children:[(0,n.jsx)(Zo,{title:(0,o.__)("Filter by source","quicktasker")}),e.sourcePipelines.map((e=>{const s=t.sourcePipelinesFilter.some((t=>t.id===e.id)),a=`source-${e.id}`;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)("label",{htmlFor:a,children:e.name}),(0,n.jsx)("input",{type:"checkbox",value:e.name,id:a,checked:s,onChange:()=>{let a;a=s?t.sourcePipelinesFilter.filter((t=>t.id!==e.id)):[...t.sourcePipelinesFilter,e],r(Object.assign(Object.assign({},t),{sourcePipelinesFilter:a}))}})]},e.id)}))]})]})}function Zo({title:e}){return(0,n.jsx)("div",{className:"wpqt-font-semibold",children:e})}function er({importData:e}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-2",children:[(0,n.jsxs)("div",{children:[(0,o.__)("Number of tasks","quicktasker"),":"," ",(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[e.tasks.length," (",(0,o.__)("archived","quicktasker")," ",e.tasks.filter((e=>e.archived)).length,")"]})]}),(0,n.jsxs)("div",{children:[(0,o.__)("Number of stages","quicktasker"),":"," ",(0,n.jsx)("span",{className:"wpqt-font-semibold",children:e.stages.length})]}),(0,n.jsxs)("div",{children:[(0,o.__)("Number of labels","quicktasker"),":"," ",(0,n.jsx)("span",{className:"wpqt-font-semibold"}),e.labels.length]})]})}var tr=s(1578),sr=s(7613);const ar=s.p+"images/icon-80x80.78f40056.png";function nr({selectedImportSource:e,handleImportSourceChange:t}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(e===zo.TRELLO?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>t(zo.TRELLO),children:(0,n.jsx)(tr.IK4,{className:"wpqt-size-6 wpqt-trello-blue"})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(e===zo.ASANA?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>t(zo.ASANA),children:(0,n.jsx)(bn.OpO,{className:"wpqt-size-6 wpqt-asana-pink"})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(e===zo.PIPEDRIVE?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>t(zo.PIPEDRIVE),children:(0,n.jsx)(sr.nad,{className:"wpqt-size-6 wpqt-pipedrive-green"})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(e===zo.QUICKTASKER?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>t(zo.QUICKTASKER),children:(0,n.jsx)("img",{src:ar,className:"wpqt-size-6"})})]})}const ir={includeArchivedTasks:!0,sourcePipelinesFilter:[]};function or(){const{state:{pipelineImportModalOpen:e},modalDispatch:t}=(0,a.useContext)(As),{pipelinesDispatch:s,checkIfPipelineNameExists:r}=function(){const{state:{pipelines:e},pipelinesDispatch:t}=(0,a.useContext)(ha);return{pipelines:e,pipelinesDispatch:t,checkIfPipelineNameExists:function(t){return e.some((e=>e.name.toLowerCase()===t.toLowerCase()))}}}(),{fetchAndSetPipelineData:c}=(0,a.useContext)(os),[l,d]=(0,a.useState)(zo.TRELLO),[u,p]=(0,a.useState)(null),[m,h]=(0,a.useState)(Object.assign({},ir)),[w,f]=(0,a.useState)(null),[q,_]=(0,a.useState)(!1),x=(0,a.useRef)(null),{importPipeline:g}=function(){return{importPipeline:(e,t)=>Vo(this,void 0,void 0,(function*(){try{const s=yield function(e,t){return Ot()({path:"/wpqt/v1/import",method:"POST",data:{source:e,data:t},headers:Ct()})}(e,t);return{success:!0,data:s.data}}catch(e){return console.error(e),i.oR.error((0,o.__)("Import failed","quicktasker")),{success:!1,error:e}}}))}}(),v=(0,a.useMemo)((()=>!!(null==u?void 0:u.pipelineName)&&r(u.pipelineName)),[null==u?void 0:u.pipelineName]),j=w&&!v,y=()=>{p(null),f(null),h(Object.assign({},ir))};return(0,a.useEffect)((()=>{if(u){const e=Object.assign(Object.assign({},u),{tasks:u.tasks.filter((e=>m.includeArchivedTasks||!e.archived))});m.sourcePipelinesFilter.length>0&&(e.tasks=e.tasks.filter((e=>m.sourcePipelinesFilter.some((t=>e.sourcePipeline&&t.id===e.sourcePipeline.id)))),e.stages=e.stages.filter((e=>m.sourcePipelinesFilter.some((t=>e.sourcePipeline.id===t.id))))),f(e)}}),[u,m]),(0,n.jsx)(Hs,{modalOpen:e,closeModal:()=>{t({type:ie}),y()},children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-4",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Import board","quicktasker")}),(0,n.jsx)(nr,{selectedImportSource:l,handleImportSourceChange:e=>{d(e),y()}}),(0,n.jsxs)("div",{className:"wpqt-text-center wp-mb-4",children:[(0,n.jsx)("p",{className:"wpqt-my-0",children:Yo(l)}),(0,n.jsx)("p",{className:"wpqt-my-0",children:Jo(l)})]}),!u&&(0,n.jsx)(Vs,{text:(0,o.__)("Select import file","quicktasker"),onClick:()=>{x.current&&x.current.click()},icon:(0,n.jsx)(Go.t76,{className:"wpqt-size-5 wpqt-text-blue-500"})}),u&&(0,n.jsx)(Xo,{importData:u,importDataFilter:m,validation:{pipelineNameExists:v},selectedImportSource:l,onNameChange:e=>{p((t=>t?Object.assign(Object.assign({},t),{pipelineName:e}):t))},onDescriptionChange:e=>{p((t=>t?Object.assign(Object.assign({},t),{pipelineDescription:e}):t))},onImportDataFilterChange:h}),w&&(0,n.jsx)(er,{importData:w}),j&&(0,n.jsx)(Vs,{text:(0,o.__)("Start import","quicktasker"),onClick:()=>{return e=this,a=void 0,r=function*(){if(!w||v)return;_(!0);const{data:e}=yield g(l,w);e&&(s({type:k,payload:e.pipeline}),yield c(e.pipeline.id),y(),t({type:ie}),i.oR.success((0,o.__)("Board imported","quicktasker"))),_(!1)},new((n=void 0)||(n=Promise))((function(t,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}c((r=r.apply(e,a||[])).next())}));var e,a,n,r},loading:q}),(0,n.jsx)("input",{type:"file",ref:x,id:"import-upload",className:"wpqt-hidden",accept:(()=>{switch(l){case zo.PIPEDRIVE:return".csv";case zo.TRELLO:case zo.ASANA:case zo.QUICKTASKER:default:return".json"}})(),onChange:e=>{var t,s;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){const e=new FileReader,t=null===(s=a.name.split(".").pop())||void 0===s?void 0:s.toLowerCase();e.onload=e=>{var s,a;try{let n,r;switch(n="csv"===t?function(e){if(!e||"string"!=typeof e)return[];const t=e.split("\n").filter((e=>""!==e.trim()));if(0===t.length)return[];const s=Ho(t[0]).map(Bo),a=[];for(let e=1;e<t.length;e++){const n=Ho(t[e]);if(0===n.length)continue;const i={};for(let e=0;e<s.length;e++)i[s[e]]=e<n.length?n[e]:"";a.push(i)}return a}(null===(s=e.target)||void 0===s?void 0:s.result):JSON.parse(null===(a=e.target)||void 0===a?void 0:a.result),l){case zo.TRELLO:{const e=function(e){if(!e||"object"!=typeof e)return"Import data is missing or not an object";const t=e;if(!t.name)return"Missing board name";if(!t.cards)return"Missing cards array";if(!t.lists)return"Missing lists array";if(!t.labels)return"Missing labels array";if(!Array.isArray(t.cards))return"Cards property is not an array";if(!Array.isArray(t.lists))return"Lists property is not an array";if(!Array.isArray(t.labels))return"Labels property is not an array";if(t.lists.length>0&&!t.lists.some((e=>!e.closed)))return"All lists are closed, at least one open list is required";for(const e of t.cards){if(!e.id)return`Card missing ID: ${JSON.stringify(e).substring(0,100)}...`;if(!e.name)return`Card missing name: ${e.id}`;if(!e.idList)return`Card missing list ID: ${e.id}`;if(!Array.isArray(e.labels))return`Card labels is not an array: ${e.id}`}for(const e of t.lists){if(!e.id)return`List missing ID: ${JSON.stringify(e).substring(0,100)}...`;if(!e.name)return`List missing name: ${e.id}`;if("boolean"!=typeof e.closed)return`List closed status is not boolean: ${e.id}`}for(const e of t.labels){if(!e.id)return`Label missing ID: ${JSON.stringify(e).substring(0,100)}...`;if(!e.name&&""!==e.name)return`Label missing name: ${e.id}`;if(!e.color)return`Label missing color: ${e.id}`}return!0}(n);if(!0!==e)return void i.oR.error(`${(0,o.__)("Invalid Trello import","quicktasker")}: ${e}`);r=function(e){const t=[{name:e.name,id:e.id}],s=e.actions.filter((e=>e.type===Ko.Comment_CARD));return{pipelineName:e.name,pipelineDescription:e.desc,stages:e.lists.filter((e=>!e.closed)).map((t=>({stageName:t.name,stageDescription:"",stageId:t.id,sourcePipeline:{name:e.name,id:e.id}}))),tasks:e.cards.map((t=>{var s,a;return{taskId:t.id,taskName:t.name,taskDescription:"",stageId:t.idList,archived:t.closed,assignedLabels:t.labels.map((e=>({labelName:e.name,labelId:e.id,color:e.color}))),dueDate:t.due?t.due:null,taskCompletedAt:t.dateCompleted?t.dateCompleted:null,taskFocusColor:null!==(a=null===(s=t.cover)||void 0===s?void 0:s.color)&&void 0!==a?a:null,sourcePipeline:{name:e.name,id:e.id}}})),labels:e.labels.map((e=>({labelName:e.name,labelId:e.id,color:e.color}))),sourcePipelines:t,taskComments:s.map((e=>{var t,s,a;return{commentId:e.id,taskId:null!==(s=null===(t=e.data.card)||void 0===t?void 0:t.id)&&void 0!==s?s:"",createdAt:e.date,commentText:null!==(a=e.data.text)&&void 0!==a?a:"",authorId:e.idMemberCreator,isAuthorAdmin:!1,isPrivate:!0}}))}}(n);break}case zo.ASANA:{const e=function(e){if(!e||"object"!=typeof e)return"Import data is missing or not an object";const t=e;if(!t.data)return"Missing data array";if(!Array.isArray(t.data))return"Data property is not an array";if(0===t.data.length)return"Data array is empty";for(const e of t.data){if(!e.gid)return`Task missing GID: ${JSON.stringify(e).substring(0,100)}...`;if(!e.name)return`Task missing name: ${e.gid}`;if("boolean"!=typeof e.completed)return`Task completed status is not boolean: ${e.gid}`;if(!Array.isArray(e.projects))return`Task projects is not an array: ${e.gid}`;if(0===e.projects.length)return`Task has no projects: ${e.gid}`;if(!Array.isArray(e.memberships))return`Task memberships is not an array: ${e.gid}`;if(!Array.isArray(e.tags))return`Task tags is not an array: ${e.gid}`;for(const t of e.projects){if(!t.gid)return`Project missing GID in task ${e.gid}`;if(!t.name)return`Project missing name in task ${e.gid}`}for(const t of e.memberships){if(!t.project)return`Membership missing project in task ${e.gid}`;if(!t.section)return`Membership missing section in task ${e.gid}`;const s=t.project,a=t.section;if(!s.gid)return`Membership project missing GID in task ${e.gid}`;if(!s.name)return`Membership project missing name in task ${e.gid}`;if(!a.gid)return`Membership section missing GID in task ${e.gid}`;if(!a.name)return`Membership section missing name in task ${e.gid}`}for(const t of e.tags){if(!t.gid)return`Tag missing GID in task ${e.gid}`;if(!t.name)return`Tag missing name in task ${e.gid}`}}return!0}(n);if(!0!==e)return void i.oR.error(`${(0,o.__)("Invalid Asana import","quicktasker")}: ${e}`);r=function(e){if(!e.data||0===e.data.length)return Object.assign({},Qo);const t=e.data[0].projects[0].gid,s=e.data[0].projects[0].name,a=new Map,n=new Map,i=[{name:s,id:t}];e.data.forEach((e=>{e.memberships.forEach((e=>{if(e.project.gid===t){const t=e.section;a.has(t.gid)||a.set(t.gid,t)}})),e.tags.forEach((e=>{n.has(e.gid)||n.set(e.gid,e)}))}));const o=Array.from(a.values()).map((e=>({stageId:e.gid,stageName:e.name,stageDescription:"",sourcePipeline:{name:s,id:t}}))),r=Array.from(n.values()).map((e=>({labelId:e.gid,labelName:e.name||"",color:bt}))),c=e.data.map((e=>{var a;const n=e.memberships.find((e=>e.project.gid===t)),i=(null==n?void 0:n.section.gid)||(null===(a=o[0])||void 0===a?void 0:a.stageId)||"";return{taskId:e.gid,taskName:e.name,taskDescription:"",stageId:i,archived:e.completed,dueDate:e.due_at||e.due_on||null,taskCompletedAt:e.completed_at||null,assignedLabels:e.tags.map((e=>({labelName:e.name,labelId:e.gid,color:bt}))),taskFocusColor:null,sourcePipeline:{name:s,id:t}}}));return{pipelineName:s,pipelineDescription:"",stages:o,tasks:c,labels:r,sourcePipelines:i,taskComments:[]}}(n);break}case zo.PIPEDRIVE:{const e=function(e){if(!e||!Array.isArray(e))return"Import data is missing or not an array";if(0===e.length)return"Deals array is empty";for(const t of e){if(!t.title)return`Deal missing title: ${JSON.stringify(t).substring(0,100)}...`;if(!t.stage)return`Deal missing stage: ${t.title||"Unknown"}`;if(!t.status)return`Deal missing status: ${t.title||"Unknown"}`;const e=String(t.status).toLowerCase();if(!["open","won","lost","deleted"].includes(e))return`Invalid deal status: ${e} for deal: ${t.title||"Unknown"}`;if(void 0!==t.label&&null!==t.label&&"string"!=typeof t.label)return`Deal label must be a string: ${t.title||"Unknown"}`;if(void 0!==t.expected_close_date&&null!==t.expected_close_date&&"string"!=typeof t.expected_close_date)return`Deal expected_close_date must be a string or null: ${t.title||"Unknown"}`;if(void 0!==t.deal_closed_on&&null!==t.deal_closed_on&&"string"!=typeof t.deal_closed_on)return`Deal deal_closed_on must be a string or null: ${t.title||"Unknown"}`}const t=new Set;for(const s of e)s.stage&&"string"==typeof s.stage&&t.add(s.stage);return 0!==t.size||"No valid stages found in deals"}(n);if(!0!==e)return void i.oR.error(`${(0,o.__)("Invalid Pipedrive import","quicktasker")}: ${e}`);r=function(e){if(!e)return Object.assign({},Qo);const t=new Map,s=new Map,a=new Map;e.forEach((e=>{e.pipeline&&!a.has(e.pipeline)&&a.set(e.pipeline,{name:e.pipeline,id:Wo()})})),e.forEach((e=>{e.stage&&!t.has(e.stage)&&t.set(e.stage,{stageId:Wo(),stageName:e.stage,stageDescription:"",sourcePipeline:a.get(e.pipeline)||{name:"",id:Wo()}}),e.label&&e.label.split(",").map((e=>e.trim())).filter(Boolean).forEach((e=>{e&&!s.has(e)&&s.set(e,{labelId:Wo(),labelName:e,color:bt})}))}));const n=Array.from(t.values()).map((e=>({stageId:e.stageId,stageName:e.stageName,stageDescription:"",sourcePipeline:{name:e.sourcePipeline.name,id:e.sourcePipeline.id}}))),i=Array.from(s.values()).map((e=>({labelId:e.labelId,labelName:e.labelName,color:e.color}))),o=Array.from(a.values()).map((e=>({name:e.name,id:e.id}))),r=e.map((e=>{var i;const o=t.get(e.stage),r=e.status.toLocaleLowerCase(),c=[];let l=null;if(e.label&&e.label.split(",").map((e=>e.trim())).filter(Boolean).forEach((e=>{const t=s.get(e);t&&c.push({labelId:t.labelId,labelName:t.labelName,color:t.color})})),e.pipeline){const t=a.get(e.pipeline);t&&(l={name:t.name,id:t.id})}return{taskId:e.id,taskName:e.title,taskDescription:"",stageId:o?o.stageId:(null===(i=n[0])||void 0===i?void 0:i.stageId)||"",archived:"lost"===r||"deleted"===r,assignedLabels:c,dueDate:e.expected_close_date||null,taskFocusColor:null,taskCompletedAt:"won"===r&&e.deal_closed_on||null,sourcePipeline:l}}));return{pipelineName:"",pipelineDescription:"",stages:n,tasks:r,labels:i,sourcePipelines:o,taskComments:[]}}(n);break}case zo.QUICKTASKER:{const e=function(e){if(!e||"object"!=typeof e)return"Invalid import data: Not a valid object";const t=e;if(!t.pipelineName)return"Pipeline name is required";if(!Array.isArray(t.stages))return"Stages must be an array";for(let e=0;e<t.stages.length;e++){const s=t.stages[e];if(!s.stageName||"string"!=typeof s.stageName||!s.stageName.trim())return`Stage #${e+1} is missing a name`;if(void 0===s.stageId||null===s.stageId)return`Stage #${e+1} is missing an ID`}if(t.tasks&&Array.isArray(t.tasks))for(let e=0;e<t.tasks.length;e++){const s=t.tasks[e];if(!s.taskName||"string"!=typeof s.taskName||!s.taskName.trim())return`Task #${e+1} is missing a name`;if(void 0===s.stageId||null===s.stageId)return`Task #${e+1} is missing a stage ID`;if(!t.stages.some((e=>e.stageId==s.stageId)))return`Task "${s.taskName}" references a stage ID that does not exist in the import data`;if(s.assignedLabels&&Array.isArray(s.assignedLabels))for(let e=0;e<s.assignedLabels.length;e++){const t=s.assignedLabels[e];if(void 0===t.labelId||null===t.labelId||!t.labelName)return`Task "${s.taskName}" has an invalid label at position ${e+1}`}}if(t.labels&&Array.isArray(t.labels))for(let e=0;e<t.labels.length;e++){const s=t.labels[e];if(!s.labelName||"string"!=typeof s.labelName||!s.labelName.trim())return`Label #${e+1} is missing a name`;if(void 0===s.labelId||null===s.labelId)return`Label #${e+1} is missing an ID`;if(!s.color||"string"!=typeof s.color||!s.color.trim())return`Label "${s.labelName||e+1}" is missing a color`}return!0}(n);if(!0!==e)return void i.oR.error(`${(0,o.__)("Invalid Quicktasker import","quicktasker")}: ${e}`);r=n;break}default:throw new Error("Unsupported import source")}p(r)}catch(e){console.error("Error parsing import file:",e),i.oR.error((0,o.__)("Failed to parse import file","quicktasker"))}},e.readAsText(a)}}})]})})}function rr(){const{state:{moveTaskModalOpen:e,taskToEdit:t},modalDispatch:s}=(0,a.useContext)(As),{dispatch:i}=(0,a.useContext)(os),{getActivePipelineStages:r,getActivePipelinStageTasksLength:c,getTaskStage:l,getTaskOrderInStage:d}=Po(),{moveTask:u}=ps(),[p,m]=(0,a.useState)(0),[w,f]=(0,a.useState)(""),[q,_]=(0,a.useState)(!1),x=c(w),k=Array.from({length:x+1},((e,t)=>({value:t.toString(),label:(t+1).toString()}))),g=r().map((e=>({value:e.id,label:e.name}))),v=()=>{s({type:X})};return(0,a.useEffect)((()=>{if(t){const e=l(t.id),s=d(t.id);e&&null!==s&&(f(e.id),m(s))}}),[t]),(0,n.jsx)(Hs,{modalOpen:e,closeModal:v,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)("h2",{children:(0,o.__)("Change task location on board","quicktasker")}),(0,n.jsx)("label",{htmlFor:"move-task-stage-selection",children:(0,o.__)("Select stage","quicktasker")}),(0,n.jsx)(qa,{id:"move-task-stage-selection",allSelector:!1,selectedOptionValue:w,options:g,onSelectionChange:e=>{f(e),m(0)}}),(0,n.jsx)("label",{htmlFor:"move-task-order-selection",children:(0,o.__)("Select order","quicktasker")}),(0,n.jsx)(qa,{id:"move-task-order-selection",allSelector:!1,selectedOptionValue:String(p),options:k,onSelectionChange:e=>m(Number(e))}),(0,n.jsx)(Gs,{btnText:(0,o.__)("Apply","quicktasker"),loading:q,onClick:()=>{return e=this,s=void 0,n=function*(){if(!t)return;const e=l(t.id),s=d(t.id);e&&null!==s&&(_(!0),yield u(t.id,w,p,(t=>{t&&(i({type:h,payload:{source:{droppableId:e.id,index:s},destination:{droppableId:w,index:p}}}),v())})),_(!1))},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n}})]})})}const cr=(0,a.forwardRef)((({addPipeline:e,modalSaving:t},s)=>{const[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(""),d=()=>{r(""),l("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:d}))),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(Qs,{children:[(0,n.jsx)(Ys,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(ua,{isAutoFocus:!0,value:i,onChange:e=>r(e),className:"wpqt-w-full",wrapperClassName:"wpqt-w-full"})}),(0,n.jsx)(Ys,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(sn,{rowsCount:3,value:c,onChange:e=>l(e),className:"wpqt-w-full"})})]}),(0,n.jsx)(Js,{onSave:()=>{e(i,c)},loading:t,saveBtnText:(0,o.__)("Add board","quicktasker")})]})}));var lr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function dr(){return{deletePipeline:(e,t)=>lr(this,void 0,void 0,(function*(){try{const s=yield function(e){return Ot()({path:`/wpqt/v1/pipelines/${e}`,method:"DELETE",headers:Ct()})}(e);t&&t(s.data.deletedPipelineId,s.data.pipelineIdToLoad)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete board","quicktasker"))}})),addPipeline:(e,t,s,a)=>lr(this,void 0,void 0,(function*(){try{const a=yield(n=e,r=t,Ot()({path:"/wpqt/v1/pipelines",method:"POST",data:{name:n,description:r},headers:Ct()}));i.oR.success((0,o.__)("Board created successfully","quicktasker")),s&&s(a.data)}catch(e){i.oR.error((0,o.__)("Failed to create a board","quicktasker")),a&&a(e)}var n,r})),editPipeline:(e,t,s)=>lr(this,void 0,void 0,(function*(){try{const s=yield function(e){return Ot()({path:`/wpqt/v1/pipelines/${e.id}`,method:"PATCH",data:{name:e.name,description:e.description,is_primary:e.is_primary},headers:Ct()})}(e);i.oR.success((0,o.__)("Board updated successfully","quicktasker")),t&&t(s.data)}catch(e){i.oR.error((0,o.__)("Failed to update board","quicktasker")),s&&s(e)}}))}}function ur(){const{state:{newPipelineModalOpen:e}}=(0,a.useContext)(As),{fetchAndSetPipelineData:t}=(0,a.useContext)(os),{modalSaving:s,setModalSaving:i,modalContentRef:o,closeModal:r,handleSuccess:c,handleError:l}=Sa(V),{addPipeline:d}=dr();return(0,n.jsx)(Hs,{modalOpen:e,closeModal:r,size:"sm",children:(0,n.jsx)(cr,{ref:o,addPipeline:(e,s)=>{return a=this,n=void 0,u=function*(){i(!0),yield d(e,s,(e=>{c(k,e,Aa.PIPELINES),t(e.id),r()}),(e=>{l(e)}))},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{r(u.next(e))}catch(e){t(e)}}function i(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){var a;t.done?e(t.value):(a=t.value,a instanceof o?a:new o((function(e){e(a)}))).then(s,i)}r((u=u.apply(a,n||[])).next())}));var a,n,o,u},modalSaving:s,setModalSaving:i})})}const pr=(0,a.forwardRef)((({editPipeline:e,modalSaving:t},s)=>{const{state:{pipelineToEdit:r},modalDispatch:c}=(0,a.useContext)(As),{fetchAndSetPipelineData:l,dispatch:d}=(0,a.useContext)(os),{pipelinesDispatch:u}=(0,a.useContext)(ha),{deletePipeline:p}=dr(),[m,h]=(0,a.useState)(""),[w,f]=(0,a.useState)(""),{loading1:q,setLoading1:_}=$a();(0,a.useEffect)((()=>{r&&(h(r.name),f(r.description||""))}),[r]);const x=()=>{h(""),f("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:x}))),r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsx)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:(0,n.jsxs)("div",{className:"wpqt-mb-5 wpqt-grid wpqt-grid-cols-1 wpqt-gap-4 md:wpqt-grid-cols-[auto_1fr]",children:[(0,n.jsxs)(Qs,{children:[(0,n.jsx)(Ys,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(ua,{isAutoFocus:!0,value:m,onChange:e=>h(e),className:"wpqt-w-full",wrapperClassName:"wpqt-w-full"})}),(0,n.jsx)(Ys,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(sn,{rowsCount:3,value:w,onChange:e=>f(e)})})]}),(0,n.jsx)(Dn,{entityId:r.id,entityType:Xa.Pipeline})]})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:(0,n.jsx)(Pn,{onConfirm:()=>{r&&(_(!0),p(r.id,((e,t)=>{c({type:V}),_(!1),i.oR.success((0,o.__)("Board deleted","quicktasker")),u({type:T,payload:e}),null!==t?(u({type:v,payload:t}),l(t)):d({type:A})})))},confirmMessage:(0,o.__)("Are you sure you want to delete this board?","quicktasker"),children:({onClick:e})=>(0,n.jsx)(Vs,{icon:(0,n.jsx)(Ra.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:q,text:(0,o.__)("Delete board","quicktasker"),onClick:e})})})]}),(0,n.jsx)(Js,{onSave:()=>{r&&e(Object.assign(Object.assign({},r),{name:m,description:w}))},loading:t,saveBtnText:(0,o.__)("Save","quicktasker")})]}):null}));function mr(){const{state:{pipelineModalOpen:e}}=(0,a.useContext)(As),{modalSaving:t,setModalSaving:s,modalContentRef:i,closeModal:o,handleSuccess:r,handleError:c}=Sa(V),{editPipeline:l}=dr();return(0,n.jsx)(Hs,{modalOpen:e,closeModal:o,size:"xl",children:(0,n.jsx)(pr,{ref:i,editPipeline:e=>{return t=this,a=void 0,i=function*(){s(!0),yield l(e,(e=>{r(g,e,Aa.ACTIVE_PIPELINE)}),(e=>{c(e)}))},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i},modalSaving:t,setModalSaving:s})})}function hr(e){switch(e){case Es.PDF:return(0,o.__)("Export as PDF","quicktasker");case Es.JSON:return(0,o.__)("Export as JSON","quicktasker");default:return(0,o.__)("Export","quicktasker")}}var wr=s(6973);function fr(){const{modalDispatch:e,state:{taskExportModalSettings:t}}=(0,a.useContext)(As);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(t.selectedMethod===Es.PDF?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>e({type:ae,payload:{selectedMethod:Es.PDF}}),"data-testid":"task-export-pdf-icon",children:(0,n.jsx)(tr.uNb,{className:"wpqt-size-5 wpqt-pdf-red"})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-1 wpqt-rounded-lg wpqt-border-none wpqt-cursor-pointer "+(t.selectedMethod===Es.JSON?"wpqt-border wpqt-border-blue-500 !wpqt-border-solid":""),onClick:()=>e({type:ae,payload:{selectedMethod:Es.JSON}}),"data-testid":"task-export-json-icon",children:(0,n.jsx)(wr.Qio,{className:"wpqt-size-5"})})]})}function qr({pipelineId:e}){const{state:{taskExportModalOpen:t,taskExportModalSettings:s},modalDispatch:i}=(0,a.useContext)(As),{state:{siteURL:r}}=(0,a.useContext)(Ga),[c,l]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1);return(0,n.jsx)(Hs,{modalOpen:t,closeModal:()=>{i({type:se})},size:"md",children:(0,n.jsxs)("form",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",action:r,target:"_blank",method:"GET",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Tasks export","quicktasker")}),(0,n.jsx)(fr,{}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(xa,{labelFor:"export-search-filter",children:(0,o.__)("Filter by task name and desription","quicktasker")}),(0,n.jsx)(ua,{value:c,onChange:l,inputId:"export-search-filter",name:"task_search",wrapperClassName:"wpqt-mb-0"})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(xa,{labelFor:"export-include-archive-filter",children:(0,o.__)("Include board archived tasks","quicktasker")}),(0,n.jsx)(nn,{checked:d,handleChange:u,id:"export-include-archive-filter"})]}),(0,n.jsx)(Gs,{btnText:hr(s.selectedMethod),type:Fs.SUBMIT}),e&&(0,n.jsx)("input",{type:"hidden",name:"pipeline_id",value:e}),(0,n.jsx)("input",{type:"hidden",name:"wpqt-page",value:`${s.selectedMethod}-export`}),(0,n.jsx)("input",{type:"hidden",name:"include_archive",value:d?"1":"0"})]})})}var _r=s(9919),xr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const kr=(0,a.forwardRef)((({editStage:e,addStage:t,stageModalSaving:s},i)=>{const{state:{stageToEdit:r}}=(0,a.useContext)(As),[c,l]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),p=!!r;(0,a.useEffect)((()=>{r&&(l(r.name),u(r.description))}),[r]);const m=()=>{l(""),u("")};return(0,a.useImperativeHandle)(i,(()=>({clearContent:m}))),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Ws,{children:p?(0,o.__)("Edit Stage","quicktasker"):(0,o.__)("Add Stage","quicktasker")}),(0,n.jsxs)(Qs,{children:[(0,n.jsx)(Ys,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(ua,{isAutoFocus:!0,value:c,onChange:e=>l(e)})}),(0,n.jsx)(Ys,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(sn,{rowsCount:3,value:d,onChange:e=>u(e)})})]}),(0,n.jsx)(Js,{onSave:()=>{p?e(Object.assign(Object.assign({},r),{name:c,description:d})):t(c,d)},loading:s,saveBtnText:p?(0,o.__)("Save","quicktasker"):(0,o.__)("Add stage","quicktasker")})]})}));var gr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function vr(){const{state:{stageModalOpen:e,targetPipelineId:t}}=(0,a.useContext)(As),{modalSaving:s,setModalSaving:r,modalContentRef:c,closeModal:l,handleSuccess:d,handleError:u}=Sa($),{editStage:p,addStage:m}=function(){return{editStage:(e,t,s)=>xr(this,void 0,void 0,(function*(){try{const s=yield function(e){return Ot()({path:`/wpqt/v1/stages/${e.id}`,method:"PATCH",data:{name:e.name,description:e.description},headers:Ct()})}(e);i.oR.success((0,o.__)("Stage updated successfully","quicktasker")),t&&t(s.data)}catch(e){i.oR.error((0,o.__)("Failed to update stage","quicktasker")),s&&s(e)}})),addStage:(e,t,s,a,n)=>xr(this,void 0,void 0,(function*(){try{const n=yield(r=e,c=t,l=s,Ot()({path:"/wpqt/v1/stages",method:"POST",data:{pipelineId:r,name:c,description:l},headers:Ct()}));i.oR.success((0,o.__)("Stage created successfully","quicktasker")),a&&a(n.data)}catch(e){i.oR.error((0,o.__)("Failed to create stage","quicktasker")),n&&n(e)}var r,c,l}))}}();return(0,n.jsx)(Hs,{modalOpen:e,closeModal:l,children:(0,n.jsx)(kr,{ref:c,editStage:e=>gr(this,void 0,void 0,(function*(){r(!0),yield p(e,(e=>{d(x,e,Aa.ACTIVE_PIPELINE),l()}),(e=>{u(e)}))})),addStage:(e,s)=>gr(this,void 0,void 0,(function*(){try{r(!0),yield m(t,e,s,(e=>{d(f,{stage:Object.assign(Object.assign({},e),{tasks:[]})},Aa.ACTIVE_PIPELINE),l()}))}catch(e){u(e)}})),stageModalSaving:s,stageTaskModalSaving:r})})}var jr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function yr(){const{state:{taskColorModalOpen:e,taskToEdit:t},modalDispatch:s}=(0,a.useContext)(As),{dispatch:i}=(0,a.useContext)(os),{updateTaskFocusColor:r}=ps(),[c,l]=(0,a.useState)(vt),[d,u]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{t&&t.task_focus_color&&l(t.task_focus_color)}),[t]),(0,n.jsx)(Hs,{modalOpen:e,closeModal:()=>{s({type:ee})},size:"sm",children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-4 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Task focus color","quicktasker")}),(0,n.jsx)(zn.A,{color:c||void 0,disableAlpha:!0,onChange:e=>{l(e.hex)}}),(0,n.jsx)(Gs,{btnText:(0,o.__)("Apply changes","quicktasker"),onClick:()=>jr(this,void 0,void 0,(function*(){if(!t)return;u(!0);const{success:e}=yield r(t.id,c);u(!1),e&&i({type:P,payload:{taskId:t.id,color:c}})})),loading:d}),(0,n.jsx)(Gs,{buttonStyleType:$s.DANGER,btnText:(0,o.__)("Reset color","quicktasker"),onClick:()=>{l(vt)}})]})})}var br=s(1609);function Er({pipelineId:e,stagesLength:t=0}){const{modalDispatch:s}=(0,a.useContext)(As),i=()=>{return t=this,a=void 0,i=function*(){s({type:F,payload:{targetPipelineId:e}})},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i};return 0===t?(0,n.jsx)("div",{className:"wpqt-pipeline-height wpqt-flex wpqt-w-full wpqt-items-center wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-main-border wpqt-flex wpqt-cursor-pointer wpqt-flex-col wpqt-items-center wpqt-justify-start wpqt-gap-y-1 wpqt-p-3 hover:wpqt-bg-gray-100",onClick:i,children:[(0,n.jsx)(un.A,{className:"wpqt-size-6 wpqt-text-green-600"}),(0,n.jsx)("div",{className:"wpqt-whitespace-nowrap",children:(0,o.__)("Add first stage","quicktasker")})]})}):(0,n.jsxs)("div",{className:"wpqt-main-border wpqt-mb-3 wpqt-flex wpqt-cursor-pointer wpqt-flex-col wpqt-items-center wpqt-justify-start wpqt-self-start wpqt-p-3 hover:wpqt-bg-gray-100",onClick:i,children:[(0,n.jsx)(un.A,{className:"wpqt-size-6 wpqt-text-green-600"}),(0,n.jsx)("div",{className:"wpqt-whitespace-nowrap",children:(0,o.__)("Add stage","quicktasker")})]})}var Tr=s(5575),Ar=s(6304),Sr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Nr({stage:e}){var t,s,r,c;const{dispatch:d,state:{activePipeline:u},fetchAndSetPipelineData:p}=(0,a.useContext)(os),{modalDispatch:m}=(0,a.useContext)(As),{state:{isUserAllowedToDelete:h}}=(0,a.useContext)(Ga),[w,f]=(0,a.useState)(!1),[_,x]=(0,a.useState)(!1),[k,g]=(0,a.useState)(!1),v=null!==(s=null===(t=null==u?void 0:u.stages)||void 0===t?void 0:t.length)&&void 0!==s?s:0,j=null!==(c=null===(r=e.tasks)||void 0===r?void 0:r.length)&&void 0!==c?c:0,y=+e.stage_order,b=y>0&&y<v,E=y!==v-1,T=t=>Sr(this,void 0,void 0,(function*(){try{f(!0),yield function(e,t){return Ot()({path:`/wpqt/v1/stages/${e}/move`,method:"PATCH",data:{direction:t},headers:Ct()})}(e.id,t),yield p(u.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to move a stage","quicktasker"))}finally{f(!1)}}));return(0,n.jsxs)(Un,{menuBtn:({active:e})=>(0,n.jsx)(Fn,{isActive:e,IconComponent:l.A}),children:[b&&(0,n.jsx)($n,{text:(0,o.__)("Move left","quicktasker"),loading:w,icon:(0,n.jsx)(Tr.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:()=>T("left")}),E&&(0,n.jsx)($n,{text:(0,o.__)("Move right","quicktasker"),loading:w,icon:(0,n.jsx)(Ar.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:()=>T("right")}),(0,n.jsx)($n,{text:(0,o.__)("Edit stage","quicktasker"),icon:(0,n.jsx)(Hn.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:()=>{m({type:K,payload:{stageToEdit:e}})}}),(0,n.jsx)(Pn,{onConfirm:()=>Sr(this,void 0,void 0,(function*(){try{x(!0),yield(t=e.id,Ot()({path:`/wpqt/v1/stages/${t}/archive-tasks`,method:"PATCH",headers:Ct()})),yield p(u.id),i.oR.success((0,o.sprintf)((0,o.__)("Archived all %s tasks","quicktasker"),e.name))}catch(t){console.error(t),i.oR.error((0,o.sprintf)((0,o.__)("Failed to archive stage %s tasks","quicktasker"),e.name))}finally{x(!1)}var t})),confirmMessage:(0,o.__)("Are you sure you want to archive all tasks on the stage?","quicktasker"),children:({onClick:t})=>(0,n.jsx)($n,{text:(0,o.__)("Archive all stage tasks","quicktasker"),icon:(0,n.jsx)(Pa.A,{className:"wpqt-icon-blue wpqt-size-4"}),loading:_,onClick:t,disabled:0===j,id:`item-dropdown-${e.id}-archive`,tooltipText:0===j?(0,o.__)("No tasks to archive on the stage","quicktasker"):void 0})}),h&&(0,n.jsx)($n,{text:(0,o.__)("Delete stage","quicktasker"),icon:(0,n.jsx)(Ra.A,{className:"wpqt-icon-red wpqt-size-4"}),loading:k,onClick:()=>Sr(this,void 0,void 0,(function*(){try{g(!0),yield(t=e.id,Ot()({path:`/wpqt/v1/stages/${t}`,method:"DELETE",data:{stageId:t},headers:Ct()})),d({type:q,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete a stage","quicktasker"))}finally{g(!1)}var t})),disabled:j>0,className:"!wpqt-mb-0",id:`item-dropdown-${e.id}`,tooltipText:j>0?(0,o.__)("Stage can be deleted when there are no tasks on it","quicktasker"):void 0})]})}var Or=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Cr({stageId:e}){const[t,s]=(0,a.useState)(""),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),u=(0,a.useRef)(null),p=(0,a.useRef)(null),{state:{activePipeline:m},dispatch:h}=(0,a.useContext)(os),{handleExecutedAutomations:f}=ds();(0,a.useEffect)((()=>{const e=e=>{"Enter"===e.key&&document.activeElement===p.current&&q()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[t]),(0,a.useEffect)((()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&_()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),(0,a.useEffect)((()=>{var e;r&&(null===(e=p.current)||void 0===e||e.focus())}),[r]);const q=()=>Or(this,void 0,void 0,(function*(){if(t)try{d(!0);const s=yield function(e,t,s){return Ot()({path:"/wpqt/v1/tasks",method:"POST",data:{stageId:e,name:s,pipelineId:t},headers:Ct()})}(e,m.id,t);h({type:w,payload:s.data.newTask}),i.oR.success((0,o.__)("Task created","quicktasker")),_(),f(s.data.executedAutomations,s.data.newTask.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create task","quicktasker"))}finally{d(!1)}else i.oR.error((0,o.__)("Task name is required","quicktasker"))})),_=()=>{c(!1),s("")};return(0,n.jsx)("div",{ref:u,className:"wpqt-sticky wpqt-bottom-0 wpqt-z-10 wpqt-order-1 wpqt-mt-2 wpqt-flex wpqt-justify-center wpqt-bg-gray-100 wpqt-py-2",children:r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-3",children:[(0,n.jsx)(ua,{ref:p,value:t,onChange:e=>s(e),wrapperClassName:"!wpqt-mb-0",className:"!wpqt-mb-0"}),l?(0,n.jsx)(Ls,{width:"24",height:"24"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(dn.A,{className:"wpqt-icon-red wpqt-size-6 wpqt-cursor-pointer",onClick:_}),(0,n.jsx)(un.A,{className:"wpqt-icon-green wpqt-size-6 wpqt-cursor-pointer",onClick:q})]})]}):(0,n.jsxs)("div",{onClick:()=>c(!0),className:"wpqt-main-border wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-p-2 hover:wpqt-bg-white",children:[(0,o.__)("Add task","quicktasker"),(0,n.jsx)(un.A,{className:"wpqt-size-6 wpqt-text-green-600"})]})})}var Ir=s(7959),Dr=s(1735),Pr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Rr({task:e}){const{modalDispatch:t}=(0,a.useContext)(As),{dispatch:s}=(0,a.useContext)(os),{state:{isUserAllowedToDelete:i}}=(0,a.useContext)(Ga),{deleteTask:r,archiveTask:c}=ps(),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1);return(0,n.jsxs)(Un,{menuBtn:({active:e})=>(0,n.jsx)(Fn,{isActive:e,IconComponent:to.A}),children:[(0,n.jsx)(Pn,{confirmMessage:(0,o.__)("Are you sure you want to archive this task?","quicktasker"),onConfirm:()=>Pr(this,void 0,void 0,(function*(){p(!0),c(e.id,(({success:t})=>{t&&s({type:S,payload:e.id}),p(!1)}))})),children:({onClick:e})=>(0,n.jsx)($n,{text:(0,o.__)("Archive task","quicktasker"),icon:(0,n.jsx)(Pa.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:e,loading:u})}),(0,n.jsx)($n,{text:(0,o.__)("Edit task","quicktasker"),icon:(0,n.jsx)(Hn.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:M,payload:{taskToEdit:e}})}}),(0,n.jsx)($n,{text:(0,o.__)("Color","quicktasker"),icon:(0,n.jsx)(Ir.A,{className:"wpqt-icon-orange wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:Z,payload:{task:e}})}}),(0,n.jsx)($n,{text:(0,o.__)("Move task","quicktasker"),icon:(0,n.jsx)(Dr.zhn,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:J,payload:{task:e}})}}),i&&(0,n.jsx)(Pn,{onConfirm:()=>Pr(this,void 0,void 0,(function*(){d(!0),yield r(e.id,(({success:t})=>{t&&s({type:S,payload:e.id}),d(!1)}))})),confirmMessage:(0,o.__)("Are you sure you want to delete this task?","quicktasker"),confirmButtonText:(0,o.__)("Delete","quicktasker"),children:({onClick:e})=>(0,n.jsx)($n,{text:(0,o.__)("Delete task","quicktasker"),icon:(0,n.jsx)(Ra.A,{className:"wpqt-icon-red wpqt-size-4"}),loading:l,onClick:e,className:"!wpqt-mb-0"})})]})}function Lr({task:e}){const{convertToWPTimezone:t}=Ya();return e.due_date?(0,n.jsxs)("div",{className:"wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(Yi.A,{className:`wpqt-size-5 ${function(e){const t=function(e,t){const s=new Date(e),a=new Date(t).getTime()-s.getTime(),n=Math.floor(a/1e3),i=Math.floor(n/60),o=Math.floor(i/60);return{milliseconds:a,seconds:n,minutes:i,hours:o,days:Math.floor(o/24)}}(Ua()().utc().format("YYYY-MM-DD HH:mm:ss"),e);return t.milliseconds<0?"wpqt-text-red-600":t.hours<24?"wpqt-text-amber-500":t.hours<72?"wpqt-text-yellow-500":"wpqt-icon-blue"}(e.due_date)}`}),(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[(0,o.__)("Due date","quicktasker"),":"]}),t(e.due_date)]}):null}var Mr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ur({task:e,allowToMarkTaskAsDone:t}){const{dispatch:s}=(0,a.useContext)(os),{changeTaskDoneStatus:i}=ps(),[o,r]=(0,a.useState)(!1),c=e.is_done,l=t=>Mr(this,void 0,void 0,(function*(){r(!0),yield i(e.id,t,(t=>{s({type:E,payload:{taskId:e.id,done:t}})})),r(!1)}));return t?o?(0,n.jsx)(Us,{ovalSize:"24"}):(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:c?(0,n.jsx)(La.A,{className:"wpqt-size-6 wpqt-icon-green hover:wpqt-icon-gray",onClick:e=>{e.stopPropagation(),l(!1)}}):(0,n.jsx)(La.A,{className:"wpqt-size-6 wpqt-icon-gray hover:wpqt-icon-green",onClick:e=>{e.stopPropagation(),l(!0)}})}):null}function Fr({task:e,index:t,onLastStage:s}){const{modalDispatch:i}=(0,a.useContext)(As),{state:{activePipeline:o}}=(0,a.useContext)(os),r=!(null==o?void 0:o.settings).allow_only_last_stage_task_done||s,c=()=>{i({type:M,payload:{taskToEdit:e,taskModalSettings:{allowToMarkTaskAsDone:r}}})},l=e.task_focus_color?{borderTopColor:e.task_focus_color,borderTopWidth:jt,borderTopStyle:yt}:{};return(0,n.jsx)(_r.sx,{draggableId:e.id,index:t,children:t=>(0,n.jsx)("div",Object.assign({ref:t.innerRef},t.draggableProps,t.dragHandleProps,{children:(0,n.jsxs)("div",{className:"wpqt-relative wpqt-mx-4 wpqt-mb-2 wpqt-flex !wpqt-cursor-pointer wpqt-flex-col wpqt-gap-1 wpqt-rounded wpqt-border wpqt-border-gray-200 wpqt-bg-white wpqt-p-3 wpqt-shadow hover:wpqt-shadow-md",style:l,onClick:c,children:[(0,n.jsx)("div",{className:"wpqt-absolute wpqt-right-[12px] wpqt-top-[12px]",children:(0,n.jsx)(Rr,{task:e})}),(0,n.jsx)("div",{className:"wpqt-text-base",children:e.name}),e.description&&(0,n.jsx)("div",{className:"wpqt-text-sm wpqt-italic",children:e.description}),(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(oi,{task:e}),(0,n.jsx)(Zn,{task:e})]}),(0,n.jsx)(Lr,{task:e}),(0,n.jsx)(Ur,{task:e,allowToMarkTaskAsDone:r})]})}))},e.id)}function $r({tasks:e}){const t=e.length;return(0,n.jsx)("span",{className:"wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-1 wpqt-text-xs",children:t})}function Kr({stage:e,isLastStage:t}){return(0,n.jsxs)("div",{"data-stage-id":e.id,className:"wpqt-relative wpqt-mb-3 wpqt-flex wpqt-max-h-full wpqt-w-[360px] wpqt-flex-none wpqt-flex-col wpqt-overflow-hidden wpqt-rounded-md wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-bg-gray-100",children:[(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-flex wpqt-flex-wrap wpqt-items-center wpqt-gap-1 wpqt-px-4 wpqt-pt-3",children:[(0,n.jsxs)("div",{className:"wpqt-mr-auto wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-text-base wpqt-leading-none",children:[e.name," ",(0,n.jsx)($r,{tasks:e.tasks})]}),(0,n.jsx)(Nr,{stage:e}),e.description&&(0,n.jsx)("div",{className:"wpqt-w-full wpqt-flex-shrink-0 wpqt-flex-grow-0 wpqt-text-sm",children:e.description})]}),(0,n.jsx)(_r.gL,{droppableId:e.id,children:s=>{var a;return(0,n.jsxs)("div",{ref:s.innerRef,className:"wpqt-flex wpqt-h-full wpqt-flex-col wpqt-overflow-y-auto wpqt-overflow-x-hidden",children:[null===(a=e.tasks)||void 0===a?void 0:a.map(((e,s)=>(0,n.jsx)(Fr,{task:e,index:s,onLastStage:t},e.id))),s.placeholder,(0,n.jsx)(Cr,{stageId:e.id})]})}})]})}const zr=()=>{var e,t;const{state:{activePipeline:s},dispatch:r,fetchAndSetPipelineData:c}=(0,a.useContext)(os),{isTabVisible:l}=(()=>{const[e,t]=(0,br.useState)(!document.hidden);return(0,br.useEffect)((()=>{const e=()=>{t(!document.hidden)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),{isTabVisible:e}})(),{modalDispatch:d}=(0,a.useContext)(As);(0,a.useEffect)((()=>{const e=setInterval((()=>{s&&l&&c(s.id)}),3e4);return()=>clearInterval(e)}),[s,l]);const u=(e,t)=>{e.droppableId===t.droppableId?r({type:"REORDER_TASK",payload:{source:e,destination:t}}):r({type:h,payload:{source:e,destination:t}})},p=(0,a.useCallback)((e=>{return t=void 0,s=void 0,n=function*(){const{source:t,destination:s,draggableId:a}=e;if(s){u(t,s);try{yield It(a,s.droppableId,s.index)}catch(e){console.error(e),u(s,t),i.oR.error((0,o.__)("Failed to move a task","quicktasker"))}}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n}),[s]);return s?(0,n.jsxs)("div",{className:"wpqt-pipeline-height wpqt-flex wpqt-gap-[24px] wpqt-overflow-x-auto wpqt-overflow-y-hidden",children:[(0,n.jsx)(_r.JY,{onDragEnd:p,children:null===(e=s.stages)||void 0===e?void 0:e.map(((e,t)=>{const a=t===s.stages.length-1;return(0,n.jsx)(Kr,{stage:e,isLastStage:a},e.id)}))}),(0,n.jsx)(Er,{pipelineId:s.id,stagesLength:null===(t=s.stages)||void 0===t?void 0:t.length}),(0,n.jsx)(Hi,{deleteTaskCallback:()=>{s&&c(s.id)}}),(0,n.jsx)(yr,{}),(0,n.jsx)(vr,{})]}):(0,n.jsx)(vo,{infoDescription:(0,o.__)("No boards found. Start by creating a board to organize and manage your tasks effectively.","quicktasker"),children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(Vs,{text:(0,o.__)("Create a new board","quicktasker"),icon:(0,n.jsx)(un.A,{className:"wpqt-size-6 wpqt-icon-green"}),onClick:()=>{d({type:z})}}),(0,n.jsx)("span",{children:(0,o.__)("or","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-blue-text wpqt-blue-text-hover wpqt-cursor-pointer",onClick:()=>{d({type:ne})},children:(0,o.__)("Import an existing board","quicktasker")})]})})};var Gr=s(8932),Vr=s(247),Br=s(1203),Hr=s(2496),Wr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Qr(){const{state:{activePipeline:e},fetchAndSetPipelineData:t}=(0,a.useContext)(os),{state:{pipelines:s},pipelinesDispatch:r}=(0,a.useContext)(ha),{modalDispatch:c}=(0,a.useContext)(As),l=e=>Wr(this,void 0,void 0,(function*(){try{yield(t=e.id,Ot()({path:`/wpqt/v1/pipelines/${t}/set-primary`,method:"PATCH",headers:Ct()})),r({type:v,payload:e.id}),i.oR.success((0,o.__)("Primary board has been set successfully.","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to set primary board","quicktasker"))}var t}));return(0,n.jsxs)(Un,{menuBtnClasses:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1 wpqt-rounded-xl wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-p-3",menuBtn:({active:t})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-leading-none",children:null==e?void 0:e.name}),(0,n.jsx)(Br.A,{className:"wpqt-size-4 "+(t?"wpqt-text-qtBlueHover":"")})]}),children:[(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center wpqt-font-bold",children:(0,o.__)("Change board","quicktasker")}),s.map((s=>{const a=s.is_primary,i=(null==e?void 0:e.id)===s.id;return(0,n.jsx)(Mn.Dr,{children:(0,n.jsxs)("div",{className:"wpqt-mb-3 wpqt-flex wpqt-gap-2",children:[(0,n.jsx)("div",{className:(0,tn.$)("wpqt-cursor-pointer wpqt-text-center",{"wpqt-font-bold":i}),onClick:()=>t(s.id),children:s.name}),(0,n.jsx)("div",{className:"wpqt-ml-auto",children:a?(0,n.jsx)(Hr.A,{className:"wpqt-size-4 wpqt-cursor-pointer wpqt-text-blue-500"}):(0,n.jsx)(Vr.A,{className:"wpqt-size-4 wpqt-cursor-pointer wpqt-text-gray-400",onClick:e=>{e.stopPropagation(),l(s)}})})]})},s.id)})),(0,n.jsx)(Mn.Dr,{children:(0,n.jsx)("div",{className:"wpqt-my-4 wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-2",children:(0,n.jsx)(Vs,{text:(0,o.__)("Add new board","quicktasker"),onClick:()=>Wr(this,void 0,void 0,(function*(){c({type:z})})),icon:(0,n.jsx)(un.A,{className:"wpqt-size-6 wpqt-icon-green"}),className:"wpqt-bg-white hover:!wpqt-bg-gray-100"})})},"new-pipeline"),(0,n.jsx)(Mn.Dr,{children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-justify-center wpqt-cursor-pointer wpqt-blue-text wpqt-blue-text-hover",onClick:()=>{c({type:ne})},children:(0,o.__)("Import existing","quicktasker")})},"export-pipeline")]})}function Yr(){const{modalDispatch:e}=(0,a.useContext)(As),t=t=>{e({type:te,payload:{selectedMethod:t}})};return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-mr-5 wpqt-gap-2",children:[(0,n.jsx)(tr.uNb,{className:"wpqt-size-5 wpqt-pdf-red wpqt-cursor-pointer","data-testid":"task-export-pdf-icon",onClick:()=>{t(Es.PDF)}}),(0,n.jsx)(wr.Qio,{className:"wpqt-size-5 wpqt-cursor-pointer","data-testid":"task-export-pdf-json-icon",onClick:()=>{t(Es.JSON)}})]})}function Jr(){const{state:{activePipeline:e,loading:t},fetchAndSetPipelineData:s}=(0,a.useContext)(os),{modalDispatch:i}=(0,a.useContext)(As);return e?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-py-5",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:e.name}),(0,n.jsx)(l.A,{className:"wpqt-text-gray-400 wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{e&&i({type:G,payload:{pipelineToEdit:e}})}})]}),e.description&&(0,n.jsx)("div",{className:"wpqt-italic",children:e.description})]}),(0,n.jsxs)("div",{className:"wpqt-ml-auto wpqt-flex wpqt-items-center wpqt-gap-3",children:[(0,n.jsx)(Yr,{}),(0,n.jsx)(Xr,{}),t?(0,n.jsx)(Ls,{width:"24",height:"24"}):(0,n.jsx)(wi.A,{className:"wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>s(e.id)}),(0,n.jsx)(Qr,{})]})]}):null}function Xr(){const{state:{view:e},dispatch:t}=(0,a.useContext)(os);return(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-items-center wpqt-cursor-pointer wpqt-text-blue-400 wpqt-text-base :hover:wpqt-text-blue-600",onClick:()=>{t({type:N,payload:e===es.PIPELINE?es.TASK:es.PIPELINE})},children:e===es.PIPELINE?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Gr.A,{className:"wpqt-size-5 wpqt-text-blue-400"}),(0,o.__)("Switch to Task view","quicktasker")]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Qi.A,{className:"wpqt-size-5 wpqt-text-blue-400"}),(0,o.__)("Switch to Board view","quicktasker")]})})}function Zr(){const{modalDispatch:e}=(0,a.useContext)(As),{activePipelineTasks:t,activePipelineSettings:s,isTaskOnLastStage:i}=Po(),{taskViewFilter:r}=(()=>{const{state:{stageIdFilter:e,userFilter:t}}=(0,a.useContext)(Uo);return{taskViewFilter:s=>{var a,n;const i=!e||s.stage_id===e,o=!t.id||!t.type||t.type===Nt.QUICKTASKER&&(null===(a=s.assigned_users)||void 0===a?void 0:a.some((e=>e.id===t.id)))||t.type===Nt.WP_USER&&(null===(n=s.assigned_wp_users)||void 0===n?void 0:n.some((e=>e.id===t.id)));return i&&o}}})(),c=t.filter(r);return 0===c.length?(0,n.jsx)(Wi,{text:(0,o.__)("No tasks","quictasker")}):(0,n.jsxs)("div",{className:"wpqt-card-grid",children:[c.map((t=>{const a=i(t.id),o=!s.allow_only_last_stage_task_done||a,r=t.task_focus_color?{borderTopColor:t.task_focus_color,borderTopWidth:jt,borderTopStyle:yt}:{};return(0,n.jsxs)(Ji,{className:"wpqt-cursor-pointer",style:r,title:t.name,description:t.description,dropdown:(0,n.jsx)(Rr,{task:t}),onClick:()=>{e({type:M,payload:{taskToEdit:t,taskModalSettings:{allowToMarkTaskAsDone:o}}})},children:[(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(oi,{task:t}),(0,n.jsx)(Zn,{task:t})]}),(0,n.jsx)(Lr,{task:t}),(0,n.jsx)(Ur,{task:t,allowToMarkTaskAsDone:o})]},t.id)})),(0,n.jsx)(Hi,{}),(0,n.jsx)(yr,{})]})}const ec=()=>(0,n.jsx)(rs,{children:(0,n.jsx)(oa,{children:(0,n.jsx)(tc,{})})}),tc=()=>{const{state:{view:e,activePipeline:t}}=(0,a.useContext)(os),s=e===es.PIPELINE;return(0,n.jsxs)(ra,{children:[(0,n.jsx)(Jr,{}),s?(0,n.jsx)(zr,{}):(0,n.jsxs)(Fo,{children:[(0,n.jsx)($o,{}),(0,n.jsx)(Zr,{})]}),(0,n.jsx)(ur,{}),(0,n.jsx)(mr,{}),(0,n.jsx)(rr,{}),(0,n.jsx)(qr,{pipelineId:(null==t?void 0:t.id)||null}),(0,n.jsx)(or,{})]})};var sc=s(6197),ac=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function nc(){return{saveCustomUserPageStyles:(e,t)=>ac(this,void 0,void 0,(function*(){try{const a=yield(s=e,Ot()({path:"/wpqt/v1/settings/user-page-custom-styles",method:"PATCH",data:{styles:s},headers:Ct()}));t&&t(a.data),i.oR.success((0,o.__)("Custom user page styles saved successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to save custom user page styles","quicktasker"))}var s})),saveTaskCompletionDoneSetting:(e,t,s)=>ac(this,void 0,void 0,(function*(){try{yield function(e,t){return Ot()({path:`/wpqt/v1/pipelines/${e}/settings/task-completion-done-restriction`,method:"PATCH",data:{allow_task_completion_only_on_last_stage:t},headers:Ct()})}(e,t),s&&s(t)}catch(e){s&&s(!t),console.error(e),i.oR.error((0,o.__)("Failed to save setting","quicktasker"))}}))}}const ic=({children:e,title:t,description:s})=>(0,n.jsxs)("div",{className:"wpqt-mb-5",children:[(0,n.jsx)("h3",{className:"wpqt-mb-1",children:t}),(0,n.jsx)("p",{children:s}),e]});const oc=()=>{const{state:{userPageCustomStyles:e},appDispatch:t}=(0,a.useContext)(Ga),[s,i]=(0,a.useState)(""),[r,c]=(0,a.useState)(!1),{saveCustomUserPageStyles:l}=nc();return(0,a.useEffect)((()=>{i(e)}),[e]),(0,n.jsxs)(ic,{title:(0,o.__)("Custom style","quicktasker"),description:(0,o.__)("Add custom CSS rules for QuickTasker user page.","quicktasker"),children:[(0,n.jsx)(sn,{value:s,onChange:i,colsCount:40}),(0,n.jsx)(Vs,{text:(0,o.__)("Save","quicktasker"),loading:r,onClick:()=>{return e=void 0,a=void 0,i=function*(){c(!0),yield l(s,(e=>{t({type:Pe,payload:e})})),c(!1)},new((n=void 0)||(n=Promise))((function(t,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(e,a||[])).next())}));var e,a,n,i},icon:(0,n.jsx)(sc.RZ0,{className:"wpqt-icon-blue wpqt-size-4"})})]})};var rc=s(8046),cc=s(1226);const lc=(e,t)=>{var s,a;switch(t.type){case ct:{const s=t.payload.automations;return Object.assign(Object.assign({},e),{automations:s})}case lt:{const s=t.payload;return Object.assign(Object.assign({},e),{loading:s})}case dt:{const n=t.payload,i=null!==(a=null===(s=e.automations)||void 0===s?void 0:s.filter((e=>e.id!==n)))&&void 0!==a?a:null;return Object.assign(Object.assign({},e),{automations:i})}case pt:{const s=e.automations?e.automations.map((e=>e.id===t.payload.id?Object.assign(Object.assign({},e),{active:t.payload.active}):e)):null;return Object.assign(Object.assign({},e),{automations:s})}case ut:{const s=t.payload,a=e.automations?[...e.automations,s]:[s];return Object.assign(Object.assign({},e),{automations:a})}default:return e}},dc={[Ht.ARCHIVE_TASK]:(0,o.__)("Archive task","quicktasker"),[Ht.ASSIGN_USER]:(0,o.__)("Assign user","quickkasker"),[Ht.NEW_ENTITY_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Ht.DELETED_ENTITY_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Ht.TASK_ASSIGNED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Ht.TASK_UNASSIGNED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Ht.TASK_PUBLIC_COMMENT_ADDED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Ht.TASK_PRIVATE_COMMENT_ADDED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Ht.TASK_FILE_UPLOADED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Ht.TASK_FILE_DELETED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[Ht.CREATE_TASK]:(0,o.__)("Create task","quicktasker"),[Ht.SEND_SLACK_MESSAGE]:(0,o.__)("Send Slack message","quicktasker")},uc={[Vt.Task]:(0,o.__)("Task","quicktasker"),[Vt.Stage]:(0,o.__)("Stage","quicktasker"),[Vt.PIPELINE]:(0,o.__)("Board","quicktasker"),[Vt.quicktasker]:"Quicktasker",[Vt.WOOCOMMERCE_ORDER]:(0,o.__)("WooCommerce Order","quicktasker"),[Vt.SEATREG_BOOKING]:(0,o.__)("SeatReg Booking","quicktasker")},pc={[Kt.TASK_DONE]:(0,o.__)("Task marked as done","quicktasker"),[Kt.Task_NOT_DONE]:(0,o.__)("Task marked as not done","quicktasker"),[Kt.TASK_CREATED]:(0,o.__)("Task created","quicktasker"),[Kt.TASK_DELETED]:(0,o.__)("Task deleted","quicktasker"),[Kt.TASK_ASSIGNED]:(0,o.__)("Task assigned","quicktasker"),[Kt.TASK_UNASSIGNED]:(0,o.__)("Task unassigned","quicktasker"),[Kt.TASK_PUBLIC_COMMENT_ADDED]:(0,o.__)("Public comment added","quicktasker"),[Kt.TASK_PRIVATE_COMMENT_ADDED]:(0,o.__)("Private comment added","quicktasker"),[Kt.TASK_FILE_UPLOADED]:(0,o.__)("File attached","quicktasker"),[Kt.TASK_FILE_DELETED]:(0,o.__)("Attached file deleted","quicktasker"),[zt.WOOCOMMERCE_ORDER_ADDED]:(0,o.__)("Order added","quicktasker"),[Gt.SEATREG_BOOKING_CREATED]:(0,o.__)("Booking created","quicktasker"),[Gt.SEATREG_BOOKING_APPROVED]:(0,o.__)("Booking gets approved state","quicktasker"),[Gt.SEATREG_BOOKING_PENDING]:(0,o.__)("Booking gets pending state","quicktasker"),[Gt.SEATREG_BOOKING_APPROVED_VIA_MANAGER]:(0,o.__)("Booking gets approved state manually with booking manager","quicktasker"),[Gt.SEATREG_BOOKING_PENDING_VIA_MANAGER]:(0,o.__)("Booking gets pending state manually with booking manager","quicktasker")},mc=(zt.WOOCOMMERCE_ORDER_ADDED,(0,o.__)("Order added","quicktasker"),{[Kt.TASK_DONE]:[{id:Ht.ARCHIVE_TASK},{id:Ht.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Kt.Task_NOT_DONE]:[{id:Ht.ARCHIVE_TASK}],[Kt.TASK_CREATED]:[{id:Ht.ASSIGN_USER,requireAutomationTarget:!0,requireAutomationTargetType:!0},{id:Ht.NEW_ENTITY_EMAIL,requireMetaData:!0},{id:Ht.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Kt.TASK_DELETED]:[{id:Ht.DELETED_ENTITY_EMAIL,requireMetaData:!0},{id:Ht.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Kt.TASK_ASSIGNED]:[{id:Ht.TASK_ASSIGNED_EMAIL,requireMetaData:!0},{id:Ht.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Kt.TASK_UNASSIGNED]:[{id:Ht.TASK_UNASSIGNED_EMAIL,requireMetaData:!0},{id:Ht.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Kt.TASK_PUBLIC_COMMENT_ADDED]:[{id:Ht.TASK_PUBLIC_COMMENT_ADDED_EMAIL,requireMetaData:!0},{id:Ht.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Kt.TASK_PRIVATE_COMMENT_ADDED]:[{id:Ht.TASK_PRIVATE_COMMENT_ADDED_EMAIL,requireMetaData:!0},{id:Ht.SEND_SLACK_MESSAGE,requireMetaData:!0}],[Kt.TASK_FILE_UPLOADED]:[{id:Ht.TASK_FILE_UPLOADED_EMAIL,requireMetaData:!0}],[Kt.TASK_FILE_DELETED]:[{id:Ht.TASK_FILE_DELETED_EMAIL,requireMetaData:!0}]}),hc={[zt.WOOCOMMERCE_ORDER_ADDED]:[{id:Ht.CREATE_TASK}]},wc={[Gt.SEATREG_BOOKING_CREATED]:[{id:Ht.CREATE_TASK}],[Gt.SEATREG_BOOKING_APPROVED]:[{id:Ht.CREATE_TASK}],[Gt.SEATREG_BOOKING_PENDING]:[{id:Ht.CREATE_TASK}],[Gt.SEATREG_BOOKING_APPROVED_VIA_MANAGER]:[{id:Ht.CREATE_TASK}],[Gt.SEATREG_BOOKING_PENDING_VIA_MANAGER]:[{id:Ht.CREATE_TASK}]},fc={[Vt.Task]:mc,[Vt.WOOCOMMERCE_ORDER]:hc,[Vt.SEATREG_BOOKING]:wc};const qc={automations:null,loading:!0},_c=(0,a.createContext)({state:qc,pipelineAutomationsDispatch:()=>{}}),xc=({children:e,pipelineId:t})=>{const[s,r]=(0,a.useReducer)(lc,qc),c=()=>{return e=void 0,s=void 0,n=function*(){try{r({type:lt,payload:!0});const s=yield function(e){return Ot()({path:`/wpqt/v1/pipelines/${e}/automations`,method:"GET",headers:Ct()})}(t);r({type:ct,payload:{automations:(e=s.data.automations,e.map((e=>Object.assign(Object.assign({},e),{active:"1"===e.active,verify_success:"1"===e.verify_success}))))}})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load board automations","quicktasker"))}finally{r({type:lt,payload:!1})}var e},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n};return(0,a.useEffect)((()=>{c()}),[]),(0,n.jsx)(_c.Provider,{value:{state:s,pipelineAutomationsDispatch:r},children:e})},kc={automationTarget:null,automationTrigger:null,automationAction:null,automationActionTargetId:null,automationActionTargetType:null,metaData:null};function gc(e,t){switch(t.type){case"SET_TARGET":return Object.assign(Object.assign({},e),{automationTarget:t.payload,automationTrigger:null,automationAction:null});case"SET_TRIGGER":return Object.assign(Object.assign({},e),{automationTrigger:t.payload,automationAction:null});case"SET_ACTION":return Object.assign(Object.assign({},e),{automationAction:t.payload});case"RESET":return kc;case ht:return Object.assign(Object.assign({},e),{automationActionTargetId:t.payload.automationActionTargetId,automationActionTargetType:t.payload.automationActionTargetType});case mt:return Object.assign(Object.assign({},e),{metaData:t.payload});case wt:return kc;case ft:return Object.assign(Object.assign({},kc),{automationTarget:e.automationTarget});case qt:return Object.assign(Object.assign({},kc),{automationTarget:e.automationTarget,automationTrigger:e.automationTrigger});default:return e}}function vc({actionTargetId:e,actionTargetType:t}){if(null===e||null===t)return null;const{getUser:s}=Ro();if(t===Bt.QUICKTASKER||t===Bt.WP_USER||null!==e){const a=Qt(t);if(a){const t=s(e,a);return(0,n.jsx)("div",{className:"wpqt-text-center",children:(null==t?void 0:t.name)||(0,o.__)("User not found","quicktasker")})}}return null}function jc({value:e,label:t,onClick:s=()=>{},className:a=""}){return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-text-center wpqt-font-semibold wpqt-rounded-xl wpqt-px-4 wpqt-py-2 wpqt-border wpqt-border-solid wpqt-cursor-pointer wpqt-border-qtBorder ${a}`,onClick:()=>{s(e)},children:t})}function yc({children:e,title:t}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-base wpqt-mb-4 wpqt-text-center",children:t}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center wpqt-gap-3 wpqt-flex-wrap",children:e})]})}function bc({automationDispatch:e,automation:t}){if(!t.automationTarget||!t.automationTrigger)return null;const s=t.automationTarget,a=t.automationTrigger,i=fc[s],r=i&&a in i?i[a]:[];return(0,n.jsx)(yc,{title:(0,o.__)("Step 3. Select action","quicktasker"),children:r.map((t=>(0,n.jsx)(jc,{value:t.id,label:dc[t.id],onClick:()=>{e({type:"SET_ACTION",payload:t})}},t.id)))})}function Ec({quickTaskerUsers:e,wpUsers:t,assignUser:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-w-[320px] wpqt-flex-col",children:[(0,n.jsx)(ai,{sectionTitle:(0,o.__)("Assign a quicktasker","quicktasker"),users:e,onItemSelect:s,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No quicktaskers available to assign","quicktasker")}),(0,n.jsx)(ai,{sectionTitle:(0,o.__)("Assign a WordPress user","quicktasker"),users:t,onItemSelect:s,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No WordPress users with required permissions available to assign","quicktasker")})]})}function Tc({automationAction:e,onUserAdd:t=()=>{},quickTaskerUserTargets:s=[],wpUserTargets:a=[],menuBtnClasses:i=""}){const o=[...s,...a].length>0;return(0,n.jsx)(Un,{menuBtnClasses:`wpqt-inline-flex ${i}`,anchor:"bottom start",menuBtn:()=>(0,n.jsx)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1",children:(0,n.jsx)(ei.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`})}),children:e===Ht.ASSIGN_USER&&(0,n.jsx)(Ec,{quickTaskerUsers:s,wpUsers:a,assignUser:t})})}const Ac=[Ht.ASSIGN_USER];function Sc({automationDispatch:e,automation:t}){var s;const{state:{users:i,wpUsers:r}}=(0,a.useContext)(Ea),c=null===(s=t.automationAction)||void 0===s?void 0:s.id,l=void 0!==c&&Ac.includes(c);return(0,n.jsx)(yc,{title:(0,o.__)("Step 4. Select action target","quicktasker"),children:l&&(0,n.jsx)(Tc,{automationAction:c,quickTaskerUserTargets:i,wpUserTargets:r,onUserAdd:t=>{e({type:ht,payload:{automationActionTargetId:t.id,automationActionTargetType:t.user_type}})}})})}var Nc=s(4476);const Oc=Nc.z.string().email({message:"Invalid email address"});function Cc({setAutomationMeta:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(e=>{try{Oc.parse(e),r(!0)}catch(e){r(!1)}})(t)}),[t]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-justify-center wpqt-items-center",children:[(0,n.jsx)(qi,{type:"info",children:(0,o.__)("Make sure your website is configured to send out emails","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("label",{htmlFor:"automation-meta-email-input",children:(0,o.__)("Email will be sent to","quicktasker")}),(0,n.jsx)(ua,{inputId:"automation-meta-email-input",value:t,onChange:s,wrapperClassName:"!wpqt-mb-0"}),!i&&(0,n.jsx)("div",{className:"wpqt-text-red-500",children:(0,o.__)("Invalid email address","quicktasker")})]}),(0,n.jsx)(Gs,{btnText:(0,o.__)("Set email","quicktasker"),onClick:()=>{i&&e(t)}})]})}const Ic=Nc.z.string().url({message:"Invalid URL"}).refine((e=>e.startsWith("https://hooks.slack.com/services/")),{message:"Invalid Slack webhook URL"}),Dc=function({setAutomationMeta:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(e=>{try{Ic.parse(e),r(!0)}catch(e){r(!1)}})(t)}),[t]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-justify-center wpqt-items-center",children:[(0,n.jsxs)(qi,{type:"info",children:[(0,o.__)("Make sure your have configured your Slack webhook URL.","quicktasker"),(0,n.jsx)("a",{href:"https://api.slack.com/messaging/webhooks",target:"_blank",rel:"noopener noreferrer",className:"wpqt-text-blue-500 hover:underline wpqt-ml-1",children:(0,o.__)("Read more about Slack webhooks.","quicktasker")})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("label",{htmlFor:"automation-meta-slack-webhook-input",children:(0,o.__)("Slack webhook URL","quicktasker")}),(0,n.jsx)(ua,{inputId:"automation-meta-slack-webhook-input",value:t,onChange:s,wrapperClassName:"!wpqt-mb-0"}),!i&&(0,n.jsx)("div",{className:"wpqt-text-red-500",children:(0,o.__)("Invalid Slack webhook","quicktasker")})]}),(0,n.jsx)(Gs,{btnText:(0,o.__)("Set webhook URL","quicktasker"),onClick:()=>{i&&e(t)}})]})};function Pc({automationCreationState:e,automationDispatch:t}){var s;const a=null===(s=null==e?void 0:e.automationAction)||void 0===s?void 0:s.id,i=a===Ht.NEW_ENTITY_EMAIL||a===Ht.DELETED_ENTITY_EMAIL||a===Ht.TASK_ASSIGNED_EMAIL||a===Ht.TASK_UNASSIGNED_EMAIL||a===Ht.TASK_PUBLIC_COMMENT_ADDED_EMAIL||a===Ht.TASK_PRIVATE_COMMENT_ADDED_EMAIL||a===Ht.TASK_FILE_UPLOADED_EMAIL||a===Ht.TASK_FILE_DELETED_EMAIL,o=a===Ht.SEND_SLACK_MESSAGE,r=e=>{t({type:mt,payload:e})};return i?(0,n.jsx)(Cc,{setAutomationMeta:r}):o?(0,n.jsx)(Dc,{setAutomationMeta:r}):null}function Rc({automationDispatch:e}){const t=Object.keys(fc).map((e=>({value:e,label:uc[e]||e})));return(0,n.jsx)(yc,{title:(0,o.__)("Step 1. Select a target","quicktasker"),children:t.map((({value:t,label:s})=>(0,n.jsx)(jc,{value:t,label:s,onClick:()=>{e({type:"SET_TARGET",payload:t})}},t)))})}function Lc({automationDispatch:e,automation:t}){if(!t.automationTarget)return null;const s=t.automationTarget,a=Object.keys(fc[s]).map((e=>({value:e,label:pc[e]||e})));return(0,n.jsx)(yc,{title:(0,o.__)("Step 2. Select a trigger","quicktasker"),children:a.map((({value:t,label:s})=>(0,n.jsx)(jc,{value:t,label:s,onClick:()=>{e({type:"SET_TRIGGER",payload:t})}},t)))})}var Mc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Uc({automation:e,automationDispatch:t,createAutomation:s}){const[i,r]=(0,a.useState)(!1);return null===e.automationTarget?(0,n.jsx)(Rc,{automationDispatch:t}):null===e.automationTrigger?(0,n.jsx)(Lc,{automationDispatch:t,automation:e}):null===e.automationAction?(0,n.jsx)(bc,{automationDispatch:t,automation:e}):e.automationAction&&e.automationAction.requireAutomationTarget&&e.automationAction.requireAutomationTargetType&&(null===e.automationActionTargetType||null===e.automationActionTargetId)?(0,n.jsx)(Sc,{automationDispatch:t,automation:e}):e.automationAction.requireMetaData&&!e.metaData?(0,n.jsx)(Pc,{automationCreationState:e,automationDispatch:t}):(0,n.jsx)(Vs,{text:(0,o.__)("Create automation","quicktasker"),icon:(0,n.jsx)(sr.ltU,{className:"wpqt-size-6"}),onClick:()=>Mc(this,void 0,void 0,(function*(){r(!0),yield s(),r(!1)})),loading:i})}var Fc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function $c({pipelineId:e}){const{pipelineAutomationsDispatch:t,state:{loading:s,automations:i}}=(0,a.useContext)(_c),[r,c]=(0,a.useReducer)(gc,kc),{createAutomation:l}=ds(),d=null!==r.automationActionTargetId&&null!==r.automationActionTargetType,u=null!==r.metaData,p=!gt&&i&&i.length>=1,m="wpqt-px-3 wpqt-min-w-[60px] wpqt-cursor-pointer",h="wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1";return s?null:p?(0,n.jsx)(hn,{description:(0,o.__)("Free version limit reached. Upgrade to premium to create more automations.","quicktasker")}):(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-3 wpqt-p-4 wpqt-justify-center wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-start"}),(0,n.jsx)(Ji,{title:(0,o.__)("Target","quicktasker"),className:m,titleClassName:h,onClick:()=>{c({type:wt})},children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:r.automationTarget?uc[r.automationTarget]:(0,n.jsx)(Kc,{})})}),(0,n.jsx)(rc.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(Ji,{title:(0,o.__)("Trigger","quicktasker"),className:m,titleClassName:h,onClick:()=>{c({type:ft})},children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:r.automationTrigger?pc[r.automationTrigger]:(0,n.jsx)(Kc,{})})}),(0,n.jsx)(rc.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(Ji,{title:(0,o.__)("Action","quicktasker"),className:m,titleClassName:h,onClick:()=>{c({type:qt})},children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center wpqt-items-center",children:[r.automationAction?dc[r.automationAction.id]:(0,n.jsx)(Kc,{}),d&&(0,n.jsx)(vc,{actionTargetId:r.automationActionTargetId,actionTargetType:r.automationActionTargetType}),u&&(0,n.jsx)("div",{children:r.metaData})]})})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Uc,{automation:r,automationDispatch:c,createAutomation:()=>Fc(this,void 0,void 0,(function*(){yield l(e,r,((e,s)=>{e&&s&&(c({type:"RESET"}),t({type:ut,payload:s}))}))}))})})]})})}function Kc(){return(0,n.jsx)(cc.A,{className:"wpqt-size-7 wpqt-text-gray-300"})}function zc({pipelineId:e}){const{state:{automationCreatorModalOpen:t},modalDispatch:s}=(0,a.useContext)(As);return(0,n.jsxs)(Hs,{modalOpen:t,closeModal:()=>{s({type:re})},size:"lg",children:[(0,n.jsx)(Ws,{className:"wpqt-text-center",children:(0,o.__)("Create a new automation","quicktasker")}),(0,n.jsx)($c,{pipelineId:e})]})}var Gc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Vc({automation:e,className:t="",titleClassName:s=""}){const{deleteAutomation:i,updateAutomationActiveStatus:r}=ds(),{pipelineAutomationsDispatch:c}=(0,a.useContext)(_c),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1);return(0,n.jsx)(Ji,{title:(0,o.__)("Controls","quicktasker"),className:`${t} wpqt-ml-6`,titleClassName:s,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3 wpqt-justify-center",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-1 wpqt-justify-center wpqt-items-center wpqt-h-[40px]",children:u?(0,n.jsx)(Us,{ovalSize:"32"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Active","quicktasker")}),(0,n.jsx)(nn,{checked:e.active,handleChange:t=>Gc(this,void 0,void 0,(function*(){p(!0);const s=yield r(e.pipeline_id,e.id,t);p(!1),s.success&&c({type:pt,payload:{id:e.id,active:t}})}))})]})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-2",children:(0,n.jsx)(Vs,{loading:l,icon:(0,n.jsx)(Ra.A,{className:"wpqt-icon-red wpqt-size-5"}),onClick:()=>Gc(this,void 0,void 0,(function*(){d(!0),yield i(e.pipeline_id,e.id,(t=>{t&&c({type:dt,payload:e.id})})),d(!1)})),text:(0,o.__)("Delete","quicktasker")})})]})})}function Bc({automation:e}){const t="wpqt-px-3 wpqt-pt-1 wpqt-min-w-[60px] wpqt-cursor-default",s="wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1",a=null!==e.automation_action_target_id&&null!==e.automation_action_target_type,i=null!==e.metadata;return(0,n.jsxs)("div",{className:"wpqt-flex",children:[(0,n.jsxs)("div",{className:"wpqt-flex-1 wpqt-flex wpqt-p-4 wpqt-items-center wpqt-justify-center wpqt-gap-3",children:[(0,n.jsx)(Ji,{title:(0,o.__)("Target","quicktasker"),className:t,titleClassName:s,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:uc[e.target_type]})}),(0,n.jsx)(rc.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(Ji,{title:(0,o.__)("Trigger","quicktasker"),className:t,titleClassName:s,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:pc[e.automation_trigger]})}),(0,n.jsx)(rc.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(Ji,{title:(0,o.__)("Action","quicktasker"),className:t,titleClassName:s,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center wpqt-items-center",children:[dc[e.automation_action],a&&(0,n.jsx)(vc,{actionTargetId:e.automation_action_target_id,actionTargetType:e.automation_action_target_type}),i&&(0,n.jsx)("div",{children:e.metadata})]})})]}),(0,n.jsx)(Vc,{automation:e,className:`${t}`,titleClassName:s})]})}function Hc(){const{state:{automations:e,loading:t}}=(0,a.useContext)(_c);return t?(0,n.jsx)(Us,{ovalSize:"24"}):e&&0!==e.length?(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-4 wpqt-mx-auto wpqt-max-w-7xl",children:e.map((e=>(0,n.jsx)(Bc,{automation:e},e.id)))}):(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-p-4",children:(0,n.jsx)(qi,{type:"info",children:(0,o.__)("No automations created for this board","quicktasker")})})}function Wc(){const{state:{automationsModalOpen:e},modalDispatch:t}=(0,a.useContext)(As);return(0,n.jsxs)(Hs,{modalOpen:e,closeModal:()=>{t({type:le})},size:"lg",children:[(0,n.jsx)(Ws,{className:"wpqt-text-center",children:(0,o.__)("Manage board automations","quicktasker")}),(0,n.jsx)(Hc,{})]})}function Qc({pipelineId:e}){const t=gt?(0,o.__)("Set up automated processes to help manage your board.","quicktasker"):(0,o.__)("Set up automated processes to help manage your board. To create more than one automation, please upgrade to the premium version.","quicktasker");return(0,n.jsx)(xc,{pipelineId:e,children:(0,n.jsxs)(ic,{title:(0,o.__)("Board automations","quicktasker"),description:t,children:[(0,n.jsx)(Yc,{}),(0,n.jsx)(Wc,{}),(0,n.jsx)(zc,{pipelineId:e})]})})}function Yc(){const{automations:e,loading:t}=function(){const{state:{automations:e,loading:t}}=(0,a.useContext)(_c);return{automations:e,loading:t}}(),{modalDispatch:s}=(0,a.useContext)(As),i=(null==e?void 0:e.length)||0,r=gt||i<1;return t?(0,n.jsx)(Us,{ovalSize:"24",className:"!wpqt-items-start"}):(0,n.jsxs)("div",{className:"wpqt-text-left",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:0===i?(0,n.jsx)("p",{children:(0,o.__)("There are no automations configured for this board.","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:(0,o.sprintf)((0,o.__)("There are %d automations configured for this board.","quicktasker"),i)}),(0,n.jsx)("div",{children:(0,n.jsx)("span",{className:"wpqt-cursor-pointer wpqt-text-blue-500 hover:wpqt-underline",onClick:()=>{s({type:ce})},children:(0,o.__)("Manage board automations","quicktasker")})})]})}),r&&(0,n.jsx)("div",{children:(0,n.jsx)("span",{className:"wpqt-cursor-pointer wpqt-text-blue-500 hover:wpqt-underline",onClick:()=>{s({type:oe})},children:(0,o.__)("Create a new automation","quicktasker")})})]})}var Jc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Xc({allow_only_last_stage_task_done:e,pipelineId:t}){const[s,i]=(0,a.useState)(e),[r,c]=(0,a.useState)(!1),{saveTaskCompletionDoneSetting:l}=nc();return(0,n.jsx)(ic,{title:(0,o.__)("Restrict Task Completion","quicktasker"),description:(0,o.__)("Allow to mark task as done only on board last stage. By default, task can be marked as done on any stage. Will apply also to QuickTasker page.","quicktasker"),children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(nn,{checked:s,handleChange:e=>Jc(this,void 0,void 0,(function*(){i(e),c(!0),yield l(t,e,(e=>{i(e)})),c(!1)}))}),r&&(0,n.jsx)(Ls,{width:"20",height:"20"})]})})}var Zc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function el({pipeline:e}){const[t,s]=(0,a.useState)(!0),[i,o]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(()=>{Zc(this,void 0,void 0,(function*(){try{s(!0);const a=yield(t=e.id,Ot()({path:`/wpqt/v1/pipelines/${t}/settings`,method:"GET",headers:Ct()}));o($t(a.data.settings))}catch(e){console.error(e)}finally{s(!1)}var t}))})()}),[]),t?(0,n.jsx)(Us,{}):i?(0,n.jsxs)("div",{children:[(0,n.jsx)(Xc,{pipelineId:e.id,allow_only_last_stage_task_done:i.allow_only_last_stage_task_done}),(0,n.jsx)(Qc,{pipelineId:e.id})]}):null}function tl(){const{state:{pipelines:e}}=(0,a.useContext)(ha),t=e.map((e=>e.name)),s=e.map((e=>(0,n.jsx)(el,{pipeline:e},e.id)));return(0,n.jsx)("div",{children:(0,n.jsx)(ci,{tabs:t,tabsContent:s,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})})}const sl=()=>(0,n.jsxs)(ra,{children:[(0,n.jsx)(d,{description:(0,o.__)("Manage settings, preferences, and configurations.","quicktasker"),children:(0,o.__)("Settings","quicktasker")}),(0,n.jsx)(oc,{}),(0,n.jsx)(tl,{})]});var al=s(1548),nl=s(1266),il=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ol(){return{createUser:(e,t,s)=>il(this,void 0,void 0,(function*(){try{const r=yield(a=e,n=t,Ot()({path:"/wpqt/v1/users",method:"POST",data:{name:a,description:n},headers:Ct()}));s&&s(r.data),i.oR.success((0,o.__)("User created successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("User creation failed. Please try again","quicktasker"))}var a,n})),editUser:(e,t)=>il(this,void 0,void 0,(function*(){try{const s=yield function(e){return Ot()({path:`/wpqt/v1/users/${e.id}`,method:"PATCH",data:{user:e},headers:Ct()})}(e);t&&t(s.data),i.oR.success((0,o.__)("User edited successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("User edit failed. Please try again","quicktasker"))}})),changeUserStatus:(e,t,s)=>il(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return Ot()({path:`/wpqt/v1/users/${e}/status`,method:"PATCH",data:{status:t},headers:Ct()})}(e,t);s&&s(a.data),i.oR.success((0,o.__)("User status changed successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change user status. Please try again","quicktasker"))}})),deleteUser:(e,t)=>il(this,void 0,void 0,(function*(){try{yield function(e){return Ot()({path:`/wpqt/v1/users/${e}`,method:"DELETE",headers:Ct()})}(e),t&&t(e),i.oR.success((0,o.__)("User deleted successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete user. Please try again","quicktasker"))}})),resetUserPassword:(e,t)=>il(this,void 0,void 0,(function*(){try{yield function(e){return Ot()({path:`/wpqt/v1/users/${e}/password-reset`,method:"PATCH",headers:Ct()})}(e),t&&t(e),i.oR.success((0,o.__)("User password reset successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to reset user password. Please try again","quicktasker"))}}))}}var rl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function cl({data:e,changeStatus:t,changeSetUpStatus:s,changePasswordStatus:i}){const{changeUserStatus:r,deleteUser:c,resetUserPassword:l}=ol(),{userDispatch:d}=(0,a.useContext)(Ea),{loading1:u,setLoading1:p,loading2:m,setLoading2:h,loading3:w,setLoading3:f}=$a(),q=e.is_active,_=e.has_password;return(0,n.jsxs)("div",{className:"wpqt-mt-5 wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(Vs,{icon:(0,n.jsx)(Gr.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("User tasks","quicktasker"),onClick:()=>{window.location.hash=`#/users/${e.id}/tasks`}}),!q&&(0,n.jsx)(Vs,{icon:(0,n.jsx)(al.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Activate user","quicktasker"),loading:m,onClick:()=>rl(this,void 0,void 0,(function*(){h(!0),yield r(e.id,!0,(e=>{d({type:Ne,payload:Object.assign({},e)}),t(!0)})),h(!1)}))}),q&&(0,n.jsx)(Vs,{icon:(0,n.jsx)(al.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Disable user","quicktasker"),loading:m,onClick:()=>rl(this,void 0,void 0,(function*(){h(!0),yield r(e.id,!1,(e=>{d({type:Ne,payload:Object.assign({},e)}),t(!1)})),h(!1)}))}),_&&(0,n.jsx)(Vs,{icon:(0,n.jsx)(nl.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:u,text:(0,o.__)("Reset password","quicktasker"),onClick:()=>rl(this,void 0,void 0,(function*(){p(!0),yield l(e.id,(()=>{s(!1),i(!1)})),p(!1)}))}),(0,n.jsx)(Vs,{icon:(0,n.jsx)(Ra.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:w,text:(0,o.__)("Delete user","quicktasker"),onClick:()=>rl(this,void 0,void 0,(function*(){f(!0),yield c(e.id,(e=>{d({type:Oe,payload:e}),window.location.hash="#/users"})),f(!1)}))})]})}var ll=s(8624),dl=s(3997),ul=s(5028);function pl(){const{state:{siteURL:e,publicUserPageId:t}}=(0,a.useContext)(Ga);return{userPage:e+`/wpqt?page=${t}&page_id=wpqt`}}function ml({data:e}){const{userPage:t}=pl(),{convertToWPTimezone:s}=Ya(),a=e.is_active,i=t+"&code="+e.page_hash;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)(hl,{label:(0,o.__)("Name","quicktasker"),value:e.name,icon:(0,n.jsx)(ll.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(hl,{label:(0,o.__)("Created at","quicktasker"),value:s(e.created_at),icon:(0,n.jsx)(dl.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(hl,{label:(0,o.__)("Assigned tasks count","quicktasker"),value:e.assigned_tasks_count,icon:(0,n.jsx)(Gr.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(hl,{label:(0,o.__)("Setup completed","quicktasker"),value:e.setup_completed?(0,o.__)("Yes","quicktasker"):(0,o.__)("No","quicktasker"),icon:(0,n.jsx)(ul.A,{className:"wpqt-size-5 wpqt-text-yellow-600"})}),(0,n.jsx)(hl,{label:(0,o.__)("Is active","quicktasker"),value:a?(0,o.__)("Yes","quicktasker"):(0,o.__)("No","quicktasker"),icon:(0,n.jsx)(al.A,{className:"wpqt-size-5 "+(a?"wpqt-icon-green":"wpqt-icon-red")})}),(0,n.jsx)(hl,{label:(0,o.__)("User Page","quicktasker"),value:(0,n.jsx)("a",{href:i,rel:"noreferrer",target:"_blank",children:i}),icon:(0,n.jsx)(so.A,{className:"wpqt-size-5 wpqt-icon-blue"})})]})}function hl({label:e,value:t,icon:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[s,(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[e,": "]}),(0,n.jsx)("span",{children:t})]})}var wl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function fl({userId:e}){const{loadingDispatch:t}=(0,a.useContext)(as),[s,r]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(()=>{wl(this,void 0,void 0,(function*(){try{t({type:Re,payload:!0});const a=yield function(e){return Ot()({path:`/wpqt/v1/users/${e}/extended`,method:"GET",headers:Ct()})}(e);r((s=a.data,Object.assign(Object.assign({},s),{is_active:"1"===s.is_active})))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to get user data. Please try again","quicktasker"))}finally{t({type:Re,payload:!1})}var s}))})()}),[]),(0,n.jsx)(ra,{children:s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d,{description:(0,o.__)("User details","quicktasker"),children:s.name}),(0,n.jsx)(ml,{data:s}),(0,n.jsx)(cl,{data:s,changeStatus:e=>wl(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{is_active:e}):t))})),changeSetUpStatus:e=>wl(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{setup_completed:e}):t))})),changePasswordStatus:e=>wl(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{has_password:e}):t))}))})]})})}const ql=e=>Object.assign(Object.assign({},e),{is_active:"1"===e.is_active}),_l=(e,t)=>{var s;switch(t.type){case Le:return Object.assign(Object.assign({},e),{sessionsSearchValue:null!==(s=t.payload)&&void 0!==s?s:""});case Me:{const s=t.payload.map(ql);return Object.assign(Object.assign({},e),{userSessions:s})}case Ue:{const{sessionId:s,status:a}=t.payload;return Object.assign(Object.assign({},e),{userSessions:e.userSessions.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_active:a}):e))})}case Fe:{const s=t.payload;return Object.assign(Object.assign({},e),{userSessions:e.userSessions.filter((e=>e.id!==s))})}default:return e}};var xl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const kl={loading:!0,sessionsSearchValue:"",userSessions:[]},gl=(0,a.createContext)({state:kl,usersSessionDispatch:()=>{},loadUserSessions:()=>xl(void 0,void 0,void 0,(function*(){}))}),vl=({children:e})=>{const[t,s]=(0,a.useReducer)(_l,kl),{loadingDispatch:r}=(0,a.useContext)(as);(0,a.useEffect)((()=>{c()}),[]);const c=()=>xl(void 0,void 0,void 0,(function*(){try{r({type:Re,payload:!0});const e=yield Ot()({path:"/wpqt/v1/users/sessions",method:"GET",headers:Ct()});s({type:Me,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch user sessions","quicktasker"))}finally{r({type:Re,payload:!1})}}));return(0,n.jsx)(gl.Provider,{value:{state:t,usersSessionDispatch:s,loadUserSessions:c},children:e})};function jl(){const{state:{sessionsSearchValue:e},usersSessionDispatch:t}=(0,a.useContext)(gl);return(0,n.jsx)(ka,{title:(0,o.__)("Session filtering","quicktasker"),searchChildren:(0,n.jsx)(ga,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"session-search",children:(0,n.jsx)(ua,{inputId:"session-search",value:e,onChange:e=>{t({type:Le,payload:e})}})})})}const yl=()=>{const{state:{sessionsSearchValue:e}}=(0,a.useContext)(gl);return{filterSessions:t=>t.user_name.toLowerCase().includes(e.toLowerCase())||t.user_description&&t.user_description.toLowerCase().includes(e.toLowerCase())}};var bl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function El({session:e}){const{usersSessionDispatch:t}=(0,a.useContext)(gl),{state:{isUserAllowedToDelete:s}}=(0,a.useContext)(Ga),{convertToWPTimezone:r}=Ya(),c=e.is_active,l=s=>bl(this,void 0,void 0,(function*(){try{yield function(e,t){return Ot()({path:`/wpqt/v1/users/sessions/${e}/status`,method:"PATCH",data:{status:t},headers:Ct()})}(e.id,s),t({type:Ue,payload:{sessionId:e.id,status:s}})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change session status","quicktasker"))}}));return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:e.user_name}),(0,n.jsx)("div",{className:"wpqt-italic",children:e.user_description})]}),(0,n.jsx)("div",{children:r(e.created_at_utc)}),(0,n.jsx)("div",{children:r(e.expires_at_utc)}),(0,n.jsx)("div",{className:c?"wpqt-text-qtTextGreen":"wpqt-text-qtTextRed",children:c?(0,o.__)("On","quicktasker"):(0,o.__)("Off","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-4",children:[c?(0,n.jsx)(al.A,{className:"wpqt-icon-red wpqt-size-5 wpqt-cursor-pointer",onClick:()=>l(!1),title:(0,o.__)("Turn session off","quicktasker")}):(0,n.jsx)(al.A,{className:"wpqt-icon-green wpqt-size-5 wpqt-cursor-pointer",onClick:()=>l(!0),title:(0,o.__)("Turn session on","quicktasker")}),s&&(0,n.jsx)(Ra.A,{className:"wpqt-icon-red wpqt-size-5 wpqt-cursor-pointer",title:(0,o.__)("Delete session","quicktasker"),onClick:()=>bl(this,void 0,void 0,(function*(){try{yield(s=e.id,Ot()({path:`/wpqt/v1/users/sessions/${s}`,method:"DELETE",headers:Ct()})),t({type:Fe,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete session","quicktasker"))}var s}))})]})]})}function Tl(){const{state:{userSessions:e}}=(0,a.useContext)(gl),{filterSessions:t}=yl(),s=e.filter(t);return 0===s.length?(0,n.jsx)(Wi,{text:(0,o.__)("No sessions found","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-grid wpqt-grid-cols-5 wpqt-font-bold",children:[(0,n.jsx)("div",{children:(0,o.__)("Session owner","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Created at","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Expires at","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Status","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Actions","quicktasker")})]}),(0,n.jsx)("div",{className:"wpqt-grid wpqt-grid-cols-5 wpqt-items-center wpqt-gap-y-4",children:s.map((e=>(0,n.jsx)(El,{session:e},e.id)))})]})}function Al(){return(0,n.jsx)(vl,{children:(0,n.jsx)(ra,{children:(0,n.jsx)(Sl,{})})})}function Sl(){const{state:{userSessions:e}}=(0,a.useContext)(gl);return e.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d,{children:(0,o.__)("Quicktasker sessions","quicktasker")}),(0,n.jsx)(jl,{}),(0,n.jsx)(Tl,{})]}):(0,n.jsx)(vo,{infoTitle:(0,o.__)("No sessions","quicktasker"),infoDescription:(0,o.__)("No QuickTasker sessions found","quicktasker")})}function Nl(){const{state:{usersSearchValue:e},userDispatch:t}=(0,a.useContext)(Ea);return(0,n.jsx)(ka,{title:(0,o.__)("User filtering","quicktasker"),searchChildren:(0,n.jsx)(ga,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"user-search",children:(0,n.jsx)(ua,{inputId:"user-search",value:e,onChange:e=>{t({type:Se,payload:e})}})})})}var Ol=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Cl({userId:e}){return(0,n.jsx)(xi,{typeId:e,fetchData:()=>Ol(this,void 0,void 0,(function*(){try{return(yield Rt(e,hs.User)).data}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load log","quicktasker"))}})),renderItem:e=>(0,n.jsx)(pi,{log:e}),noDataMessage:(0,o.__)("No logs available","quicktasker"),explanation:(0,o.__)("Logs can be seen only by WordPress users (with required permissions)","quicktasker")})}var Il=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Dl({userId:e}){return(0,n.jsx)(xi,{typeId:e,fetchData:()=>Il(this,void 0,void 0,(function*(){try{return(yield Dt(e,hs.User,!0)).data.map(Ei)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load private comments","quicktasker"))}})),onAdd:t=>Il(this,void 0,void 0,(function*(){try{const s=yield Pt(e,hs.User,!0,t);return Ei(s.data.newComment)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add private comment","quicktasker"))}})),renderItem:e=>(0,n.jsx)(gi,{item:e}),noDataMessage:(0,o.__)("No comments available","quicktasker"),explanation:(0,o.__)("Comments that can be added and viewed only by WordPress users (with required permissions).","quicktasker"),enableAdd:!0})}var Pl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Rl({userId:e}){const{addComment:t}=bi();return(0,n.jsx)(xi,{typeId:e,fetchData:()=>Pl(this,void 0,void 0,(function*(){try{return(yield Dt(e,hs.User,!1)).data.map(Ei)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load comments","quicktasker"))}})),onAdd:s=>Pl(this,void 0,void 0,(function*(){const a=yield t(e,hs.User,!1,s);if(a)return Ei(a)})),renderItem:e=>(0,n.jsx)(gi,{item:e}),noDataMessage:(0,o.__)("No comments available","quicktasker"),explanation:(0,o.__)("Comments that can be added and viewed by WordPress users (with required permissions) and current QuickTasker user (in user page).","quicktasker"),enableAdd:!0})}function Ll({user:e}){const t=[(0,o.__)("Private comments","quicktasker"),(0,o.__)("Public comments","quicktasker"),(0,o.__)("Logs","quicktasker")];return(0,n.jsx)(ci,{tabs:t,tabsContent:[(0,n.jsx)(Dl,{userId:e.id},1),(0,n.jsx)(Rl,{userId:e.id},2),(0,n.jsx)(Cl,{userId:e.id},3)]})}var Ml=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Ul=(0,a.forwardRef)((function({modalSaving:e,editUser:t},s){const{state:{userToEdit:i},modalDispatch:r}=(0,a.useContext)(As),{state:{isUserAllowedToDelete:c}}=(0,a.useContext)(Ga),[l,d]=(0,a.useState)(""),[u,p]=(0,a.useState)(""),[m,h]=(0,a.useState)(!1),[w,f]=(0,a.useState)(!1),{changeUserStatus:q,deleteUser:_,resetUserPassword:x}=ol(),{userDispatch:k}=(0,a.useContext)(Ea),{loading1:g,setLoading1:v,loading2:j,setLoading2:y,loading3:b,setLoading3:E}=$a();(0,a.useEffect)((()=>{i&&(d(i.name),p(i.description),h(i.is_active),f(i.has_password))}),[i]);const T=()=>{d(""),p("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:T}))),i?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsxs)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:[(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-3 md:wpqt-grid-cols-[auto_1fr]",children:[(0,n.jsx)("div",{children:(0,n.jsxs)(Qs,{children:[(0,n.jsx)(Ys,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(ua,{isAutoFocus:!0,value:l,onChange:e=>d(e)})}),(0,n.jsx)(Ys,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(sn,{rowsCount:3,value:u,onChange:e=>p(e)})})]})}),(0,n.jsx)(Dn,{entityId:i.id,entityType:Xa.User})]}),(0,n.jsx)(Js,{onSave:()=>{i&&t(Object.assign(Object.assign({},i),{name:l,description:u}))},saveBtnText:e?(0,o.__)("Saving...","quicktasker"):(0,o.__)("Save","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mt-7",children:(0,n.jsx)(Ll,{user:i})})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)(Vs,{icon:(0,n.jsx)(ll.A,{className:"wpqt-icon-blue wpqt-size-4"}),text:(0,o.__)("User details","quicktasker"),onClick:()=>{window.location.hash=`#/users/${i.id}`,r({type:B})}}),(0,n.jsx)(Vs,{icon:(0,n.jsx)(Gr.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("User tasks","quicktasker"),onClick:()=>{window.location.hash=`#/users/${i.id}/tasks`,r({type:B})}}),w&&(0,n.jsx)(Vs,{icon:(0,n.jsx)(nl.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Reset password","quicktasker"),loading:g,onClick:()=>Ml(this,void 0,void 0,(function*(){v(!0),yield x(i.id,(()=>{k({type:Ie,payload:i.id}),f(!1)})),v(!1)}))}),!m&&(0,n.jsx)(Vs,{icon:(0,n.jsx)(al.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Activate user","quicktasker"),loading:j,onClick:()=>Ml(this,void 0,void 0,(function*(){y(!0),yield q(i.id,!0,(e=>{k({type:Ne,payload:Object.assign({},e)}),h(!0)})),y(!1)}))}),m&&(0,n.jsx)(Vs,{icon:(0,n.jsx)(al.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Disable user","quicktasker"),loading:j,onClick:()=>Ml(this,void 0,void 0,(function*(){y(!0),yield q(i.id,!1,(e=>{k({type:Ne,payload:Object.assign({},e)}),h(!1)})),y(!1)}))}),c&&(0,n.jsx)(Pn,{confirmMessage:(0,o.__)("Are you sure you want to delete this user?","quicktasker"),onConfirm:()=>Ml(this,void 0,void 0,(function*(){E(!0),yield _(i.id,(e=>{k({type:Oe,payload:e}),r({type:B})})),E(!1)})),containerClassName:"wpqt-flex",children:({onClick:e})=>(0,n.jsx)(Vs,{icon:(0,n.jsx)(Ra.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Delete user","quicktasker"),loading:b,onClick:e,className:"wpqt-w-full"})})]})]})}):null}));var Fl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function $l(){const{state:{userModalOpen:e}}=(0,a.useContext)(As),{modalSaving:t,setModalSaving:s,modalContentRef:i,closeModal:o,handleSuccess:r}=Sa(B),{editUser:c}=ol();return(0,n.jsx)(Hs,{modalOpen:e,closeModal:o,size:"xl",children:(0,n.jsx)(Ul,{ref:i,modalSaving:t,editUser:e=>Fl(this,void 0,void 0,(function*(){s(!0),yield c(e,(e=>{r(Ne,e,Aa.USER)})),s(!1)}))})})}function Kl(){const{state:{userSettingsModalOpen:e},modalDispatch:t}=(0,a.useContext)(As);return(0,n.jsx)(Hs,{modalOpen:e,closeModal:()=>t({type:Y,payload:!1}),size:"lg",children:(0,n.jsx)("div",{children:(0,n.jsx)(Dn,{entityId:"null",entityType:Xa.Users})})})}var zl=s(8316),Gl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Vl(){const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(""),{userDispatch:d}=(0,a.useContext)(Ea),{createUser:u}=ol(),p=()=>{r(""),l(""),t(!1)};return(0,n.jsx)("div",{className:"wpqt-mb-6",children:e?(0,n.jsxs)("div",{className:"wpqt-w-1/4",children:[(0,n.jsx)("label",{className:"wpqt-mb-2 wpqt-block wpqt-font-semibold",children:(0,o.__)("User name","quicktasker")}),(0,n.jsx)(ua,{value:s,onChange:r,className:"wpqt-w-full"}),(0,n.jsx)("label",{className:"wpqt-mb-2 wpqt-block wpqt-font-semibold",children:(0,o.__)("User description","quicktasker")}),(0,n.jsx)(sn,{value:c,onChange:l,className:"wpqt-w-full"}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:[(0,n.jsx)(Vs,{text:(0,o.__)("Cancel","quicktasker"),onClick:p,icon:(0,n.jsx)(Ds.A,{className:"wpqt-icon-red wpqt-size-5"})}),(0,n.jsx)(Vs,{text:(0,o.__)("Add","quicktasker"),onClick:()=>Gl(this,void 0,void 0,(function*(){s?yield u(s,c,(e=>{d({type:Ae,payload:e}),p()})):i.oR.error("User name is required")})),icon:(0,n.jsx)(zl.A,{className:"wpqt-icon-green wpqt-size-5"})})]})]}):(0,n.jsx)(Vs,{text:(0,o.__)("Add QuickTasker","quicktasker"),onClick:()=>t(!0),icon:(0,n.jsx)(zl.A,{className:"wpqt-icon-green wpqt-size-5"})})})}const Bl=()=>{const{state:{usersSearchValue:e}}=(0,a.useContext)(Ea);return{filterUsers:t=>t.name.toLowerCase().includes(e.toLowerCase())||t.description&&t.description.toLowerCase().includes(e.toLowerCase())}};var Hl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Wl({user:e}){const{modalDispatch:t}=(0,a.useContext)(As),{userDispatch:s}=(0,a.useContext)(Ea),{changeUserStatus:i,deleteUser:r,resetUserPassword:c}=ol(),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),w=e.is_active,f=t=>Hl(this,void 0,void 0,(function*(){h(!0),yield i(e.id,t,(()=>{s({type:Ce,payload:{userId:e.id,isActive:t}})})),h(!1)}));return(0,n.jsxs)(Un,{menuBtn:({active:e})=>(0,n.jsx)(Fn,{isActive:e,IconComponent:to.A}),children:[(0,n.jsx)($n,{text:(0,o.__)("User details","quicktasker"),icon:(0,n.jsx)(ll.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}`}}),(0,n.jsx)($n,{text:(0,o.__)("User tasks","quicktasker"),icon:(0,n.jsx)(Gr.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}/tasks`}}),(0,n.jsx)($n,{text:(0,o.__)("Edit user","quicktasker"),icon:(0,n.jsx)(Hn.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:H,payload:e})}}),e.has_password&&(0,n.jsx)($n,{text:(0,o.__)("Reset password","quicktasker"),loading:l,icon:(0,n.jsx)(nl.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>Hl(this,void 0,void 0,(function*(){t.stopPropagation(),d(!0),yield c(e.id,(()=>{s({type:Ie,payload:e.id})})),d(!1)}))}),w&&(0,n.jsx)($n,{text:(0,o.__)("Disable user","quicktasker"),loading:m,icon:(0,n.jsx)(al.A,{className:"wpqt-icon-red wpqt-size-4"}),className:"!wpqt-mb-0",onClick:e=>{e.stopPropagation(),f(!1)}}),!w&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)($n,{text:(0,o.__)("Activate user","quicktasker"),loading:m,icon:(0,n.jsx)(al.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:e=>{e.stopPropagation(),f(!0)}}),(0,n.jsx)($n,{text:(0,o.__)("Delete user","quicktasker"),loading:u,icon:(0,n.jsx)(Ra.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>Hl(this,void 0,void 0,(function*(){t.stopPropagation(),p(!0),yield r(e.id,(e=>{s({type:Oe,payload:e})})),p(!1)}))})]})]})}function Ql({user:e}){const{userPage:t}=pl(),{modalDispatch:s}=(0,a.useContext)(As),i=e.is_active,r=t+"&code="+e.page_hash;return(0,n.jsxs)(Ji,{title:e.name,description:e.description,dropdown:(0,n.jsx)(Wl,{user:e}),onClick:()=>{s({type:H,payload:e})},className:"wpqt-cursor-pointer",children:[(0,n.jsx)(eo,{className:"hover:wpqt-underline wpqt-self-start",label:(0,o.__)("Open user page","quicktasker"),icon:(0,n.jsx)(so.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:e=>{e.stopPropagation(),window.open(r,"_blank")}}),(0,n.jsx)(eo,{className:"hover:wpqt-underline wpqt-self-start",label:(0,o.__)("View user details","quicktasker"),icon:(0,n.jsx)(so.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}`}}),(0,n.jsx)(eo,{label:(0,o.__)("Status","quicktasker"),value:i?(0,o.__)("Active","quicktasker"):(0,o.__)("Disabled","quicktasker"),valueClassName:i?"wpqt-text-qtTextGreen wpqt-font-bold":"wpqt-text-qtTextRed wpqt-font-bold",icon:(0,n.jsx)(al.A,{className:"wpqt-size-5 "+(i?"wpqt-icon-green":"wpqt-icon-red")})})]})}function Yl(){const{state:{users:e}}=(0,a.useContext)(Ea),{filterUsers:t}=Bl(),s=e.filter(t);return e&&0===e.length?(0,n.jsx)(Wi,{text:(0,o.__)("No users found","quicktasker")}):s&&0===s.length?(0,n.jsx)(Wi,{}):(0,n.jsx)("div",{className:"wpqt-card-grid",children:s.map((e=>(0,n.jsx)(Ql,{user:e},e.id)))})}function Jl(){return(0,n.jsxs)("div",{children:[(0,n.jsx)(Vl,{}),(0,n.jsx)(Nl,{}),(0,n.jsx)(Yl,{}),(0,n.jsx)(Kl,{}),(0,n.jsx)($l,{})]})}var Xl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};var Zl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ed({user:e}){const[t,s]=(0,a.useState)({quicktasker_admin_role:"quicktasker_admin_role"in e.allcaps,quicktasker_admin_role_allow_delete:"quicktasker_admin_role_allow_delete"in e.allcaps,quicktasker_admin_role_manage_users:"quicktasker_admin_role_manage_users"in e.allcaps,quicktasker_admin_role_manage_settings:"quicktasker_admin_role_manage_settings"in e.allcaps,quicktasker_admin_role_manage_archive:"quicktasker_admin_role_manage_archive"in e.allcaps}),[i,r]=(0,a.useState)(!1),{updateWPUserCapabilities:c}=function(){return{updateWPUserCapabilities:(e,t,s,a)=>Xl(this,void 0,void 0,(function*(){try{yield function(e,t){return Ot()({path:`/wpqt/v1/wp-users/${e}/capabilities`,method:"PATCH",data:{quicktasker_admin_role:t.quicktasker_admin_role,quicktasker_admin_role_allow_delete:t.quicktasker_admin_role_allow_delete,quicktasker_admin_role_manage_users:t.quicktasker_admin_role_manage_users,quicktasker_admin_role_manage_settings:t.quicktasker_admin_role_manage_settings,quicktasker_admin_role_manage_archive:t.quicktasker_admin_role_manage_archive},headers:Ct()})}(e,t),s&&s()}catch(e){a&&a(e)}}))}}(),l=(a,n)=>Zl(this,void 0,void 0,(function*(){if(i)return;r(!0);const o=Object.assign({},t),l=Object.assign(Object.assign({},t),{[n]:a});s(l),yield c(e.id,l,(()=>{}),(()=>{s(o)})),r(!1)}));return(0,n.jsxs)(Ji,{title:e.name,description:e.description,children:[(0,n.jsx)(eo,{label:(0,o.__)("Role","quicktasker"),value:Array.isArray(e.roles)?e.roles.join(", "):""}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to admin areas","quicktasker")}),(0,n.jsx)(nn,{checked:t.quicktasker_admin_role,handleChange:e=>{l(e,"quicktasker_admin_role")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to users page","quicktasker")}),(0,n.jsx)(nn,{checked:t.quicktasker_admin_role_manage_users,handleChange:e=>{l(e,"quicktasker_admin_role_manage_users")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to settings page","quicktasker")}),(0,n.jsx)(nn,{checked:t.quicktasker_admin_role_manage_settings,handleChange:e=>{l(e,"quicktasker_admin_role_manage_settings")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to archive page","quicktasker")}),(0,n.jsx)(nn,{checked:t.quicktasker_admin_role_manage_archive,handleChange:e=>{l(e,"quicktasker_admin_role_manage_archive")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Allow to delete resources","quicktasker")}),(0,n.jsx)(nn,{checked:t.quicktasker_admin_role_allow_delete,handleChange:e=>{l(e,"quicktasker_admin_role_allow_delete")}})]}),i&&(0,n.jsx)(Us,{ovalSize:"24"})]})}var td=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function sd(){const[e,t]=(0,a.useState)(null),[s,i]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(()=>{td(this,void 0,void 0,(function*(){try{i(!0);const s=yield(e=qs.Other,Ot()({path:`/wpqt/v1/wp-users?type=${encodeURIComponent(e)}`,method:"GET",headers:Ct()}));t(s.data)}catch(e){console.error(e)}finally{i(!1)}var e}))})()}),[]),s||null===e?(0,n.jsx)(Us,{ovalSize:"48"}):0===e.length?(0,n.jsx)(Wi,{text:(0,o.__)("No non-admin WordPress users found","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Displaying non-admin WordPress users.","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-card-grid",children:e.map((e=>(0,n.jsx)(ed,{user:e},e.id)))})]})}function ad(){const{updateUsers:e}=(0,a.useContext)(Ea),{loadingDispatch:t}=(0,a.useContext)(as),{modalDispatch:s}=(0,a.useContext)(As),i=[(0,n.jsx)(Jl,{},0),(0,n.jsx)(sd,{},1)];return(0,a.useEffect)((()=>{(()=>{var s,a,n,i;s=this,a=void 0,i=function*(){t({type:Re,payload:!0}),yield e(),t({type:Re,payload:!1})},new((n=void 0)||(n=Promise))((function(e,t){function o(e){try{c(i.next(e))}catch(e){t(e)}}function r(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(s,a||[])).next())}))})()}),[]),(0,n.jsxs)(ra,{children:[(0,n.jsx)(d,{description:(0,o.__)("Manage QuickTaskers and WordPress users. This plugin supports three types of users: WordPress admins, other WordPress users, and QuickTaskers. WordPress admins have full access to all admin areas. Other WordPress users do not have any access by default but can be granted if needed. QuickTaskers are separate users who do not have admin access but can manage tasks through a mobile-friendly webpage.","quicktasker"),icon:(0,n.jsx)(l.A,{className:"wpqt-icon-gray wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{s({type:Y,payload:!0})}}),children:(0,o.__)("Users","quicktasker")}),(0,n.jsx)(ci,{tabs:["QuickTaskers","WordPress users"],tabsContent:i,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})]})}const nd=(e,t)=>{switch(t.type){case $e:{const s=t.payload.map(Jt);return Object.assign(Object.assign({},e),{tasks:s})}case ze:{const s=t.payload;return Object.assign(Object.assign({},e),{tasks:e.tasks.filter((e=>e.id!==s))})}case Ge:{const s=t.payload,a=e.tasks.map((e=>e.id===s.id?Jt(s):e));return Object.assign(Object.assign({},e),{tasks:a})}case Ke:{const s=t.payload;return Object.assign(Object.assign({},e),{searchValue:s})}case Ve:{const s=t.payload;return Object.assign(Object.assign({},e),{filteredPipelineId:s})}case Be:{const{taskId:s,user:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:Ut(a)?[a,...e.assigned_users]:e.assigned_users,assigned_wp_users:Ft(a)?[a,...e.assigned_wp_users]:e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{tasks:n})}case He:{const{taskId:s,user:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:Ut(a)?e.assigned_users.filter((e=>e.id!==a.id)):e.assigned_users,assigned_wp_users:Ft(a)?e.assigned_wp_users.filter((e=>e.id!==a.id)):e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{tasks:n})}case We:{const{taskId:s,done:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}default:return e}};var id=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const od={tasks:[],searchValue:"",filteredPipelineId:""},rd=(0,a.createContext)({state:od,userTasksDispatch:()=>{},fetchAndSetUserTasks:()=>id(void 0,void 0,void 0,(function*(){}))}),cd=({children:e,userId:t})=>{const[s,r]=(0,a.useReducer)(nd,od),{loadingDispatch:c}=(0,a.useContext)(as);(0,a.useEffect)((()=>{l()}),[]);const l=()=>id(void 0,void 0,void 0,(function*(){try{c({type:Re,payload:!0});const e=yield function(e){return Ot()({path:`/wpqt/v1/users/${e}/tasks`,method:"GET",headers:Ct()})}(t);r({type:$e,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch user tasks","quicktasker"))}finally{c({type:Re,payload:!1})}}));return(0,n.jsx)(rd.Provider,{value:{state:s,userTasksDispatch:r,fetchAndSetUserTasks:l},children:e})};function ld(){const{state:{searchValue:e,filteredPipelineId:t},userTasksDispatch:s}=(0,a.useContext)(rd);return(0,n.jsx)(ka,{title:(0,o.__)("Filter tasks","quicktasker"),searchChildren:(0,n.jsx)(ga,{title:(0,o.__)("Search","quicktasker"),labelIdFor:"user-tasks-search",children:(0,n.jsx)(ua,{inputId:"user-tasks-search",value:e,onChange:e=>{s({type:Ke,payload:e})},className:"!wpqt-mb-0"})}),children:(0,n.jsx)(ga,{title:(0,o.__)("Board","quicktasker"),children:(0,n.jsx)(_a,{selectedOptionValue:t,selectionChange:e=>{s({type:Ve,payload:e})}})})})}var dd=s(7028),ud=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function pd({taskId:e,onUnAssignTask:t}){const[s,i]=(0,a.useState)(!1);return(0,n.jsx)(Un,{menuBtn:({active:e})=>(0,n.jsx)(Fn,{isActive:e,IconComponent:to.A}),children:(0,n.jsx)($n,{text:(0,o.__)("Unassign from task","quicktasker"),loading:s,icon:(0,n.jsx)(dd.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:s=>ud(this,void 0,void 0,(function*(){s.stopPropagation(),i(!0),yield t(e),i(!1)})),className:"!wpqt-mb-0"})})}const md=()=>{const{state:{searchValue:e,filteredPipelineId:t}}=(0,a.useContext)(rd);return{filterTasks:s=>{const a=s.name&&s.name.toLowerCase().includes(e.toLowerCase())||s.description&&s.description.toLowerCase().includes(e.toLowerCase()),n=!t||s.pipeline_id===t;return a&&n}}};var hd=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function wd({userId:e}){var t;const{filterTasks:s}=md(),{modalDispatch:i}=(0,a.useContext)(As),{state:{tasks:r},userTasksDispatch:c}=(0,a.useContext)(rd),{removeTaskFromUser:l}=ps(),d=null!==(t=null==r?void 0:r.filter(s))&&void 0!==t?t:[],u=t=>hd(this,void 0,void 0,(function*(){yield l(e,t,(()=>{c({type:ze,payload:t})}))}));return r&&0===r.length?(0,n.jsx)(Wi,{text:(0,o.__)("User has no tasks","quicktasker")}):d&&0===d.length?(0,n.jsx)(Wi,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-card-grid",children:d.map((e=>(0,n.jsxs)(Ji,{className:"wpqt-cursor-pointer",title:e.name,description:e.description,dropdown:(0,n.jsx)(pd,{taskId:e.id,onUnAssignTask:u}),onClick:()=>{i({type:M,payload:{taskToEdit:e}})},children:[(0,n.jsx)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:(0,n.jsx)(oi,{task:e,onUserAdd:t=>{c({type:Be,payload:{taskId:e.id,user:t}})},onUserDelete:t=>{c({type:He,payload:{taskId:e.id,user:t}})}})}),(0,n.jsx)(Zi,{task:e,onDoneStatusChange:(e,t)=>{c({type:We,payload:{taskId:e,done:t}})}})]},e.id)))}),(0,n.jsx)(Hi,{editTaskCallback:e=>{c({type:Ge,payload:e})}})]})}function fd({userId:e}){return(0,n.jsx)(cd,{userId:e,children:(0,n.jsxs)(ra,{children:[(0,n.jsx)(d,{description:(0,o.__)("Tasks assigned to user","quicktasker"),children:(0,o.__)("User tasks","quicktasker")}),(0,n.jsx)(ld,{}),(0,n.jsx)(wd,{userId:e})]})})}const qd=()=>{const{page:e,hash:t}=_d();if("wp-quick-tasks"===e){const e=t.match(/^#\/users\/(\d+)\/tasks$/);if(e){const t=e[1];return(0,n.jsx)(fd,{userId:t})}const s=t.match(/^#\/users\/(\d+)$/);if(s){const e=s[1];return(0,n.jsx)(fl,{userId:e})}switch(t){case"#/users":return(0,n.jsx)(ad,{});case"#/overview":return(0,n.jsx)(Do,{});case"#/archive":return(0,n.jsx)(co,{});case"#/user-sessions":return(0,n.jsx)(Al,{});case"#/logs":return(0,n.jsx)(go,{});case"#/settings":return(0,n.jsx)(sl,{});case"#/guide":return(0,n.jsx)(lo,{});default:return(0,n.jsx)(ec,{})}}},_d=()=>({page:new URLSearchParams(window.location.search).get("page"),hash:window.location.hash}),xd=function(){const e=(()=>{const[e,t]=(0,a.useState)(qd());return(0,a.useEffect)((()=>{const e=()=>{t(qd()),(()=>{const{page:e,hash:t}=_d();if("wp-quick-tasks"!==e)return;const s=document.querySelectorAll("#toplevel_page_wp-quick-tasks .wp-submenu li");s.forEach((e=>e.classList.remove("wpqt-current")));const a={"#/users":"#/users","#/overview":"#/overview","#/archive":"#/archive","#/user-sessions":"#/user-sessions","#/logs":"#/logs","#/settings":"#/settings","#/guide":"#/guide",default:""};let n=a.default;void 0!==a[t]?n=a[t]:/^#\/users(\/\d+)?(\/tasks)?$/.test(t)&&(n="#/users"),s.forEach((e=>{const t=e.querySelector("a");t&&t.getAttribute("href")&&t.getAttribute("href")===`admin.php?page=wp-quick-tasks${n}`&&e.classList.add("wpqt-current")}))})()};return e(),window.addEventListener("popstate",e),window.addEventListener("hashchange",e),()=>{window.removeEventListener("popstate",e),window.removeEventListener("hashchange",e)}}),[]),e})();return(0,n.jsx)(c,{children:(0,n.jsx)(Va,{children:(0,n.jsx)(Ta,{children:(0,n.jsx)(Ss,{children:(0,n.jsx)(wa,{children:(0,n.jsxs)(ns,{children:[e,(0,n.jsx)(i.N9,{position:"bottom-right",className:"wpqt-z-[999999]"})]})})})})})})};(0,a.render)((0,n.jsx)(xd,{}),document.getElementById("wpqt-app"))},1609:e=>{e.exports=window.React},5795:e=>{e.exports=window.ReactDOM},790:e=>{e.exports=window.ReactJSXRuntime}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return a[e].call(s.exports,s,s.exports,i),s.exports}i.m=a,e=[],i.O=(t,s,a,n)=>{if(!s){var o=1/0;for(d=0;d<e.length;d++){for(var[s,a,n]=e[d],r=!0,c=0;c<s.length;c++)(!1&n||o>=n)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(r=!1,n<o&&(o=n));if(r){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,a,n]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},s=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var n=Object.create(null);i.r(n);var o={};t=t||[null,s({}),s([]),s(s)];for(var r=2&a&&e;"object"==typeof r&&!~t.indexOf(r);r=s(r))Object.getOwnPropertyNames(r).forEach((t=>o[t]=()=>e[t]));return o.default=()=>e,i.d(n,o),n},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=524,(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var a=s.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=s[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={524:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[o,r,c]=s,l=0;if(o.some((t=>0!==e[t]))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(c)var d=c(i)}for(t&&t(s);l<o.length;l++)n=o[l],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},s=globalThis.webpackChunkquicktasker=globalThis.webpackChunkquicktasker||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.nc=void 0;var o=i.O(void 0,[96],(()=>i(6247)));o=i.O(o)})();