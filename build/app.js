(()=>{"use strict";var e,t,s,a={9897:(e,t,s)=>{const a=window.wp.element;var n=s(790),i=s(9571);const o=window.wp.i18n;class r extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){var e;return this.state.hasError?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-h-screen wpqt-items-center wpqt-justify-center wpqt-text-center wpqt-text-lg",children:[(0,o.__)("Something went wrong. Please refresh the page.","quicktasker"),(0,n.jsx)("br",{}),null===(e=this.state.error)||void 0===e?void 0:e.message]}):this.props.children}}const c=r;function l({children:e,description:t=null,icon:s=null}){return(0,n.jsx)("div",{className:"wpqt-mb-6 wpqt-inline-grid wpqt-grid-cols-[auto_auto] wpqt-items-center wpqt-gap-2",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("h1",{children:[e,s&&(0,n.jsx)("span",{className:"wpqt-ml-1 wpqt-align-middle",children:s})]}),t&&(0,n.jsx)("div",{children:t})]})})}const d=window.wp.apiFetch;var u=s.n(d);function p(){return{"Content-Type":"application/json","X-WPQT-API-Nonce":window.wpqt.apiNonce}}function h(e,t,s){return u()({path:`/wpqt/v1/tasks/${e}/move`,method:"PATCH",data:{stageId:t,order:s},headers:p()})}function w(e,t,s){const a=new URLSearchParams({typeId:e,type:t,isPrivate:s.toString()}).toString();return u()({path:`/wpqt/v1/comments?${a}`,method:"GET",headers:p()})}function m(e,t,s,a){return u()({path:"/wpqt/v1/comments",data:{comment:a,typeId:e,type:t,isPrivate:s},method:"POST",headers:p()})}function q(e,t){const s=new URLSearchParams({typeId:e,type:t});return u()({path:`/wpqt/v1/logs?${s.toString()}`,method:"GET",headers:p()})}function v(e,t,s){return u()({path:`/wpqt/v1/users/${e}/tasks/${t}`,method:"DELETE",data:{user_type:s},headers:p()})}function x(e,t,s){const a=new URLSearchParams({entityId:e,entityType:t,active:String(s)});return u()({path:`/wpqt/v1/custom-fields?${a.toString()}`,method:"GET",headers:p()})}const f="SET_LOADING",_="SET_PIPELINE",k="MOVE_TASK",g="ADD_TASK",j="ADD_STAGE",y="DELETE_STAGE",b="EDIT_TASK",T="EDIT_STAGE",E="ADD_PIPELINE",S="EDIT_PIPELINE",A="SET_PRIMARY",C="SET_PIPELINES",O="ADD_USER_TO_TASK",N="REMOVE_USER_FROM_TASK",D="CHANGE_TASK_DONE_STATUS",I="REMOVE_PIPELINE",P="REMOVE_ACTIVE_PIPELINE",R="REMOVE_TASK",L="TOGGLE_VIEW",U="ADD_LABEL_TO_TASK",M="REMOVE_LABEL_FROM_TASK",F="EDIT_PIPELINE_LABEL",z="REMOVE_PIPELINE_LABEL",K="SET_TASK_FOCUS_COLOR",$="SET_STAGE_FILTER",G="SET_USER_FILTER",V="OPEN_EDIT_TASK_MODAL",B="CLOSE_TASK_MODAL",H="OPEN_NEW_STAGE_MODAL",W="CLOSE_STAGE_MODAL",Q="OPEN_STAGE_EDIT_MODAL",Y="OPEN_NEW_PIPELINE_MODAL",X="OPEN_EDIT_PIPELINE_MODAL",J="CLOSE_PIPELINE_EDIT_MODAL",Z="CLOSE_USER_MODAL",ee="OPEN_EDIT_USER_MODAL",te="ADD_ASSIGNED_USER_TO_EDITING_TASK",se="REMOVE_ASSIGNED_USER_FROM_EDITING_TASK",ae="CHANGE_USER_SETTINGS_MODAL_OPEN",ne="OPEN_MOVE_TASK_MODAL",ie="CLOSE_MOVE_TASK_MODAL",oe="OPEN_TASK_COLOR_MODAL",re="CLOSE_TASK_COLOR_MODAL",ce="OPEN_TASK_EXPORT_MODAL",le="CLOSE_TASK_EXPORT_MODAL",de="SET_ARCHIVE_TASKS",ue="SET_ARCHIVE_SEARCH_VALUE",pe="SET_ARCHIVE_FILTERED_PIPELINE",he="REMOVE_ARCHIVED_TASK",we="ADD_ASSIGNED_USER_TO_ARCHIVED_TASK",me="REMOVE_ASSINGED_USER_FROM_ARCHIVED_TASK",qe="CHANGE_ARCHIVED_TASK_DONE_STATUS",ve="EDIT_ARCHIVED_TASK",xe="CHANGE_ARCHIVE_TASK_DONE_FILTER",fe="ADD_LABEL_ARCHIVED_TASK",_e="REMOVE_LABEL_ARCHIVED_TASK",ke="SET_USERS",ge="SET_WP_USERS",je="ADD_USER",ye="SET_USERS_SEARCH_VALUE",be="EDIT_USER",Te="DELETE_USER",Ee="CHANGE_USER_STATUS",Se="RESET_PASSWORD",Ae="INIT_APP_STATE",Ce="SET_CUSTOM_USER_PAGE_STYLES",Oe="SET_FULL_PAGE_LOADING",Ne="SET_USER_SESSIONS_SEARCH_VALUE",De="SET_USER_SESSIONS",Ie="CHANGE_USER_SESSION_STATUS",Pe="DELETE_USER_SESSION",Re="SET_USER_TASKS",Le="SET_USER_TASKS_SEARCH_VALUE",Ue="REMOVE_USER_TASK",Me="EDIT_USER_TASK",Fe="SET_USER_TASKS_FILTERED_PIPELINE",ze="ADD_ASSIGNED_USER_TO_USER_TASK",Ke="REMOVE_ASSIGNED_USER_FROM_USER_TASK",$e="CHANGE_USER_TASK_DONE_STATUS",Ge="SET_CUSTOM_FIELDS",Ve="ADD_CUSTOM_FIELD",Be="DELETE_CUSTOM_FIELD",He="SET_CUSTOM_FIELD_LOADING",We="SET_CUSTOM_FIELD_INITIAL_DATA",Qe="SET_LABELS",Ye="ADD_LABEL",Xe="REMOVE_LABEL",Je="EDIT_LABEL",Ze="SET_LABEL_ACTION_STATE_SELECTION",et="SET_LABEL_ACTION_STATE_EDITING",tt="SET_LABEL_ACTION_STATE_CREATION",st="RESET_LABEL_CONTEXT",at="SET_PIPELINE_AUTOMATIONS",nt="SET_PIPELINE_AUTOMATIONS_LOADING",it="REMOVE_PIPELINE_AUTOMATION",ot="ADD_PIPELINE_AUTOMATION",rt="UPDATE_PIPELINE_AUTOMATION_ACTIVE_STATUS",ct="SET_META",lt="SET_ACTION_TARGET",dt="RESET_AUTOMATION_TO_TARGET",ut="RESET_AUTOMATION_TO_TRIGGER",pt="RESET_AUTOMATION_TO_ACTION",ht="SET_UPLOADS",wt="ADD_UPLOAD",mt="REMOVE_UPLOAD",qt=!1,vt="#ffffff",xt="6px",ft="solid",_t=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","text/plain","image/jpeg","image/png","image/gif","image/bmp","image/svg+xml","audio/mpeg","audio/wav","audio/ogg","video/mp4","video/webm","video/ogg","application/zip","application/x-rar-compressed","application/x-tar","application/gzip"],kt=26214400,gt=/^[a-zA-Z0-9_\-.]+$/;var jt,yt,bt,Tt,Et,St;function At(e){return!e.user_type||e.user_type===jt.QUICKTASKER}function Ct(e){return e.user_type===jt.WP_USER}!function(e){e.QUICKTASKER="quicktasker",e.WP_USER="wp-user"}(jt||(jt={})),function(e){e.TASK_DONE="task-done",e.Task_NOT_DONE="task-not-done",e.TASK_CREATED="task-created",e.TASK_DELETED="task-deleted",e.TASK_ASSIGNED="task-assigned",e.TASK_UNASSIGNED="task-unassigned",e.TASK_PUBLIC_COMMENT_ADDED="task-public-comment-added",e.TASK_PRIVATE_COMMENT_ADDED="task-private-comment-added",e.TASK_FILE_UPLOADED="task-attachment-added",e.TASK_FILE_DELETED="task-attachment-deleted"}(yt||(yt={})),function(e){e.WOOCOMMERCE_ORDER_ADDED="woocommerce-order-added"}(bt||(bt={})),function(e){e.PIPELINE="pipeline",e.Stage="stage",e.Task="task",e.quicktasker="quicktasker",e.WOOCOMMERCE_ORDER="woocommerce-order"}(Tt||(Tt={})),function(e){e.PIPELINE="pipeline",e.STAGE="stage",e.TASK="task",e.QUICKTASKER="quicktasker",e.WP_USER="wp-user"}(Et||(Et={})),function(e){e.ARCHIVE_TASK="archive-task",e.ASSIGN_USER="assign-user",e.NEW_ENTITY_EMAIL="new-entity-email",e.DELETED_ENTITY_EMAIL="deleted-entity-email",e.TASK_ASSIGNED_EMAIL="task-assigned-email",e.TASK_UNASSIGNED_EMAIL="task-unassigned-email",e.TASK_PUBLIC_COMMENT_ADDED_EMAIL="task-public-comment-added-email",e.TASK_PRIVATE_COMMENT_ADDED_EMAIL="task-private-comment-added-email",e.TASK_FILE_UPLOADED_EMAIL="task-attachment-added-email",e.TASK_FILE_DELETED_EMAIL="task-attachment-deleted-email",e.CREATE_TASK="create-task",e.SEND_SLACK_MESSAGE="send-slack-message"}(St||(St={}));const Ot=e=>Object.assign(Object.assign({},e),{is_active:"1"===e.is_active,has_password:"1"===e.has_password}),Nt=e=>{switch(e){case Et.QUICKTASKER:return jt.QUICKTASKER;case Et.WP_USER:return jt.WP_USER;default:return null}},Dt={[jt.QUICKTASKER]:"Quicktasker",[jt.WP_USER]:"WordPress User"},It=e=>Object.assign(Object.assign({},e),{task_order:Number(e.task_order),free_for_all:"1"===e.free_for_all,is_archived:"1"===e.is_archived,is_done:"1"===e.is_done,assigned_users:e.assigned_users?e.assigned_users.map((e=>Object.assign({},Ot(e)))):[]}),Pt=(e,t)=>{var s,a,n,i,o,r,c;switch(t.type){case de:{const s=t.payload;return Object.assign(Object.assign({},e),{archivedTasks:s.map(It)})}case ue:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveSearchValue:s})}case pe:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveFilteredPipelineId:s})}case he:{const a=(null!==(s=e.archivedTasks)&&void 0!==s?s:[]).filter((e=>e.id!==t.payload));return Object.assign(Object.assign({},e),{archivedTasks:a})}case we:{const{taskId:s,user:n}=t.payload,i=(null!==(a=e.archivedTasks)&&void 0!==a?a:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:At(n)?[n,...e.assigned_users]:e.assigned_users,assigned_wp_users:Ct(n)?[n,...e.assigned_wp_users]:e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{archivedTasks:i})}case me:{const{taskId:s,user:a}=t.payload,i=(null!==(n=e.archivedTasks)&&void 0!==n?n:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:At(a)?e.assigned_users.filter((e=>e.id!==a.id)):e.assigned_users,assigned_wp_users:Ct(a)?e.assigned_wp_users.filter((e=>e.id!==a.id)):e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{archivedTasks:i})}case qe:{const{taskId:s,done:a}=t.payload,n=(null!==(i=e.archivedTasks)&&void 0!==i?i:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case ve:{const s=t.payload,a=(null!==(o=e.archivedTasks)&&void 0!==o?o:[]).map((e=>e.id===s.id?It(s):e));return Object.assign(Object.assign({},e),{archivedTasks:a})}case xe:{const s=t.payload;return Object.assign(Object.assign({},e),{archiveTaskDoneFilter:s})}case fe:{const{taskId:s,label:a}=t.payload,n=(null!==(r=e.archivedTasks)&&void 0!==r?r:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:[...e.assigned_labels,a]}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}case _e:{const{taskId:s,labelId:a}=t.payload,n=(null!==(c=e.archivedTasks)&&void 0!==c?c:[]).map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:e.assigned_labels.filter((e=>e.id!==a))}):e));return Object.assign(Object.assign({},e),{archivedTasks:n})}default:return e}};var Rt,Lt,Ut,Mt;!function(e){e.Task="task",e.User="user"}(Rt||(Rt={})),function(e){e.System="system",e.Admin="admin",e.WPQTUser="quicktasker_user",e.Automation="automation"}(Lt||(Lt={})),function(e){e.All="all",e.Completed="completed",e.NotCompleted="not completed"}(Ut||(Ut={})),function(e){e.Admin="administrator",e.Other="other"}(Mt||(Mt={}));const Ft=(e,t)=>{if(t.type===Oe){const s=t.payload;return Object.assign(Object.assign({},e),{fullPageLoading:s})}return e},zt={fullPageLoading:!1},Kt=(0,a.createContext)({state:zt,loadingDispatch:()=>{}}),$t=({children:e})=>{const[t,s]=(0,a.useReducer)(Ft,zt);return(0,n.jsx)(Kt.Provider,{value:{state:t,loadingDispatch:s},children:e})};const Gt={archivedTasks:null,archiveLoading:!1,archiveSearchValue:"",archiveFilteredPipelineId:"",archiveTaskDoneFilter:Ut.All},Vt=(0,a.createContext)({state:Gt,archiveDispatch:()=>{}}),Bt=({children:e})=>{const[t,s]=(0,a.useReducer)(Pt,Gt),{loadingDispatch:r}=(0,a.useContext)(Kt);(0,a.useEffect)((()=>{c()}),[]);const c=()=>{return e=void 0,t=void 0,n=function*(){try{r({type:Oe,payload:!0});const{data:e}=yield u()({path:"/wpqt/v1/tasks/archived",method:"GET",headers:p()});s({type:de,payload:e})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch archived tasks","quicktasker"))}finally{r({type:Oe,payload:!1})}},new((a=void 0)||(a=Promise))((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}c((n=n.apply(e,t||[])).next())}));var e,t,a,n};return(0,n.jsx)(Vt.Provider,{value:{state:t,archiveDispatch:s},children:e})};var Ht;!function(e){e.SELECTION="select",e.CREATION="create",e.EDIT="edit"}(Ht||(Ht={}));const Wt=(e,t)=>{switch(t.type){case Qe:return Object.assign(Object.assign({},e),{labels:t.payload});case Ye:return Object.assign(Object.assign({},e),{labels:e.labels?[...e.labels,t.payload]:[t.payload],labelActionState:Ht.SELECTION});case Je:return Object.assign(Object.assign({},e),{labels:e.labels?e.labels.map((e=>e.id===t.payload.id?t.payload:e)):[t.payload]});case Xe:return Object.assign(Object.assign({},e),{labels:e.labels?e.labels.filter((e=>e.id!==t.payload.id)):[]});case Ze:return Object.assign(Object.assign({},e),{labelActionState:Ht.SELECTION,labelToEdit:null});case et:return Object.assign(Object.assign({},e),{labelActionState:Ht.EDIT,labelToEdit:t.payload});case tt:return Object.assign(Object.assign({},e),{labelActionState:Ht.CREATION,labelToEdit:null});case st:return Qt;default:return e}},Qt={labels:null,labelActionState:Ht.SELECTION,labelToEdit:null},Yt=(0,a.createContext)({state:Qt,labelDispatch:()=>{}}),Xt=({children:e})=>{const[t,s]=(0,a.useReducer)(Wt,Qt);return(0,n.jsx)(Yt.Provider,{value:{state:t,labelDispatch:s},children:e})};var Jt=s(6061);function Zt({width:e="80",height:t="80",className:s="",color:a="#1d4ed8",secondaryColor:i="#2563eb"}){return(0,n.jsx)(Jt.BM,{visible:!0,height:t,width:e,color:a,secondaryColor:i,ariaLabel:"oval-loading",wrapperStyle:{},wrapperClass:s})}function es(){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-h-screen-minus-top-bar wpqt-flex-col wpqt-items-center wpqt-justify-center",children:(0,n.jsx)(Zt,{})})}function ts({className:e,ovalSize:t}){const s=t?{width:t,height:t}:{};return(0,n.jsx)("div",{className:`wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center ${e}`,children:(0,n.jsx)(Zt,Object.assign({},s))})}function ss({children:e}){const{state:{fullPageLoading:t}}=(0,a.useContext)(Kt);return(0,n.jsx)("div",{className:"wpqt-pr-4",children:t?(0,n.jsx)(es,{}):e})}var as=s(2912);const ns=e=>Object.assign(Object.assign({},e),{allow_only_last_stage_task_done:"1"===e.allow_only_last_stage_task_done}),is=e=>Object.assign(Object.assign({},e),{stage_order:Number(e.stage_order),tasks:(e.tasks||[]).map((e=>Object.assign({},It(e))))}),os=(e,t)=>{var s;switch(t.type){case C:{const s=t.payload,a=e=>Object.assign({},is(e)),n=e=>{var t;return Object.assign(Object.assign({},e),{stages:null===(t=e.stages)||void 0===t?void 0:t.map(a),settings:e.settings?ns(e.settings):void 0,is_primary:"1"===e.is_primary})};return Object.assign(Object.assign({},e),{pipelines:s.map(n)})}case E:{const a=t.payload,n=e=>Object.assign({},is(e)),i=Object.assign(Object.assign({},a),{stages:null===(s=a.stages)||void 0===s?void 0:s.map(n),settings:a.settings?ns(a.settings):void 0,is_primary:!1});return Object.assign(Object.assign({},e),{pipelines:[...e.pipelines,i]})}case A:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.map((e=>Object.assign(Object.assign({},e),{is_primary:e.id===s})))})}case S:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.map((e=>e.id===s.id?s:e))})}case I:{const s=t.payload;return Object.assign(Object.assign({},e),{pipelines:e.pipelines.filter((e=>e.id!==s))})}default:return e}},rs={pipelines:[]},cs=(0,a.createContext)({state:rs,pipelinesDispatch:()=>{}}),ls=({children:e})=>{const[t,s]=(0,a.useReducer)(os,rs);return(0,a.useEffect)((()=>{const e=window.wpqt.initialPipelines;s({type:C,payload:e})}),[]),(0,n.jsx)(cs.Provider,{value:{state:t,pipelinesDispatch:s},children:e})};var ds=s(3482);function us({options:e,selectedOptionValue:t,onSelectionChange:s,allSelector:a=!0,className:i="",allSelectorLabel:o="All boards",id:r}){return(0,n.jsxs)(ds.l,{id:r,value:t,onChange:e=>{const t=e.target.value;s(t)},className:`!wpqt-rounded-lg !wpqt-border !wpqt-border-solid !wpqt-border-qtBorder !wpqt-px-2 !wpqt-pr-6 !wpqt-py-1 focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${i}`,children:[a&&(0,n.jsx)("option",{value:"",children:o}),e.map((e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value)))]})}function ps({selectedOptionValue:e,selectionChange:t,extraOptions:s=[]}){const{state:{pipelines:i}}=(0,a.useContext)(cs),o=(0,a.useMemo)((()=>i.map((e=>({value:e.id,label:e.name})))),[i]);return(0,n.jsx)(us,{options:[...o,...s],selectedOptionValue:e,onSelectionChange:t})}function hs({children:e,title:t,childrenClassName:s="",titleClassName:a=""}){return(0,n.jsxs)("div",{className:"wpqt-mb-8",children:[(0,n.jsx)("div",{className:`wpqt-mb-3 wpqt-text-lg wpqt-text-center ${a}`,children:t}),(0,n.jsx)("div",{className:`wpqt-flex wpqt-gap-4 wpqt-items-center wpqt-justify-center ${s}`,children:e})]})}function ws(){const{state:{archiveSearchValue:e,archiveFilteredPipelineId:t,archiveTaskDoneFilter:s},archiveDispatch:i}=(0,a.useContext)(Vt);return(0,n.jsxs)(hs,{title:(0,o.__)("Archive filtering","quicktasker"),children:[(0,n.jsx)(as.p,{type:"text",value:e,onChange:e=>{i({type:ue,payload:e.target.value})}}),(0,n.jsx)(ps,{selectedOptionValue:t,selectionChange:e=>{i({type:pe,payload:e})},extraOptions:[{value:"DELETED",label:(0,o.__)("DELETED","quicktasker")}]}),(0,n.jsx)(us,{allSelector:!1,selectedOptionValue:s,options:[{label:(0,o.__)("All status","quicktasker"),value:Ut.All},{label:(0,o.__)("Completed","quicktasker"),value:Ut.Completed},{label:(0,o.__)("Not completed","quicktasker"),value:Ut.NotCompleted}],onSelectionChange:e=>{const t=(e=>{switch(e){case Ut.All:return Ut.All;case Ut.Completed:return Ut.Completed;case Ut.NotCompleted:return Ut.NotCompleted;default:throw new Error(`Invalid selection: ${e}`)}})(e);i({type:xe,payload:t})}})]})}const ms=(e,t)=>{var s,a,n,i,o,r,c,l,d,u,p,h,w,m,q;switch(t.type){case f:return Object.assign(Object.assign({},e),{loading:t.payload});case _:{const s=t.payload,a=(s.stages||[]).map((e=>Object.assign({},is(e)))),n=s.settings?ns(s.settings):void 0;return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},s),{stages:a,settings:n,is_primary:"1"===s.is_primary})})}case k:{if(!e.activePipeline||!e.activePipeline.stages)return e;const s=((e,t,s)=>{const a=[...e],n=a.find((e=>e.id===t.droppableId)),i=a.find((e=>e.id===s.droppableId));if((null==n?void 0:n.tasks)&&(null==i?void 0:i.tasks)){const[e]=n.tasks.splice(t.index,1);i.tasks.splice(s.index,0,e)}return a})(e.activePipeline.stages,t.payload.source,t.payload.destination);return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:s})})}case"REORDER_TASK":{const{source:n,destination:i}=t.payload,o=i.droppableId,r=i.index;if(!e.activePipeline)return e;const c=null===(s=e.activePipeline.stages)||void 0===s?void 0:s.find((e=>e.id===o));if(!c||!c.tasks)return e;const l=((e,t,s)=>{const a=[...e],[n]=a.splice(t,1);return a.splice(s,0,n),a})(c.tasks,n.index,r),d=null===(a=e.activePipeline.stages)||void 0===a?void 0:a.map((e=>e.id===o?Object.assign(Object.assign({},e),{tasks:l}):e));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:d})})}case g:{const s=It(t.payload);return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:null===(n=e.activePipeline.stages)||void 0===n?void 0:n.map((e=>e.id===s.stage_id?Object.assign(Object.assign({},e),{tasks:[...e.tasks||[],s]}):e))})}):e}case b:{const s=It(t.payload);if(!e.activePipeline)return e;const a=null===(i=e.activePipeline.stages)||void 0===i?void 0:i.map((e=>{var t;return e.id===s.stage_id?Object.assign(Object.assign({},e),{tasks:null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s.id?s:e))}):e}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case j:{const{stage:s}=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:[...e.activePipeline.stages||[],s]})}):e}case T:{const s=t.payload;if(!e.activePipeline)return e;const a=e=>e.id===s.id?Object.assign(Object.assign({},e),{name:s.name,description:s.description}):e,n=null===(o=e.activePipeline.stages)||void 0===o?void 0:o.map(a);return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case y:{const s=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:null===(r=e.activePipeline.stages)||void 0===r?void 0:r.filter((e=>e.id!==s))})}):e}case O:{const{taskId:s,user:a}=t.payload;if(!e.activePipeline)return e;const n=null===(c=e.activePipeline.stages)||void 0===c?void 0:c.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>{if(e.id===s){const t=At(a)?[a,...e.assigned_users||[]]:e.assigned_users||[],s=Ct(a)?[a,...e.assigned_wp_users||[]]:e.assigned_wp_users||[];return Object.assign(Object.assign({},e),{assigned_users:t,assigned_wp_users:s})}return e}));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case N:{const{taskId:s,userId:a,userType:n}=t.payload;if(!e.activePipeline)return e;const i=null===(l=e.activePipeline.stages)||void 0===l?void 0:l.map((e=>{var t;const i=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>{var t,i;return e.id===s?Object.assign(Object.assign({},e),{assigned_users:n===jt.QUICKTASKER?null===(t=e.assigned_users)||void 0===t?void 0:t.filter((e=>e.id!==a)):e.assigned_users,assigned_wp_users:n===jt.WP_USER?null===(i=e.assigned_wp_users)||void 0===i?void 0:i.filter((e=>e.id!==a)):e.assigned_wp_users}):e}));return Object.assign(Object.assign({},e),{tasks:i})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:i})})}case S:{const s=t.payload;return e.activePipeline?Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{name:s.name,description:s.description,is_primary:"1"===s.is_primary})}):e}case D:{const{taskId:s,done:a}=t.payload;if(!e.activePipeline)return e;const n=null===(d=e.activePipeline.stages)||void 0===d?void 0:d.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case P:return Object.assign(Object.assign({},e),{activePipeline:null});case R:{const s=t.payload;if(!e.activePipeline)return e;const a=null===(u=e.activePipeline.stages)||void 0===u?void 0:u.map((e=>{var t;return Object.assign(Object.assign({},e),{tasks:null===(t=e.tasks)||void 0===t?void 0:t.filter((e=>e.id!==s))})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case L:return Object.assign(Object.assign({},e),{view:t.payload});case U:{const{taskId:s,label:a}=t.payload;if(!e.activePipeline)return e;const n=null===(p=e.activePipeline.stages)||void 0===p?void 0:p.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:[...e.assigned_labels||[],a]}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case M:{const{taskId:s,labelId:a}=t.payload;if(!e.activePipeline)return e;const n=null===(h=e.activePipeline.stages)||void 0===h?void 0:h.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).filter((e=>e.id!==a))}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}case F:{const{label:s}=t.payload;if(!e.activePipeline)return e;const a=null===(w=e.activePipeline.stages)||void 0===w?void 0:w.map((e=>{var t;const a=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).map((e=>e.id===s.id?s:e))})));return Object.assign(Object.assign({},e),{tasks:a})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case z:{const s=t.payload;if(!e.activePipeline)return e;const a=null===(m=e.activePipeline.stages)||void 0===m?void 0:m.map((e=>{var t;const a=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>Object.assign(Object.assign({},e),{assigned_labels:(e.assigned_labels||[]).filter((e=>e.id!==s))})));return Object.assign(Object.assign({},e),{tasks:a})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:a})})}case K:{const{taskId:s,color:a}=t.payload;if(!e.activePipeline)return e;const n=null===(q=e.activePipeline.stages)||void 0===q?void 0:q.map((e=>{var t;const n=null===(t=e.tasks)||void 0===t?void 0:t.map((e=>e.id===s?Object.assign(Object.assign({},e),{task_focus_color:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}));return Object.assign(Object.assign({},e),{activePipeline:Object.assign(Object.assign({},e.activePipeline),{stages:n})})}default:return e}};var qs;!function(e){e.PIPELINE="PIPELINE-VIEW",e.TASK="TASK-VIEW"}(qs||(qs={}));const vs={loading:!1,view:qs.PIPELINE,activePipeline:null},xs=(0,a.createContext)({state:vs,dispatch:()=>{},fetchAndSetPipelineData:()=>Promise.resolve()}),fs=({children:e})=>{const[t,s]=(0,a.useReducer)(ms,vs),{loadingDispatch:r}=(0,a.useContext)(Kt);(0,a.useEffect)((()=>{const e=window.wpqt.initialActivePipelineId;e&&l(e,!0)}),[]);const c=(e,t)=>{t?r({type:Oe,payload:e}):s({type:f,payload:e})},l=(e,...t)=>{return a=void 0,n=[e,...t],l=function*(e,t=!1){try{c(!0,t);const{data:{pipeline:a}}=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e}`,headers:p()})}(e);s({type:_,payload:a})}catch(e){console.error(e),i.oR.error((0,o.__)("Unable to load the board. Please try again later.","quicktasker"))}finally{c(!1,t)}},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{o(l.next(e))}catch(e){t(e)}}function i(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var a;t.done?e(t.value):(a=t.value,a instanceof r?a:new r((function(e){e(a)}))).then(s,i)}o((l=l.apply(a,n||[])).next())}));var a,n,r,l};return(0,n.jsx)(xs.Provider,{value:{state:t,dispatch:s,fetchAndSetPipelineData:l},children:e})};var _s=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const ks={[St.ARCHIVE_TASK]:(0,o.__)("Task archived by automation","quicktasker"),[St.ASSIGN_USER]:(0,o.__)("User assigned by automation","quicktasker"),[St.NEW_ENTITY_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[St.DELETED_ENTITY_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[St.TASK_ASSIGNED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[St.TASK_UNASSIGNED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[St.TASK_PUBLIC_COMMENT_ADDED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[St.TASK_PRIVATE_COMMENT_ADDED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[St.TASK_FILE_UPLOADED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[St.TASK_FILE_DELETED_EMAIL]:(0,o.__)("Email notification sent by automation","quicktasker"),[St.CREATE_TASK]:(0,o.__)("Task created by automation","quicktasker"),[St.SEND_SLACK_MESSAGE]:(0,o.__)("Slack message sent by automation","quicktasker")};function gs(){const{dispatch:e}=(0,a.useContext)(xs),t=e=>{e&&e.forEach((e=>{if(e.automation_action.includes("email"))return;const t=ks[e.automation_action]||`Automation executed: ${e.automation_action}`;i.oR.info(t)}))},s=(t,s)=>{t&&s&&t.forEach((t=>{if(t.automation_action===St.ARCHIVE_TASK&&e({type:R,payload:s}),t.automation_action===St.ASSIGN_USER){const n=t.executionResult;!n||!(a=n)||"object"!=typeof a||a.user_type&&a.user_type!==jt.QUICKTASKER&&a.user_type!==jt.WP_USER||e({type:O,payload:{taskId:s,user:n}})}var a}))};return{displayAutomationMessages:t,handleExecutedAnimationsResults:s,handleExecutedAutomations:(e,a)=>{0!==e.length&&(s(e,a),t(e))},createAutomation:(e,t,s)=>_s(this,void 0,void 0,(function*(){try{const a=yield function(e,t){var s;return u()({path:`/wpqt/v1/pipelines/${e}/automations`,method:"POST",data:{automationTargetId:null,automationTarget:t.automationTarget,automationTrigger:t.automationTrigger,automationAction:null===(s=t.automationAction)||void 0===s?void 0:s.id,automationActionTargetId:t.automationActionTargetId,automationActionTargetType:t.automationActionTargetType,automationMetadata:t.metaData},headers:p()})}(e,t);i.oR.success((0,o.__)("Automation created","quicktasker")),s&&s(!0,a.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create automation","quicktasker")),s&&s(!1,null)}})),updateAutomationActiveStatus:(e,t,s)=>_s(this,void 0,void 0,(function*(){try{const a=yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/automations/${t}/active`,method:"PATCH",data:{active:s},headers:p()})}(e,t,s);return i.oR.success(s?(0,o.__)("Automation activated","quicktasker"):(0,o.__)("Automation deactivated","quicktasker")),{success:!0,data:a.data}}catch(e){return console.error(e),i.oR.error(s?(0,o.__)("Failed to activate automation","quicktasker"):(0,o.__)("Failed to deactivate automation","quicktasker")),{success:!1,data:null}}})),deleteAutomation:(e,t,s)=>_s(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/automations/${t}`,method:"DELETE",headers:p()})}(e,t),i.oR.success((0,o.__)("Automation deleted","quicktasker")),s&&s(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete automation","quicktasker")),s&&s(!1)}}))}}var js=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const ys=()=>{const{handleExecutedAutomations:e}=gs(),{displayErrorMessages:t}=function(){return{displayErrorMessages:e=>{return t=this,s=void 0,n=function*(){if(e.messages&&Array.isArray(e.messages)&&e.messages.length>0){const t=e.messages.join(", ");i.oR.error(t)}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n}}}();return{deleteTask:(t,s)=>js(void 0,void 0,void 0,(function*(){try{const a=yield function(e){return u()({path:`/wpqt/v1/tasks/${e}`,method:"DELETE",headers:p()})}(t);s&&s(),i.oR.success((0,o.__)("Task deleted","quicktasker")),e(a.data.executedAutomations,t)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete a task","quicktasker"))}})),archiveTask:(e,t)=>js(void 0,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/tasks/${e}/archive`,method:"PATCH",headers:p()})}(e),t&&t(),i.oR.success((0,o.__)("Task archived","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to archive a task","quicktasker"))}})),restoreArchivedTask:(e,t)=>js(void 0,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/tasks/${e}/archive-restore`,method:"PATCH",headers:p()})}(e),t&&t(),i.oR.success((0,o.__)("Task restored","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to restore a task","quicktasker"))}})),removeTaskFromUser:(t,s,a)=>js(void 0,void 0,void 0,(function*(){try{const n=yield v(t,s,jt.QUICKTASKER);i.oR.success((0,o.__)("Task has been unassigned","quicktasker")),e(n.data.executedAutomations,s),a&&a()}catch(e){console.error(e),i.oR.error((0,o.__)("Task unassignment failed. Try again","quicktasker"))}})),changeTaskDoneStatus:(s,a,n)=>js(void 0,void 0,void 0,(function*(){try{const t=a?(0,o.__)("Task marked as completed","quicktasker"):(0,o.__)("Task marked as incomplete","quicktasker"),r=yield function(e,t){return u()({path:`/wpqt/v1/tasks/${e}/done`,method:"PATCH",data:{done:t},headers:p()})}(s,a);n&&n(a),i.oR.success(t),e(r.data.executedAutomations,s)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change task status","quicktasker")),t(e)}})),moveTask:(e,t,s,a)=>js(void 0,void 0,void 0,(function*(){try{yield h(e,t,s),i.oR.success((0,o.__)("Task moved","quicktasaker")),a&&a(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to move a task","quicktasker")),a&&a(!1)}})),updateTaskFocusColor:(e,t)=>js(void 0,void 0,void 0,(function*(){const s={taskId:e,color:t};try{return yield function(e,t){return u()({path:`/wpqt/v1/tasks/${e}/focus-color`,method:"PATCH",data:{color:t},headers:p()})}(e,t),i.oR.success((0,o.__)("Task focus color changed","quicktasker")),Object.assign({success:!0},s)}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to change task focus color","quicktasker")),Object.assign({success:!1},s)}}))}},bs=()=>Object.assign({},Ss),Ts=(e,t)=>{var s,a,n,i,o,r,c,l,d,u,p,h,w,m,q,v;switch(t.type){case V:{const{taskToEdit:s,taskModalSettings:a}=t.payload;return Object.assign(Object.assign({},e),{taskModalOpen:!0,taskToEdit:s,targetStageId:s.stage_id,taskModalSettings:Object.assign(Object.assign({},e.taskModalSettings),a)})}case B:return bs();case te:{const d=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{assigned_users:At(d)?[d,...null!==(a=null===(s=e.taskToEdit)||void 0===s?void 0:s.assigned_users)&&void 0!==a?a:[]]:null!==(i=null===(n=e.taskToEdit)||void 0===n?void 0:n.assigned_users)&&void 0!==i?i:[],assigned_wp_users:Ct(d)?[d,...null!==(r=null===(o=e.taskToEdit)||void 0===o?void 0:o.assigned_wp_users)&&void 0!==r?r:[]]:null!==(l=null===(c=e.taskToEdit)||void 0===c?void 0:c.assigned_wp_users)&&void 0!==l?l:[]})})}case se:{const s=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{assigned_users:At(s)?(null!==(u=null===(d=e.taskToEdit)||void 0===d?void 0:d.assigned_users)&&void 0!==u?u:[]).filter((e=>e.id!==s.id)):null!==(h=null===(p=e.taskToEdit)||void 0===p?void 0:p.assigned_users)&&void 0!==h?h:[],assigned_wp_users:Ct(s)?(null!==(m=null===(w=e.taskToEdit)||void 0===w?void 0:w.assigned_wp_users)&&void 0!==m?m:[]).filter((e=>e.id!==s.id)):null!==(v=null===(q=e.taskToEdit)||void 0===q?void 0:q.assigned_wp_users)&&void 0!==v?v:[]})})}case H:{const{targetPipelineId:s}=t.payload;return Object.assign(Object.assign({},e),{stageModalOpen:!0,targetPipelineId:s})}case Q:{const{stageToEdit:s}=t.payload;return Object.assign(Object.assign({},e),{stageModalOpen:!0,stageToEdit:s})}case W:return bs();case Y:return Object.assign(Object.assign({},e),{newPipelineModalOpen:!0});case X:{const{pipelineToEdit:s}=t.payload;return Object.assign(Object.assign({},e),{pipelineModalOpen:!0,pipelineToEdit:s})}case J:return bs();case"OPEN_ARCHIVE_TASK_MODAL":{const s=t.payload;return Object.assign(Object.assign({},e),{archiveTaskModalOpen:!0,archiveModalTask:s})}case"CLOSE_ARCHIVE_TASK_MODAL":return bs();case"OPEN_NEW_USER_MODAL":return Object.assign(Object.assign({},e),{userModalOpen:!0});case ee:{const s=t.payload;return Object.assign(Object.assign({},e),{userModalOpen:!0,userToEdit:s})}case Z:return bs();case ae:return t.payload?Object.assign(Object.assign({},e),{userSettingsModalOpen:!0}):bs();case"CHANGE_TASK_DONE_STATUS":{const{done:s}=t.payload;return Object.assign(Object.assign({},e),{taskToEdit:Object.assign(Object.assign({},e.taskToEdit),{is_done:s})})}case ne:{const{task:s}=t.payload;return Object.assign(Object.assign({},e),{moveTaskModalOpen:!0,taskToEdit:s})}case ie:return bs();case oe:{const{task:s}=t.payload;return Object.assign(Object.assign({},e),{taskColorModalOpen:!0,taskToEdit:s})}case re:return bs();case ce:{const{selectedMethod:s}=t.payload;return Object.assign(Object.assign({},e),{taskExportModalOpen:!0,taskExportModalSettings:Object.assign(Object.assign({},e.taskExportModalSettings),{selectedMethod:s})})}case le:return bs();default:return e}};var Es;!function(e){e.PDF="pdf",e.CSV="csv",e.JSON="json"}(Es||(Es={}));const Ss={taskModalOpen:!1,targetStageId:"",taskToEdit:null,taskModalSettings:{allowToMarkTaskAsDone:!0},moveTaskModalOpen:!1,stageModalOpen:!1,stageToEdit:null,targetPipelineId:"",pipelineModalOpen:!1,newPipelineModalOpen:!1,pipelineToEdit:null,archiveTaskModalOpen:!1,archiveModalTask:null,userModalOpen:!1,userToEdit:null,userSettingsModalOpen:!1,taskColorModalOpen:!1,taskExportModalOpen:!1,taskExportModalSettings:{selectedMethod:Es.PDF}},As=(0,a.createContext)({state:Ss,modalDispatch:()=>{}}),Cs=({children:e})=>{const[t,s]=(0,a.useReducer)(Ts,Ss);return(0,n.jsx)(As.Provider,{value:{state:t,modalDispatch:s},children:e})},Os=(e,t)=>{switch(t.type){case ke:{const s=t.payload.map(Ot);return Object.assign(Object.assign({},e),{users:s})}case ge:{const s=t.payload.map((e=>Object.assign(Object.assign({},e),{id:String(e.id)})));return Object.assign(Object.assign({},e),{wpUsers:s})}case je:{const s=t.payload,a=Ot(s);return Object.assign(Object.assign({},e),{users:[...e.users,a]})}case be:{const s=t.payload,a=Ot(s),n=e.users.map((e=>e.id===a.id?a:e));return Object.assign(Object.assign({},e),{users:n})}case Ee:{const{isActive:s,userId:a}=t.payload,n=e.users.map((e=>e.id===a?Object.assign(Object.assign({},e),{is_active:s}):e));return Object.assign(Object.assign({},e),{users:n})}case Se:{const s=t.payload,a=e.users.map((e=>e.id===s?Object.assign(Object.assign({},e),{has_password:!1}):e));return Object.assign(Object.assign({},e),{users:a})}case Te:{const s=t.payload,a=e.users.filter((e=>e.id!==s));return Object.assign(Object.assign({},e),{users:a})}case ye:{const s=t.payload;return Object.assign(Object.assign({},e),{usersSearchValue:s})}default:return e}};var Ns=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Ds={users:[],wpUsers:[],usersSearchValue:""},Is=(0,a.createContext)({state:Ds,userDispatch:()=>{},updateUsers:()=>Ns(void 0,void 0,void 0,(function*(){}))}),Ps=({children:e})=>{const[t,s]=(0,a.useReducer)(Os,Ds);return(0,a.useEffect)((()=>{const e=window.wpqt.initialUsers,t=window.wpqt.initialWPUsers;s({type:ke,payload:e}),s({type:ge,payload:t})}),[]),(0,n.jsx)(Is.Provider,{value:{state:t,userDispatch:s,updateUsers:()=>Ns(void 0,void 0,void 0,(function*(){try{const e=yield u()({path:"/wpqt/v1/users",method:"GET",headers:p()});s({type:ke,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch users","quicktasker"))}}))},children:e})};var Rs;!function(e){e.ACTIVE_PIPELINE="ACTIVE_PIPELINE",e.PIPELINES="PIPELINES",e.USER="USER"}(Rs||(Rs={}));const Ls=e=>{const[t,s]=(0,a.useState)(!1),n=(0,a.useRef)(null),{modalDispatch:i}=(0,a.useContext)(As),{dispatch:o}=(0,a.useContext)(xs),{pipelinesDispatch:r}=(0,a.useContext)(cs),{userDispatch:c}=(0,a.useContext)(Is);return{modalSaving:t,setModalSaving:s,modalContentRef:n,closeModal:()=>{i({type:e}),n.current&&n.current.clearContent()},handleSuccess:(e,t,a)=>{let n;switch(a){case Rs.PIPELINES:n=r;break;case Rs.ACTIVE_PIPELINE:n=o;break;case Rs.USER:n=c;break;default:n=o}s(!1),n({type:e,payload:t})},handleError:e=>{s(!1),console.error(e)}}},Us=(e,t)=>{switch(t.type){case ht:return Object.assign(Object.assign({},e),{uploads:t.payload});case wt:return Object.assign(Object.assign({},e),{uploads:[...e.uploads,t.payload]});case mt:return Object.assign(Object.assign({},e),{uploads:e.uploads.filter((e=>e.id!==t.payload))});default:return e}},Ms={uploads:[]},Fs=(0,a.createContext)({state:Ms,uploadDispatch:()=>{}}),zs=({children:e})=>{const[t,s]=(0,a.useReducer)(Us,Ms);return(0,n.jsx)(Fs.Provider,{value:{state:t,uploadDispatch:s},children:e})};var Ks,$s,Gs=s(2922),Vs=s(6053),Bs=s(9828),Hs=s(540),Ws=s(4576),Qs=s(5138),Ys=s(7008);function Xs({id:e}){return(0,n.jsx)(Ys.m_,{id:e,className:"wpqt-bg-red-600",children:(0,n.jsx)("span",{children:"Tooltip content"})})}function Js({onClick:e=()=>{},btnText:t,className:s,type:a=Ks.BUTTON,disabled:i=!1,loading:o=!1,buttonStyleType:r=$s.PRIMARY}){const c=r===$s.PRIMARY?"wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-transparent wpqt-bg-blue-500 wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-text-white wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 focus:wpqt-ring-blue-800 enabled:hover:wpqt-bg-blue-600":r===$s.SECONDARY?"wpqt-inline-flex wpqt-cursor-pointer wpqt-bg-gray-100 wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 enabled:hover:wpqt-bg-gray-200":"wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-whitespace-nowrap wpqt-rounded-lg wpqt-border wpqt-border-transparent wpqt-bg-red-500 wpqt-px-3 wpqt-py-1 wpqt-text-sm/6 wpqt-text-white wpqt-transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] focus:wpqt-outline-none focus:wpqt-ring-4 focus:wpqt-ring-red-800 enabled:hover:wpqt-bg-red-600";return(0,n.jsx)(Qs.$,{disabled:i||o,className:`${c} ${s}`,onClick:e,type:a,children:o?(0,n.jsx)(Zt,{width:"24",height:"24",color:"#ffffff",secondaryColor:"#ffffff"}):t})}function Zs({icon:e,text:t,onClick:s=()=>{},className:a,tooltipId:i,tooltipText:o,loading:r=!1}){const c=o&&i,l=c?{"data-tooltip-id":i,"data-tooltip-content":o,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info"}:{};return(0,n.jsxs)("div",Object.assign({},l,{className:`wpqt-main-border wpqt-relative wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-bg-gray-100 wpqt-p-2 hover:wpqt-bg-white ${a}`,onClick:s,children:[e,t||r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center wpqt-relative",children:[t&&(0,n.jsx)("span",{className:"wpqt-whitespace-nowrap "+(r?"wpqt-invisible":""),children:t}),r&&(0,n.jsx)(Zt,{width:"20",height:"20",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"})]}):null,c&&(0,n.jsx)(Xs,{id:i})]}))}function ea({icon:e,onClick:t=()=>{},className:s,loading:a=!1}){return(0,n.jsxs)("div",{className:`wpqt-main-border wpqt-p-1 wpqt-relative wpqt-inline-flex wpqt-cursor-pointer wpqt-bg-gray-100 hover:wpqt-bg-white ${s}`,onClick:t,children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-items-center "+(a?"wpqt-invisible":""),children:e}),a&&(0,n.jsx)(Zt,{width:"20",height:"20",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-center"})]})}function ta({modalOpen:e,closeModal:t,children:s,size:a="sm"}){return(0,n.jsxs)(Gs.lG,{open:e,as:"div",className:"wpqt-relative wpqt-z-9999 focus:wpqt-outline-none",onClose:t,children:[(0,n.jsx)(Gs.Xi,{className:"wpqt-fixed wpqt-inset-0 wpqt-bg-black/40"}),(0,n.jsx)("div",{className:"wpqt-fixed wpqt-inset-0 wpqt-z-10 wpqt-w-screen wpqt-overflow-y-auto",children:(0,n.jsx)("div",{className:"wpqt-mt-[8vh] wpqt-flex wpqt-justify-center",children:(0,n.jsxs)(Gs.Lj,{transition:!0,className:`data-[closed]:wpqt-transform-[wpqt-scale(95%)] wpqt-relative wpqt-mt-[20px] wpqt-w-4/5 ${{sm:"wpqt-max-w-sm",md:"wpqt-max-w-lg",lg:"wpqt-max-w-4xl",xl:"wpqt-max-w-6xl"}[a]} wpqt-rounded-xl wpqt-bg-white wpqt-p-8 wpqt-backdrop-blur-2xl wpqt-duration-300 wpqt-ease-out data-[closed]:wpqt-opacity-0`,children:[(0,n.jsx)("div",{className:"wpqt-group wpqt-absolute wpqt-right-[-20px] wpqt-top-[-20px] wpqt-flex wpqt-h-[40px] wpqt-w-[40px] wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-rounded-full wpqt-border wpqt-border-solid wpqt-bg-white wpqt-text-qtBorder",onClick:t,children:(0,n.jsx)(Ws.A,{className:"wpqt-icon-blue group-hover:wpqt-icon-red wpqt-size-5"})}),s]})})})]})}function sa({children:e}){return(0,n.jsx)(Gs.L3,{as:"div",className:"wpqt-text-base/7 wpqt-font-medium wpqt-text-black",children:e})}function aa({children:e}){return(0,n.jsx)(Vs.L,{children:e})}function na({label:e,children:t,tooltipId:s,tooltipText:a}){const i=s&&a,o=i?{"data-tooltip-id":s,"data-tooltip-content":a,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info","data-tooltip-place":"top-end"}:{};return(0,n.jsxs)(Bs.D,{className:"wpqt-mb-3",children:[(0,n.jsx)(Hs.JU,Object.assign({className:"wpqt-mb-2 wpqt-block wpqt-text-sm/6 wpqt-font-medium"},o,{children:e})),t,i&&(0,n.jsx)(Xs,{id:s})]})}function ia({onSave:e,saveBtnText:t,loading:s=!1}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-px-2",children:(0,n.jsx)(Js,{btnText:t,loading:s,onClick:e})})}!function(e){e.BUTTON="button",e.SUBMIT="submit",e.RESET="reset"}(Ks||(Ks={})),function(e){e.PRIMARY="primary",e.SECONDARY="secondary",e.DANGER="danger"}($s||($s={}));var oa=s(1489),ra=s(8448),ca=s(8176),la=s(1052),da=s(4353),ua=s.n(da),pa=s(4461);function ha(){const[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1);return{loading1:e,loading2:s,setLoading1:t,setLoading2:n,loading3:i,setLoading3:o}}const wa=(e,t)=>{switch(t.type){case"SET_SITE_URL":{const s=t.payload;return Object.assign(Object.assign({},e),{siteURL:s})}case Ae:{const{siteURL:s,publicUserPageId:a,timezone:n,isUserAllowedToDelete:i,userPageCustomStyles:o,pluginURL:r,taskUploadsURL:c}=t.payload;return Object.assign(Object.assign({},e),{siteURL:s,publicUserPageId:a,timezone:n,isUserAllowedToDelete:i,userPageCustomStyles:o,pluginURL:r,taskUploadsURL:c})}case Ce:{const s=t.payload;return Object.assign(Object.assign({},e),{userPageCustomStyles:s})}default:return e}},ma={siteURL:"",pluginURL:"",publicUserPageId:"",is_customFields:!1,timezone:"",isUserAllowedToDelete:!1,userPageCustomStyles:"",taskUploadsURL:""},qa=(0,a.createContext)({state:ma,appDispatch:()=>{}}),va=({children:e})=>{const[t,s]=(0,a.useReducer)(wa,ma);return(0,a.useEffect)((()=>{const e=window.wpqt.siteURL,t=window.wpqt.publicUserPageId,a=window.wpqt.timezone,n="1"===window.wpqt.isUserAllowedToDelete,i=window.wpqt.userPageCustomStyles,o=window.wpqt.pluginURL,r=window.wpqt.taskUploadsURL;s({type:Ae,payload:{siteURL:e,publicUserPageId:t,timezone:a,isUserAllowedToDelete:n,userPageCustomStyles:i,pluginURL:o,taskUploadsURL:r}})}),[]),(0,n.jsx)(qa.Provider,{value:{state:t,appDispatch:s},children:e})};var xa=s(8569),fa=s.n(xa),_a=s(3826),ka=s.n(_a);ua().extend(ka()),ua().extend(fa());const ga=()=>{const{state:{timezone:e}}=(0,a.useContext)(qa);return{convertToWPTimezone:t=>((e,t)=>{try{return ua().utc(e).tz(t).format("MMMM D, YYYY HH:mm")}catch(t){return console.error("Error: ",t),e+" (UTC)"}})(t,e),convertUTCDateTimeToWPTimezone:t=>((e,t)=>{try{return ua().utc(e).tz(t).toDate()}catch(t){return console.error("Error: ",t),new Date(e)}})(t,e)}};var ja,ya,ba,Ta;!function(e){e.Text="text",e.Select="select",e.Checkbox="checkbox",e.Radio="radio",e.Datetime="datetime",e.File="file"}(ja||(ja={})),function(e){e.User="user",e.Pipeline="pipeline",e.Users="users",e.Task="task"}(ya||(ya={})),function(e){e.TASK="task"}(ba||(ba={})),function(e){e.TEXT="text",e.PASSWORD="password"}(Ta||(Ta={}));const Ea=(0,a.forwardRef)((({value:e,onChange:t,isAutoFocus:s,className:a="",wrapperClassName:i="",disabled:o=!1,type:r=Ta.TEXT,loading:c=!1,inputId:l,name:d},u)=>(0,n.jsxs)("div",{className:`wpqt-inline-block wpqt-relative wpqt-mb-3 ${i}`,children:[(0,n.jsx)(as.p,{ref:u,autoFocus:s,className:`wpqt-block wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-3 wpqt-py-1.5 wpqt-text-sm/6 focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${a}`,value:e,disabled:o,onChange:e=>t(e.target.value),type:r,id:l,name:d}),c&&(0,n.jsx)(Zt,{width:"24",height:"24",className:"wpqt-absolute wpqt-right-[-32px] wpqt-top-1/2 wpqt-transform-y-center"})]})));var Sa=s(1062),Aa=s(4164);function Ca({value:e,onChange:t,rowsCount:s=3,className:a=""}){return(0,n.jsx)(Sa.T,{className:(0,Aa.$)("wpqt-border-1 wpqt-mb-3 wpqt-block wpqt-w-auto wpqt-resize-none wpqt-rounded-lg wpqt-border-qtBorder wpqt-px-3 wpqt-py-1.5 wpqt-text-sm/6",`focus:wpqt-shadow-none focus:wpqt-outline-none data-[focus]:wpqt-outline-2 data-[focus]:wpqt--outline-offset-2 data-[focus]:wpqt-outline-gray-300 ${a}`),rows:s,value:e,onChange:e=>t(e.target.value)})}var Oa=s(303);function Na({checked:e,handleChange:t,id:s}){return(0,n.jsx)(Oa.A,{onChange:t,checked:e,uncheckedIcon:!1,checkedIcon:!1,height:20,width:44,id:s})}const Da=(e,t)=>{switch(t.type){case He:{const s=t.payload;return Object.assign(Object.assign({},e),{loading:s})}case We:{const{entityId:s,entityType:a}=t.payload;return Object.assign(Object.assign({},e),{entityId:s,entityType:a})}case Ge:{const s=t.payload;return Object.assign(Object.assign({},e),{customFields:s})}case Ve:{const s=t.payload;return Object.assign(Object.assign({},e),{customFields:[...e.customFields,s]})}case Be:{const s=t.payload,a=e.customFields.filter((e=>e.id!==s));return Object.assign(Object.assign({},e),{customFields:a})}default:return e}};const Ia={customFields:[],loading:!0,entityId:"",entityType:null},Pa=(0,a.createContext)({state:Ia,customFieldsDispatch:()=>{},fetchCustomFields:()=>{}}),Ra=({children:e,entityId:t,entityType:s})=>{const[r,c]=(0,a.useReducer)(Da,Ia);(0,a.useEffect)((()=>{l()}),[]),(0,a.useEffect)((()=>{c({type:We,payload:{entityType:s,entityId:t}})}),[s,t]);const l=()=>{return e=void 0,a=void 0,r=function*(){try{c({type:He,payload:!0});const e=yield x(t,s,!0);c({type:Ge,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch custom fields","quicktasker"))}finally{c({type:He,payload:!1})}},new((n=void 0)||(n=Promise))((function(t,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}c((r=r.apply(e,a||[])).next())}));var e,a,n,r};return(0,n.jsx)(Pa.Provider,{value:{state:r,customFieldsDispatch:c,fetchCustomFields:l},children:e})};var La=s(9197),Ua=s(2767),Ma=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Fa(){return{addCustomField:(e,t,s,a,n,r)=>Ma(this,void 0,void 0,(function*(){try{const i=yield function(e,t,s,a,n){return u()({path:"/wpqt/v1/custom-fields",method:"POST",data:{entityId:e,entityType:t,type:s,name:a,description:n},headers:p()})}(e,t,s,a,n);r&&r(i.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add a custom field","quicktasker"))}})),markCustomFieldAsDeleted:(e,t)=>Ma(this,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/custom-fields/${e}`,method:"DELETE",headers:p()})}(e),t&&t()}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to mark custom field as deleted","quicktasker"))}})),restoreCustomField:(e,t)=>Ma(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/custom-fields/${e}/restore`,method:"PATCH",headers:p()})}(e);i.oR.success((0,o.__)("Custom field restored","quicktasker")),t&&t(s.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to restore custom field","quicktasker"))}})),updateCustomFieldValue:(e,t,s,a,n)=>Ma(this,void 0,void 0,(function*(){try{yield function(e,t,s,a){return u()({path:`/wpqt/v1/custom-fields/${e}/value`,method:"PATCH",data:{value:t,entityId:String(s),entityType:a},headers:p()})}(e,t,s,a),n&&n()}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to update custom field value","quicktasker"))}}))}}function za({title:e,description:t,className:s=""}){return(0,n.jsxs)("div",{className:`wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center wpqt-h-full ${s}`,children:[e&&(0,n.jsx)("h2",{className:"wpqt-font-semibold",children:e}),t&&(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-4",children:t}),(0,n.jsx)("div",{className:"wpqt-text-blue-500 wpqt-font-semibold",children:(0,n.jsx)("a",{href:"https://payhip.com/b/84TLC",target:"_blank",rel:"noreferrer",children:(0,o.__)("Get the premium version","quicktasker")})})]})}var Ka=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function $a({description:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(!1),[d,u]=(0,a.useState)(ja.Text),{addCustomField:p}=Fa(),{state:{entityId:h,entityType:w,customFields:m,loading:q},customFieldsDispatch:v}=(0,a.useContext)(Pa),{state:{is_customFields:x}}=(0,a.useContext)(qa),[f,_]=(0,a.useState)(!1),k=[{value:ja.Text,label:"Text"},{value:ja.Checkbox,label:"Checkbox"}],g=m.length>=1&&!x;return q?null:(0,n.jsxs)("div",{className:"wpqt-mb-6 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom Fields","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-text-center",children:[e,!x&&(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[" ",(0,o.__)("Free version allows only one custom field. To add more, please upgrade to premium.","quicktasker")]})]}),c&&(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(Ea,{value:t,onChange:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Description","quicktasker")}),(0,n.jsx)(Ca,{value:i,onChange:r})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Type","quicktasker")}),(0,n.jsx)(us,{selectedOptionValue:d,options:k,onSelectionChange:e=>{u(e)},allSelector:!1})]})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:[!g&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Zs,{text:c?(0,o.__)("Cancel","quicktasker"):(0,o.__)("Add new custom field","quicktasker"),onClick:()=>l(!c),icon:c?(0,n.jsx)(La.A,{className:"wpqt-icon-red wpqt-size-5"}):(0,n.jsx)(Ua.A,{className:"wpqt-icon-green wpqt-size-5"})}),c&&(0,n.jsx)(Zs,{text:(0,o.__)("Add","quicktasker"),onClick:()=>Ka(this,void 0,void 0,(function*(){h&&w?(_(!0),yield p(h,w,d,t,i,(e=>{v({type:Ve,payload:e}),s(""),r(""),u(ja.Text),l(!1)})),_(!1)):console.error("Entity ID or Entity Type is missing")})),loading:f,icon:(0,n.jsx)(Ua.A,{className:"wpqt-icon-green wpqt-size-5"})})]}),g&&(0,n.jsx)(za,{})]})]})}var Ga=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Va({data:e,onSave:t,locationOfCustomFields:s,onDelete:i,actionLoading:r}){const{state:{isUserAllowedToDelete:c}}=(0,a.useContext)(qa),l=e.entity_type===s,d=s===ya.Task||s===ya.User,u=e.entity_type===ya.Pipeline?"board":e.entity_type;return r?(0,n.jsx)(ts,{ovalSize:"24"}):(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-center wpqt-gap-2",children:[d&&(0,n.jsx)(Js,{onClick:t,btnText:(0,o.__)("Save","quicktasker")}),c&&(0,n.jsx)(Zs,Object.assign({onClick:()=>Ga(this,void 0,void 0,(function*(){l&&i()})),className:l?"":"!wpqt-cursor-not-allowed",icon:(0,n.jsx)(ca.A,{className:"wpqt-icon-red wpqt-size-4"})},!l&&{tooltipId:`custom-field-${e.id}-delete`,tooltipText:(0,o.sprintf)((0,o.__)("This custom field is inherited from %s settings and can't be deleted here","quicktasker"),u)}))]})}var Ba=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ha({data:e}){const[t,s]=(0,a.useState)(""),{state:{entityType:i,entityId:o},customFieldsDispatch:r}=(0,a.useContext)(Pa),{updateCustomFieldValue:c,markCustomFieldAsDeleted:l}=Fa(),[d,u]=(0,a.useState)(!1);let p;switch((0,a.useEffect)((()=>{e.value&&s(e.value)}),[e.value]),e.type){case ja.Text:p=(0,n.jsx)(Wa,{data:e,value:t,onChange:s});break;case ja.Checkbox:p=(0,n.jsx)(Qa,{data:e,value:t,onChange:s})}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{}),p,(0,n.jsx)(Va,{data:e,locationOfCustomFields:i,onSave:()=>Ba(this,void 0,void 0,(function*(){i===ya.User||i===ya.Task?(u(!0),yield c(e.id,t,o,i),u(!1)):console.error("Invalid entity type for saving custom field value")})),onDelete:()=>Ba(this,void 0,void 0,(function*(){u(!0),yield l(e.id,(()=>{r({type:Be,payload:e.id})})),u(!1)})),actionLoading:d})]})}function Wa({data:e,value:t,onChange:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-justify-center",children:[(0,n.jsx)(Ya,{name:e.name,description:e.description}),(0,n.jsx)(Ea,{value:t,onChange:s})]})}function Qa({data:e,value:t,onChange:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(Ya,{name:e.name,description:e.description}),(0,n.jsx)("input",{type:"checkbox",checked:"true"===t,className:"!wpqt-block",onChange:e=>s(e.target.checked?"true":"false")})]})}function Ya({name:e,description:t=""}){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-mb-1 wpqt-text-base wpqt-font-semibold",children:e}),t&&(0,n.jsx)("div",{className:"wpqt-mb-2 wpqt-italic",children:t})]})}function Xa(){const{state:{loading:e,customFields:t}}=(0,a.useContext)(Pa);return e?(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Zt,{width:"36",height:"36"})}):t&&0===t.length?(0,n.jsx)("div",{className:"wpqt-text-center wpqt-font-semibold",children:(0,o.__)("No related custom fields created","quicktasker")}):(0,n.jsx)("div",{className:"wpqt-my-4 wpqt-grid wpqt-grid-cols-[100px_1fr_100px] wpqt-items-center wpqt-gap-3",children:t.map((e=>(0,n.jsx)(Ha,{data:e},e.id)))})}var Ja=s(5066);const Za={[ya.Pipeline]:(0,o.__)("Board","quicktasker"),[ya.Task]:(0,o.__)("Task","quicktasker"),[ya.User]:(0,o.__)("User","quicktasker"),[ya.Users]:(0,o.__)("Global users","quicktasker")};var en=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function tn({customField:e,refreshDeletedFields:t}){const{customFieldsDispatch:s}=(0,a.useContext)(Pa),[i,r]=(0,a.useState)(!1),{restoreCustomField:c}=Fa(),{convertToWPTimezone:l}=ga();return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Name:","quicktasker")})," ",e.name]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Description:","quicktasker")})," ",e.description]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Level:","quicktasker")})," ",Za[e.entity_type]]}),e.deleted_at&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Deleted:","quicktasker")})," ",l(e.deleted_at)]}),(0,n.jsx)("div",{children:(0,n.jsx)(ea,{onClick:()=>en(this,void 0,void 0,(function*(){r(!0),yield c(e.id,(e=>{s({type:Ve,payload:e}),t()})),r(!1)})),loading:i,icon:(0,n.jsx)(Ja.HCd,{className:"wpqt-icon-green wpqt-size-5"})})})]})}var sn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function an(){const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(!0),[c,l]=(0,a.useState)(null),{state:{entityId:d,entityType:u}}=(0,a.useContext)(Pa);(0,a.useEffect)((()=>{e&&p()}),[e]);const p=()=>sn(this,void 0,void 0,(function*(){if(d&&u)try{r(!0);const e=yield x(d,u,!1);l(e.data)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load deleted custom fields","quicktasker"))}finally{r(!1)}else console.error("Entity ID or Entity Type is missing")}));return(0,n.jsxs)("div",{className:"wpqt-my-3 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)("h2",{children:(0,o.__)("Custom Field recovery","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:(0,o.__)("Deleted custom field by accident? No worries! You can recover it here.","quicktasker")}),e&&(0,n.jsx)("div",{className:"wpqt-mb-3",children:s?(0,n.jsx)(ts,{ovalSize:"36"}):c&&0===c.length?(0,n.jsx)("div",{className:"wpqt-text-center wpqt-font-semibold",children:(0,o.__)("No deleted custom fields","quicktasker")}):c&&c.length>0?(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:c.map((e=>(0,n.jsx)(tn,{customField:e,refreshDeletedFields:p},e.id)))}):null}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:(0,n.jsx)(Zs,{text:e?(0,o.__)("Close recovery","quicktasker"):(0,o.__)("Open recovery","quicktasker"),onClick:()=>t(!e),icon:(0,n.jsx)(Ja.HCd,{className:"wpqt-icon-green wpqt-size-5"})})})]})}const nn={[ya.User]:(0,o.__)("Add user-specific custom fields. If you want to add custom fields to all users, please go to users settings.","quicktasker"),[ya.Users]:(0,o.__)("Add custom fields to all users. If you want to add custom fields to a specific user only, please go to that user settings.","quicktasker"),[ya.Pipeline]:(0,o.__)("Add board level custom fields.","quicktasker"),[ya.Task]:(0,o.__)("Add task-specific custom fields. If you want to add custom fields to all tasks in this board, please go to board settings.","quicktasker")},on={[ya.User]:(0,o.__)("Custom fields applied to this user, including both user-specific and global users fields.","quicktasker"),[ya.Users]:(0,o.__)("Global user custom field are applied to all users.","quicktasker"),[ya.Pipeline]:(0,o.__)("Board level fields are applied to all tasks in this board.","quicktasker"),[ya.Task]:(0,o.__)("Custom fields applied to this task, including both task-specific and board-level fields.","quicktasker")},rn={[ya.User]:(0,o.__)("User custom fields","quicktasker"),[ya.Users]:(0,o.__)("Global users custom fields","quicktasker"),[ya.Pipeline]:(0,o.__)("Board custom fields","quicktasker"),[ya.Task]:(0,o.__)("Task custom fields","quicktasker")};function cn({entityId:e,entityType:t}){const s=nn[t],a=rn[t],i=on[t];return(0,n.jsx)("div",{children:(0,n.jsxs)(Ra,{entityId:e,entityType:t,children:[(0,n.jsx)("h2",{className:"wpqt-text-center",children:a}),(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center",children:i}),(0,n.jsx)(Xa,{}),(0,n.jsx)($a,{description:s}),(0,n.jsx)(an,{})]})})}var ln=s(5785);function dn({children:e,inlineStyle:t,className:s=""}){return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-py-1 wpqt-px-2 wpqt-font-semibold wpqt-text-xs wpqt-leading-none wpqt-shopping-tag ${s}`,style:t,children:e})}var un=s(2185);function pn({children:e,menuBtn:t,menuBtnClasses:s="",anchor:a="bottom end"}){return(0,n.jsxs)(un.W1,{children:[(0,n.jsx)(un.IU,{as:"div",className:`wpqt-cursor-pointer ${s}`,onClick:e=>e.stopPropagation(),children:({active:e})=>(0,n.jsx)(n.Fragment,{children:t({active:e})})}),(0,n.jsx)(un.c,{anchor:a,transition:!0,className:"wpqt-z-20 wpqt-origin-top wpqt-rounded-xl wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-bg-white wpqt-p-4 wpqt-transition wpqt-duration-200 wpqt-ease-out data-[closed]:wpqt-scale-95 data-[closed]:wpqt-opacity-0",children:e})]})}function hn({isActive:e,IconComponent:t}){return(0,n.jsx)(t,{className:"wpqt-size-6 wpqt-text-gray-400 hover:wpqt-text-qtBlueHover "+(e?"wpqt-text-qtBlueHover":"")})}function wn({text:e,onClick:t,icon:s,className:a,disabled:i=!1,id:o="",tooltipText:r="",loading:c=!1}){const l=""!==r&&""!==o?{"data-tooltip-id":o,"data-tooltip-content":r,"data-tooltip-position-strategy":"fixed","data-tooltip-variant":"info"}:{};return(0,n.jsx)(un.Dr,{children:(0,n.jsxs)("div",Object.assign({},l,{className:`wpqt-mb-3 wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-relative ${i?"wpqt-cursor-not-allowed wpqt-line-through":"wpqt-cursor-pointer hover:wpqt-underline"} ${a}`,onClick:e=>{!i&&t&&t(e)},children:[s,(0,n.jsx)("span",{className:c?"wpqt-invisible":"",children:e}),c&&(0,n.jsx)(Zt,{width:"16",height:"16",className:"wpqt-absolute wpqt-top-1/2 wpqt-left-1/2 wpqt-transform-y-center wpqt-transform-x-center"}),(0,n.jsx)(Xs,{id:o})]}))})}var mn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};var qn=s(3858);function vn({children:e,labelFor:t,className:s=""}){return(0,n.jsx)("label",{className:`wpqt-mb-1 ${s}`,htmlFor:t,children:e})}function xn({labelCreated:e,loading:t=!1}){const{labelDispatch:s}=(0,a.useContext)(Yt),[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)("");return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Create new label","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(vn,{labelFor:"new-label-name",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(Ea,{value:i,onChange:r,inputId:"new-label-name"})]}),(0,n.jsx)(qn.A,{color:c,disableAlpha:!0,onChange:e=>{l(e.hex)}}),(0,n.jsx)(Js,{btnText:(0,o.__)("Create","quicktasker"),onClick:()=>{i&&c&&e(i,c)},loading:t}),(0,n.jsx)(Js,{btnText:(0,o.__)("Cancel","quicktasker"),buttonStyleType:$s.SECONDARY,onClick:()=>{s({type:Ze})}})]})}var fn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function _n({labelToEdit:e,editLabel:t,deleteLabe:s,closeEdit:i=()=>{}}){if(!e)return null;const[r,c]=(0,a.useState)(Object.assign({},e)),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Edit label","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)(vn,{labelFor:"edit-label-name",children:(0,o.__)("Name","quicktasker")}),(0,n.jsx)(Ea,{value:r.name,onChange:e=>{c(Object.assign(Object.assign({},r),{name:e}))},inputId:"edit-label-name"})]}),(0,n.jsx)(qn.A,{color:r.color,disableAlpha:!0,onChange:e=>{c(Object.assign(Object.assign({},r),{color:e.hex}))}}),(0,n.jsx)(Js,{btnText:(0,o.__)("Save","quicktasker"),onClick:()=>fn(this,void 0,void 0,(function*(){r.name&&r.color&&(d(!0),yield t(r),d(!1))})),loading:l}),(0,n.jsx)(Js,{btnText:(0,o.__)("Delete","quicktasker"),onClick:()=>fn(this,void 0,void 0,(function*(){p(!0),yield s(r.id),p(!1)})),loading:u,buttonStyleType:$s.DANGER}),(0,n.jsx)(Js,{btnText:(0,o.__)("Cancel","quicktasker"),buttonStyleType:$s.SECONDARY,onClick:i})]})}var kn=s(2601),gn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function jn({labels:e,title:t,labelSelected:s,labelDeSelection:i,loading:r=!1}){const{labelDispatch:c}=(0,a.useContext)(Yt);return e?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-4",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:t}),r?(0,n.jsx)(ts,{ovalSize:"24"}):0===e.length?(0,n.jsx)("div",{className:"wpqt-text-gray-500",children:(0,o.__)("There are no labels created for this board","quicktasker")}):e.map((e=>(0,n.jsx)(yn,{label:e,labelSelected:s,labelDeSelection:i},e.id))),(0,n.jsx)(Js,{btnText:(0,o.__)("Create new label","quicktasker"),className:"wpqt-mt-3",buttonStyleType:$s.SECONDARY,onClick:()=>{c({type:tt})}})]}):null}function yn({label:e,labelSelected:t,labelDeSelection:s}){const{labelDispatch:i}=(0,a.useContext)(Yt),[o,r]=(0,a.useState)(e.selected);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-justify-between wpqt-gap-2 wpqt-w-full",children:[(0,n.jsx)("input",{type:"checkbox",checked:o,onChange:a=>gn(this,void 0,void 0,(function*(){const n=a.target.checked;r(n),n?t(e.id):s(e.id)}))}),(0,n.jsx)(dn,{inlineStyle:{backgroundColor:e.color},className:"wpqt-py-2",children:e.name}),(0,n.jsx)(kn.A,{className:"wpqt-size-5 wpqt-icon-green wpqt-cursor-pointer",onClick:()=>{i({type:et,payload:e})}})]})}var bn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Tn=(0,a.memo)((({task:e,labelSelected:t,labelDeselected:s,labelDeleted:r})=>{const{state:{labels:c,labelActionState:l,labelToEdit:d},labelDispatch:h}=(0,a.useContext)(Yt),{archiveDispatch:w}=(0,a.useContext)(Vt),{dispatch:m}=(0,a.useContext)(xs),[q,v]=(0,a.useState)(!0),[x,f]=(0,a.useState)(!1),{getPipelineLabels:_,createPipelineLabel:k,assignLabelToTask:g,usassignLabelFromTask:j,editLabel:y,deleteLabel:b}=function(){return{deleteLabel:(e,t,s)=>mn(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/labels/${t}`,method:"DELETE",headers:p()})}(e,t);i.oR.success((0,o.__)("Label deleted from the board","quicktasker")),s&&s(!0,a.data.deletedLabel)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete label","quicktasker")),s&&s(!1)}})),getPipelineLabels:(e,t)=>mn(this,void 0,void 0,(function*(){try{const a=yield(s=e,u()({path:`/wpqt/v1/pipelines/${s}/labels`,method:"GET",headers:p()}));t&&t(!0,a.data.labels)}catch(e){console.error(e),t&&t(!1)}var s})),createPipelineLabel:(e,t,s,a)=>mn(this,void 0,void 0,(function*(){try{const n=yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/labels`,method:"POST",headers:p(),data:{name:t,color:s}})}(e,t,s);i.oR.success((0,o.__)("Label created successfully","quicktasker")),a&&a(!0,n.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create label","quicktasker")),a&&a(!1)}})),editLabel:(e,t,s)=>mn(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/labels/${t.id}`,method:"PATCH",headers:p(),data:{name:t.name,color:t.color}})}(e,t);i.oR.success((0,o.__)("Label updated successfully","quicktasker")),s&&s(!0,a.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to update label","quicktasker")),s&&s(!1)}})),assignLabelToTask:(e,t,s,a)=>mn(this,void 0,void 0,(function*(){try{const n=yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/tasks/${t}/labels`,method:"POST",headers:p(),data:{labelId:s}})}(e,t,s);i.oR.success((0,o.__)("Label added to task","quicktasker")),a&&a(!0,n.data.label)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add label to task","quicktasker")),a&&a(!1)}})),usassignLabelFromTask:(e,t,s,a)=>mn(this,void 0,void 0,(function*(){try{yield function(e,t,s){return u()({path:`/wpqt/v1/pipelines/${e}/tasks/${t}/labels/${s}`,method:"DELETE",headers:p()})}(e,t,s),i.oR.success((0,o.__)("Label removed from task","quicktasker")),a&&a(!0)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to remove label from task","quicktasker")),a&&a(!1)}}))}}();(0,a.useEffect)((()=>(bn(void 0,void 0,void 0,(function*(){v(!0),yield _(e.pipeline_id,((e,t)=>{e&&t&&h({type:Qe,payload:t})})),v(!1)})),()=>{h({type:st})})),[]);const T=()=>{const t=e.assigned_labels||[];return(c||[]).map((e=>Object.assign(Object.assign({},e),{selected:t.some((t=>t.id===e.id))})))},E=s=>bn(void 0,void 0,void 0,(function*(){yield g(e.pipeline_id,e.id,s,((s,a)=>{s&&a&&(m({type:U,payload:{taskId:e.id,label:a}}),w({type:fe,payload:{taskId:e.id,label:a}}),t(a))}))})),S=t=>bn(void 0,void 0,void 0,(function*(){yield j(e.pipeline_id,e.id,t,(a=>{a&&(m({type:M,payload:{taskId:e.id,labelId:t}}),w({type:_e,payload:{taskId:e.id,labelId:t}}),s(t))}))})),A=(t,s)=>bn(void 0,void 0,void 0,(function*(){f(!0),yield k(e.pipeline_id,t,s,((e,t)=>{e&&t&&h({type:Ye,payload:t})})),f(!1)})),C=t=>bn(void 0,void 0,void 0,(function*(){yield y(e.pipeline_id,t,((e,t)=>{e&&t&&(h({type:Je,payload:t}),m({type:F,payload:{label:t}}))}))})),O=t=>bn(void 0,void 0,void 0,(function*(){yield b(e.pipeline_id,t,((e,s)=>{e&&s&&(h({type:Ze}),h({type:Xe,payload:s}),m({type:z,payload:t}),r(t))}))}));return(0,n.jsx)("div",{className:"wpqt-min-w-56 wpqt-flex wpqt-flex-col wpqt-gap-4",onClick:e=>e.stopPropagation(),children:(()=>{switch(l){case Ht.SELECTION:return(0,n.jsx)(jn,{title:(0,o.__)("Task label selection","quicktasker"),labels:T(),loading:q,labelSelected:E,labelDeSelection:S});case Ht.CREATION:return(0,n.jsx)(xn,{labelCreated:A,loading:x});case Ht.EDIT:return(0,n.jsx)(_n,{labelToEdit:d,editLabel:C,deleteLabe:O,closeEdit:()=>{h({type:Ze})}});default:return null}})()})}));function En({task:e,labelSelected:t=()=>{},labelDeselected:s=()=>{},labelDeleted:a=()=>{}}){const i=e.assigned_labels||[],o=Array.isArray(i)&&i.length>0;return(0,n.jsx)(pn,{menuBtnClasses:"wpqt-inline-flex",anchor:"bottom start",menuBtn:()=>(0,n.jsxs)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1.5",children:[(0,n.jsx)(ln.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`}),o&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-flex-wrap",children:i.map((e=>(0,n.jsx)(dn,{inlineStyle:{backgroundColor:e.color},children:e.name},e.id)))})]}),children:e&&(0,n.jsx)(Tn,{task:e,labelSelected:t,labelDeselected:s,labelDeleted:a})})}var Sn=s(2792),An=s(6797),Cn=s(4403);function On({sectionTitle:e,onItemSelect:t=()=>{},users:s=[],ActionIcon:a=Cn.A,actionIconClasses:i,noUsersText:o}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2 wpqt-text-lg",children:e}),s.map(((e,s)=>{var o;return(0,n.jsxs)("div",{onClick:s=>{s.stopPropagation(),t(e)},className:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-px-2 wpqt-py-1 hover:wpqt-bg-gray-100",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("div",{children:e.name}),(0,n.jsx)("div",{className:"wpqt-italic",children:e.description}),Ct(e)&&(0,n.jsx)("div",{children:null===(o=e.roles)||void 0===o?void 0:o.join(",")})]}),(0,n.jsx)(a,{className:`wpqt-ml-auto wpqt-size-5 ${i}`})]},s)})),0===s.length&&(0,n.jsx)("div",{children:o})]})}var Nn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Dn({task:e,onUserAdd:t,onUserDelete:s}){const{state:{users:r,wpUsers:c}}=(0,a.useContext)(Is),{handleExecutedAutomations:l}=gs(),{dispatch:d}=(0,a.useContext)(xs),[h,w]=(0,a.useState)(!1),m=r.filter((t=>{var s;return!(null!==(s=e.assigned_users)&&void 0!==s?s:[]).some((e=>e.id===t.id))})),q=c.filter((t=>{var s;return!(null!==(s=e.assigned_wp_users)&&void 0!==s?s:[]).some((e=>e.id===t.id))})),x=s=>Nn(this,void 0,void 0,(function*(){try{w(!0);const a=s.user_type,n=yield function(e,t,s){return u()({path:`/wpqt/v1/users/${e}/tasks/${t}`,method:"POST",data:{user_type:s},headers:p()})}(s.id,e.id,a);d({type:O,payload:{taskId:e.id,user:s}}),t(s),l(n.data.executedAutomations,e.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to assign user","quicktasker"))}finally{w(!1)}})),f=t=>Nn(this,void 0,void 0,(function*(){try{w(!0);const a=t.user_type,n=yield v(t.id,e.id,a);d({type:N,payload:{taskId:e.id,userId:t.id,userType:a}}),s(t),l(n.data.executedAutomations,e.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to remove user","quicktasker"))}finally{w(!1)}}));return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-w-[320px] wpqt-flex-col",children:[(0,n.jsx)(On,{sectionTitle:(0,o.__)("Assigned quicktaskers","quicktasker"),users:e.assigned_users,onItemSelect:f,ActionIcon:An.A,actionIconClasses:"wpqt-icon-red",noUsersText:(0,o.__)("No quicktaskers assigned","quicktasker")}),(0,n.jsx)(On,{sectionTitle:(0,o.__)("Assigned WordPress users","quicktasker"),users:e.assigned_wp_users,onItemSelect:f,ActionIcon:An.A,actionIconClasses:"wpqt-icon-red",noUsersText:(0,o.__)("No WordPress users assigned","quicktasker")}),(0,n.jsx)(On,{sectionTitle:(0,o.__)("Assign a quicktasker","quicktasker"),users:m,onItemSelect:x,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No quicktaskers available to assign","quicktasker")}),(0,n.jsx)(On,{sectionTitle:(0,o.__)("Assign a WordPress user","quicktasker"),users:q,onItemSelect:x,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No WordPress users with required permissions available to assign","quicktasker")}),h&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Zt,{width:"30",height:"30"})})]})}function In({task:e,onUserAdd:t=()=>{},onUserDelete:s=()=>{},menuBtnClasses:a=""}){const i=[...e.assigned_users||[],...e.assigned_wp_users||[]],o=i.length>0;return(0,n.jsx)(pn,{menuBtnClasses:`wpqt-inline-flex ${a}`,anchor:"bottom start",menuBtn:()=>(0,n.jsxs)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1",children:[(0,n.jsx)(Sn.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`}),o&&(0,n.jsx)("div",{children:i.map(((e,t)=>(0,n.jsxs)("span",{children:[e.name,t<i.length-1&&", "]},t)))})]}),children:(0,n.jsx)(Dn,{task:e,onUserAdd:t,onUserDelete:s})})}var Pn=s(1848);function Rn({tabs:e,tabsContent:t,tabClassName:s="",tabListClassName:a=""}){return(0,n.jsxs)(Pn.fu,{children:[(0,n.jsx)(Pn.wb,{className:`wpqt-mb-6 wpqt-flex wpqt-border-0 wpqt-border-b wpqt-border-solid wpqt-border-b-gray-300 ${a}`,children:e.map((e=>(0,n.jsx)(Ln,{className:s,children:e},e)))}),(0,n.jsx)(Pn.T2,{children:t.map(((e,t)=>(0,n.jsx)(Un,{children:e},t)))})]})}function Ln({children:e,className:t}){return(0,n.jsx)(Pn.oz,{as:"div",className:`wpqt-flex-1 wpqt-cursor-pointer wpqt-p-1 wpqt-pb-[10px] wpqt-text-center wpqt-text-lg data-[selected]:wpqt-border-b-2 data-[selected]:wpqt-border-l-0 data-[selected]:wpqt-border-r-0 data-[selected]:wpqt-border-t-0 data-[selected]:wpqt-border-solid data-[selected]:wpqt-border-b-blue-500 ${t}`,children:e})}function Un({children:e}){return(0,n.jsx)(Pn.Kp,{children:e})}const Mn={[Lt.Admin]:(0,o.__)("Admin","quicktasker"),[Lt.Automation]:(0,o.__)("Automation","quicktasker"),[Lt.System]:(0,o.__)("System","quicktasker"),[Lt.WPQTUser]:"Quicktasker"},Fn=({log:e})=>{const{convertToWPTimezone:t}=ga(),s=Mn[e.created_by];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-1",children:e.author_name}),(0,n.jsx)("div",{className:"wpqt-text-center",children:s})]}),(0,n.jsx)("div",{children:e.text}),(0,n.jsx)("div",{children:t(e.created_at)})]})};var zn=s(3338),Kn=s(3211);const $n={success:"wpqt-bg-green-100 wpqt-border-green-400 wpqt-text-green-700",error:"wpqt-bg-red-100 wpqt-border-red-400 wpqt-text-red-700",warning:"wpqt-bg-yellow-100 wpqt-border-yellow-400 wpqt-text-yellow-700",info:"wpqt-bg-blue-100 wpqt-border-blue-400 wpqt-text-blue-700",primary:"wpqt-bg-gray-100 wpqt-border-gray-400 wpqt-text-gray-700"};function Gn({type:e="primary",className:t="",children:s}){const a=$n[e];return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-p-2 wpqt-border wpqt-border-solid wpqt-rounded-md ${a} ${t}`,children:s})}var Vn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Bn({typeId:e,fetchData:t,renderItem:s,noDataMessage:i,explanation:o,onAdd:r=()=>Vn(this,void 0,void 0,(function*(){})),enableAdd:c=!1}){const[l,d]=(0,a.useState)(null),[u,p]=(0,a.useState)(""),[h,w]=(0,a.useState)(!0),[m,q]=(0,a.useState)(!1);(0,a.useEffect)((()=>{v()}),[e]);const v=()=>Vn(this,void 0,void 0,(function*(){w(!0);const e=yield t();e&&d(e),w(!1)}));return null===l?(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Zt,{width:"30",height:"30"})}):(0,n.jsxs)("div",{children:[o&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Gn,{type:"info",className:"wpqt-mb-3 wpqt-text-center",children:o})}),0===l.length&&(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-text-center",children:i}),(0,n.jsx)("div",{className:"wpqt-mb-3 wpqt-mt-3 wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Hn,{isLoading:h,refreshComemnts:v})}),c&&(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-w-2/3 wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(Ca,{rowsCount:3,value:u,onChange:e=>p(e),className:"wpqt-mb-4 wpqt-w-full"}),(0,n.jsx)(Zs,{text:"Add comment",loading:m,onClick:()=>Vn(this,void 0,void 0,(function*(){if(!u)return;q(!0);const e=yield r(u);e&&(d((t=>t?[e,...t]:[e])),p("")),q(!1)})),icon:(0,n.jsx)(zn.A,{className:"wpqt-icon-blue wpqt-size-5"})})]})}),l.length>0&&(0,n.jsx)("div",{className:"wpqt-mb-[28px] wpqt-mt-[56px] wpqt-logs-grid",children:l.map((e=>s(e)))})]})}function Hn({isLoading:e,refreshComemnts:t}){return(0,n.jsx)(n.Fragment,{children:e?(0,n.jsx)(Zt,{width:"32",height:"32"}):(0,n.jsx)(Kn.A,{className:"wpqt-icon-blue wpqt-size-8 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:t})})}function Wn({item:e}){const{convertToWPTimezone:t}=ga();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-text-center wpqt-mb-1",children:e.author_name}),(0,n.jsx)("div",{className:"wpqt-text-center",children:e.is_admin_comment?(0,o.__)("Admin","quicktasker"):(0,o.__)("QuickTasker","quicktasker")})]}),(0,n.jsx)("div",{children:e.text}),(0,n.jsx)("div",{children:t(e.created_at)})]})}var Qn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Yn({taskId:e}){return(0,n.jsx)(Bn,{typeId:e,fetchData:()=>Qn(this,void 0,void 0,(function*(){try{return(yield q(e,Rt.Task)).data}catch(e){console.error(e),i.oR.error("Failed to get log")}})),renderItem:e=>(0,n.jsx)(Fn,{log:e}),noDataMessage:"No logs available",explanation:"Logs can be seen only by WordPress users (with required permissions)"})}var Xn=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Jn(){return{addComment:(e,t,s,a)=>Xn(this,void 0,void 0,(function*(){try{const n=yield m(e,t,s,a);return i.oR.success((0,o.__)("Comment added","quicktasker")),n.data.newComment}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add comment","quicktasker"))}}))}}const Zn=e=>Object.assign(Object.assign({},e),{is_admin_comment:"1"===e.is_admin_comment});var ei=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ti({taskId:e}){const{addComment:t}=Jn();return(0,n.jsx)(Bn,{typeId:e,fetchData:()=>ei(this,void 0,void 0,(function*(){try{return(yield w(e,Rt.Task,!0)).data.map(Zn)}catch(e){console.error(e),i.oR.error("Failed to load comments")}})),onAdd:s=>ei(this,void 0,void 0,(function*(){const a=yield t(e,Rt.Task,!0,s);if(a)return Zn(a)})),renderItem:e=>(0,n.jsx)(Wn,{item:e}),noDataMessage:"No comments available",explanation:"Comments that can be added and viewed only by WordPress users (with required permissions).",enableAdd:!0})}var si=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ai({taskId:e}){const{addComment:t}=Jn();return(0,n.jsx)(Bn,{typeId:e,fetchData:()=>si(this,void 0,void 0,(function*(){try{return(yield w(e,Rt.Task,!1)).data.map(Zn)}catch(e){console.error(e),i.oR.error("Failed to load comments")}})),onAdd:s=>si(this,void 0,void 0,(function*(){const a=yield t(e,Rt.Task,!1,s);if(a)return Zn(a)})),renderItem:e=>(0,n.jsx)(Wn,{item:e}),noDataMessage:"No comments available",explanation:"Comments that can be added and viewed by WordPress users (with required permissions) and quicktaskers (in quicktasker user page) who have been assigned to the task.",enableAdd:!0})}function ni({task:e}){return(0,n.jsx)(Rn,{tabs:["Private comments","Public comments","Logs"],tabsContent:[(0,n.jsx)(ti,{taskId:e.id},1),(0,n.jsx)(ai,{taskId:e.id},2),(0,n.jsx)(Yn,{taskId:e.id},3)]})}var ii=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function oi(){return{getUplaods:(e,t)=>ii(this,void 0,void 0,(function*(){try{const s=yield function(e,t){const s=new URLSearchParams({entity_id:e,entity_type:t});return u()({path:`/wpqt/v1/uploads?${s.toString()}`,method:"GET"})}(e,t);return{data:s.data,error:null}}catch(e){return console.error(e),{data:null,error:e}}})),uploadFile:e=>ii(this,void 0,void 0,(function*(){try{const t=yield function(e){return u()({path:"/wpqt/v1/uploads",method:"POST",body:e})}(e);return i.oR.success((0,o.__)("File uploaded successfully","quicktasker")),{data:t.data,error:null}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to upload a file","quicktasker")),{data:null,error:e}}})),deleteUpload:e=>ii(this,void 0,void 0,(function*(){try{const t=yield function(e){return u()({path:`/wpqt/v1/uploads/${e}`,method:"DELETE"})}(e);return i.oR.success((0,o.__)("File deleted successfully","quicktasker")),{data:t.data,error:null}}catch(e){return console.error(e),i.oR.error((0,o.__)("Failed to delete a file","quicktasker")),{data:null,error:e}}})),checkFileExists:e=>ii(this,void 0,void 0,(function*(){try{return(yield fetch(e,{method:"HEAD"})).ok}catch(e){return!1}}))}}var ri=s(2944),ci=s(4015);function li({upload:e,menuBtnClasses:t=""}){const{state:{taskUploadsURL:s}}=(0,a.useContext)(qa),i=`${s}/${e.upload_uuid}/${e.file_name}`;return(0,n.jsx)(pn,{menuBtnClasses:`wpqt-inline-flex ${t}`,anchor:"top",menuBtn:()=>(0,n.jsx)(ci.A,{className:"wpqt-size-5 wpqt-icon-blue"}),children:(0,n.jsxs)("div",{children:[(0,n.jsx)(di,{title:(0,o.__)("File name","quicktasker"),children:e.file_name}),(0,n.jsx)(di,{title:(0,o.__)("File link","quicktasker"),children:(0,n.jsx)("a",{href:i,target:"_blank",rel:"noreferrer",children:i})}),(0,n.jsx)(di,{title:(0,o.__)("Created at","quicktasker"),children:e.created_at}),(0,n.jsx)(di,{title:(0,o.__)("Created by","quicktasker"),children:e.uploader_name})]})})}function di({title:e,children:t}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-uppercase",children:e}),(0,n.jsx)("div",{children:t})]})}var ui=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function pi({upload:e}){const{state:{isUserAllowedToDelete:t,taskUploadsURL:s}}=(0,a.useContext)(qa),{uploadDispatch:r}=(0,a.useContext)(Fs),[c,l]=(0,a.useState)(!1),{checkFileExists:d,deleteUpload:u}=oi(),p=`${s}/${e.upload_uuid}/${e.file_name}`,h=(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-4 wpqt-justify-end wpqt-items-center",children:[(0,n.jsx)("a",{href:p,download:!0,onClick:()=>ui(this,void 0,void 0,(function*(){(yield d(p))||i.oR.error((0,o.__)("File was not found","quicktasker"))})),className:"focus:wpqt-shadow-none",children:(0,n.jsx)(ri.A,{className:"wpqt-icon-blue wpqt-size-5 :hover:wpqt-text-blue-800 wpqt-cursor-pointer"})}),(0,n.jsx)(li,{upload:e}),t&&(0,n.jsx)(ca.A,{className:"wpqt-icon-red wpqt-size-5 :hover:wpqt-text-red-800 wpqt-cursor-pointer",onClick:()=>ui(this,void 0,void 0,(function*(){l(!0);const{data:t}=yield u(e.id);t&&r({type:mt,payload:e.id}),l(!1)}))})]});return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-main-border wpqt-p-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:e.file_name}),c?(0,n.jsx)(ts,{ovalSize:"22",className:"!wpqt-items-end"}):h]})}var hi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function wi({entityId:e,entityType:t}){const{uploadDispatch:s}=(0,a.useContext)(Fs),[r,c]=(0,a.useState)(null),[l,d]=(0,a.useState)(!1),{uploadFile:u}=oi(),p=(0,a.useRef)(null);return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsxs)("div",{className:"wpqt-max-w-[300px]",children:[(0,o.sprintf)((0,o.__)("Select file to upload (Max size: %d MB)","quicktasker"),kt/1024/1024),(0,n.jsx)("br",{}),(0,o.__)("Allowed characters in file name: Latin letters, numbers, underscores, hyphens, and dots.","quicktasker")]}),(0,n.jsx)("input",{type:"file",onChange:e=>{if(e.target.files){const t=e.target.files[0];if(t.size>kt)return void i.oR.error((0,o.sprintf)((0,o.__)("File size exceeds the maximum limit of %d MB","quicktasker"),kt));if(!gt.test(t.name))return void i.oR.error((0,o.__)("Invalid file name","quicktasker"));if(0===t.size)return void i.oR.error((0,o.__)("The selected file is empty","quicktasker"));c(t)}},ref:p,accept:_t.join(",")}),r&&(0,n.jsx)(Js,{btnText:(0,o.__)("Upload","quicktasker"),loading:l,onClick:()=>hi(this,void 0,void 0,(function*(){const a=(()=>{if(!r)return null;const s=new FormData;return s.append("file_to_upload",r),s.append("entity_id",e),s.append("entity_type",t),s})();if(a){d(!0);const{data:e}=yield u(a);e&&(s({type:wt,payload:e.upload}),c(null),p.current&&(p.current.value="")),d(!1)}}))})]})}function mi({entityId:e,entityType:t}){const{state:{uploads:s},uploadDispatch:r}=(0,a.useContext)(Fs),[c,l]=(0,a.useState)(!0),{getUplaods:d}=oi(),u=()=>{return s=this,a=void 0,c=function*(){l(!0);const{data:s,error:a}=yield d(e,t);l(!1),s&&s.uploads&&r({type:ht,payload:s.uploads}),a&&i.oR.error((0,o.__)("Failed to fetch uploads","quicktasker"))},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,o)}r((c=c.apply(s,a||[])).next())}));var s,a,n,c};return(0,a.useEffect)((()=>{u()}),[]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(wi,{entityId:e,entityType:t}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-flex-wrap wpqt-items-start",children:c?(0,n.jsx)(ts,{ovalSize:"24"}):s.map((e=>(0,n.jsx)(pi,{upload:e},e.id)))})]})}var qi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const vi=(0,a.forwardRef)((({taskModalSaving:e,editTask:t,deleteTask:s},i)=>{const{state:{taskToEdit:r,taskModalSettings:c},modalDispatch:l}=(0,a.useContext)(As),{state:{isUserAllowedToDelete:d}}=(0,a.useContext)(qa),{state:{activePipeline:u},fetchAndSetPipelineData:p}=(0,a.useContext)(xs),{archiveDispatch:h}=(0,a.useContext)(Vt),[w,m]=(0,a.useState)(""),[q,v]=(0,a.useState)(""),[x,f]=(0,a.useState)(!1),[_,k]=(0,a.useState)(null),[g,j]=(0,a.useState)([]),{archiveTask:y,restoreArchivedTask:b}=ys(),{loading1:T,setLoading1:E,loading2:S,setLoading2:A}=ha(),{convertUTCDateTimeToWPTimezone:C}=ga(),O=null==r?void 0:r.is_archived,N=null!==(null==r?void 0:r.pipeline_name);(0,a.useEffect)((()=>{if(r){const e=r.due_date?C(r.due_date):null;m(r.name),v(r.description),f(r.free_for_all),k(e),j(r.assigned_labels)}}),[r]);const D=()=>{m(""),v("")};return(0,a.useImperativeHandle)(i,(()=>({clearContent:D}))),r?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsxs)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:[(0,n.jsxs)("div",{className:"wpqt-mb-2 wpqt-grid wpqt-grid-cols-1 wpqt-gap-4 md:wpqt-grid-cols-[1fr_2fr]",children:[(0,n.jsxs)(aa,{children:[(0,n.jsx)(na,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(Ea,{isAutoFocus:!0,value:w,onChange:e=>m(e),wrapperClassName:"wpqt-w-full",className:"wpqt-w-full"})}),(0,n.jsx)(na,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Ca,{rowsCount:3,value:q,className:"wpqt-w-full",onChange:e=>v(e)})}),(0,n.jsx)(na,{label:(0,o.__)("Assigned users","quicktasker"),children:(0,n.jsx)(In,{task:r,onUserAdd:e=>{l({type:te,payload:e})},onUserDelete:e=>{l({type:se,payload:e})}})}),(0,n.jsx)(na,{label:(0,o.__)("Labels","quicktasker"),children:(0,n.jsx)(En,{task:Object.assign(Object.assign({},r),{assigned_labels:g}),labelSelected:e=>{j((t=>[...t,e]))},labelDeselected:e=>{j((t=>t.filter((t=>t.id!==e))))},labelDeleted:e=>{j((t=>t.filter((t=>t.id!==e))))}})}),(0,n.jsx)(na,{label:(0,o.__)("Free for all task","quicktasker"),tooltipId:`free-for-all-${r.id}-tooltip`,tooltipText:(0,o.__)("When enabled, all QuickTasker users have the ability to self-assign or unassign this task.","quicktasker"),children:(0,n.jsx)(Na,{checked:x,handleChange:f})}),(0,n.jsx)(na,{label:(0,o.__)("Due date","quicktasker"),children:(0,n.jsx)(pa.A,{onChange:e=>{k(e)},value:_,format:"y-MM-dd HH:mm"})}),c.allowToMarkTaskAsDone&&(0,n.jsx)(xi,{taskId:r.id,isCompleted:r.is_done})]}),(0,n.jsx)("div",{children:(0,n.jsx)(cn,{entityId:r.id,entityType:ya.Task})})]}),(0,n.jsx)("div",{className:"wpqt-mb-4",children:(0,n.jsx)(ia,{onSave:()=>{r&&t(Object.assign(Object.assign({},r),{name:w,description:q,free_for_all:x,due_date:_?ua()(_).utc().format("YYYY-MM-DD HH:mm:ss"):null}))},saveBtnText:e?(0,o.__)("Saving...","quicktasker"):(0,o.__)("Save","quicktasker")})}),(0,n.jsx)(na,{label:(0,o.__)("File attachment","quicktasker"),children:(0,n.jsx)(mi,{entityId:r.id,entityType:ba.TASK})}),(0,n.jsx)("div",{className:"wpqt-mt-7 md:wpqt-pr-3",children:(0,n.jsx)(ni,{task:r})})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[O&&N&&(0,n.jsx)(Zs,{icon:(0,n.jsx)(oa.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Restore task","quicktasker"),onClick:()=>{b(r.id,(()=>{l({type:B}),h({type:he,payload:r.id})}))}}),!O&&(0,n.jsx)(Zs,{icon:(0,n.jsx)(ra.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("Archive task","quicktasker"),loading:S,onClick:()=>{A(!0),y(r.id,(()=>{l({type:B}),p(u.id),A(!1)}))}}),d&&(0,n.jsx)(Zs,{icon:(0,n.jsx)(ca.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Delete task","quicktasker"),loading:T,onClick:()=>qi(void 0,void 0,void 0,(function*(){E(!0),yield s(r),l({type:B}),E(!1)}))})]})]})}):null}));function xi({isCompleted:e,taskId:t}){const{modalDispatch:s}=(0,a.useContext)(As),{dispatch:i}=(0,a.useContext)(xs),[r,c]=(0,a.useState)(!1),{changeTaskDoneStatus:l}=ys();return(0,n.jsx)(na,{label:e?(0,o.__)("Task completed","quicktasker"):(0,o.__)("Task not completed","quicktasker"),children:r?(0,n.jsx)(Zt,{width:"24",height:"24"}):(0,n.jsx)(la.A,{onClick:()=>qi(this,void 0,void 0,(function*(){c(!0),yield l(t,!e,(e=>{s({type:D,payload:{done:e}}),i({type:D,payload:{taskId:t,done:e}})})),c(!1)})),className:`wpqt-size-6 ${e?"wpqt-icon-green":"wpqt-text-gray-300"} wpqt-cursor-pointer`})})}var fi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function _i({editTaskCallback:e,deleteTaskCallback:t}){const{state:{taskModalOpen:s}}=(0,a.useContext)(As),{deleteTask:i}=ys(),{modalSaving:o,setModalSaving:r,modalContentRef:c,closeModal:l,handleSuccess:d,handleError:h}=Ls(B);return(0,n.jsx)(ta,{modalOpen:s,closeModal:l,size:"xl",children:(0,n.jsx)(zs,{children:(0,n.jsx)(vi,{ref:c,editTask:t=>fi(this,void 0,void 0,(function*(){try{r(!0);const s=yield function(e){return u()({path:`/wpqt/v1/tasks/${e.id}`,method:"PATCH",data:{id:e.id,name:e.name,description:e.description,freeForAll:e.free_for_all,dueDate:e.due_date},headers:p()})}(t);d(b,s.data,Rs.ACTIVE_PIPELINE),e&&e(s.data)}catch(e){h(e)}})),deleteTask:e=>fi(this,void 0,void 0,(function*(){i(e.id,(()=>{t&&t(e)}))})),taskModalSaving:o})})})}function ki({text:e=(0,o.__)("No results found","quicktasker")}){return(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-center wpqt-text-xl",children:e})}const gi=()=>{const{state:{archiveSearchValue:e,archiveFilteredPipelineId:t,archiveTaskDoneFilter:s}}=(0,a.useContext)(Vt);return{filterArchive:a=>{const n=a.name.toLowerCase().includes(e.toLowerCase())||a.description&&a.description.toLowerCase().includes(e.toLowerCase()),i=!t||("DELETED"===t?null===a.pipeline_name:a.pipeline_id===t),o=s===Ut.All||s===Ut.Completed&&a.is_done||s===Ut.NotCompleted&&!a.is_done;return n&&i&&o}}};var ji=s(3033),yi=s(587);function bi({className:e,onClick:t,title:s,description:a,children:i,dropdown:o,titleClassName:r="",style:c={}}){const l=void 0!==o;return(0,n.jsxs)("div",{className:(0,Aa.$)("wpqt-relative wpqt-flex wpqt-flex-col wpqt-rounded wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-p-4",l&&"wpqt-pr-[24px]",e),style:c,onClick:t,children:[(0,n.jsxs)("div",{className:"wpqt-mb-3",children:[(0,n.jsx)("div",{className:`wpqt-text-lg ${r}`,children:s}),a&&(0,n.jsx)("div",{className:"wpqt-italic wpqt-text-gray-500",children:a})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-h-full",children:i}),l&&(0,n.jsx)("div",{className:"wpqt-absolute wpqt-right-2 wpqt-top-1 wpqt-z-10",children:o})]})}var Ti=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ei({task:e,onDoneStatusChange:t,className:s=""}){const{changeTaskDoneStatus:i}=ys(),[o,r]=(0,a.useState)(!1),c=e.is_done,l=s=>Ti(this,void 0,void 0,(function*(){r(!0),yield i(e.id,s,(s=>{t(e.id,s)})),r(!1)}));return o?(0,n.jsx)(ts,{ovalSize:"24",className:"wpqt-mt-auto"}):(0,n.jsx)("div",{className:`wpqt-flex wpqt-justify-center wpqt-mt-auto ${s}`,children:c?(0,n.jsx)(la.A,{className:"wpqt-size-6 wpqt-icon-green",onClick:e=>{e.stopPropagation(),l(!1)}}):(0,n.jsx)(la.A,{className:"wpqt-size-6 wpqt-text-gray-300",onClick:e=>{e.stopPropagation(),l(!0)}})})}function Si({label:e,value:t,valueClassName:s="",valueLink:a,icon:i,onClick:o=()=>{},className:r="",labelClassName:c=""}){return(0,n.jsxs)("div",{className:`wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center ${r}`,onClick:o,children:[i&&i,(0,n.jsx)("div",{className:c,children:t?`${e}:`:e}),(0,n.jsx)("div",{className:`${s}`,children:a?(0,n.jsx)("a",{href:a,target:"_blank",className:"wpqt-text-qtTextBlue wpqt-no-underline",rel:"noreferrer",onClick:e=>e.stopPropagation(),children:t}):t})]})}var Ai=s(6436),Ci=s(72),Oi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Ni({task:e}){const{state:{isUserAllowedToDelete:t}}=(0,a.useContext)(qa),{archiveDispatch:s}=(0,a.useContext)(Vt),{deleteTask:i,restoreArchivedTask:o}=ys(),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),u=null!==e.pipeline_name;return(0,n.jsxs)(pn,{menuBtn:({active:e})=>(0,n.jsx)(hn,{isActive:e,IconComponent:Ai.A}),children:[(0,n.jsx)(wn,{text:"View task",icon:(0,n.jsx)(Ci.A,{className:"wpqt-icon-blue wpqt-size-4"})}),(0,n.jsx)(wn,{text:"Restore task",loading:r,icon:(0,n.jsx)(oa.A,{className:"wpqt-icon-green wpqt-size-4"}),disabled:!u,id:`restore-task-${e.id}-dropdown-item`,tooltipText:"Task cannot be restored because the board has been deleted.",onClick:t=>Oi(this,void 0,void 0,(function*(){t.stopPropagation(),c(!0),yield o(e.id,(()=>{s({type:he,payload:e.id})})),c(!1)}))}),t&&(0,n.jsx)(wn,{text:"Delete",loading:l,icon:(0,n.jsx)(ca.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>Oi(this,void 0,void 0,(function*(){t.stopPropagation(),d(!0),yield i(e.id,(()=>{s({type:he,payload:e.id})})),d(!1)})),className:"!wpqt-mb-0"})]})}function Di({task:e}){const{modalDispatch:t}=(0,a.useContext)(As),{archiveDispatch:s}=(0,a.useContext)(Vt),{convertToWPTimezone:i}=ga(),r=e.due_date?i(e.due_date):null;return(0,n.jsxs)(bi,{title:e.name,description:e.description,dropdown:(0,n.jsx)(Ni,{task:e}),className:"wpqt-cursor-pointer",onClick:()=>{t({type:V,payload:{taskToEdit:e}})},children:[(0,n.jsx)(Si,{label:(0,o.__)("Board","quicktasker"),value:e.pipeline_name?e.pipeline_name:(0,o.__)("Board is deleted!","quicktasker"),icon:(0,n.jsx)(ji.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(In,{menuBtnClasses:"wpqt-self-start",task:e,onUserAdd:t=>{s({type:we,payload:{taskId:e.id,user:t}})},onUserDelete:t=>{s({type:me,payload:{taskId:e.id,user:t}})}}),(0,n.jsx)(En,{task:e})]}),r&&(0,n.jsx)(Si,{label:(0,o.__)("Due date","quicktasker"),value:r,icon:(0,n.jsx)(yi.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(Ei,{task:e,onDoneStatusChange:(e,t)=>{s({type:qe,payload:{taskId:e,done:t}})}})]})}function Ii(){var e;const{state:{archivedTasks:t=[]}}=(0,a.useContext)(Vt),{filterArchive:s}=gi(),i=null!==(e=null==t?void 0:t.filter(s))&&void 0!==e?e:[];return t&&0===t.length?(0,n.jsx)(ki,{text:(0,o.__)("No tasks archived","quicktasker")}):i&&0===i.length?(0,n.jsx)(ki,{}):(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"wpqt-card-grid",children:i.map((e=>(0,n.jsx)(Di,{task:e},e.id)))})})}function Pi(){const{state:{archivedTasks:e},archiveDispatch:t}=(0,a.useContext)(Vt);return e?(0,n.jsxs)("div",{children:[(0,n.jsx)(ws,{}),(0,n.jsx)(Ii,{}),(0,n.jsx)(_i,{editTaskCallback:e=>{t({type:ve,payload:e})},deleteTaskCallback:e=>{t({type:he,payload:e.id})}})]}):(0,n.jsx)(ts,{className:"wpqt-h-[200px]"})}function Ri(){return(0,n.jsx)(Bt,{children:(0,n.jsx)(Xt,{children:(0,n.jsxs)(ss,{children:[(0,n.jsx)(l,{description:(0,o.__)("Archived tasks management page.","quicktasker"),children:(0,o.__)("Archive","quicktasker")}),(0,n.jsx)(Pi,{})]})})})}const Li=()=>{const{state:{pluginURL:e}}=(0,a.useContext)(qa);return(0,n.jsxs)(ss,{children:[(0,n.jsx)(l,{description:(0,o.__)("Reading material about QuickTasker features and usage.","quicktasker"),children:(0,o.__)("Guide","quicktasker")}),(0,n.jsx)("div",{children:(0,n.jsx)("a",{target:"_blank",rel:"noreferrer",href:e+"help/index.html",children:(0,o.__)("View Guide","quicktasker")})})]})};var Ui=s(4175);const Mi=({filterSettings:e,setFilterSettings:t})=>{const{state:{pipelines:s}}=(0,a.useContext)(cs),[i,r]=(0,a.useState)(e);return(0,n.jsxs)(hs,{title:(0,o.__)("Logs filtering","quicktasker"),children:[(0,n.jsx)(us,{allSelector:!1,selectedOptionValue:i.type,options:[{label:(0,o.__)("All types","quicktasker"),value:Fi.All},{label:(0,o.__)("Board","quicktasker"),value:Fi.Pipeline},{label:(0,o.__)("Stage","quicktasker"),value:Fi.Stage},{label:(0,o.__)("Task","quicktasker"),value:Fi.Task}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{type:e,typeId:""}))}}),i.type===Fi.Pipeline&&(0,n.jsx)(us,{allSelector:!0,selectedOptionValue:i.typeId,options:s.map((e=>({label:e.name,value:e.id}))),onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{typeId:e}))}}),(0,n.jsx)(us,{allSelector:!1,selectedOptionValue:i.createdBy,options:[{label:(0,o.__)("Everyone","quicktasker"),value:Ki.All},{label:(0,o.__)("Admin","quicktasker"),value:Ki.Admin},{label:"QuickTasker",value:Ki.Quicktasker},{label:"Automation",value:Ki.Automation}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{createdBy:e}))}}),(0,n.jsx)(us,{allSelector:!1,selectedOptionValue:i.numberOfLogs,options:[{label:(0,o.__)("Show 100","quicktasker"),value:Vi.Hundred},{label:(0,o.__)("Show 200","quicktasker"),value:Vi.TwoHundred},{label:"Show 500",value:Vi.FiveHundred},{label:"Show all",value:Vi.All}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{numberOfLogs:e}))}}),(0,n.jsx)(us,{allSelector:!1,selectedOptionValue:i.order,options:[{label:(0,o.__)("Ascending","quicktasker"),value:Gi.Asc},{label:(0,o.__)("Descending","quicktasker"),value:Gi.Desc}],onSelectionChange:e=>{r(Object.assign(Object.assign({},i),{order:e}))}}),(0,n.jsx)(Zs,{text:(0,o.__)("Apply filter","quicktasker"),icon:(0,n.jsx)(Ui.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:()=>t(i)})]})};var Fi,zi,Ki;!function(e){e.Pipeline="pipeline",e.Stage="stage",e.Task="task",e.All="all"}(Fi||(Fi={})),function(e){e.Success="success",e.Error="error"}(zi||(zi={})),function(e){e.Admin="admin",e.Quicktasker="quicktasker_user",e.Automation="automation",e.All="all"}(Ki||(Ki={}));const $i=({logs:e,loading:t})=>t?(0,n.jsx)(ts,{ovalSize:"64",className:"wpqt-mt-12"}):0===e.length?(0,n.jsx)(ki,{text:(0,o.__)("No logs found","quicktasker")}):(0,n.jsx)("div",{className:"wpqt-logs-grid",children:e.map((e=>(0,n.jsx)(Fn,{log:e},e.id)))});var Gi,Vi,Bi=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};!function(e){e.Asc="ASC",e.Desc="DESC"}(Gi||(Gi={})),function(e){e.Hundred="100",e.TwoHundred="200",e.FiveHundred="500",e.All="all"}(Vi||(Vi={}));const Hi=()=>{const[e,t]=(0,a.useState)([]),[s,o]=(0,a.useState)({numberOfLogs:Vi.Hundred,type:Fi.All,typeId:"",createdBy:Ki.All,order:Gi.Desc}),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!0);(0,a.useEffect)((()=>{l&&(h(),d(!1))}),[s,l]);const h=()=>Bi(void 0,void 0,void 0,(function*(){try{c(!0);const e=Object.assign({},s);e.numberOfLogs===Vi.All&&delete e.numberOfLogs,e.type===Fi.All&&delete e.type,""===e.typeId&&delete e.typeId,e.createdBy===Ki.All&&delete e.createdBy;const a=yield function(e){const t=new URLSearchParams(Object.entries(e).reduce(((e,[t,s])=>(e[t]=String(s),e)),{}));return u()({path:`/wpqt/v1/global-logs?${t.toString()}`,method:"GET",headers:p()})}(e);t(a.data)}catch(e){console.error(e),i.oR.error("Failed to fetch logs")}finally{c(!1)}}));return(0,n.jsxs)("div",{children:[(0,n.jsx)(Mi,{filterSettings:s,setFilterSettings:e=>Bi(void 0,void 0,void 0,(function*(){o(e),d(!0)}))}),(0,n.jsx)($i,{logs:e,loading:r})]})},Wi=()=>(0,n.jsxs)(ss,{children:[(0,n.jsx)(l,{description:(0,o.__)("The logs page where you can see all logs and filter them.","quicktasker"),children:(0,o.__)("Logs","quicktasker")}),(0,n.jsx)(Hi,{})]});function Qi({infoText:e,infoDescription:t,actionIcon:s,infoActionClick:a}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-h-screen-minus-top-bar wpqt-items-center wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-1",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-cursor-pointer",onClick:a,children:[s,(0,n.jsx)("p",{className:"wpqt-m-0 wpqt-font-semibold wpqt-text-lg",children:e})]}),(0,n.jsx)("p",{children:t})]})})}function Yi({overviewFilter:e,onCreationDateChange:t,onDoneDateChange:s}){const a=e=>e instanceof Date?ua()(e).format("YYYY-MM-DD"):"";return(0,n.jsx)("div",{children:(0,n.jsxs)(hs,{title:(0,o.__)("Statistics filtering","quicktasker"),titleClassName:"wpqt-text-center",childrenClassName:"wpqt-gap-6 wpqt-justify-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:(0,o.__)("Task creation date","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("(Filter tasks that have creation date equal or bigger than)","quicktasker")})]}),(0,n.jsx)(pa.A,{onChange:e=>{const s=a(e);t(s)},value:e.taskCreationDate,format:"y-MM-dd",id:"taskCreationDate"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold",children:(0,o.__)("Task done date","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("(Filter tasks that have done date equal or smaller than)","quicktasker")})]}),(0,n.jsx)(pa.A,{onChange:e=>{const t=a(e);s(t)},value:e.taskDoneDate,format:"y-MM-dd",id:"taskCreationDate"})]})]})})}var Xi=s(2298);function Ji(e){const t=e.slice(1).some((e=>e[1]>0));return e.length>1&&t}function Zi({text:e}){return(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center wpqt-items-center wpqt-h-[400px] wpqt-w-[500px] wpqt-font-semibold",children:e})}function eo({pipelineOverviewData:e,options:t,width:s}){var a,i;const r=[["Archived tasks","Task Count"],["Archived tasks",parseInt(null!==(a=null==e?void 0:e.archivedTasksCount)&&void 0!==a?a:"0")||0],["Not archived tasks",parseInt(null!==(i=null==e?void 0:e.notArchivedTasksCount)&&void 0!==i?i:"0")||0]];return Ji(r)?(0,n.jsx)(Xi.t1,{chartType:"PieChart",data:r,options:Object.assign(Object.assign({},t),{title:"Archived tasks"}),width:s,height:"400px"}):(0,n.jsx)(Zi,{text:(0,o.__)("Not enough data to display archived tasks chart","quicktasker")})}function to({pipelineOverviewData:e,options:t,width:s}){var a;const i=[["Stage","Task Count"],...null!==(a=null==e?void 0:e.stages.map((e=>[e.name,parseInt(e.tasksCount)||0])))&&void 0!==a?a:[]];return Ji(i)?(0,n.jsx)(Xi.t1,{chartType:"PieChart",data:i,options:Object.assign(Object.assign({},t),{title:"Task distribution by stages"}),width:s,height:"400px"}):(0,n.jsx)(Zi,{text:(0,o.__)("Not enough data to display task distribution by stages chart","quicktasker")})}function so({pipelineOverviewData:e,options:t,width:s}){var a,i;const r=[["Task status","Task Count"],["Done",parseInt(null!==(a=null==e?void 0:e.doneTasksCount)&&void 0!==a?a:"0")||0],["Not Done",parseInt(null!==(i=null==e?void 0:e.notDoneTasksCount)&&void 0!==i?i:"0")||0]];return Ji(r)?(0,n.jsx)(Xi.t1,{chartType:"PieChart",data:r,options:Object.assign(Object.assign({},t),{title:"Task status"}),width:s,height:"400px"}):(0,n.jsx)(Zi,{text:(0,o.__)("Not enough data to display task status chart","quicktasker")})}var ao=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const no={legend:{position:"left",alignment:"center",textStyle:{color:"#233238",fontSize:14}}};function io({pipeline:e,overviewFilter:t}){const[s,i]=(0,a.useState)(null),[o,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(()=>{ao(this,void 0,void 0,(function*(){try{r(!0);const s=yield function(e,t){const s=new URLSearchParams({taskStartDate:t.taskCreationDate||"",taskDoneDate:t.taskDoneDate||"",taskAssignees:t.taskAssignees.join(",")});return u()({path:`/wpqt/v1/pipelines/${e}/overview?${s.toString()}`,method:"GET",headers:p()})}(e.id,t);i(s.data)}catch(e){console.error(e)}finally{r(!1)}}))})()}),[e.id,t]),o||!s?(0,n.jsx)(ts,{ovalSize:"48"}):(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-wrap wpqt-justify-center xl:wpqt-justify-start",children:[(0,n.jsx)(to,{pipelineOverviewData:s,options:no,width:"500px"}),(0,n.jsx)(so,{pipelineOverviewData:s,options:no,width:"500px"}),(0,n.jsx)(eo,{pipelineOverviewData:s,options:no,width:"500px"})]})}function oo({pipeline:e}){const[t,s]=(0,a.useState)({taskCreationDate:null,taskDoneDate:null,taskAssignees:[]});return(0,n.jsxs)("div",{children:[(0,n.jsx)(Yi,{overviewFilter:t,onCreationDateChange:e=>{s(Object.assign(Object.assign({},t),{taskCreationDate:e}))},onDoneDateChange:e=>{s(Object.assign(Object.assign({},t),{taskDoneDate:e}))}}),(0,n.jsx)(io,{pipeline:e,overviewFilter:t})]})}function ro(){const{state:{pipelines:e}}=(0,a.useContext)(cs),t=e.map((e=>e.name)),s=e.map((e=>(0,n.jsx)(oo,{pipeline:e},e.id)));return(0,n.jsx)(ss,{children:s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{description:(0,o.__)("Get overview of the tasks.","quicktasker"),children:(0,o.__)("Overview","quicktasker")}),(0,n.jsx)(Rn,{tabs:t,tabsContent:s,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})]}):(0,n.jsx)(Qi,{infoText:(0,o.__)("No overview to display","quicktasker"),infoDescription:(0,o.__)("You need to first create a board to see the overview.","quicktasker")})})}function co(){const{state:{activePipeline:e}}=(0,a.useContext)(xs),t=()=>(null==e?void 0:e.stages)||[],s=e=>{const s=t();let a=null;return s?(s.forEach((t=>{t.tasks&&!a&&t.tasks.find((t=>t.id===e))&&(a=t)})),a):null},n=(0,a.useMemo)((()=>{const e=t();return e?e.map((e=>({label:e.name,value:e.id}))):[]}),[e]),i=(0,a.useMemo)((()=>{const e=t(),s=[];return e?(e.forEach((e=>{e.tasks&&s.push(...e.tasks)})),s):s}),[e]),o=null==e?void 0:e.settings;return{getActivePipelineStages:t,getActivePipelinStageTasksLength:e=>{const s=t();if(!s)return 0;const a=s.find((t=>t.id===e));return a&&a.tasks?a.tasks.length:0},getTaskStage:s,getTaskOrderInStage:e=>{const t=s(e);if(!t||!t.tasks)return null;const a=t.tasks.findIndex((t=>t.id===e));return-1!==a?a:null},activePipelineTasks:i,activePipelineSettings:o,isTaskOnLastStage:e=>{const a=t();if(!a)return!1;const n=s(e);if(!n)return!1;const i=a[a.length-1];return n.id===i.id},stageOptions:n}}const lo=()=>{const{state:{users:e,wpUsers:t}}=(0,a.useContext)(Is);return{getUser:(s,a)=>a===jt.QUICKTASKER?e.find((e=>e.id===s)):a===jt.WP_USER?t.find((e=>e.id===s)):void 0,combinedUsers:(0,a.useMemo)((()=>[...e,...t]),[e,t])}},uo=(e,t)=>{switch(t.type){case G:{const{id:s,type:a}=t.payload;return Object.assign(Object.assign({},e),{userFilter:{id:s,type:a}})}case $:return Object.assign(Object.assign({},e),{stageIdFilter:t.payload});default:return e}},po={stageIdFilter:"",userFilter:{id:null,type:null}},ho=(0,a.createContext)({state:po,taskViewDispatch:()=>{}}),wo=({children:e})=>{const[t,s]=(0,a.useReducer)(uo,po);return(0,n.jsx)(ho.Provider,{value:{state:t,taskViewDispatch:s},children:e})};function mo(){const{state:{stageIdFilter:e,userFilter:t},taskViewDispatch:s}=(0,a.useContext)(ho),{stageOptions:i}=co(),{combinedUsers:r}=lo(),c=r.map((e=>({value:`${e.id}:${e.user_type}`,label:`${e.name} (${Dt[e.user_type]})`}))),l=t.id&&t.type?`${t.id}:${t.type}`:"";return(0,n.jsxs)(hs,{title:(0,o.__)("Filter tasks","quicktasker"),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(vn,{labelFor:"task-view-stage-filter",className:"wpqt-block wpqt-text-center",children:(0,o.__)("Stage","quicktasker")}),(0,n.jsx)(us,{id:"task-view-stage-filter",allSelectorLabel:(0,o.__)("All stages","quicktasker"),selectedOptionValue:e,options:i,onSelectionChange:e=>{s({type:$,payload:e})}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(vn,{labelFor:"task-view-assigned-user-filter",className:"wpqt-block wpqt-text-center",children:(0,o.__)("Assigned user","quicktasker")}),(0,n.jsx)(us,{id:"task-view-assigned-user-filter",allSelectorLabel:(0,o.__)("All users","quicktasker"),selectedOptionValue:l,options:c,onSelectionChange:e=>{const[t,a]=e.split(":");s({type:G,payload:{id:t,type:a}})}})]})]})}function qo(){const{state:{moveTaskModalOpen:e,taskToEdit:t},modalDispatch:s}=(0,a.useContext)(As),{dispatch:i}=(0,a.useContext)(xs),{getActivePipelineStages:r,getActivePipelinStageTasksLength:c,getTaskStage:l,getTaskOrderInStage:d}=co(),{moveTask:u}=ys(),[p,h]=(0,a.useState)(0),[w,m]=(0,a.useState)(""),[q,v]=(0,a.useState)(!1),x=c(w),f=Array.from({length:x+1},((e,t)=>({value:t.toString(),label:(t+1).toString()}))),_=r().map((e=>({value:e.id,label:e.name}))),g=()=>{s({type:ie})};return(0,a.useEffect)((()=>{if(t){const e=l(t.id),s=d(t.id);e&&null!==s&&(m(e.id),h(s))}}),[t]),(0,n.jsx)(ta,{modalOpen:e,closeModal:g,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)("h2",{children:(0,o.__)("Change task location on board","quicktasker")}),(0,n.jsx)("label",{htmlFor:"move-task-stage-selection",children:(0,o.__)("Select stage","quicktasker")}),(0,n.jsx)(us,{id:"move-task-stage-selection",allSelector:!1,selectedOptionValue:w,options:_,onSelectionChange:e=>{m(e),h(0)}}),(0,n.jsx)("label",{htmlFor:"move-task-order-selection",children:(0,o.__)("Select order","quicktasker")}),(0,n.jsx)(us,{id:"move-task-order-selection",allSelector:!1,selectedOptionValue:String(p),options:f,onSelectionChange:e=>h(Number(e))}),(0,n.jsx)(Js,{btnText:(0,o.__)("Apply","quicktasker"),loading:q,onClick:()=>{return e=this,s=void 0,n=function*(){if(!t)return;const e=l(t.id),s=d(t.id);e&&null!==s&&(v(!0),yield u(t.id,w,p,(t=>{t&&(i({type:k,payload:{source:{droppableId:e.id,index:s},destination:{droppableId:w,index:p}}}),g())})),v(!1))},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n}})]})})}const vo=(0,a.forwardRef)((({addPipeline:e,modalSaving:t},s)=>{const[i,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(""),d=()=>{r(""),l("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:d}))),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(aa,{children:[(0,n.jsx)(na,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(Ea,{isAutoFocus:!0,value:i,onChange:e=>r(e)})}),(0,n.jsx)(na,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Ca,{rowsCount:3,value:c,onChange:e=>l(e)})})]}),(0,n.jsx)(ia,{onSave:()=>{e(i,c)},loading:t,saveBtnText:(0,o.__)("Add board","quicktasker")})]})}));var xo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function fo(){return{deletePipeline:(e,t)=>xo(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e}`,method:"DELETE",headers:p()})}(e);t&&t(s.data.deletedPipelineId,s.data.pipelineIdToLoad)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete board","quicktasker"))}})),addPipeline:(e,t,s,a)=>xo(this,void 0,void 0,(function*(){try{const a=yield(n=e,r=t,u()({path:"/wpqt/v1/pipelines",method:"POST",data:{name:n,description:r},headers:p()}));i.oR.success((0,o.__)("Board created successfully","quicktasker")),s&&s(a.data)}catch(e){i.oR.error((0,o.__)("Failed to create a board","quicktasker")),a&&a(e)}var n,r})),editPipeline:(e,t,s)=>xo(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e.id}`,method:"PATCH",data:{name:e.name,description:e.description,is_primary:e.is_primary},headers:p()})}(e);i.oR.success((0,o.__)("Board updated successfully","quicktasker")),t&&t(s.data)}catch(e){i.oR.error((0,o.__)("Failed to update board","quicktasker")),s&&s(e)}}))}}function _o(){const{state:{newPipelineModalOpen:e}}=(0,a.useContext)(As),{fetchAndSetPipelineData:t}=(0,a.useContext)(xs),{modalSaving:s,setModalSaving:i,modalContentRef:o,closeModal:r,handleSuccess:c,handleError:l}=Ls(J),{addPipeline:d}=fo();return(0,n.jsx)(ta,{modalOpen:e,closeModal:r,children:(0,n.jsx)(vo,{ref:o,addPipeline:(e,s)=>{return a=this,n=void 0,u=function*(){i(!0),yield d(e,s,(e=>{c(E,e,Rs.PIPELINES),t(e.id),r()}),(e=>{l(e)}))},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{r(u.next(e))}catch(e){t(e)}}function i(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){var a;t.done?e(t.value):(a=t.value,a instanceof o?a:new o((function(e){e(a)}))).then(s,i)}r((u=u.apply(a,n||[])).next())}));var a,n,o,u},modalSaving:s,setModalSaving:i})})}const ko=(0,a.forwardRef)((({editPipeline:e,modalSaving:t},s)=>{const{state:{pipelineToEdit:r},modalDispatch:c}=(0,a.useContext)(As),{fetchAndSetPipelineData:l,dispatch:d}=(0,a.useContext)(xs),{pipelinesDispatch:u}=(0,a.useContext)(cs),{deletePipeline:p}=fo(),[h,w]=(0,a.useState)(""),[m,q]=(0,a.useState)(""),{loading1:v,setLoading1:x}=ha();(0,a.useEffect)((()=>{r&&(w(r.name),q(r.description||""))}),[r]);const f=()=>{w(""),q("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:f}))),r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsx)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:(0,n.jsxs)("div",{className:"wpqt-mb-5 wpqt-grid wpqt-grid-cols-1 wpqt-gap-4 md:wpqt-grid-cols-[auto_1fr]",children:[(0,n.jsxs)(aa,{children:[(0,n.jsx)(na,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(Ea,{isAutoFocus:!0,value:h,onChange:e=>w(e)})}),(0,n.jsx)(na,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Ca,{rowsCount:3,value:m,onChange:e=>q(e)})})]}),(0,n.jsx)(cn,{entityId:r.id,entityType:ya.Pipeline})]})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:(0,n.jsx)(Zs,{icon:(0,n.jsx)(ca.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:v,text:(0,o.__)("Delete board","quicktasker"),onClick:()=>{r&&(x(!0),p(r.id,((e,t)=>{c({type:J}),x(!1),i.oR.success((0,o.__)("Board deleted","quicktasker")),u({type:I,payload:e}),null!==t?(u({type:A,payload:t}),l(t)):d({type:P})})))}})})]}),(0,n.jsx)(ia,{onSave:()=>{r&&e(Object.assign(Object.assign({},r),{name:h,description:m}))},loading:t,saveBtnText:(0,o.__)("Save","quicktasker")})]}):null}));function go(){const{state:{pipelineModalOpen:e}}=(0,a.useContext)(As),{modalSaving:t,setModalSaving:s,modalContentRef:i,closeModal:o,handleSuccess:r,handleError:c}=Ls(J),{editPipeline:l}=fo();return(0,n.jsx)(ta,{modalOpen:e,closeModal:o,size:"xl",children:(0,n.jsx)(ko,{ref:i,editPipeline:e=>{return t=this,a=void 0,i=function*(){s(!0),yield l(e,(e=>{r(S,e,Rs.ACTIVE_PIPELINE)}),(e=>{c(e)}))},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i},modalSaving:t,setModalSaving:s})})}function jo({pipelineId:e}){const{state:{taskExportModalOpen:t,taskExportModalSettings:s},modalDispatch:i}=(0,a.useContext)(As),{state:{siteURL:r}}=(0,a.useContext)(qa),[c,l]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1);return(0,n.jsx)(ta,{modalOpen:t,closeModal:()=>{i({type:le})},size:"md",children:(0,n.jsxs)("form",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3 wpqt-items-center",action:r,target:"_blank",method:"GET",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Tasks export","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(vn,{labelFor:"export-search-filter",children:(0,o.__)("Filter by task name and desription","quicktasker")}),(0,n.jsx)(Ea,{value:c,onChange:l,inputId:"export-search-filter",name:"task_search",wrapperClassName:"wpqt-mb-0"})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center",children:[(0,n.jsx)(vn,{labelFor:"export-include-archive-filter",children:(0,o.__)("Include board archived tasks","quicktasker")}),(0,n.jsx)(Na,{checked:d,handleChange:u,id:"export-include-archive-filter"})]}),(0,n.jsx)(Js,{btnText:(0,o.__)("Open export","quicktasker"),type:Ks.SUBMIT}),e&&(0,n.jsx)("input",{type:"hidden",name:"pipeline_id",value:e}),(0,n.jsx)("input",{type:"hidden",name:"wpqt-page",value:`${s.selectedMethod}-export`}),(0,n.jsx)("input",{type:"hidden",name:"include_archive",value:d?"1":"0"})]})})}var yo=s(9919),bo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const To=(0,a.forwardRef)((({editStage:e,addStage:t,stageModalSaving:s},i)=>{const{state:{stageToEdit:r}}=(0,a.useContext)(As),[c,l]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),p=!!r;(0,a.useEffect)((()=>{r&&(l(r.name),u(r.description))}),[r]);const h=()=>{l(""),u("")};return(0,a.useImperativeHandle)(i,(()=>({clearContent:h}))),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(sa,{children:p?(0,o.__)("Edit Stage","quicktasker"):(0,o.__)("Add Stage","quicktasker")}),(0,n.jsxs)(aa,{children:[(0,n.jsx)(na,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(Ea,{isAutoFocus:!0,value:c,onChange:e=>l(e)})}),(0,n.jsx)(na,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Ca,{rowsCount:3,value:d,onChange:e=>u(e)})})]}),(0,n.jsx)(ia,{onSave:()=>{p?e(Object.assign(Object.assign({},r),{name:c,description:d})):t(c,d)},loading:s,saveBtnText:p?(0,o.__)("Save","quicktasker"):(0,o.__)("Add stage","quicktasker")})]})}));var Eo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function So(){const{state:{stageModalOpen:e,targetPipelineId:t}}=(0,a.useContext)(As),{modalSaving:s,setModalSaving:r,modalContentRef:c,closeModal:l,handleSuccess:d,handleError:h}=Ls(W),{editStage:w,addStage:m}=function(){return{editStage:(e,t,s)=>bo(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/stages/${e.id}`,method:"PATCH",data:{name:e.name,description:e.description},headers:p()})}(e);i.oR.success((0,o.__)("Stage updated successfully","quicktasker")),t&&t(s.data)}catch(e){i.oR.error((0,o.__)("Failed to update stage","quicktasker")),s&&s(e)}})),addStage:(e,t,s,a,n)=>bo(this,void 0,void 0,(function*(){try{const n=yield(r=e,c=t,l=s,u()({path:"/wpqt/v1/stages",method:"POST",data:{pipelineId:r,name:c,description:l},headers:p()}));i.oR.success((0,o.__)("Stage created successfully","quicktasker")),a&&a(n.data)}catch(e){i.oR.error((0,o.__)("Failed to create stage","quicktasker")),n&&n(e)}var r,c,l}))}}();return(0,n.jsx)(ta,{modalOpen:e,closeModal:l,children:(0,n.jsx)(To,{ref:c,editStage:e=>Eo(this,void 0,void 0,(function*(){r(!0),yield w(e,(e=>{d(T,e,Rs.ACTIVE_PIPELINE),l()}),(e=>{h(e)}))})),addStage:(e,s)=>Eo(this,void 0,void 0,(function*(){try{r(!0),yield m(t,e,s,(e=>{d(j,{stage:Object.assign(Object.assign({},e),{tasks:[]})},Rs.ACTIVE_PIPELINE),l()}))}catch(e){h(e)}})),stageModalSaving:s,stageTaskModalSaving:r})})}var Ao=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Co(){const{state:{taskColorModalOpen:e,taskToEdit:t},modalDispatch:s}=(0,a.useContext)(As),{dispatch:i}=(0,a.useContext)(xs),{updateTaskFocusColor:r}=ys(),[c,l]=(0,a.useState)(vt),[d,u]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{t&&t.task_focus_color&&l(t.task_focus_color)}),[t]),(0,n.jsx)(ta,{modalOpen:e,closeModal:()=>{s({type:re})},size:"sm",children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-4 wpqt-items-center",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:(0,o.__)("Task focus color","quicktasker")}),(0,n.jsx)(qn.A,{color:c||void 0,disableAlpha:!0,onChange:e=>{l(e.hex)}}),(0,n.jsx)(Js,{btnText:(0,o.__)("Apply changes","quicktasker"),onClick:()=>Ao(this,void 0,void 0,(function*(){if(!t)return;u(!0);const{success:e}=yield r(t.id,c);u(!1),e&&i({type:K,payload:{taskId:t.id,color:c}})})),loading:d}),(0,n.jsx)(Js,{buttonStyleType:$s.DANGER,btnText:(0,o.__)("Reset color","quicktasker"),onClick:()=>{l(vt)}})]})})}var Oo=s(1609);function No({pipelineId:e,stagesLength:t=0}){const{modalDispatch:s}=(0,a.useContext)(As),i=()=>{return t=this,a=void 0,i=function*(){s({type:H,payload:{targetPipelineId:e}})},new((n=void 0)||(n=Promise))((function(e,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(t,a||[])).next())}));var t,a,n,i};return 0===t?(0,n.jsx)("div",{className:"wpqt-pipeline-height wpqt-flex wpqt-w-full wpqt-items-center wpqt-justify-center",children:(0,n.jsxs)("div",{className:"wpqt-main-border wpqt-flex wpqt-cursor-pointer wpqt-flex-col wpqt-items-center wpqt-justify-start wpqt-gap-y-1 wpqt-p-3 hover:wpqt-bg-gray-100",onClick:i,children:[(0,n.jsx)(Ua.A,{className:"wpqt-size-6 wpqt-text-green-600"}),(0,n.jsx)("div",{className:"wpqt-whitespace-nowrap",children:(0,o.__)("Add first stage","quicktasker")})]})}):(0,n.jsxs)("div",{className:"wpqt-main-border wpqt-mb-3 wpqt-flex wpqt-cursor-pointer wpqt-flex-col wpqt-items-center wpqt-justify-start wpqt-self-start wpqt-p-3 hover:wpqt-bg-gray-100",onClick:i,children:[(0,n.jsx)(Ua.A,{className:"wpqt-size-6 wpqt-text-green-600"}),(0,n.jsx)("div",{className:"wpqt-whitespace-nowrap",children:(0,o.__)("Add stage","quicktasker")})]})}var Do=s(12),Io=s(5575),Po=s(6304),Ro=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Lo({stage:e}){var t,s,r,c;const{dispatch:l,state:{activePipeline:d},fetchAndSetPipelineData:h}=(0,a.useContext)(xs),{modalDispatch:w}=(0,a.useContext)(As),{state:{isUserAllowedToDelete:m}}=(0,a.useContext)(qa),[q,v]=(0,a.useState)(!1),[x,f]=(0,a.useState)(!1),[_,k]=(0,a.useState)(!1),g=null!==(s=null===(t=null==d?void 0:d.stages)||void 0===t?void 0:t.length)&&void 0!==s?s:0,j=null!==(c=null===(r=e.tasks)||void 0===r?void 0:r.length)&&void 0!==c?c:0,b=+e.stage_order,T=b>0&&b<g,E=b!==g-1,S=t=>Ro(this,void 0,void 0,(function*(){try{v(!0),yield function(e,t){return u()({path:`/wpqt/v1/stages/${e}/move`,method:"PATCH",data:{direction:t},headers:p()})}(e.id,t),yield h(d.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to move a stage","quicktasker"))}finally{v(!1)}}));return(0,n.jsxs)(pn,{menuBtn:({active:e})=>(0,n.jsx)(hn,{isActive:e,IconComponent:Do.A}),children:[T&&(0,n.jsx)(wn,{text:(0,o.__)("Move left","quicktasker"),loading:q,icon:(0,n.jsx)(Io.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:()=>S("left")}),E&&(0,n.jsx)(wn,{text:(0,o.__)("Move right","quicktasker"),loading:q,icon:(0,n.jsx)(Po.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:()=>S("right")}),(0,n.jsx)(wn,{text:(0,o.__)("Edit stage","quicktasker"),icon:(0,n.jsx)(kn.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:()=>{w({type:Q,payload:{stageToEdit:e}})}}),(0,n.jsx)(wn,{text:(0,o.__)("Archive all stage tasks","quicktasker"),icon:(0,n.jsx)(ra.A,{className:"wpqt-icon-blue wpqt-size-4"}),loading:x,onClick:()=>Ro(this,void 0,void 0,(function*(){try{f(!0),yield(t=e.id,u()({path:`/wpqt/v1/stages/${t}/archive-tasks`,method:"PATCH",headers:p()})),yield h(d.id),i.oR.success((0,o.sprintf)((0,o.__)("Archived all %s tasks","quicktasker"),e.name))}catch(t){console.error(t),i.oR.error((0,o.sprintf)((0,o.__)("Failed to archive stage %s tasks","quicktasker"),e.name))}finally{f(!1)}var t})),disabled:0===j,id:`item-dropdown-${e.id}-archive`,tooltipText:0===j?(0,o.__)("No tasks to archive on the stage","quicktasker"):void 0}),m&&(0,n.jsx)(wn,{text:(0,o.__)("Delete stage","quicktasker"),icon:(0,n.jsx)(ca.A,{className:"wpqt-icon-red wpqt-size-4"}),loading:_,onClick:()=>Ro(this,void 0,void 0,(function*(){try{k(!0),yield(t=e.id,u()({path:`/wpqt/v1/stages/${t}`,method:"DELETE",data:{stageId:t},headers:p()})),l({type:y,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete a stage","quicktasker"))}finally{k(!1)}var t})),disabled:j>0,className:"!wpqt-mb-0",id:`item-dropdown-${e.id}`,tooltipText:(0,o.__)("Stage can be deleted when there are no tasks on it","quicktasker")})]})}var Uo=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Mo({stageId:e}){const[t,s]=(0,a.useState)(""),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),h=(0,a.useRef)(null),w=(0,a.useRef)(null),{state:{activePipeline:m},dispatch:q}=(0,a.useContext)(xs),{handleExecutedAutomations:v}=gs();(0,a.useEffect)((()=>{const e=e=>{"Enter"===e.key&&document.activeElement===w.current&&x()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[t]),(0,a.useEffect)((()=>{const e=e=>{h.current&&!h.current.contains(e.target)&&f()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),(0,a.useEffect)((()=>{var e;r&&(null===(e=w.current)||void 0===e||e.focus())}),[r]);const x=()=>Uo(this,void 0,void 0,(function*(){if(t)try{d(!0);const s=yield function(e,t,s){return u()({path:"/wpqt/v1/tasks",method:"POST",data:{stageId:e,name:s,pipelineId:t},headers:p()})}(e,m.id,t);q({type:g,payload:s.data.newTask}),i.oR.success((0,o.__)("Task created","quicktasker")),f(),v(s.data.executedAutomations,s.data.newTask.id)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to create task","quicktasker"))}finally{d(!1)}else i.oR.error((0,o.__)("Task name is required","quicktasker"))})),f=()=>{c(!1),s("")};return(0,n.jsx)("div",{ref:h,className:"wpqt-sticky wpqt-bottom-0 wpqt-z-10 wpqt-order-1 wpqt-mt-2 wpqt-flex wpqt-justify-center wpqt-bg-gray-100 wpqt-py-2",children:r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-3",children:[(0,n.jsx)(Ea,{ref:w,value:t,onChange:e=>s(e),wrapperClassName:"!wpqt-mb-0",className:"!wpqt-mb-0"}),l?(0,n.jsx)(Zt,{width:"24",height:"24"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(La.A,{className:"wpqt-icon-red wpqt-size-6 wpqt-cursor-pointer",onClick:f}),(0,n.jsx)(Ua.A,{className:"wpqt-icon-green wpqt-size-6 wpqt-cursor-pointer",onClick:x})]})]}):(0,n.jsxs)("div",{onClick:()=>c(!0),className:"wpqt-main-border wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-justify-center wpqt-gap-2 wpqt-p-2 hover:wpqt-bg-white",children:[(0,o.__)("Add task","quicktasker"),(0,n.jsx)(Ua.A,{className:"wpqt-size-6 wpqt-text-green-600"})]})})}var Fo=s(7959),zo=s(1735),Ko=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function $o({task:e}){const{modalDispatch:t}=(0,a.useContext)(As),{state:{activePipeline:s},fetchAndSetPipelineData:i}=(0,a.useContext)(xs),{state:{isUserAllowedToDelete:r}}=(0,a.useContext)(qa),{deleteTask:c,archiveTask:l}=ys(),[d,u]=(0,a.useState)(!1);return(0,n.jsxs)(pn,{menuBtn:({active:e})=>(0,n.jsx)(hn,{isActive:e,IconComponent:Ai.A}),children:[(0,n.jsx)(wn,{text:(0,o.__)("Archive task","quicktasker"),icon:(0,n.jsx)(ra.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),l(e.id,(()=>{i(s.id)}))}}),(0,n.jsx)(wn,{text:(0,o.__)("Edit task","quicktasker"),icon:(0,n.jsx)(kn.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:V,payload:{taskToEdit:e}})}}),(0,n.jsx)(wn,{text:(0,o.__)("Color","quicktasker"),icon:(0,n.jsx)(Fo.A,{className:"wpqt-icon-orange wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:oe,payload:{task:e}})}}),(0,n.jsx)(wn,{text:(0,o.__)("Move task","quicktasker"),icon:(0,n.jsx)(zo.zhn,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:ne,payload:{task:e}})}}),r&&(0,n.jsx)(wn,{text:(0,o.__)("Delete task","quicktasker"),icon:(0,n.jsx)(ca.A,{className:"wpqt-icon-red wpqt-size-4"}),loading:d,onClick:t=>Ko(this,void 0,void 0,(function*(){t.stopPropagation(),u(!0),yield c(e.id,(()=>{i(s.id)})),u(!1)})),className:"!wpqt-mb-0"})]})}var Go=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Vo({task:e,allowToMarkTaskAsDone:t}){const{dispatch:s}=(0,a.useContext)(xs),{changeTaskDoneStatus:i}=ys(),[o,r]=(0,a.useState)(!1),c=e.is_done,l=t=>Go(this,void 0,void 0,(function*(){r(!0),yield i(e.id,t,(t=>{s({type:D,payload:{taskId:e.id,done:t}})})),r(!1)}));return t?o?(0,n.jsx)(ts,{ovalSize:"24"}):(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:c?(0,n.jsx)(la.A,{className:"wpqt-size-6 wpqt-icon-green",onClick:e=>{e.stopPropagation(),l(!1)}}):(0,n.jsx)(la.A,{className:"wpqt-size-6 wpqt-icon-gray",onClick:e=>{e.stopPropagation(),l(!0)}})}):null}function Bo({task:e,index:t,onLastStage:s}){const{modalDispatch:i}=(0,a.useContext)(As),{state:{activePipeline:r}}=(0,a.useContext)(xs),{convertToWPTimezone:c}=ga(),l=!(null==r?void 0:r.settings).allow_only_last_stage_task_done||s,d=()=>{i({type:V,payload:{taskToEdit:e,taskModalSettings:{allowToMarkTaskAsDone:l}}})},u=e.task_focus_color?{borderTopColor:e.task_focus_color,borderTopWidth:xt,borderTopStyle:ft}:{};return(0,n.jsx)(yo.sx,{draggableId:e.id,index:t,children:t=>(0,n.jsx)("div",Object.assign({ref:t.innerRef},t.draggableProps,t.dragHandleProps,{children:(0,n.jsxs)("div",{className:"wpqt-relative wpqt-mx-4 wpqt-mb-2 wpqt-flex !wpqt-cursor-pointer wpqt-flex-col wpqt-gap-1 wpqt-rounded wpqt-border wpqt-border-gray-200 wpqt-bg-white wpqt-p-3 wpqt-shadow hover:wpqt-shadow-md",style:u,onClick:d,children:[(0,n.jsx)("div",{className:"wpqt-absolute wpqt-right-[12px] wpqt-top-[12px]",children:(0,n.jsx)($o,{task:e})}),(0,n.jsx)("div",{className:"wpqt-text-base",children:e.name}),e.description&&(0,n.jsx)("div",{className:"wpqt-text-sm wpqt-italic",children:e.description}),(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(In,{task:e}),(0,n.jsx)(En,{task:e})]}),e.due_date&&(0,n.jsxs)("div",{className:"wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(yi.A,{className:"wpqt-size-5 wpqt-icon-blue"}),(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[(0,o.__)("Due date","quicktasker"),":"]}),c(e.due_date)]}),(0,n.jsx)(Vo,{task:e,allowToMarkTaskAsDone:l})]})}))},e.id)}function Ho({tasks:e}){const t=e.length;return(0,n.jsx)("span",{className:"wpqt-rounded-lg wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-px-1 wpqt-text-xs",children:t})}function Wo({stage:e,isLastStage:t}){return(0,n.jsxs)("div",{"data-stage-id":e.id,className:"wpqt-relative wpqt-mb-3 wpqt-flex wpqt-max-h-full wpqt-w-[360px] wpqt-flex-none wpqt-flex-col wpqt-overflow-hidden wpqt-rounded-md wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-bg-gray-100",children:[(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-flex wpqt-flex-wrap wpqt-items-center wpqt-gap-1 wpqt-px-4 wpqt-pt-3",children:[(0,n.jsxs)("div",{className:"wpqt-mr-auto wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-text-base wpqt-leading-none",children:[e.name," ",(0,n.jsx)(Ho,{tasks:e.tasks})]}),(0,n.jsx)(Lo,{stage:e}),e.description&&(0,n.jsx)("div",{className:"wpqt-w-full wpqt-flex-shrink-0 wpqt-flex-grow-0 wpqt-text-sm",children:e.description})]}),(0,n.jsx)(yo.gL,{droppableId:e.id,children:s=>{var a;return(0,n.jsxs)("div",{ref:s.innerRef,className:"wpqt-flex wpqt-h-full wpqt-flex-col wpqt-overflow-y-auto wpqt-overflow-x-hidden",children:[null===(a=e.tasks)||void 0===a?void 0:a.map(((e,s)=>(0,n.jsx)(Bo,{task:e,index:s,onLastStage:t},e.id))),s.placeholder,(0,n.jsx)(Mo,{stageId:e.id})]})}})]})}const Qo=()=>{var e,t;const{state:{activePipeline:s},dispatch:r,fetchAndSetPipelineData:c}=(0,a.useContext)(xs),{isTabVisible:l}=(()=>{const[e,t]=(0,Oo.useState)(!document.hidden);return(0,Oo.useEffect)((()=>{const e=()=>{t(!document.hidden)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),{isTabVisible:e}})(),{modalDispatch:d}=(0,a.useContext)(As);(0,a.useEffect)((()=>{const e=setInterval((()=>{s&&l&&c(s.id)}),3e4);return()=>clearInterval(e)}),[s,l]);const u=(e,t)=>{e.droppableId===t.droppableId?r({type:"REORDER_TASK",payload:{source:e,destination:t}}):r({type:k,payload:{source:e,destination:t}})},p=(0,a.useCallback)((e=>{return t=void 0,s=void 0,n=function*(){const{source:t,destination:s,draggableId:a}=e;if(s){u(t,s);try{yield h(a,s.droppableId,s.index)}catch(e){console.error(e),u(s,t),i.oR.error((0,o.__)("Failed to move a task","quicktasker"))}}},new((a=void 0)||(a=Promise))((function(e,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(t,s||[])).next())}));var t,s,a,n}),[s]);return s?(0,n.jsxs)("div",{className:"wpqt-pipeline-height wpqt-flex wpqt-gap-[24px] wpqt-overflow-x-auto wpqt-overflow-y-hidden",children:[(0,n.jsx)(yo.JY,{onDragEnd:p,children:null===(e=s.stages)||void 0===e?void 0:e.map(((e,t)=>{const a=t===s.stages.length-1;return(0,n.jsx)(Wo,{stage:e,isLastStage:a},e.id)}))}),(0,n.jsx)(No,{pipelineId:s.id,stagesLength:null===(t=s.stages)||void 0===t?void 0:t.length}),(0,n.jsx)(_i,{deleteTaskCallback:()=>{s&&c(s.id)}}),(0,n.jsx)(Co,{}),(0,n.jsx)(So,{})]}):(0,n.jsx)(Qi,{infoText:(0,o.__)("Create a new board","quicktasker"),infoDescription:(0,o.__)("No boards found. Start by creating your first board to organize and manage your tasks effectively.","quicktasker"),actionIcon:(0,n.jsx)(Ua.A,{className:"wpqt-icon-green wpqt-size-6 wpqt-cursor-pointer"}),infoActionClick:()=>{d({type:Y})}})};var Yo=s(8932),Xo=s(247),Jo=s(1203),Zo=s(2496),er=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function tr(){const{state:{activePipeline:e},fetchAndSetPipelineData:t}=(0,a.useContext)(xs),{state:{pipelines:s},pipelinesDispatch:r}=(0,a.useContext)(cs),{modalDispatch:c}=(0,a.useContext)(As),l=e=>er(this,void 0,void 0,(function*(){try{yield(t=e.id,u()({path:`/wpqt/v1/pipelines/${t}/set-primary`,method:"PATCH",headers:p()})),r({type:A,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to set primary board","quicktasker"))}var t}));return(0,n.jsxs)(pn,{menuBtnClasses:"wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1 wpqt-rounded-xl wpqt-border wpqt-border-solid wpqt-border-qtBorder wpqt-p-3",menuBtn:({active:t})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-leading-none",children:null==e?void 0:e.name}),(0,n.jsx)(Jo.A,{className:"wpqt-size-4 "+(t?"wpqt-text-qtBlueHover":"")})]}),children:[(0,n.jsx)("div",{className:"wpqt-mb-4 wpqt-text-center wpqt-font-bold",children:(0,o.__)("Change board","quicktasker")}),s.map((s=>{const a=s.is_primary,i=(null==e?void 0:e.id)===s.id;return(0,n.jsx)(un.Dr,{children:(0,n.jsxs)("div",{className:"wpqt-mb-3 wpqt-flex wpqt-gap-2",children:[(0,n.jsx)("div",{className:(0,Aa.$)("wpqt-cursor-pointer wpqt-text-center",{"wpqt-font-bold":i}),onClick:()=>t(s.id),children:s.name}),(0,n.jsx)("div",{className:"wpqt-ml-auto",children:a?(0,n.jsx)(Zo.A,{className:"wpqt-size-4 wpqt-cursor-pointer wpqt-text-blue-500"}):(0,n.jsx)(Xo.A,{className:"wpqt-size-4 wpqt-cursor-pointer wpqt-text-gray-400",onClick:e=>{e.stopPropagation(),l(s)}})})]})},s.id)})),(0,n.jsx)(un.Dr,{children:(0,n.jsx)("div",{className:"wpqt-mt-4 wpqt-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-2",children:(0,n.jsx)(Zs,{text:(0,o.__)("Add new board","quicktasker"),onClick:()=>er(this,void 0,void 0,(function*(){c({type:Y})})),icon:(0,n.jsx)(Ua.A,{className:"wpqt-size-6 wpqt-icon-green"}),className:"wpqt-bg-white hover:!wpqt-bg-gray-100"})})},"new-pipeline")]})}var sr=s(1578);function ar(){const{modalDispatch:e}=(0,a.useContext)(As);return(0,n.jsx)("div",{className:"wpqt-flex wpqt-mr-4",children:(0,n.jsx)("div",{className:"wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1.5 wpqt-text-gray-500 hover:wpqt-text-gray-700",children:(0,n.jsx)(sr.uNb,{className:"wpqt-size-5 wpqt-pdf-red","data-testid":"task-export-pdf-icon",onClick:()=>{var t;t=Es.PDF,e({type:ce,payload:{selectedMethod:t}})}})})})}function nr(){const{state:{activePipeline:e,loading:t},fetchAndSetPipelineData:s}=(0,a.useContext)(xs),{modalDispatch:i}=(0,a.useContext)(As);return e?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2 wpqt-py-5",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[(0,n.jsx)("div",{className:"wpqt-text-lg",children:e.name}),(0,n.jsx)(Do.A,{className:"wpqt-text-gray-400 wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{e&&i({type:X,payload:{pipelineToEdit:e}})}})]}),e.description&&(0,n.jsx)("div",{className:"wpqt-italic",children:e.description})]}),(0,n.jsxs)("div",{className:"wpqt-ml-auto wpqt-flex wpqt-items-center wpqt-gap-3",children:[(0,n.jsx)(ar,{}),(0,n.jsx)(ir,{}),t?(0,n.jsx)(Zt,{width:"24",height:"24"}):(0,n.jsx)(Kn.A,{className:"wpqt-size-6 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>s(e.id)}),(0,n.jsx)(tr,{})]})]}):null}function ir(){const{state:{view:e},dispatch:t}=(0,a.useContext)(xs);return(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-1 wpqt-items-center wpqt-cursor-pointer wpqt-text-blue-400 wpqt-text-base :hover:wpqt-text-blue-600",onClick:()=>{t({type:L,payload:e===qs.PIPELINE?qs.TASK:qs.PIPELINE})},children:e===qs.PIPELINE?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Yo.A,{className:"wpqt-size-5 wpqt-text-blue-400"}),(0,o.__)("Switch to Task view","quicktasker")]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ji.A,{className:"wpqt-size-5 wpqt-text-blue-400"}),(0,o.__)("Switch to Board view","quicktasker")]})})}function or(){const{modalDispatch:e}=(0,a.useContext)(As),{activePipelineTasks:t,activePipelineSettings:s,isTaskOnLastStage:i}=co(),{taskViewFilter:r}=(()=>{const{state:{stageIdFilter:e,userFilter:t}}=(0,a.useContext)(ho);return{taskViewFilter:s=>{var a,n;const i=!e||s.stage_id===e,o=!t.id||!t.type||t.type===jt.QUICKTASKER&&(null===(a=s.assigned_users)||void 0===a?void 0:a.some((e=>e.id===t.id)))||t.type===jt.WP_USER&&(null===(n=s.assigned_wp_users)||void 0===n?void 0:n.some((e=>e.id===t.id)));return i&&o}}})(),{convertToWPTimezone:c}=ga(),l=t.filter(r);return 0===l.length?(0,n.jsx)(ki,{text:(0,o.__)("No tasks","quictasker")}):(0,n.jsxs)("div",{className:"wpqt-card-grid",children:[l.map((t=>{const a=i(t.id),r=!s.allow_only_last_stage_task_done||a,l=t.task_focus_color?{borderTopColor:t.task_focus_color,borderTopWidth:xt,borderTopStyle:ft}:{};return(0,n.jsxs)(bi,{className:"wpqt-cursor-pointer",style:l,title:t.name,description:t.description,dropdown:(0,n.jsx)($o,{task:t}),onClick:()=>{e({type:V,payload:{taskToEdit:t,taskModalSettings:{allowToMarkTaskAsDone:r}}})},children:[(0,n.jsxs)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:[(0,n.jsx)(In,{task:t}),(0,n.jsx)(En,{task:t})]}),t.due_date&&(0,n.jsxs)("div",{className:"wpqt-mb-2 wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(yi.A,{className:"wpqt-size-5 wpqt-icon-blue"}),(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[(0,o.__)("Due date","quicktasker"),":"]}),c(t.due_date)]}),(0,n.jsx)(Vo,{task:t,allowToMarkTaskAsDone:r})]},t.id)})),(0,n.jsx)(_i,{}),(0,n.jsx)(Co,{})]})}const rr=()=>(0,n.jsx)(fs,{children:(0,n.jsx)(Xt,{children:(0,n.jsx)(cr,{})})}),cr=()=>{const{state:{view:e,activePipeline:t}}=(0,a.useContext)(xs),s=e===qs.PIPELINE;return(0,n.jsxs)(ss,{children:[(0,n.jsx)(nr,{}),s?(0,n.jsx)(Qo,{}):(0,n.jsxs)(wo,{children:[(0,n.jsx)(mo,{}),(0,n.jsx)(or,{})]}),(0,n.jsx)(_o,{}),(0,n.jsx)(go,{}),(0,n.jsx)(qo,{}),(0,n.jsx)(jo,{pipelineId:(null==t?void 0:t.id)||null})]})};var lr=s(6197),dr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ur(){return{saveCustomUserPageStyles:(e,t)=>dr(this,void 0,void 0,(function*(){try{const a=yield(s=e,u()({path:"/wpqt/v1/settings/user-page-custom-styles",method:"PATCH",data:{styles:s},headers:p()}));t&&t(a.data),i.oR.success((0,o.__)("Custom user page styles saved successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to save custom user page styles","quicktasker"))}var s})),saveTaskCompletionDoneSetting:(e,t,s)=>dr(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/pipelines/${e}/settings/task-completion-done-restriction`,method:"PATCH",data:{allow_task_completion_only_on_last_stage:t},headers:p()})}(e,t),s&&s(t)}catch(e){s&&s(!t),console.error(e),i.oR.error((0,o.__)("Failed to save setting","quicktasker"))}}))}}const pr=({children:e,title:t,description:s})=>(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-mb-5",children:[(0,n.jsx)("h3",{className:"wpqt-mb-1",children:t}),(0,n.jsx)("p",{children:s}),e]});const hr=()=>{const{state:{userPageCustomStyles:e},appDispatch:t}=(0,a.useContext)(qa),[s,i]=(0,a.useState)(""),[r,c]=(0,a.useState)(!1),{saveCustomUserPageStyles:l}=ur();return(0,a.useEffect)((()=>{i(e)}),[e]),(0,n.jsxs)(pr,{title:(0,o.__)("Custom style","quicktasker"),description:(0,o.__)("Add custom CSS rules for QuickTasker user page.","quicktasker"),children:[(0,n.jsx)(Ca,{value:s,onChange:i}),(0,n.jsx)(Zs,{text:(0,o.__)("Save","quicktasker"),loading:r,onClick:()=>{return e=void 0,a=void 0,i=function*(){c(!0),yield l(s,(e=>{t({type:Ce,payload:e})})),c(!1)},new((n=void 0)||(n=Promise))((function(t,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function r(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(e,a||[])).next())}));var e,a,n,i},icon:(0,n.jsx)(lr.RZ0,{className:"wpqt-icon-blue wpqt-size-4"})})]})},wr=(e,t)=>{var s,a;switch(t.type){case at:{const s=t.payload.automations;return Object.assign(Object.assign({},e),{automations:s})}case nt:{const s=t.payload;return Object.assign(Object.assign({},e),{loading:s})}case it:{const n=t.payload,i=null!==(a=null===(s=e.automations)||void 0===s?void 0:s.filter((e=>e.id!==n)))&&void 0!==a?a:null;return Object.assign(Object.assign({},e),{automations:i})}case rt:{const s=e.automations?e.automations.map((e=>e.id===t.payload.id?Object.assign(Object.assign({},e),{active:t.payload.active}):e)):null;return Object.assign(Object.assign({},e),{automations:s})}case ot:{const s=t.payload,a=e.automations?[...e.automations,s]:[s];return Object.assign(Object.assign({},e),{automations:a})}default:return e}},mr={[St.ARCHIVE_TASK]:(0,o.__)("Archive task","quicktasker"),[St.ASSIGN_USER]:(0,o.__)("Assign user","quickkasker"),[St.NEW_ENTITY_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[St.DELETED_ENTITY_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[St.TASK_ASSIGNED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[St.TASK_UNASSIGNED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[St.TASK_PUBLIC_COMMENT_ADDED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[St.TASK_PRIVATE_COMMENT_ADDED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[St.TASK_FILE_UPLOADED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[St.TASK_FILE_DELETED_EMAIL]:(0,o.__)("Send email notification","quicktasker"),[St.CREATE_TASK]:(0,o.__)("Create task","quicktasker"),[St.SEND_SLACK_MESSAGE]:(0,o.__)("Send Slack message","quicktasker")},qr={[Tt.Task]:(0,o.__)("Task","quicktasker"),[Tt.Stage]:(0,o.__)("Stage","quicktasker"),[Tt.PIPELINE]:(0,o.__)("Board","quicktasker"),[Tt.quicktasker]:"Quicktasker",[Tt.WOOCOMMERCE_ORDER]:(0,o.__)("WooCommerce Order","quicktasker")},vr={[yt.TASK_DONE]:(0,o.__)("Task marked as done","quicktasker"),[yt.Task_NOT_DONE]:(0,o.__)("Task marked as not done","quicktasker"),[yt.TASK_CREATED]:(0,o.__)("Task created","quicktasker"),[yt.TASK_DELETED]:(0,o.__)("Task deleted","quicktasker"),[yt.TASK_ASSIGNED]:(0,o.__)("Task assigned","quicktasker"),[yt.TASK_UNASSIGNED]:(0,o.__)("Task unassigned","quicktasker"),[yt.TASK_PUBLIC_COMMENT_ADDED]:(0,o.__)("Public comment added","quicktasker"),[yt.TASK_PRIVATE_COMMENT_ADDED]:(0,o.__)("Private comment added","quicktasker"),[yt.TASK_FILE_UPLOADED]:(0,o.__)("File attached","quicktasker"),[yt.TASK_FILE_DELETED]:(0,o.__)("Attached file deleted","quicktasker"),[bt.WOOCOMMERCE_ORDER_ADDED]:(0,o.__)("Order added","quicktasker")},xr=(bt.WOOCOMMERCE_ORDER_ADDED,(0,o.__)("Order added","quicktasker"),{[yt.TASK_DONE]:[{id:St.ARCHIVE_TASK},{id:St.SEND_SLACK_MESSAGE,requireMetaData:!0}],[yt.Task_NOT_DONE]:[{id:St.ARCHIVE_TASK}],[yt.TASK_CREATED]:[{id:St.ASSIGN_USER,requireAutomationTarget:!0,requireAutomationTargetType:!0},{id:St.NEW_ENTITY_EMAIL,requireMetaData:!0},{id:St.SEND_SLACK_MESSAGE,requireMetaData:!0}],[yt.TASK_DELETED]:[{id:St.DELETED_ENTITY_EMAIL,requireMetaData:!0},{id:St.SEND_SLACK_MESSAGE,requireMetaData:!0}],[yt.TASK_ASSIGNED]:[{id:St.TASK_ASSIGNED_EMAIL,requireMetaData:!0},{id:St.SEND_SLACK_MESSAGE,requireMetaData:!0}],[yt.TASK_UNASSIGNED]:[{id:St.TASK_UNASSIGNED_EMAIL,requireMetaData:!0},{id:St.SEND_SLACK_MESSAGE,requireMetaData:!0}],[yt.TASK_PUBLIC_COMMENT_ADDED]:[{id:St.TASK_PUBLIC_COMMENT_ADDED_EMAIL,requireMetaData:!0},{id:St.SEND_SLACK_MESSAGE,requireMetaData:!0}],[yt.TASK_PRIVATE_COMMENT_ADDED]:[{id:St.TASK_PRIVATE_COMMENT_ADDED_EMAIL,requireMetaData:!0},{id:St.SEND_SLACK_MESSAGE,requireMetaData:!0}],[yt.TASK_FILE_UPLOADED]:[{id:St.TASK_FILE_UPLOADED_EMAIL,requireMetaData:!0}],[yt.TASK_FILE_DELETED]:[{id:St.TASK_FILE_DELETED_EMAIL,requireMetaData:!0}]}),fr={[bt.WOOCOMMERCE_ORDER_ADDED]:[{id:St.CREATE_TASK}]},_r={[Tt.Task]:xr,[Tt.WOOCOMMERCE_ORDER]:fr};const kr={automations:null,loading:!0},gr=(0,a.createContext)({state:kr,pipelineAutomationsDispatch:()=>{}}),jr=({children:e,pipelineId:t})=>{const[s,o]=(0,a.useReducer)(wr,kr),r=()=>{return e=void 0,s=void 0,n=function*(){try{o({type:nt,payload:!0});const s=yield function(e){return u()({path:`/wpqt/v1/pipelines/${e}/automations`,method:"GET",headers:p()})}(t);o({type:at,payload:{automations:(e=s.data.automations,e.map((e=>Object.assign(Object.assign({},e),{active:"1"===e.active,verify_success:"1"===e.verify_success}))))}})}catch(e){console.error(e),i.oR.error("Failed to load board automations")}finally{o({type:nt,payload:!1})}var e},new((a=void 0)||(a=Promise))((function(t,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function r(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,r)}c((n=n.apply(e,s||[])).next())}));var e,s,a,n};return(0,a.useEffect)((()=>{r()}),[]),(0,n.jsx)(gr.Provider,{value:{state:s,pipelineAutomationsDispatch:o},children:e})};var yr=s(8046),br=s(1226),Tr=s(6973);const Er={automationTarget:null,automationTrigger:null,automationAction:null,automationActionTargetId:null,automationActionTargetType:null,metaData:null};function Sr(e,t){switch(t.type){case"SET_TARGET":return Object.assign(Object.assign({},e),{automationTarget:t.payload,automationTrigger:null,automationAction:null});case"SET_TRIGGER":return Object.assign(Object.assign({},e),{automationTrigger:t.payload,automationAction:null});case"SET_ACTION":return Object.assign(Object.assign({},e),{automationAction:t.payload});case"RESET":return Er;case lt:return Object.assign(Object.assign({},e),{automationActionTargetId:t.payload.automationActionTargetId,automationActionTargetType:t.payload.automationActionTargetType});case ct:return Object.assign(Object.assign({},e),{metaData:t.payload});case dt:return Er;case ut:return Object.assign(Object.assign({},Er),{automationTarget:e.automationTarget});case pt:return Object.assign(Object.assign({},Er),{automationTarget:e.automationTarget,automationTrigger:e.automationTrigger});default:return e}}function Ar({actionTargetId:e,actionTargetType:t}){if(null===e||null===t)return null;const{getUser:s}=lo();if(t===Et.QUICKTASKER||t===Et.WP_USER||null!==e){const a=Nt(t);if(a){const t=s(e,a);return(0,n.jsx)("div",{className:"wpqt-text-center",children:(null==t?void 0:t.name)||(0,o.__)("User not found","quicktasker")})}}return null}var Cr=s(7613);function Or({value:e,label:t,onClick:s=()=>{},className:a=""}){return(0,n.jsx)("div",{className:`wpqt-inline-flex wpqt-font-semibold wpqt-rounded-xl wpqt-px-4 wpqt-py-2 wpqt-border wpqt-border-solid wpqt-cursor-pointer wpqt-border-qtBorder ${a}`,onClick:()=>{s(e)},children:t})}function Nr({children:e,title:t}){return(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-font-semibold wpqt-text-base wpqt-mb-4 wpqt-text-center",children:t}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center wpqt-gap-3",children:e})]})}function Dr({automationDispatch:e,automation:t}){if(!t.automationTarget||!t.automationTrigger)return null;const s=t.automationTarget,a=t.automationTrigger,i=_r[s],r=i&&a in i?i[a]:[];return(0,n.jsx)(Nr,{title:(0,o.__)("Step 3. Select action","quicktasker"),children:r.map((t=>(0,n.jsx)(Or,{value:t.id,label:mr[t.id],onClick:()=>{e({type:"SET_ACTION",payload:t})}},t.id)))})}function Ir({quickTaskerUsers:e,wpUsers:t,assignUser:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-w-[320px] wpqt-flex-col",children:[(0,n.jsx)(On,{sectionTitle:(0,o.__)("Assign a quicktasker","quicktasker"),users:e,onItemSelect:s,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No quicktaskers available to assign","quicktasker")}),(0,n.jsx)(On,{sectionTitle:(0,o.__)("Assign a WordPress user","quicktasker"),users:t,onItemSelect:s,actionIconClasses:"wpqt-icon-green",noUsersText:(0,o.__)("No WordPress users with required permissions available to assign","quicktasker")})]})}function Pr({automationAction:e,onUserAdd:t=()=>{},quickTaskerUserTargets:s=[],wpUserTargets:a=[],menuBtnClasses:i=""}){const o=[...s,...a].length>0;return(0,n.jsx)(pn,{menuBtnClasses:`wpqt-inline-flex ${i}`,anchor:"bottom start",menuBtn:()=>(0,n.jsx)("div",{className:"wpqt-group wpqt-inline-flex wpqt-cursor-pointer wpqt-items-center wpqt-gap-1",children:(0,n.jsx)(Sn.A,{className:`wpqt-mr-1 wpqt-size-5 ${o?"wpqt-text-blue-400":"wpqt-text-gray-300"} group-hover:wpqt-text-blue-600`})}),children:e===St.ASSIGN_USER&&(0,n.jsx)(Ir,{quickTaskerUsers:s,wpUsers:a,assignUser:t})})}const Rr=[St.ASSIGN_USER];function Lr({automationDispatch:e,automation:t}){var s;const{state:{users:i,wpUsers:r}}=(0,a.useContext)(Is),c=null===(s=t.automationAction)||void 0===s?void 0:s.id,l=void 0!==c&&Rr.includes(c);return(0,n.jsx)(Nr,{title:(0,o.__)("Step 4. Select action target","quicktasker"),children:l&&(0,n.jsx)(Pr,{automationAction:c,quickTaskerUserTargets:i,wpUserTargets:r,onUserAdd:t=>{e({type:lt,payload:{automationActionTargetId:t.id,automationActionTargetType:t.user_type}})}})})}var Ur=s(4476);const Mr=Ur.z.string().email({message:"Invalid email address"});function Fr({setAutomationMeta:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(e=>{try{Mr.parse(e),r(!0)}catch(e){r(!1)}})(t)}),[t]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-justify-center wpqt-items-center",children:[(0,n.jsx)(Gn,{type:"info",children:(0,o.__)("Make sure your website is configured to send out emails","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("label",{htmlFor:"automation-meta-email-input",children:(0,o.__)("Email will be sent to","quicktasker")}),(0,n.jsx)(Ea,{inputId:"automation-meta-email-input",value:t,onChange:s,wrapperClassName:"!wpqt-mb-0"}),!i&&(0,n.jsx)("div",{className:"wpqt-text-red-500",children:(0,o.__)("Invalid email address","quicktasker")})]}),(0,n.jsx)(Js,{btnText:(0,o.__)("Set email","quicktasker"),onClick:()=>{i&&e(t)}})]})}const zr=Ur.z.string().url({message:"Invalid URL"}).refine((e=>e.startsWith("https://hooks.slack.com/services/")),{message:"Invalid Slack webhook URL"}),Kr=function({setAutomationMeta:e}){const[t,s]=(0,a.useState)(""),[i,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(e=>{try{zr.parse(e),r(!0)}catch(e){r(!1)}})(t)}),[t]),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-justify-center wpqt-items-center",children:[(0,n.jsxs)(Gn,{type:"info",children:[(0,o.__)("Make sure your have configured your Slack webhook URL.","quicktasker"),(0,n.jsx)("a",{href:"https://api.slack.com/messaging/webhooks",target:"_blank",rel:"noopener noreferrer",className:"wpqt-text-blue-500 hover:underline wpqt-ml-1",children:(0,o.__)("Read more about Slack webhooks.","quicktasker")})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("label",{htmlFor:"automation-meta-slack-webhook-input",children:(0,o.__)("Slack webhook URL","quicktasker")}),(0,n.jsx)(Ea,{inputId:"automation-meta-slack-webhook-input",value:t,onChange:s,wrapperClassName:"!wpqt-mb-0"}),!i&&(0,n.jsx)("div",{className:"wpqt-text-red-500",children:(0,o.__)("Invalid Slack webhook","quicktasker")})]}),(0,n.jsx)(Js,{btnText:(0,o.__)("Set webhook URL","quicktasker"),onClick:()=>{i&&e(t)}})]})};function $r({automationCreationState:e,automationDispatch:t}){var s;const a=null===(s=null==e?void 0:e.automationAction)||void 0===s?void 0:s.id,i=a===St.NEW_ENTITY_EMAIL||a===St.DELETED_ENTITY_EMAIL||a===St.TASK_ASSIGNED_EMAIL||a===St.TASK_UNASSIGNED_EMAIL||a===St.TASK_PUBLIC_COMMENT_ADDED_EMAIL||a===St.TASK_PRIVATE_COMMENT_ADDED_EMAIL||a===St.TASK_FILE_UPLOADED_EMAIL||a===St.TASK_FILE_DELETED_EMAIL,o=a===St.SEND_SLACK_MESSAGE,r=e=>{t({type:ct,payload:e})};return i?(0,n.jsx)(Fr,{setAutomationMeta:r}):o?(0,n.jsx)(Kr,{setAutomationMeta:r}):null}function Gr({automationDispatch:e}){const t=Object.keys(_r).map((e=>({value:e,label:qr[e]||e})));return(0,n.jsx)(Nr,{title:(0,o.__)("Step 1. Select a target","quicktasker"),children:t.map((({value:t,label:s})=>(0,n.jsx)(Or,{value:t,label:s,onClick:()=>{e({type:"SET_TARGET",payload:t})}},t)))})}function Vr({automationDispatch:e,automation:t}){if(!t.automationTarget)return null;const s=t.automationTarget,a=Object.keys(_r[s]).map((e=>({value:e,label:vr[e]||e})));return(0,n.jsx)(Nr,{title:(0,o.__)("Step 2. Select a trigger","quicktasker"),children:a.map((({value:t,label:s})=>(0,n.jsx)(Or,{value:t,label:s,onClick:()=>{e({type:"SET_TRIGGER",payload:t})}},t)))})}var Br=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Hr({automation:e,automationDispatch:t,createAutomation:s}){const[i,r]=(0,a.useState)(!1);return null===e.automationTarget?(0,n.jsx)(Gr,{automationDispatch:t}):null===e.automationTrigger?(0,n.jsx)(Vr,{automationDispatch:t,automation:e}):null===e.automationAction?(0,n.jsx)(Dr,{automationDispatch:t,automation:e}):e.automationAction&&e.automationAction.requireAutomationTarget&&e.automationAction.requireAutomationTargetType&&(null===e.automationActionTargetType||null===e.automationActionTargetId)?(0,n.jsx)(Lr,{automationDispatch:t,automation:e}):e.automationAction.requireMetaData&&!e.metaData?(0,n.jsx)($r,{automationCreationState:e,automationDispatch:t}):(0,n.jsx)(Zs,{text:(0,o.__)("Create automation","quicktasker"),icon:(0,n.jsx)(Cr.ltU,{className:"wpqt-size-6"}),onClick:()=>Br(this,void 0,void 0,(function*(){r(!0),yield s(),r(!1)})),loading:i})}var Wr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Qr({pipelineId:e}){const{pipelineAutomationsDispatch:t,state:{loading:s,automations:i}}=(0,a.useContext)(gr),[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useReducer)(Sr,Er),{createAutomation:u}=gs(),p=null!==l.automationActionTargetId&&null!==l.automationActionTargetType,h=null!==l.metaData,w=!qt&&i&&i.length>=1,m="wpqt-px-3 wpqt-min-w-[60px] wpqt-cursor-pointer",q="wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1",v=()=>{d({type:"RESET"})};return s?null:r?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-3",children:[(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-3 wpqt-p-4 wpqt-justify-center wpqt-items-center",children:[(0,n.jsx)(bi,{title:(0,o.__)("Target","quicktasker"),className:m,titleClassName:q,onClick:()=>{d({type:dt})},children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:l.automationTarget?qr[l.automationTarget]:(0,n.jsx)(Yr,{})})}),(0,n.jsx)(yr.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(bi,{title:(0,o.__)("Trigger","quicktasker"),className:m,titleClassName:q,onClick:()=>{d({type:ut})},children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:l.automationTrigger?vr[l.automationTrigger]:(0,n.jsx)(Yr,{})})}),(0,n.jsx)(yr.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(bi,{title:(0,o.__)("Action","quicktasker"),className:m,titleClassName:q,onClick:()=>{d({type:pt})},children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center wpqt-items-center",children:[l.automationAction?mr[l.automationAction.id]:(0,n.jsx)(Yr,{}),p&&(0,n.jsx)(Ar,{actionTargetId:l.automationActionTargetId,actionTargetType:l.automationActionTargetType}),h&&(0,n.jsx)("div",{children:l.metaData})]})})]}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Hr,{automation:l,automationDispatch:d,createAutomation:()=>Wr(this,void 0,void 0,(function*(){yield u(e,l,((e,s)=>{e&&s&&(v(),c(!1),t({type:ot,payload:s}))}))}))})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Zs,{icon:(0,n.jsx)(Tr.QK_,{className:"wpqt-size-5"}),text:(0,o.__)("Close automation creator","quicktasker"),onClick:()=>{c(!1),v()}})})]}):w?(0,n.jsx)(za,{description:(0,o.__)("Free version limit reached. Upgrade to premium to create more automations.","quicktasker")}):(0,n.jsx)("div",{children:(0,n.jsx)(Zs,{icon:(0,n.jsx)(Tr.QK_,{className:"wpqt-size-5"}),text:(0,o.__)("Create a new automation","quicktasker"),onClick:()=>c(!0)})})}function Yr(){return(0,n.jsx)(br.A,{className:"wpqt-size-7 wpqt-text-gray-300"})}var Xr=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Jr({automation:e,className:t="",titleClassName:s=""}){const{deleteAutomation:i,updateAutomationActiveStatus:r}=gs(),{pipelineAutomationsDispatch:c}=(0,a.useContext)(gr),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1);return(0,n.jsx)(bi,{title:(0,o.__)("Controls","quicktasker"),className:`${t} wpqt-ml-6`,titleClassName:s,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3 wpqt-justify-center",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-1 wpqt-justify-center wpqt-items-center wpqt-h-[40px]",children:u?(0,n.jsx)(ts,{ovalSize:"32"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"wpqt-font-semibold",children:(0,o.__)("Active","quicktasker")}),(0,n.jsx)(Na,{checked:e.active,handleChange:t=>Xr(this,void 0,void 0,(function*(){p(!0);const s=yield r(e.pipeline_id,e.id,t);p(!1),s.success&&c({type:rt,payload:{id:e.id,active:t}})}))})]})}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-gap-2",children:(0,n.jsx)(Zs,{loading:l,icon:(0,n.jsx)(ca.A,{className:"wpqt-icon-red wpqt-size-5"}),onClick:()=>Xr(this,void 0,void 0,(function*(){d(!0),yield i(e.pipeline_id,e.id,(t=>{t&&c({type:it,payload:e.id})})),d(!1)})),text:(0,o.__)("Delete","quicktasker")})})]})})}function Zr({automation:e}){const t="wpqt-px-3 wpqt-pt-1 wpqt-min-w-[60px] wpqt-cursor-default",s="wpqt-absolute wpqt-top-0 wpqt-left-[50%] wpqt-transform-center wpqt-bg-[#fff] wpqt-text-[1rem] wpqt-leading-none wpqt-font-semibold wpqt-p-1",a=null!==e.automation_action_target_id&&null!==e.automation_action_target_type,i=null!==e.metadata;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-3 wpqt-p-4 wpqt-items-center",children:[(0,n.jsx)(bi,{title:(0,o.__)("Target","quicktasker"),className:t,titleClassName:s,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:qr[e.target_type]})}),(0,n.jsx)(yr.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(bi,{title:(0,o.__)("Trigger","quicktasker"),className:t,titleClassName:s,children:(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:vr[e.automation_trigger]})}),(0,n.jsx)(yr.A,{className:"wpqt-icon-blue wpqt-size-6"}),(0,n.jsx)(bi,{title:(0,o.__)("Action","quicktasker"),className:t,titleClassName:s,children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-justify-center wpqt-items-center",children:[mr[e.automation_action],a&&(0,n.jsx)(Ar,{actionTargetId:e.automation_action_target_id,actionTargetType:e.automation_action_target_type}),i&&(0,n.jsx)("div",{children:e.metadata})]})}),(0,n.jsx)(Jr,{automation:e,className:`${t} wpqt-ml-6`,titleClassName:s})]})}function ec(){const{state:{automations:e,loading:t}}=(0,a.useContext)(gr),[s,i]=(0,a.useState)(!0);return t?(0,n.jsx)(ts,{ovalSize:"24"}):e&&0!==e.length?s?(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col",children:[(0,n.jsx)("div",{className:"wpqt-flex wpqt-flex-col wpqt-items-center wpqt-gap-3 wpqt-mb-3",children:e.map((e=>(0,n.jsx)(Zr,{automation:e},e.id)))}),(0,n.jsx)("div",{className:"wpqt-flex wpqt-justify-center",children:(0,n.jsx)(Zs,{icon:(0,n.jsx)(Tr.QK_,{className:"wpqt-size-5"}),text:(0,o.__)("Hide board automations","quicktasker"),onClick:()=>i(!1)})})]}):(0,n.jsx)("div",{children:(0,n.jsx)(Zs,{icon:(0,n.jsx)(Tr.QK_,{className:"wpqt-size-5"}),text:(0,o.__)("Show board automations","quicktasker"),onClick:()=>i(!0)})}):(0,n.jsx)(Gn,{type:"info",children:(0,o.__)("No automations created for this board","quicktasker")})}function tc({children:e}){const t=qt?(0,o.__)("Allows to automate various tasks","quicktasker"):(0,o.__)("Allows to automate various tasks. To create more than one automation, please upgrade to the premium version.","quicktasker");return(0,n.jsx)(pr,{title:(0,o.__)("Board automations","quicktasker"),description:t,children:e})}function sc({pipelineId:e}){return(0,n.jsx)(jr,{pipelineId:e,children:(0,n.jsxs)(tc,{children:[(0,n.jsx)("div",{className:"wpqt-mb-4",children:(0,n.jsx)(ec,{})}),(0,n.jsx)("div",{children:(0,n.jsx)(Qr,{pipelineId:e})})]})})}var ac=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function nc({allow_only_last_stage_task_done:e,pipelineId:t}){const[s,i]=(0,a.useState)(e),[r,c]=(0,a.useState)(!1),{saveTaskCompletionDoneSetting:l}=ur();return(0,n.jsx)(pr,{title:(0,o.__)("Restrict Task Completion","quicktasker"),description:(0,o.__)("Allow to mark task as done only on board last stage. By default, task can be marked as done on any stage. Will apply also to QuickTasker page","quicktasker"),children:(0,n.jsxs)("div",{className:"wpqt-flex wpqt-gap-2 wpqt-items-center",children:[(0,n.jsx)(Na,{checked:s,handleChange:e=>ac(this,void 0,void 0,(function*(){i(e),c(!0),yield l(t,e,(e=>{i(e)})),c(!1)}))}),r&&(0,n.jsx)(Zt,{width:"20",height:"20"})]})})}var ic=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function oc({pipeline:e}){const[t,s]=(0,a.useState)(!0),[i,o]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(()=>{ic(this,void 0,void 0,(function*(){try{s(!0);const a=yield(t=e.id,u()({path:`/wpqt/v1/pipelines/${t}/settings`,method:"GET",headers:p()}));o(ns(a.data.settings))}catch(e){console.error(e)}finally{s(!1)}var t}))})()}),[]),t?(0,n.jsx)(ts,{}):i?(0,n.jsxs)("div",{children:[(0,n.jsx)(nc,{pipelineId:e.id,allow_only_last_stage_task_done:i.allow_only_last_stage_task_done}),(0,n.jsx)(sc,{pipelineId:e.id})]}):null}function rc(){const{state:{pipelines:e}}=(0,a.useContext)(cs),t=e.map((e=>e.name)),s=e.map((e=>(0,n.jsx)(oc,{pipeline:e},e.id)));return(0,n.jsx)("div",{children:(0,n.jsx)(Rn,{tabs:t,tabsContent:s,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})})}const cc=()=>(0,n.jsxs)(ss,{children:[(0,n.jsx)(l,{description:(0,o.__)("Manage settings, preferences, and configurations.","quicktasker"),children:(0,o.__)("Settings","quicktasker")}),(0,n.jsx)(hr,{}),(0,n.jsx)(rc,{})]});var lc=s(1548),dc=s(1266),uc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function pc(){return{createUser:(e,t,s)=>uc(this,void 0,void 0,(function*(){try{const r=yield(a=e,n=t,u()({path:"/wpqt/v1/users",method:"POST",data:{name:a,description:n},headers:p()}));s&&s(r.data),i.oR.success((0,o.__)("User created successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("User creation failed. Please try again","quicktasker"))}var a,n})),editUser:(e,t)=>uc(this,void 0,void 0,(function*(){try{const s=yield function(e){return u()({path:`/wpqt/v1/users/${e.id}`,method:"PATCH",data:{user:e},headers:p()})}(e);t&&t(s.data),i.oR.success((0,o.__)("User edited successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("User edit failed. Please try again","quicktasker"))}})),changeUserStatus:(e,t,s)=>uc(this,void 0,void 0,(function*(){try{const a=yield function(e,t){return u()({path:`/wpqt/v1/users/${e}/status`,method:"PATCH",data:{status:t},headers:p()})}(e,t);s&&s(a.data),i.oR.success((0,o.__)("User status changed successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change user status. Please try again","quicktasker"))}})),deleteUser:(e,t)=>uc(this,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/users/${e}`,method:"DELETE",headers:p()})}(e),t&&t(e),i.oR.success((0,o.__)("User deleted successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete user. Please try again","quicktasker"))}})),resetUserPassword:(e,t)=>uc(this,void 0,void 0,(function*(){try{yield function(e){return u()({path:`/wpqt/v1/users/${e}/password-reset`,method:"PATCH",headers:p()})}(e),t&&t(e),i.oR.success((0,o.__)("User password reset successfully","quicktasker"))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to reset user password. Please try again","quicktasker"))}}))}}var hc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function wc({data:e,changeStatus:t,changeSetUpStatus:s,changePasswordStatus:i}){const{changeUserStatus:r,deleteUser:c,resetUserPassword:l}=pc(),{userDispatch:d}=(0,a.useContext)(Is),{loading1:u,setLoading1:p,loading2:h,setLoading2:w,loading3:m,setLoading3:q}=ha(),v=e.is_active,x=e.has_password;return(0,n.jsxs)("div",{className:"wpqt-mt-5 wpqt-flex wpqt-gap-2",children:[(0,n.jsx)(Zs,{icon:(0,n.jsx)(Yo.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("User tasks","quicktasker"),onClick:()=>{window.location.hash=`#/users/${e.id}/tasks`}}),!v&&(0,n.jsx)(Zs,{icon:(0,n.jsx)(lc.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Activate user","quicktasker"),loading:h,onClick:()=>hc(this,void 0,void 0,(function*(){w(!0),yield r(e.id,!0,(e=>{d({type:be,payload:Object.assign({},e)}),t(!0)})),w(!1)}))}),v&&(0,n.jsx)(Zs,{icon:(0,n.jsx)(lc.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Disable user","quicktasker"),loading:h,onClick:()=>hc(this,void 0,void 0,(function*(){w(!0),yield r(e.id,!1,(e=>{d({type:be,payload:Object.assign({},e)}),t(!1)})),w(!1)}))}),x&&(0,n.jsx)(Zs,{icon:(0,n.jsx)(dc.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:u,text:(0,o.__)("Reset password","quicktasker"),onClick:()=>hc(this,void 0,void 0,(function*(){p(!0),yield l(e.id,(()=>{s(!1),i(!1)})),p(!1)}))}),(0,n.jsx)(Zs,{icon:(0,n.jsx)(ca.A,{className:"wpqt-icon-red wpqt-size-5"}),loading:m,text:(0,o.__)("Delete user","quicktasker"),onClick:()=>hc(this,void 0,void 0,(function*(){q(!0),yield c(e.id,(e=>{d({type:Te,payload:e}),window.location.hash="#/users"})),q(!1)}))})]})}var mc=s(8624),qc=s(3997),vc=s(5028);function xc(){const{state:{siteURL:e,publicUserPageId:t}}=(0,a.useContext)(qa);return{userPage:e+`/wpqt?page=${t}&page_id=wpqt`}}function fc({data:e}){const{userPage:t}=xc(),{convertToWPTimezone:s}=ga(),a=e.is_active,i=t+"&code="+e.page_hash;return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)(_c,{label:(0,o.__)("Name","quicktasker"),value:e.name,icon:(0,n.jsx)(mc.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(_c,{label:(0,o.__)("Created at","quicktasker"),value:s(e.created_at),icon:(0,n.jsx)(qc.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(_c,{label:(0,o.__)("Assigned tasks count","quicktasker"),value:e.assigned_tasks_count,icon:(0,n.jsx)(Yo.A,{className:"wpqt-size-5 wpqt-icon-blue"})}),(0,n.jsx)(_c,{label:(0,o.__)("Setup completed","quicktasker"),value:e.setup_completed?(0,o.__)("Yes","quicktasker"):(0,o.__)("No","quicktasker"),icon:(0,n.jsx)(vc.A,{className:"wpqt-size-5 wpqt-text-yellow-600"})}),(0,n.jsx)(_c,{label:(0,o.__)("Is active","quicktasker"),value:a?(0,o.__)("Yes","quicktasker"):(0,o.__)("No","quicktasker"),icon:(0,n.jsx)(lc.A,{className:"wpqt-size-5 "+(a?"wpqt-icon-green":"wpqt-icon-red")})}),(0,n.jsx)(_c,{label:(0,o.__)("User Page","quicktasker"),value:(0,n.jsx)("a",{href:i,rel:"noreferrer",target:"_blank",children:i}),icon:(0,n.jsx)(Ci.A,{className:"wpqt-size-5 wpqt-icon-blue"})})]})}function _c({label:e,value:t,icon:s}){return(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-2",children:[s,(0,n.jsxs)("span",{className:"wpqt-font-semibold",children:[e,": "]}),(0,n.jsx)("span",{children:t})]})}var kc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function gc({userId:e}){const{loadingDispatch:t}=(0,a.useContext)(Kt),[s,r]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(()=>{kc(this,void 0,void 0,(function*(){try{t({type:Oe,payload:!0});const a=yield function(e){return u()({path:`/wpqt/v1/users/${e}/extended`,method:"GET",headers:p()})}(e);r((s=a.data,Object.assign(Object.assign({},s),{is_active:"1"===s.is_active})))}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to get user data. Please try again","quicktasker"))}finally{t({type:Oe,payload:!1})}var s}))})()}),[]),(0,n.jsx)(ss,{children:s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{description:(0,o.__)("User details","quicktasker"),children:s.name}),(0,n.jsx)(fc,{data:s}),(0,n.jsx)(wc,{data:s,changeStatus:e=>kc(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{is_active:e}):t))})),changeSetUpStatus:e=>kc(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{setup_completed:e}):t))})),changePasswordStatus:e=>kc(this,void 0,void 0,(function*(){r((t=>t?Object.assign(Object.assign({},t),{has_password:e}):t))}))})]})})}const jc=e=>Object.assign(Object.assign({},e),{is_active:"1"===e.is_active}),yc=(e,t)=>{var s;switch(t.type){case Ne:return Object.assign(Object.assign({},e),{sessionsSearchValue:null!==(s=t.payload)&&void 0!==s?s:""});case De:{const s=t.payload.map(jc);return Object.assign(Object.assign({},e),{userSessions:s})}case Ie:{const{sessionId:s,status:a}=t.payload;return Object.assign(Object.assign({},e),{userSessions:e.userSessions.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_active:a}):e))})}case Pe:{const s=t.payload;return Object.assign(Object.assign({},e),{userSessions:e.userSessions.filter((e=>e.id!==s))})}default:return e}};var bc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Tc={loading:!0,sessionsSearchValue:"",userSessions:[]},Ec=(0,a.createContext)({state:Tc,usersSessionDispatch:()=>{},loadUserSessions:()=>bc(void 0,void 0,void 0,(function*(){}))}),Sc=({children:e})=>{const[t,s]=(0,a.useReducer)(yc,Tc),{loadingDispatch:r}=(0,a.useContext)(Kt);(0,a.useEffect)((()=>{c()}),[]);const c=()=>bc(void 0,void 0,void 0,(function*(){try{r({type:Oe,payload:!0});const e=yield u()({path:"/wpqt/v1/users/sessions",method:"GET",headers:p()});s({type:De,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch user sessions","quicktasker"))}finally{r({type:Oe,payload:!1})}}));return(0,n.jsx)(Ec.Provider,{value:{state:t,usersSessionDispatch:s,loadUserSessions:c},children:e})};function Ac(){const{state:{sessionsSearchValue:e},usersSessionDispatch:t}=(0,a.useContext)(Ec);return(0,n.jsx)(hs,{title:(0,o.__)("Session filtering","quicktasker"),children:(0,n.jsx)(Ea,{value:e,onChange:e=>{t({type:Ne,payload:e})}})})}const Cc=()=>{const{state:{sessionsSearchValue:e}}=(0,a.useContext)(Ec);return{filterSessions:t=>t.user_name.toLowerCase().includes(e.toLowerCase())||t.user_description&&t.user_description.toLowerCase().includes(e.toLowerCase())}};var Oc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Nc({session:e}){const{usersSessionDispatch:t}=(0,a.useContext)(Ec),{state:{isUserAllowedToDelete:s}}=(0,a.useContext)(qa),{convertToWPTimezone:r}=ga(),c=e.is_active,l=s=>Oc(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/users/sessions/${e}/status`,method:"PATCH",data:{status:t},headers:p()})}(e.id,s),t({type:Ie,payload:{sessionId:e.id,status:s}})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to change session status","quicktasker"))}}));return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:e.user_name}),(0,n.jsx)("div",{className:"wpqt-italic",children:e.user_description})]}),(0,n.jsx)("div",{children:r(e.created_at_utc)}),(0,n.jsx)("div",{children:r(e.expires_at_utc)}),(0,n.jsx)("div",{className:c?"wpqt-text-qtTextGreen":"wpqt-text-qtTextRed",children:c?(0,o.__)("On","quicktasker"):(0,o.__)("Off","quicktasker")}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-items-center wpqt-gap-4",children:[c?(0,n.jsx)(lc.A,{className:"wpqt-icon-red wpqt-size-5 wpqt-cursor-pointer",onClick:()=>l(!1),title:(0,o.__)("Turn session off","quicktasker")}):(0,n.jsx)(lc.A,{className:"wpqt-icon-green wpqt-size-5 wpqt-cursor-pointer",onClick:()=>l(!0),title:(0,o.__)("Turn session on","quicktasker")}),s&&(0,n.jsx)(ca.A,{className:"wpqt-icon-red wpqt-size-5 wpqt-cursor-pointer",title:(0,o.__)("Delete session","quicktasker"),onClick:()=>Oc(this,void 0,void 0,(function*(){try{yield(s=e.id,u()({path:`/wpqt/v1/users/sessions/${s}`,method:"DELETE",headers:p()})),t({type:Pe,payload:e.id})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to delete session","quicktasker"))}var s}))})]})]})}function Dc(){const{state:{userSessions:e}}=(0,a.useContext)(Ec),{filterSessions:t}=Cc(),s=e.filter(t);return 0===s.length?(0,n.jsx)(ki,{text:(0,o.__)("No sessions found","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"wpqt-mb-4 wpqt-grid wpqt-grid-cols-5 wpqt-font-bold",children:[(0,n.jsx)("div",{children:(0,o.__)("Session owner","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Created at","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Expires at","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Status","quicktasker")}),(0,n.jsx)("div",{children:(0,o.__)("Actions","quicktasker")})]}),(0,n.jsx)("div",{className:"wpqt-grid wpqt-grid-cols-5 wpqt-items-center wpqt-gap-y-4",children:s.map((e=>(0,n.jsx)(Nc,{session:e},e.id)))})]})}function Ic(){return(0,n.jsx)(Sc,{children:(0,n.jsx)(ss,{children:(0,n.jsx)(Pc,{})})})}function Pc(){const{state:{userSessions:e}}=(0,a.useContext)(Ec);return e.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{children:(0,o.__)("Quicktasker sessions","quicktasker")}),(0,n.jsx)(Ac,{}),(0,n.jsx)(Dc,{})]}):(0,n.jsx)(Qi,{infoText:(0,o.__)("No sessions","quicktasker"),infoDescription:(0,o.__)("No QuickTasker sessions found","quicktasker")})}function Rc(){const{state:{usersSearchValue:e},userDispatch:t}=(0,a.useContext)(Is);return(0,n.jsx)(hs,{title:(0,o.__)("User filtering","quicktasker"),children:(0,n.jsx)(as.p,{type:"text",value:e,onChange:e=>{t({type:ye,payload:e.target.value})}})})}var Lc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Uc({userId:e}){return(0,n.jsx)(Bn,{typeId:e,fetchData:()=>Lc(this,void 0,void 0,(function*(){try{return(yield q(e,Rt.User)).data}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load log","quicktasker"))}})),renderItem:e=>(0,n.jsx)(Fn,{log:e}),noDataMessage:(0,o.__)("No logs available","quicktasker"),explanation:(0,o.__)("Logs can be seen only by WordPress users (with required permissions)","quicktasker")})}var Mc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Fc({userId:e}){return(0,n.jsx)(Bn,{typeId:e,fetchData:()=>Mc(this,void 0,void 0,(function*(){try{return(yield w(e,Rt.User,!0)).data.map(Zn)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load private comments","quicktasker"))}})),onAdd:t=>Mc(this,void 0,void 0,(function*(){try{const s=yield m(e,Rt.User,!0,t);return Zn(s.data.newComment)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to add private comment","quicktasker"))}})),renderItem:e=>(0,n.jsx)(Wn,{item:e}),noDataMessage:(0,o.__)("No comments available","quicktasker"),explanation:(0,o.__)("Comments that can be added and viewed only by WordPress users (with required permissions).","quicktasker"),enableAdd:!0})}var zc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Kc({userId:e}){const{addComment:t}=Jn();return(0,n.jsx)(Bn,{typeId:e,fetchData:()=>zc(this,void 0,void 0,(function*(){try{return(yield w(e,Rt.User,!1)).data.map(Zn)}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to load comments","quicktasker"))}})),onAdd:s=>zc(this,void 0,void 0,(function*(){const a=yield t(e,Rt.User,!1,s);if(a)return Zn(a)})),renderItem:e=>(0,n.jsx)(Wn,{item:e}),noDataMessage:(0,o.__)("No comments available","quicktasker"),explanation:(0,o.__)("Comments that can be added and viewed by WordPress users (with required permissions) and current QuickTasker user (in user page).","quicktasker"),enableAdd:!0})}function $c({user:e}){const t=[(0,o.__)("Private comments","quicktasker"),(0,o.__)("Public comments","quicktasker"),(0,o.__)("Logs","quicktasker")];return(0,n.jsx)(Rn,{tabs:t,tabsContent:[(0,n.jsx)(Fc,{userId:e.id},1),(0,n.jsx)(Kc,{userId:e.id},2),(0,n.jsx)(Uc,{userId:e.id},3)]})}var Gc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const Vc=(0,a.forwardRef)((function({modalSaving:e,editUser:t},s){const{state:{userToEdit:i},modalDispatch:r}=(0,a.useContext)(As),{state:{isUserAllowedToDelete:c}}=(0,a.useContext)(qa),[l,d]=(0,a.useState)(""),[u,p]=(0,a.useState)(""),[h,w]=(0,a.useState)(!1),[m,q]=(0,a.useState)(!1),{changeUserStatus:v,deleteUser:x,resetUserPassword:f}=pc(),{userDispatch:_}=(0,a.useContext)(Is),{loading1:k,setLoading1:g,loading2:j,setLoading2:y,loading3:b,setLoading3:T}=ha();(0,a.useEffect)((()=>{i&&(d(i.name),p(i.description),w(i.is_active),q(i.has_password))}),[i]);const E=()=>{d(""),p("")};return(0,a.useImperativeHandle)(s,(()=>({clearContent:E}))),i?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-7 md:wpqt-grid-cols-[1fr_auto]",children:[(0,n.jsxs)("div",{className:"wpqt-border-0 wpqt-border-r wpqt-border-solid wpqt-border-r-gray-300 md:wpqt-pr-3",children:[(0,n.jsxs)("div",{className:"wpqt-grid wpqt-grid-cols-1 wpqt-gap-3 md:wpqt-grid-cols-[auto_1fr]",children:[(0,n.jsx)("div",{children:(0,n.jsxs)(aa,{children:[(0,n.jsx)(na,{label:(0,o.__)("Name","quicktasker"),children:(0,n.jsx)(Ea,{isAutoFocus:!0,value:l,onChange:e=>d(e)})}),(0,n.jsx)(na,{label:(0,o.__)("Description","quicktasker"),children:(0,n.jsx)(Ca,{rowsCount:3,value:u,onChange:e=>p(e)})})]})}),(0,n.jsx)(cn,{entityId:i.id,entityType:ya.User})]}),(0,n.jsx)(ia,{onSave:()=>{i&&t(Object.assign(Object.assign({},i),{name:l,description:u}))},saveBtnText:e?(0,o.__)("Saving...","quicktasker"):(0,o.__)("Save","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-mt-7",children:(0,n.jsx)($c,{user:i})})]}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-flex-col wpqt-gap-2",children:[(0,n.jsx)(Zs,{icon:(0,n.jsx)(mc.A,{className:"wpqt-icon-blue wpqt-size-4"}),text:(0,o.__)("User details","quicktasker"),onClick:()=>{window.location.hash=`#/users/${i.id}`,r({type:Z})}}),(0,n.jsx)(Zs,{icon:(0,n.jsx)(Yo.A,{className:"wpqt-icon-blue wpqt-size-5"}),text:(0,o.__)("User tasks","quicktasker"),onClick:()=>{window.location.hash=`#/users/${i.id}/tasks`,r({type:Z})}}),m&&(0,n.jsx)(Zs,{icon:(0,n.jsx)(dc.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Reset password","quicktasker"),loading:k,onClick:()=>Gc(this,void 0,void 0,(function*(){g(!0),yield f(i.id,(()=>{_({type:Se,payload:i.id}),q(!1)})),g(!1)}))}),!h&&(0,n.jsx)(Zs,{icon:(0,n.jsx)(lc.A,{className:"wpqt-icon-green wpqt-size-5"}),text:(0,o.__)("Activate user","quicktasker"),loading:j,onClick:()=>Gc(this,void 0,void 0,(function*(){y(!0),yield v(i.id,!0,(e=>{_({type:be,payload:Object.assign({},e)}),w(!0)})),y(!1)}))}),h&&(0,n.jsx)(Zs,{icon:(0,n.jsx)(lc.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Disable user","quicktasker"),loading:j,onClick:()=>Gc(this,void 0,void 0,(function*(){y(!0),yield v(i.id,!1,(e=>{_({type:be,payload:Object.assign({},e)}),w(!1)})),y(!1)}))}),c&&(0,n.jsx)(Zs,{icon:(0,n.jsx)(ca.A,{className:"wpqt-icon-red wpqt-size-5"}),text:(0,o.__)("Delete user","quicktasker"),loading:b,onClick:()=>Gc(this,void 0,void 0,(function*(){T(!0),yield x(i.id,(e=>{_({type:Te,payload:e}),r({type:Z})})),T(!1)}))})]})]})}):null}));var Bc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Hc(){const{state:{userModalOpen:e}}=(0,a.useContext)(As),{modalSaving:t,setModalSaving:s,modalContentRef:i,closeModal:o,handleSuccess:r}=Ls(Z),{editUser:c}=pc();return(0,n.jsx)(ta,{modalOpen:e,closeModal:o,size:"xl",children:(0,n.jsx)(Vc,{ref:i,modalSaving:t,editUser:e=>Bc(this,void 0,void 0,(function*(){s(!0),yield c(e,(e=>{r(be,e,Rs.USER)})),s(!1)}))})})}function Wc(){const{state:{userSettingsModalOpen:e},modalDispatch:t}=(0,a.useContext)(As);return(0,n.jsx)(ta,{modalOpen:e,closeModal:()=>t({type:ae,payload:!1}),size:"lg",children:(0,n.jsx)("div",{children:(0,n.jsx)(cn,{entityId:"null",entityType:ya.Users})})})}var Qc=s(8316),Yc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function Xc(){const[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(""),[c,l]=(0,a.useState)(""),{userDispatch:d}=(0,a.useContext)(Is),{createUser:u}=pc(),p=()=>{r(""),l(""),t(!1)};return(0,n.jsx)("div",{className:"wpqt-mb-6",children:e?(0,n.jsxs)("div",{className:"wpqt-w-1/4",children:[(0,n.jsx)("label",{className:"wpqt-mb-2 wpqt-block wpqt-font-semibold",children:(0,o.__)("User name","quicktasker")}),(0,n.jsx)(Ea,{value:s,onChange:r,className:"wpqt-w-full"}),(0,n.jsx)("label",{className:"wpqt-mb-2 wpqt-block wpqt-font-semibold",children:(0,o.__)("User description","quicktasker")}),(0,n.jsx)(Ca,{value:c,onChange:l,className:"wpqt-w-full"}),(0,n.jsxs)("div",{className:"wpqt-flex wpqt-justify-end wpqt-gap-3",children:[(0,n.jsx)(Zs,{text:(0,o.__)("Cancel","quicktasker"),onClick:p,icon:(0,n.jsx)(Ws.A,{className:"wpqt-icon-red wpqt-size-5"})}),(0,n.jsx)(Zs,{text:(0,o.__)("Add","quicktasker"),onClick:()=>Yc(this,void 0,void 0,(function*(){s?yield u(s,c,(e=>{d({type:je,payload:e}),p()})):i.oR.error("User name is required")})),icon:(0,n.jsx)(Qc.A,{className:"wpqt-icon-green wpqt-size-5"})})]})]}):(0,n.jsx)(Zs,{text:(0,o.__)("Add QuickTasker","quicktasker"),onClick:()=>t(!0),icon:(0,n.jsx)(Qc.A,{className:"wpqt-icon-green wpqt-size-5"})})})}const Jc=()=>{const{state:{usersSearchValue:e}}=(0,a.useContext)(Is);return{filterUsers:t=>t.name.toLowerCase().includes(e.toLowerCase())||t.description&&t.description.toLowerCase().includes(e.toLowerCase())}};var Zc=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function el({user:e}){const{modalDispatch:t}=(0,a.useContext)(As),{userDispatch:s}=(0,a.useContext)(Is),{changeUserStatus:i,deleteUser:r,resetUserPassword:c}=pc(),[l,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(!1),[h,w]=(0,a.useState)(!1),m=e.is_active,q=t=>Zc(this,void 0,void 0,(function*(){w(!0),yield i(e.id,t,(()=>{s({type:Ee,payload:{userId:e.id,isActive:t}})})),w(!1)}));return(0,n.jsxs)(pn,{menuBtn:({active:e})=>(0,n.jsx)(hn,{isActive:e,IconComponent:Ai.A}),children:[(0,n.jsx)(wn,{text:(0,o.__)("User details","quicktasker"),icon:(0,n.jsx)(mc.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}`}}),(0,n.jsx)(wn,{text:(0,o.__)("User tasks","quicktasker"),icon:(0,n.jsx)(Yo.A,{className:"wpqt-icon-blue wpqt-size-4"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}/tasks`}}),(0,n.jsx)(wn,{text:(0,o.__)("Edit user","quicktasker"),icon:(0,n.jsx)(kn.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:s=>{s.stopPropagation(),t({type:ee,payload:e})}}),e.has_password&&(0,n.jsx)(wn,{text:(0,o.__)("Reset password","quicktasker"),loading:l,icon:(0,n.jsx)(dc.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>Zc(this,void 0,void 0,(function*(){t.stopPropagation(),d(!0),yield c(e.id,(()=>{s({type:Se,payload:e.id})})),d(!1)}))}),m&&(0,n.jsx)(wn,{text:(0,o.__)("Disable user","quicktasker"),loading:h,icon:(0,n.jsx)(lc.A,{className:"wpqt-icon-red wpqt-size-4"}),className:"!wpqt-mb-0",onClick:e=>{e.stopPropagation(),q(!1)}}),!m&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(wn,{text:(0,o.__)("Activate user","quicktasker"),loading:h,icon:(0,n.jsx)(lc.A,{className:"wpqt-icon-green wpqt-size-4"}),onClick:e=>{e.stopPropagation(),q(!0)}}),(0,n.jsx)(wn,{text:(0,o.__)("Delete user","quicktasker"),loading:u,icon:(0,n.jsx)(ca.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:t=>Zc(this,void 0,void 0,(function*(){t.stopPropagation(),p(!0),yield r(e.id,(e=>{s({type:Te,payload:e})})),p(!1)}))})]})]})}function tl({user:e}){const{userPage:t}=xc(),{modalDispatch:s}=(0,a.useContext)(As),i=e.is_active,r=t+"&code="+e.page_hash;return(0,n.jsxs)(bi,{title:e.name,description:e.description,dropdown:(0,n.jsx)(el,{user:e}),onClick:()=>{s({type:ee,payload:e})},className:"wpqt-cursor-pointer",children:[(0,n.jsx)(Si,{className:"hover:wpqt-underline wpqt-self-start",label:(0,o.__)("Open user page","quicktasker"),icon:(0,n.jsx)(Ci.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:e=>{e.stopPropagation(),window.open(r,"_blank")}}),(0,n.jsx)(Si,{className:"hover:wpqt-underline wpqt-self-start",label:(0,o.__)("View user details","quicktasker"),icon:(0,n.jsx)(Ci.A,{className:"wpqt-size-5 wpqt-icon-blue"}),onClick:t=>{t.stopPropagation(),window.location.hash=`#/users/${e.id}`}}),(0,n.jsx)(Si,{label:(0,o.__)("Status","quicktasker"),value:i?(0,o.__)("Active","quicktasker"):(0,o.__)("Disabled","quicktasker"),valueClassName:i?"wpqt-text-qtTextGreen wpqt-font-bold":"wpqt-text-qtTextRed wpqt-font-bold",icon:(0,n.jsx)(lc.A,{className:"wpqt-size-5 "+(i?"wpqt-icon-green":"wpqt-icon-red")})})]})}function sl(){const{state:{users:e}}=(0,a.useContext)(Is),{filterUsers:t}=Jc(),s=e.filter(t);return e&&0===e.length?(0,n.jsx)(ki,{text:(0,o.__)("No users found","quicktasker")}):s&&0===s.length?(0,n.jsx)(ki,{}):(0,n.jsx)("div",{className:"wpqt-card-grid",children:s.map((e=>(0,n.jsx)(tl,{user:e},e.id)))})}function al(){return(0,n.jsxs)("div",{children:[(0,n.jsx)(Xc,{}),(0,n.jsx)(Rc,{}),(0,n.jsx)(sl,{}),(0,n.jsx)(Wc,{}),(0,n.jsx)(Hc,{})]})}var nl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};var il=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function ol({user:e}){const[t,s]=(0,a.useState)({quicktasker_admin_role:"quicktasker_admin_role"in e.allcaps,quicktasker_admin_role_allow_delete:"quicktasker_admin_role_allow_delete"in e.allcaps,quicktasker_admin_role_manage_users:"quicktasker_admin_role_manage_users"in e.allcaps,quicktasker_admin_role_manage_settings:"quicktasker_admin_role_manage_settings"in e.allcaps}),[i,r]=(0,a.useState)(!1),{updateWPUserCapabilities:c}=function(){return{updateWPUserCapabilities:(e,t,s,a)=>nl(this,void 0,void 0,(function*(){try{yield function(e,t){return u()({path:`/wpqt/v1/wp-users/${e}/capabilities`,method:"PATCH",data:{quicktasker_admin_role:t.quicktasker_admin_role,quicktasker_admin_role_allow_delete:t.quicktasker_admin_role_allow_delete,quicktasker_admin_role_manage_users:t.quicktasker_admin_role_manage_users,quicktasker_admin_role_manage_settings:t.quicktasker_admin_role_manage_settings},headers:p()})}(e,t),s&&s()}catch(e){a&&a(e)}}))}}(),l=(a,n)=>il(this,void 0,void 0,(function*(){if(i)return;r(!0);const o=Object.assign({},t),l=Object.assign(Object.assign({},t),{[n]:a});s(l),yield c(e.id,l,(()=>{}),(()=>{s(o)})),r(!1)}));return(0,n.jsxs)(bi,{title:e.name,description:e.description,children:[(0,n.jsx)(Si,{label:(0,o.__)("Role","quicktasker"),value:Array.isArray(e.roles)?e.roles.join(", "):""}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to admin areas","quicktasker")}),(0,n.jsx)(Na,{checked:t.quicktasker_admin_role,handleChange:e=>{l(e,"quicktasker_admin_role")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to users page","quicktasker")}),(0,n.jsx)(Na,{checked:t.quicktasker_admin_role_manage_users,handleChange:e=>{l(e,"quicktasker_admin_role_manage_users")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Access to settings page","quicktasker")}),(0,n.jsx)(Na,{checked:t.quicktasker_admin_role_manage_settings,handleChange:e=>{l(e,"quicktasker_admin_role_manage_settings")}})]}),(0,n.jsxs)("div",{className:"wpqt-mb-2",children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Allow to delete resources","quicktasker")}),(0,n.jsx)(Na,{checked:t.quicktasker_admin_role_allow_delete,handleChange:e=>{l(e,"quicktasker_admin_role_allow_delete")}})]}),i&&(0,n.jsx)(ts,{ovalSize:"24"})]})}var rl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function cl(){const[e,t]=(0,a.useState)(null),[s,i]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{(()=>{rl(this,void 0,void 0,(function*(){try{i(!0);const s=yield(e=Mt.Other,u()({path:`/wpqt/v1/wp-users?type=${encodeURIComponent(e)}`,method:"GET",headers:p()}));t(s.data)}catch(e){console.error(e)}finally{i(!1)}var e}))})()}),[]),s||null===e?(0,n.jsx)(ts,{ovalSize:"48"}):0===e.length?(0,n.jsx)(ki,{text:(0,o.__)("No non-admin WordPress users found","quicktasker")}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"wpqt-mb-2",children:(0,o.__)("Displaying non-admin WordPress users.","quicktasker")}),(0,n.jsx)("div",{className:"wpqt-card-grid",children:e.map((e=>(0,n.jsx)(ol,{user:e},e.id)))})]})}function ll(){const{updateUsers:e}=(0,a.useContext)(Is),{loadingDispatch:t}=(0,a.useContext)(Kt),{modalDispatch:s}=(0,a.useContext)(As),i=[(0,n.jsx)(al,{},0),(0,n.jsx)(cl,{},1)];return(0,a.useEffect)((()=>{(()=>{var s,a,n,i;s=this,a=void 0,i=function*(){t({type:Oe,payload:!0}),yield e(),t({type:Oe,payload:!1})},new((n=void 0)||(n=Promise))((function(e,t){function o(e){try{c(i.next(e))}catch(e){t(e)}}function r(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,r)}c((i=i.apply(s,a||[])).next())}))})()}),[]),(0,n.jsxs)(ss,{children:[(0,n.jsx)(l,{description:(0,o.__)("Manage QuickTaskers and WordPress users. This plugin supports three types of users: WordPress admins, other WordPress users, and QuickTaskers. WordPress admins have full access to all admin areas. Other WordPress users do not have any access by default but can be granted if needed. QuickTaskers are separate users who do not have admin access but can manage tasks through a mobile-friendly webpage.","quicktasker"),icon:(0,n.jsx)(Do.A,{className:"wpqt-icon-gray wpqt-size-7 wpqt-cursor-pointer hover:wpqt-text-qtBlueHover",onClick:()=>{s({type:ae,payload:!0})}}),children:(0,o.__)("Users","quicktasker")}),(0,n.jsx)(Rn,{tabs:["QuickTaskers","WordPress users"],tabsContent:i,tabListClassName:"wpqt-gap-5",tabClassName:"wpqt-flex-none"})]})}const dl=(e,t)=>{switch(t.type){case Re:{const s=t.payload.map(It);return Object.assign(Object.assign({},e),{tasks:s})}case Ue:{const s=t.payload;return Object.assign(Object.assign({},e),{tasks:e.tasks.filter((e=>e.id!==s))})}case Me:{const s=t.payload,a=e.tasks.map((e=>e.id===s.id?It(s):e));return Object.assign(Object.assign({},e),{tasks:a})}case Le:{const s=t.payload;return Object.assign(Object.assign({},e),{searchValue:s})}case Fe:{const s=t.payload;return Object.assign(Object.assign({},e),{filteredPipelineId:s})}case ze:{const{taskId:s,user:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:At(a)?[a,...e.assigned_users]:e.assigned_users,assigned_wp_users:Ct(a)?[a,...e.assigned_wp_users]:e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{tasks:n})}case Ke:{const{taskId:s,user:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{assigned_users:At(a)?e.assigned_users.filter((e=>e.id!==a.id)):e.assigned_users,assigned_wp_users:Ct(a)?e.assigned_wp_users.filter((e=>e.id!==a.id)):e.assigned_wp_users}):e));return Object.assign(Object.assign({},e),{tasks:n})}case $e:{const{taskId:s,done:a}=t.payload,n=e.tasks.map((e=>e.id===s?Object.assign(Object.assign({},e),{is_done:a}):e));return Object.assign(Object.assign({},e),{tasks:n})}default:return e}};var ul=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};const pl={tasks:[],searchValue:"",filteredPipelineId:""},hl=(0,a.createContext)({state:pl,userTasksDispatch:()=>{},fetchAndSetUserTasks:()=>ul(void 0,void 0,void 0,(function*(){}))}),wl=({children:e,userId:t})=>{const[s,r]=(0,a.useReducer)(dl,pl),{loadingDispatch:c}=(0,a.useContext)(Kt);(0,a.useEffect)((()=>{l()}),[]);const l=()=>ul(void 0,void 0,void 0,(function*(){try{c({type:Oe,payload:!0});const e=yield function(e){return u()({path:`/wpqt/v1/users/${e}/tasks`,method:"GET",headers:p()})}(t);r({type:Re,payload:e.data})}catch(e){console.error(e),i.oR.error((0,o.__)("Failed to fetch user tasks","quicktasker"))}finally{c({type:Oe,payload:!1})}}));return(0,n.jsx)(hl.Provider,{value:{state:s,userTasksDispatch:r,fetchAndSetUserTasks:l},children:e})};function ml(){const{state:{searchValue:e,filteredPipelineId:t},userTasksDispatch:s}=(0,a.useContext)(hl);return(0,n.jsxs)(hs,{title:(0,o.__)("Filter tasks","quicktasker"),children:[(0,n.jsx)(Ea,{value:e,onChange:e=>{s({type:Le,payload:e})},className:"!wpqt-mb-0"}),(0,n.jsx)(ps,{selectedOptionValue:t,selectionChange:e=>{s({type:Fe,payload:e})}})]})}var ql=s(7028),vl=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function xl({taskId:e,onUnAssignTask:t}){const[s,i]=(0,a.useState)(!1);return(0,n.jsx)(pn,{menuBtn:({active:e})=>(0,n.jsx)(hn,{isActive:e,IconComponent:Ai.A}),children:(0,n.jsx)(wn,{text:(0,o.__)("Unassign from task","quicktasker"),loading:s,icon:(0,n.jsx)(ql.A,{className:"wpqt-icon-red wpqt-size-4"}),onClick:s=>vl(this,void 0,void 0,(function*(){s.stopPropagation(),i(!0),yield t(e),i(!1)})),className:"!wpqt-mb-0"})})}const fl=()=>{const{state:{searchValue:e,filteredPipelineId:t}}=(0,a.useContext)(hl);return{filterTasks:s=>{const a=s.name&&s.name.toLowerCase().includes(e.toLowerCase())||s.description&&s.description.toLowerCase().includes(e.toLowerCase()),n=!t||s.pipeline_id===t;return a&&n}}};var _l=function(e,t,s,a){return new(s||(s=Promise))((function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}c((a=a.apply(e,t||[])).next())}))};function kl({userId:e}){var t;const{filterTasks:s}=fl(),{modalDispatch:i}=(0,a.useContext)(As),{state:{tasks:r},userTasksDispatch:c}=(0,a.useContext)(hl),{removeTaskFromUser:l}=ys(),d=null!==(t=null==r?void 0:r.filter(s))&&void 0!==t?t:[],u=t=>_l(this,void 0,void 0,(function*(){yield l(e,t,(()=>{c({type:Ue,payload:t})}))}));return r&&0===r.length?(0,n.jsx)(ki,{text:(0,o.__)("User has no tasks","quicktasker")}):d&&0===d.length?(0,n.jsx)(ki,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"wpqt-card-grid",children:d.map((e=>(0,n.jsxs)(bi,{className:"wpqt-cursor-pointer",title:e.name,description:e.description,dropdown:(0,n.jsx)(xl,{taskId:e.id,onUnAssignTask:u}),onClick:()=>{i({type:V,payload:{taskToEdit:e}})},children:[(0,n.jsx)("div",{className:"wpqt-mt-2 wpqt-mb-2 wpqt-flex wpqt-flex-col wpqt-gap-2 wpqt-items-start",children:(0,n.jsx)(In,{task:e,onUserAdd:t=>{c({type:ze,payload:{taskId:e.id,user:t}})},onUserDelete:t=>{c({type:Ke,payload:{taskId:e.id,user:t}})}})}),(0,n.jsx)(Ei,{task:e,onDoneStatusChange:(e,t)=>{c({type:$e,payload:{taskId:e,done:t}})}})]},e.id)))}),(0,n.jsx)(_i,{editTaskCallback:e=>{c({type:Me,payload:e})}})]})}function gl({userId:e}){return(0,n.jsx)(wl,{userId:e,children:(0,n.jsxs)(ss,{children:[(0,n.jsx)(l,{description:(0,o.__)("Tasks assigned to user","quicktasker"),children:(0,o.__)("User tasks","quicktasker")}),(0,n.jsx)(ml,{}),(0,n.jsx)(kl,{userId:e})]})})}const jl=()=>{const{page:e,hash:t}=yl();if("wp-quick-tasks"===e){const e=t.match(/^#\/users\/(\d+)\/tasks$/);if(e){const t=e[1];return(0,n.jsx)(gl,{userId:t})}const s=t.match(/^#\/users\/(\d+)$/);if(s){const e=s[1];return(0,n.jsx)(gc,{userId:e})}switch(t){case"#/users":return(0,n.jsx)(ll,{});case"#/overview":return(0,n.jsx)(ro,{});case"#/archive":return(0,n.jsx)(Ri,{});case"#/user-sessions":return(0,n.jsx)(Ic,{});case"#/logs":return(0,n.jsx)(Wi,{});case"#/settings":return(0,n.jsx)(cc,{});case"#/guide":return(0,n.jsx)(Li,{});default:return(0,n.jsx)(rr,{})}}},yl=()=>({page:new URLSearchParams(window.location.search).get("page"),hash:window.location.hash}),bl=function(){const e=(()=>{const[e,t]=(0,a.useState)(jl());return(0,a.useEffect)((()=>{const e=()=>{t(jl()),(()=>{const{page:e,hash:t}=yl();if("wp-quick-tasks"!==e)return;const s=document.querySelectorAll("#toplevel_page_wp-quick-tasks .wp-submenu li");s.forEach((e=>e.classList.remove("wpqt-current")));const a={"#/users":"#/users","#/overview":"#/overview","#/archive":"#/archive","#/user-sessions":"#/user-sessions","#/logs":"#/logs","#/settings":"#/settings","#/guide":"#/guide",default:""};let n=a.default;void 0!==a[t]?n=a[t]:/^#\/users(\/\d+)?(\/tasks)?$/.test(t)&&(n="#/users"),s.forEach((e=>{const t=e.querySelector("a");t&&t.getAttribute("href")&&t.getAttribute("href")===`admin.php?page=wp-quick-tasks${n}`&&e.classList.add("wpqt-current")}))})()};return e(),window.addEventListener("popstate",e),window.addEventListener("hashchange",e),()=>{window.removeEventListener("popstate",e),window.removeEventListener("hashchange",e)}}),[]),e})();return(0,n.jsx)(c,{children:(0,n.jsx)(va,{children:(0,n.jsx)(Ps,{children:(0,n.jsx)(Cs,{children:(0,n.jsx)(ls,{children:(0,n.jsxs)($t,{children:[e,(0,n.jsx)(i.N9,{position:"bottom-right",className:"wpqt-z-[999999]"})]})})})})})})};(0,a.render)((0,n.jsx)(bl,{}),document.getElementById("wpqt-app"))},1609:e=>{e.exports=window.React},5795:e=>{e.exports=window.ReactDOM},790:e=>{e.exports=window.ReactJSXRuntime}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return a[e].call(s.exports,s,s.exports,i),s.exports}i.m=a,e=[],i.O=(t,s,a,n)=>{if(!s){var o=1/0;for(d=0;d<e.length;d++){for(var[s,a,n]=e[d],r=!0,c=0;c<s.length;c++)(!1&n||o>=n)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(r=!1,n<o&&(o=n));if(r){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,a,n]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},s=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var n=Object.create(null);i.r(n);var o={};t=t||[null,s({}),s([]),s(s)];for(var r=2&a&&e;"object"==typeof r&&!~t.indexOf(r);r=s(r))Object.getOwnPropertyNames(r).forEach((t=>o[t]=()=>e[t]));return o.default=()=>e,i.d(n,o),n},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=524,(()=>{var e={524:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[o,r,c]=s,l=0;if(o.some((t=>0!==e[t]))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(c)var d=c(i)}for(t&&t(s);l<o.length;l++)n=o[l],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},s=globalThis.webpackChunkquicktasker=globalThis.webpackChunkquicktasker||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.nc=void 0;var o=i.O(void 0,[96],(()=>i(9897)));o=i.O(o)})();